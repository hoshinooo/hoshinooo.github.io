<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>网络安全-骨干网与WLAN5</title>
      <link href="/posts/backbone5.html"/>
      <url>/posts/backbone5.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="WLAN简介"><a href="#WLAN简介" class="headerlink" title="WLAN简介"></a>WLAN简介</h2><h3 id="什么是WLAN"><a href="#什么是WLAN" class="headerlink" title="什么是WLAN"></a>什么是WLAN</h3><p><strong>WLAN即Wireless LAN（无线局域网）</strong></p><ul><li>是指通过无线技术构建的无线局域网络</li><li>WLAN广义上是指以无线电波、激光、红外线等无线信号来代替有线局域网中的部分或全部传输介质所构成的网络</li></ul><p><img src="/../img/img_artical/net_sec/7.5.1.png" alt="7.5.1"></p><h3 id="大型WLAN组网的应用"><a href="#大型WLAN组网的应用" class="headerlink" title="大型WLAN组网的应用"></a>大型WLAN组网的应用</h3><p><img src="/../img/img_artical/net_sec/7.5.2.png" alt="7.5.2"></p><h3 id="大型WLAN组网特点"><a href="#大型WLAN组网特点" class="headerlink" title="大型WLAN组网特点"></a>大型WLAN组网特点</h3><p><img src="/../img/img_artical/net_sec/7.5.3.png" alt="7.5.3"></p><h3 id="WLAN设备"><a href="#WLAN设备" class="headerlink" title="WLAN设备"></a>WLAN设备</h3><p><strong>WLAN设备</strong></p><ul><li>AP：Access Point  无线接入点</li><li>PoE：Powerover Ethernet  以太网供电交换机，是指通过以太网网络进行供电，也被称为基于局域网的供电系统PoL（Powerover LAN）或有源以太网，PoE允许电功率通过传输数据的线路或空闲线路传输到终端设备，在WLAN网络中，可以通过PoE交换机对AP设备进行供电</li><li>AC：Access Controller  无线接入控制器，统一配置和管理无线AP的设备</li></ul><p><strong>AP的分类</strong></p><ul><li><p>FAT AP（胖AP）：家用无线路由器</p></li><li><p>FIT AP（瘦AP）：适用于大中型企业：  </p><pre><code>               需要配合AC使用，由AC统一管理和配置，需要专业网络工程师部署和管理。   需要配置 用户接入、AP上线、认证、路由、AP管理、安全协议   主要应用于：大中型 企业、高校、行政单位、酒店、机场、高铁站、购物中心、医院  用做无线覆盖用的无线AP</code></pre></li><li><p>云管理AP：适用于中小型企业：</p><pre><code>        由云管理平台统一管理和配置，功能丰富，即插即用，对网络维护人员的技能要求低。  主要应用于，家庭，餐馆、连锁超市</code></pre></li></ul><h3 id="WAN的分类"><a href="#WAN的分类" class="headerlink" title="WAN的分类"></a>WAN的分类</h3><p><strong>WPAN（Wireless Personal Area Network）：个人无线网络</strong></p><ul><li>蓝牙</li><li>NFC</li></ul><p><strong>WLAN（Wireless Local Area Network）：无线局域网</strong></p><ul><li><p>Wi-Fi</p></li><li><p>Wi-Fi技术：802.11</p><p>目前用的较多的协议标准是：</p><p>802.11n (2.4GHz和5GHz）  </p><p>801.11ac协议，称之为wifi5</p><p>802.11ax协议称之为wifi6—2019年</p></li></ul><p><strong>WWAN（Wireless Wide Area Network）：无线广域网</strong></p><ul><li><p>2G：GSM、CDMA</p></li><li><p>3G：WCDMA、TD-SCDMA</p></li><li><p>4G：LTE</p></li><li><p>5G：NR</p></li><li><p>在移动通信中，”G”是”Generation”的缩写  ：一代  的意思</p><p>- 1G：第一代移动通信，是在20世纪80年代初开始使用的模拟移动电话系统，主要用于语音通信。<br>- 2G：第二代移动通信，采用数字技术，语音质量好、安全性高，能发短信。<br>- 3G：第三代移动通信，数据传输速度快，支持包括互联网访问<br>- 4G：第四代移动通信，数据速度快，延迟低，实现了高质量的视频数据传输和其他高带宽应用。<br>- 5G：第五代移动通信，超高的数据速度（比4G快10到100倍）和超低的延迟，<br>      支持新的应用和服务，如物联网、自动驾驶车辆、虚拟现实等</p></li></ul><h3 id="WLAN设备介绍"><a href="#WLAN设备介绍" class="headerlink" title="WLAN设备介绍"></a>WLAN设备介绍</h3><p><img src="/../img/img_artical/net_sec/7.5.4.png" alt="7.5.4"></p><h3 id="基本的WLAN组网架构"><a href="#基本的WLAN组网架构" class="headerlink" title="基本的WLAN组网架构"></a>基本的WLAN组网架构</h3><p><img src="/../img/img_artical/net_sec/7.5.5.png" alt="7.5.5"></p><h3 id="有线侧组网概念：CAPWAP协议"><a href="#有线侧组网概念：CAPWAP协议" class="headerlink" title="有线侧组网概念：CAPWAP协议"></a>有线侧组网概念：CAPWAP协议</h3><p><strong>CAPWAP隧道</strong></p><ul><li>CAPWAP：无线接入点控制和配置协议</li><li>作用：<ul><li>通过该协议让AC对AP进行管理和配置，即AC通过CAPWAP隧道来实现对AP的集中管理和控制,  配置下发</li><li>CAPWAP是基于UDP进行传输的应用层协议</li><li>CAPWAP协议在传输层运输两种类型的消息：<ul><li>业务数据流量：手机和电脑访问互联网的数据报文，称为业务数据流量，端口为UDP端口5247</li><li>管理流量：AC控制AP的协议的控制报文，称为管理流量，端口为UDP端口5246</li></ul></li></ul></li></ul><p><strong>CAPWAP隧道功能</strong></p><ul><li>AC通过CAPWAP隧道来实现对AP的集中管理，业务配置和控制</li></ul><p><img src="/../img/img_artical/net_sec/7.5.6.png" alt="7.5.6"></p><h3 id="有线侧组网概念：AP-AC组网方式"><a href="#有线侧组网概念：AP-AC组网方式" class="headerlink" title="有线侧组网概念：AP-AC组网方式"></a>有线侧组网概念：AP-AC组网方式</h3><p><strong>AP和AC间的组网分为：二层组网和三层组网</strong></p><p><img src="/../img/img_artical/net_sec/7.5.7.png" alt="7.5.7"></p><h3 id="有线侧组网概念：AC连接方式"><a href="#有线侧组网概念：AC连接方式" class="headerlink" title="有线侧组网概念：AC连接方式"></a>有线侧组网概念：AC连接方式</h3><p><strong>AC的连接方式分为：直连式组网和旁挂式组网</strong></p><p><img src="/../img/img_artical/net_sec/7.5.8.png" alt="7.5.8"></p><h3 id="无线侧组网概念：BSS-SSID-BSSID"><a href="#无线侧组网概念：BSS-SSID-BSSID" class="headerlink" title="无线侧组网概念：BSS&#x2F;SSID&#x2F;BSSID"></a>无线侧组网概念：BSS&#x2F;SSID&#x2F;BSSID</h3><p><strong>基本服务集BSS（Basic Service Set）：</strong></p><ul><li>一个AP所覆盖的范围</li><li>在一个BSS的服务区域内，STA可以相互通信</li><li>为了区分BSS，每个BSS都有唯一的BSSID，用AP的MAC地址来做BSSID，BSSID是MAC地址，特别不容易记忆，用SSID来表示</li></ul><p><strong>基本服务集标识符BSSID（Basic Service Set Identifier）：</strong></p><ul><li>是无线网络的一个身份标识，用AP的MAC地址表示</li></ul><p><strong>服务集标识符SSID（Service Set Identifier）：</strong></p><ul><li>是无线网络的一个身份标识，用字符串表示</li><li>为了便于用户辩护不同的无线网络，用SSID代替BSSID</li></ul><p><img src="/../img/img_artical/net_sec/7.5.9.png" alt="7.5.9"></p><h3 id="无线侧组网概念：VAP"><a href="#无线侧组网概念：VAP" class="headerlink" title="无线侧组网概念：VAP"></a>无线侧组网概念：VAP</h3><p><strong>虚拟接入点VAP（Virtual Access Point）：</strong></p><ul><li>VAP就是一个物理实体AP上虚拟出的多个AP</li><li>每一个被虚拟出的AP就是一个VAP，每个VAP提供和物理实体AP一样的功能</li><li>每个VAP对应一个BSS，这样一个APP，就可以提供多个BSS，设置不同的SSID</li><li>早期的AP只支持1个BSS，如果在同一空间内部部署多个BSS，则需要安放多个AP，这不但增加成本，还占用了信道资源，为了改善这种状况，现在的AP通常支持创建多个虚拟AP</li></ul><h3 id="无线侧组网概念：VLAN-Pool"><a href="#无线侧组网概念：VLAN-Pool" class="headerlink" title="无线侧组网概念：VLAN Pool"></a>无线侧组网概念：VLAN Pool</h3><p><strong>现有网络面临的挑战</strong></p><ul><li><p>在无线网络环境下，使用手机或者平板上网很多，无线网络下，用户移动性增强，可能导致某一个区域IP地址请求较多。</p></li><li><p>通常情况下，一个SSID只能对应一个业务VLAN，通常一个VLAN对应一个C类地址池，只有253个可以分发的IP地址，如果在同一个VLAN内，扩大地址池范围，会导致广播报文增多</p></li><li><p>VLAN Pool：就是VLAN池， 就是把多个VLAN放在一个VLAN池子中</p></li></ul><p><strong>VLAN Pool 的优势</strong></p><ul><li><p>VLAN pool配置为无线用户的业务VLAN，实现一个SSID能够同时支持多个业务VLAN。</p></li><li><p>新接入的用户会被动态地分配到VLAN pool中的各个VLAN中，减少了单个VLAN下的用户数，缩小了广播域；同时每个VLAN尽量均匀地分配IP地址，减少了IP地址的浪费。</p></li></ul><p><strong>VLAN pool分配方式</strong></p><ul><li><p>顺序分配算法：把用户按上线顺序依次划分到不同的VLAN中</p></li><li><p>HASH分配算法：根据用户MAC地址HASH值分配VLAN，华为默认是HASH分配算法</p></li><li><p>配置命令：</p><ul><li><strong>assignment</strong>命令用来配置VLAN pool中的VLAN分配算法</li><li><strong>undo assignment</strong>命令用来恢复VLAN pool中的VLAN分配算法为缺省值</li></ul></li></ul><p><strong>分配VLAN流程</strong></p><ul><li><p>用户终端从VAP接入，判断VAP是否有绑定VLAN Pool</p></li><li><p>如果该VAP模板绑定了VLANPool，使用VLANPool分配一个VLAN</p></li><li><p>给终端分配一个VLAN</p></li><li><p>终端从VLANPool分配的VLAN上线</p></li></ul><h2 id="WLAN工作流程"><a href="#WLAN工作流程" class="headerlink" title="WLAN工作流程"></a>WLAN工作流程</h2><h3 id="WLAN工作流程概述"><a href="#WLAN工作流程概述" class="headerlink" title="WLAN工作流程概述"></a>WLAN工作流程概述</h3><p><strong>WLAN工作流程</strong></p><ul><li>AP上线</li><li>WLAN业务配置下发</li><li>STA接入</li><li>WLAN业务数据转发</li></ul><h3 id="WLAN工作流程：步骤1"><a href="#WLAN工作流程：步骤1" class="headerlink" title="WLAN工作流程：步骤1"></a>WLAN工作流程：步骤1</h3><p><strong>AP上线</strong></p><ul><li>AP获取IP地址</li><li>AP发现AC并与之建立CAPWAP隧道</li><li>AP接入</li></ul><h3 id="AP获取IP地址：DHCP方式"><a href="#AP获取IP地址：DHCP方式" class="headerlink" title="AP获取IP地址：DHCP方式"></a>AP获取IP地址：DHCP方式</h3><p><strong>AP必须获得IP地址才能够与AC通信，WLAN网络才能够正常工作</strong></p><p><img src="/../img/img_artical/net_sec/7.5.10.png" alt="7.5.10"></p><h3 id="CAPWAP隧道建立"><a href="#CAPWAP隧道建立" class="headerlink" title="CAPWAP隧道建立"></a>CAPWAP隧道建立</h3><p><strong>AC通过CAPWAP隧道来实现对AP的集中管理和控制</strong></p><p><img src="/../img/img_artical/net_sec/7.5.11.png" alt="7.5.11"></p><h3 id="AP动态发现AC"><a href="#AP动态发现AC" class="headerlink" title="AP动态发现AC"></a>AP动态发现AC</h3><p><strong>DHCP报文中携带Option 43</strong></p><ul><li>在DHCP服务器上配置DHCP报文中携带Option 43，且Option 43携带AC的IP地址</li></ul><p><img src="/../img/img_artical/net_sec/7.5.12.png" alt="7.5.12"></p><h3 id="建立CAPWAP隧道"><a href="#建立CAPWAP隧道" class="headerlink" title="建立CAPWAP隧道"></a>建立CAPWAP隧道</h3><p><strong>AP与AC关联，完成CAPWAP隧道建立</strong></p><p><strong>CAPWAP隧道包括数据隧道和控制隧道</strong></p><ul><li>数据隧道：AP的业务报文（数据流量）</li><li>控制隧道：AP与AC之间的控制报文（管理流量）</li></ul><p><img src="/../img/img_artical/net_sec/7.5.13.png" alt="7.5.13"></p><h3 id="AP接入"><a href="#AP接入" class="headerlink" title="AP接入"></a>AP接入</h3><p><strong>AC上添加AP的方式</strong></p><ul><li>离线导入AP：预先配置AP的MAC地址，当AP与AC连接时，如果AC发现AP和预先增加的AP的MAC地址匹配，则AC开始与AP建立连接</li></ul><h3 id="为确保AP上线，AC需配置内容"><a href="#为确保AP上线，AC需配置内容" class="headerlink" title="为确保AP上线，AC需配置内容"></a>为确保AP上线，AC需配置内容</h3><p><img src="/../img/img_artical/net_sec/7.5.14.png" alt="7.5.14"></p><h3 id="WLAN业务下发"><a href="#WLAN业务下发" class="headerlink" title="WLAN业务下发"></a>WLAN业务下发</h3><p><strong>AP上线后，首先会主动向AC获取当前配置，而后统一由AC对AP进行集中管理和业务配置下发</strong></p><p><img src="/../img/img_artical/net_sec/7.5.15.png" alt="7.5.15"></p><h3 id="配置模板"><a href="#配置模板" class="headerlink" title="配置模板"></a>配置模板</h3><p><strong>为了方便用户配置和维护WLAN的各个功能，针对WLAN的不同功能和特性设计了各种类型的模板，这些模板统称为WLAN模板</strong></p><p><img src="/../img/img_artical/net_sec/7.5.16.png" alt="7.5.16"></p><h3 id="VAP模板"><a href="#VAP模板" class="headerlink" title="VAP模板"></a>VAP模板</h3><p><img src="/../img/img_artical/net_sec/7.5.17.png" alt="7.5.17"></p><h3 id="无线接入安全协议"><a href="#无线接入安全协议" class="headerlink" title="无线接入安全协议"></a>无线接入安全协议</h3><p><strong>安全性称为阻碍WLAN技术发展的最重要因素</strong></p><p><strong>常用安全策略</strong></p><p><img src="/../img/img_artical/net_sec/7.5.18.png" alt="7.5.18"></p><h3 id="STA地址分配"><a href="#STA地址分配" class="headerlink" title="STA地址分配"></a>STA地址分配</h3><p><strong>STA获取到自身的IP地址，是STA正常上线的前提条件</strong></p><p><img src="/../img/img_artical/net_sec/7.5.19.png" alt="7.5.19"></p><h3 id="数据转发方式"><a href="#数据转发方式" class="headerlink" title="数据转发方式"></a>数据转发方式</h3><p><img src="/../img/img_artical/net_sec/7.5.20.png" alt="7.5.20"></p><h2 id="AP上线配置"><a href="#AP上线配置" class="headerlink" title="AP上线配置"></a>AP上线配置</h2><h3 id="AP上线"><a href="#AP上线" class="headerlink" title="AP上线"></a>AP上线</h3><p><img src="/../img/img_artical/net_sec/7.5.21.png" alt="7.5.21"></p><h3 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h3><ul><li>无线控制器（AC）连接在核心交换机SW2上，属于VLAN200</li><li>AP连接在汇聚层交换机SW1上，AP的管理IP地址属于VLAN100</li><li>企业内网中存在4个VLAN，分别服务于老师和学生</li><li>AP的网关以及所有无线用户的终端的网关，都配置在核心交换机SW2</li><li>AP和无线用户终端的IP地址都是通过DHCP的方式获得</li><li>最终确保连接到不同AP的无线终端之间可以互通</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>AP上线</strong></p><ul><li>让AP可以通过DHCP获取IP地址</li><li>在AC和AP之间建立capwap隧道</li><li>AP接入</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>第一步：AP上线</strong></p><ul><li>让AP可以通过DHCP获取IP地址</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.汇聚交换机创建VLAN，配置端口角色</span></span><br><span class="line"><span class="attr">[HJ-SW1]vlan</span> <span class="string">batch 100 200 210</span></span><br><span class="line"><span class="attr">[HJ-SW1]port-group</span> <span class="string">group-member g0/0/1 to g0/0/5</span></span><br><span class="line"><span class="attr">[HJ-SW1-port-group]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[HJ-SW1-port-group]port</span> <span class="string">trunk allow-pass vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.核心交换机创建VLAN,配置端口角色</span></span><br><span class="line"><span class="attr">[HX-SW2]vlan</span> <span class="string">batch 100 200 210</span></span><br><span class="line"><span class="attr">[HX-SW2]interface</span> <span class="string">g0/0/2</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/2]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/2]port</span> <span class="string">trunk allow-pass vlan all</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/2]interface</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/1]port</span> <span class="string">default vlan 210</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/1]interface</span> <span class="string">g0/0/10</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/10]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/10]port</span> <span class="string">default vlan 200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.DHCP-R1配置DHCP功能，配置IP地址池</span></span><br><span class="line"><span class="attr">[DHCP-R1]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">pool vlan100</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]network</span> <span class="string">192.168.100.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]gateway-list</span> <span class="string">192.168.100.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1]interface</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[DHCP-R1-G0/0/0]ip</span> <span class="string">address 192.168.210.1 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-G0/0/0]dhcp</span> <span class="string">select global</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.核心交换机SW2配置VLANIF网关地址</span></span><br><span class="line"><span class="attr">[HX-SW2]interface</span> <span class="string">vlanif 100</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]ip</span> <span class="string">address 192.168.100.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]interface</span> <span class="string">vlanif 200</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif200]ip</span> <span class="string">address 192.168.200.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif200]interface</span> <span class="string">vlanif 210</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif210]ip</span> <span class="string">address 192.168.210.254 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">5.核心交换机SW2配置DHCP中继</span></span><br><span class="line"><span class="attr">[HX-SW2]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[HX-SW2]interface</span> <span class="string">vlanif 100</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.在HJ-SW1中修改g0/0/2</span> <span class="string">- g0/0/5的pvid为vlan100</span></span><br><span class="line"><span class="attr">[HJ-SW1]port-group</span> <span class="string">group-member g0/0/2 to g0/0/5</span></span><br><span class="line"><span class="attr">[HJ-SW1-port-group]port</span> <span class="string">trunk pvid vlan 100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">7.DHCP-R1配置去往中继的回程路由</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">route-static 0.0.0.0 0 192.168.210.254</span></span><br></pre></td></tr></table></figure><ul><li>在AC和AP之间建立CAPWAP隧道</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.在AC中创建vlan200并且把g0/0/10加入vlan200，改为access</span></span><br><span class="line"><span class="attr">[AC6605]vlan</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[AC6605-vlan200]quit</span></span><br><span class="line"><span class="attr">[AC6605]interface</span> <span class="string">g0/0/10</span></span><br><span class="line"><span class="attr">[AC6605-G0/0/10]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[AC6605-G0/0/10]port</span> <span class="string">default vlan 200</span></span><br><span class="line"><span class="attr">[AC6605-G0/0/10]interface</span> <span class="string">vlanif 200</span></span><br><span class="line"><span class="attr">[AC6605-vlanif200]ip</span> <span class="string">address 192.168.200.10 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.在AC中配置默认路由，能够实现和AP互联互通</span></span><br><span class="line"><span class="attr">[AC6605]ip</span> <span class="string">route-static 0.0.0.0 0 192.168.200.254</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.在DHCP服务中配置dhcp</span> <span class="string">option 43：让AP知道AC的管理地址</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">pool vlan100</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]option</span> <span class="string">43 sub-option 1 ip-address 192.168.200.10</span></span><br><span class="line"><span class="attr">备注：修改完option43后记得重启所有AP</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.在AC中配置capwap隧道</span></span><br><span class="line"><span class="attr">[AC6605]capwap</span> <span class="string">source ip-address 192.168.200.10</span></span><br></pre></td></tr></table></figure><ul><li>AP接入</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.在AP上查询MAC地址</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;display</span>  <span class="string">system-information</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address :  00:e0:fc:c3:76:60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.在AC中填入AP的MAC地址</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">1 ap-mac 00e0-fcc3-7660</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]quit</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">2 ap-mac 00e0-fc8b-0150</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]quit</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">3 ap-mac 00e0-fc1b-4300</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]quit</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">4 ap-mac 00e0-fc7e-39c0</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]quit</span></span><br></pre></td></tr></table></figure><h2 id="WLAN业务配置下发"><a href="#WLAN业务配置下发" class="headerlink" title="WLAN业务配置下发"></a>WLAN业务配置下发</h2><h3 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求"></a>案例需求</h3><ul><li>企业内网的无线网络改造已经完成大部分工作，AP成功注册到AC</li><li>基于分配好的IP方案，为不同的无线终端，动态分配IP地址</li><li>配置AC，为不同的AP下发不同的配置，确保可以发射无线信号</li><li>实现不同的“无线终端”可以成功连接AP，并成功获得IP地址</li><li>实现不同的“无线终端”之间的互通</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>第一步：AC下发WLAN配置给AP</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.创建域管理模板-绑定国家码</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]regulatory-domain-profile</span> <span class="string">name ntd     //创建域管理模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-regulate-domain-ntd]country-code</span> <span class="string">cn         //定义国家码</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.绑定域管理模板</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name bangong    //创建AP组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]regulatory-domain-profile</span> <span class="string">ntd</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-xuexi]regulatory-domain-profile</span> <span class="string">ntd</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-xuexi]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.在AP组里添加AP设备</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">1           //配置1号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]ap-name</span> <span class="string">bangong1  //修改ap-name为bangong1</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]ap-group</span> <span class="string">bangong  //把ap1加入bangong组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">2           //配置2号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]ap-name</span> <span class="string">bangong2  //修改ap-name为bangong2</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]ap-group</span> <span class="string">bangong  //把ap2加入bangong组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">3           //配置3号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]ap-name</span> <span class="string">xuexi1    //修改ap-name为xuexi1</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]ap-group</span> <span class="string">xuexi    //把ap3加入xuexi组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">4           //配置4号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]ap-name</span> <span class="string">xuexi2    //修改ap-name为xuexi2</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]ap-group</span> <span class="string">xuexi    //把ap4加入xuexi组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.验证</span></span><br><span class="line"><span class="attr">[AC6605]display</span> <span class="string">ap-group all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">5.创建SSID模板-定义无线网名</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span>                                   <span class="string">//进入wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ssid-profile</span> <span class="string">name bangong    //创建SSID模板，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ssid-prof-bangong]ssid</span> <span class="string">bangong    //定义无线网的名字，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ssid-prof-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ssid-profile</span> <span class="string">name xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ssid-prof-xuexi]ssid</span> <span class="string">xuexi</span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.创建安全模板-定义无线网安全策略预共享密钥，加密方式</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]security-profile</span> <span class="string">name bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-sec-prof-bangong]security</span> <span class="string">wpa-wpa2 psk pass-phrase a12345678 aes</span></span><br><span class="line"><span class="attr">[AC6605-wlan-sec-prof-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]security-profile</span> <span class="string">name xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-sec-prof-xuexi]security</span> <span class="string">wpa-wpa2 psk pass-phrase a12345678 aes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">7.创建VLAN池-绑定多个VLAN</span>:<span class="string">给STA(电脑和手机)用的VLAN</span></span><br><span class="line"><span class="attr">[AC6605]vlan</span> <span class="string">pool bangong                  //创建vlan池，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-vlan-pool-bangong]vlan</span> <span class="string">101 102     //向vlan池添加vlan101和vlan102</span></span><br><span class="line"><span class="attr">[AC6605-vlan-pool-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605]vlan</span> <span class="string">pool xuexi</span></span><br><span class="line"><span class="attr">[AC6605-vlan-pool-xuexi]vlan</span> <span class="string">103 104</span></span><br><span class="line"></span><br><span class="line"><span class="attr">8.创建VAP模板--绑定VLAN池子，绑定SSID配置文件，绑定安全配置文件</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]vap-profile</span> <span class="string">name bangong                    //创建vap模板，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]ssid-profile</span> <span class="string">bangong            //绑定ssid模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]security-profile</span> <span class="string">bangong        //绑定安全模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]service-vlan</span> <span class="string">vlan-pool bangong  //绑定vlan池</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]vap-profile</span> <span class="string">name xuexi                    //创建vap模板，命名为xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]ssid-profile</span> <span class="string">xuexi              //绑定ssid模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]security-profile</span> <span class="string">xuexi          //绑定安全模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]service-vlan</span> <span class="string">vlan-pool xuexi    //绑定vlan池</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">9.将VAP配置文件绑定到AP组，把配置下发给AP组的物理设备</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name bangong    //进入AP组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 0</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 1</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name bangong    //进入AP组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 0</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">10.在HJ-SW1中创建vlan</span> <span class="string">101 102 103 104</span></span><br><span class="line"><span class="attr">[HJ-SW1]vlan</span> <span class="string">batch 101 102 103 104</span></span><br><span class="line"></span><br><span class="line"><span class="attr">11.在HX-SW2中创建vlan</span> <span class="string">101 102 103 104</span></span><br><span class="line"><span class="attr">[HX-SW2]vlan</span> <span class="string">batch 101 102 103 104</span></span><br><span class="line"></span><br><span class="line"><span class="attr">12.DHCP-R1配置DHCP功能，创建地址池</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">pool vlan101</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]network</span> <span class="string">192.168.101.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]gateway-list</span> <span class="string">192.168.101.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]ip</span> <span class="string">pool vlan102</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]network</span> <span class="string">192.168.102.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]gateway-list</span> <span class="string">192.168.102.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]ip</span> <span class="string">pool vlan103</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]network</span> <span class="string">192.168.103.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]gateway-list</span> <span class="string">192.168.103.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]ip</span> <span class="string">pool vlan104</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan104]network</span> <span class="string">192.168.104.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan104]gateway-list</span> <span class="string">192.168.104.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan104]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">13.核心交换机SW2配置网关地址</span></span><br><span class="line"><span class="attr">[HX-SW2]int</span> <span class="string">vlanif 101</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]ip</span> <span class="string">address 192.168.101.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]int</span> <span class="string">vlanif 102</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]ip</span> <span class="string">address 192.168.102.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]int</span> <span class="string">vlanif 103</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]ip</span> <span class="string">address 192.168.103.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]int</span> <span class="string">vlanif 104</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif104]ip</span> <span class="string">address 192.168.104.254 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">14.核心交换机SW2配置DHCP中继</span></span><br><span class="line"><span class="attr">[HX-SW2]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[HX-SW2]int</span> <span class="string">vlanif 101</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]int</span> <span class="string">vlanif 102</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]int</span> <span class="string">vlanif 103</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]int</span> <span class="string">vlanif 104</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif104]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif104]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br></pre></td></tr></table></figure><h2 id="STA接入"><a href="#STA接入" class="headerlink" title="STA接入"></a>STA接入</h2><h3 id="STA接入-1"><a href="#STA接入-1" class="headerlink" title="STA接入"></a>STA接入</h3><p><strong>STA接入</strong></p><ul><li>CAPWAP隧道建立完成后，用户就可以接入无线网络</li><li>STA可以通过主动扫描，定期搜索周围的无线网络，获取到周围的无线网络信息</li><li>为了保证无线链路的安全，接入过程中AP需要完成对STA的认证</li><li>对数据报文还需要使用加密的方式来保证数据安全</li><li>STA获取到自身的IP地址，是STA正常上线的前提条件</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN4</title>
      <link href="/posts/backbone4.html"/>
      <url>/posts/backbone4.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="IPv6概述"><a href="#IPv6概述" class="headerlink" title="IPv6概述"></a>IPv6概述</h2><h3 id="IPv4现状"><a href="#IPv4现状" class="headerlink" title="IPv4现状"></a>IPv4现状</h3><p><strong>Ipv4现状</strong></p><ul><li>IPv4地址不足，在NAT技术加持下，依然无法支撑全球使用</li><li>2011年2月3日，最后的468万个IPv4地址平均分配到全球5个RIR，此后IANA再没有可分配的IPv4地址</li><li>2019年11月25日IPv4地址分配完毕</li></ul><p><img src="/../img/img_artical/net_sec/7.4.1.png" alt="7.4.1"></p><h3 id="全球IPv6发展现状"><a href="#全球IPv6发展现状" class="headerlink" title="全球IPv6发展现状"></a>全球IPv6发展现状</h3><p><img src="/../img/img_artical/net_sec/7.4.2.png" alt="7.4.2"></p><h3 id="Why-IPv6？"><a href="#Why-IPv6？" class="headerlink" title="Why IPv6？"></a>Why IPv6？</h3><p><img src="/../img/img_artical/net_sec/7.4.3.png" alt="7.4.3"></p><h2 id="IPv6报文结构"><a href="#IPv6报文结构" class="headerlink" title="IPv6报文结构"></a>IPv6报文结构</h2><h3 id="IPv6报文一般由三个部分组成"><a href="#IPv6报文一般由三个部分组成" class="headerlink" title="IPv6报文一般由三个部分组成"></a>IPv6报文一般由三个部分组成</h3><ul><li>基本报头：路由器通过解析基本报头就能完成绝大多数的报文转发任务</li><li>扩展报文：提供一些扩展的报文转发信息，如分段、加密等，该部分不是必须的</li><li>上层数据协议单元：一般由上层协议报头和它的有效载荷组成，该部分与IPv4的上层协议数据单元相似</li></ul><p><img src="/../img/img_artical/net_sec/7.4.4.png" alt="7.4.4"></p><h3 id="IPv6基本报头"><a href="#IPv6基本报头" class="headerlink" title="IPv6基本报头"></a>IPv6基本报头</h3><p><strong>IPv6头部相较于IPv4的改进</strong></p><p><img src="/../img/img_artical/net_sec/7.4.5.png" alt="7.4.5"></p><p><strong>IPv6基本报头解析</strong></p><ul><li>IPv6基本报头也称之为固定报头。固定报头包含8个字段，总长度为40个字节</li><li>这8个字段分别为：<ul><li>版本（Version）：该字段规定了IP协议的版本，值为6。长度为4bit</li><li>流量类型（Traffic Class）：该字段功能和IPv4中的服务类型功能类似，表示IPv6数据报文的类或优先级。长度为8bit</li><li>流标签（Flow Label）：与IPv4相比，该字段是新增的，该字段长度为20bit。可以通过源IPv6地址+流标签来唯一确定一条数据流，也可以通过目的IPv6地址+流标签来唯一确定一条数据流</li><li>载荷长度（Payload Length）：该字段表示IPv6数据报有效载荷的长度，有效载荷是指紧跟IPv6报头的数据报的其它部分（即扩展报头），该字段长度为16bit，能表示最大长度为65535Byte的有效载荷</li><li>下一个报头（Next Header）：8bit,类似IPv4中的协议字段，主要为表示上层协议数据单元中的协议类型</li><li>跳数限制（Hop Limit）：8bit, 类似于IPv4中的TTL字段，主要是定义数据包经过的最大跳数，每经过一台设备，该值减1，该值为0时，数据包会被丢弃</li><li>源IPv6地址：128bit，发送方地址</li><li>目的IPv6地址：128bit，接收方地址</li></ul></li></ul><h2 id="IPv6地址分类"><a href="#IPv6地址分类" class="headerlink" title="IPv6地址分类"></a>IPv6地址分类</h2><h3 id="IPv6地址"><a href="#IPv6地址" class="headerlink" title="IPv6地址"></a>IPv6地址</h3><p><strong>IPv6地址</strong></p><ul><li>IPv6地址的长度为128bit，一般用冒号分割为8段，每一段16bit，每一段内用十六进制表示</li><li>与IPv4地址类似，IPv6也用“IPv6地址&#x2F;掩码长度”的方式来表示IPv6地址</li><li>IPv6地址中的字母大小不敏感，例如A等同于a</li><li>IPv6地址：2001:0DB8:2345:CD30:1230:4567:89AB:CDEF&#x2F;64</li></ul><p><img src="/../img/img_artical/net_sec/7.4.6.png" alt="7.4.6"></p><h3 id="IPv6地址空间"><a href="#IPv6地址空间" class="headerlink" title="IPv6地址空间"></a>IPv6地址空间</h3><p><strong>IPv6的128bit地址是一个什么概念？</strong></p><ul><li>IPv4有(2的32次方) &#x3D; 4,294,967,296个地址</li><li>IPv6有(2的128次方 &#x3D;2的96次方x2的32次方) &#x3D;340,282,366,920,938,463,463,374,607,431,768,211,456个地址(340万亿万亿万亿个地址)，相当于地球表面每平方米可以分配到67万亿个地址</li><li>夸张的说，地球上每一粒沙子都可以分配到一个IPv6地址</li></ul><h3 id="IPv6地址格式"><a href="#IPv6地址格式" class="headerlink" title="IPv6地址格式"></a>IPv6地址格式</h3><p><img src="/../img/img_artical/net_sec/7.4.7.png" alt="7.4.7"></p><h3 id="IPv6地址结构"><a href="#IPv6地址结构" class="headerlink" title="IPv6地址结构"></a>IPv6地址结构</h3><p><strong>一个IPv6地址可以分为如下两部分</strong></p><ul><li>网络前缀：nbit，相当于IPv4地址中的网络ID</li><li>接口标识：(128-n) bit，相当于IPv4地址中的主机ID</li></ul><p><strong>IPv6单播地址示例:2001:0DB8:6101:0001:5ED9:98FE:FECA:A298&#x2F;64</strong></p><p><img src="/../img/img_artical/net_sec/7.4.8.png" alt="7.4.8"></p><h3 id="IPv6地址前缀"><a href="#IPv6地址前缀" class="headerlink" title="IPv6地址前缀"></a>IPv6地址前缀</h3><p><strong>常用的IPv6地址或前缀有：</strong></p><table><thead><tr><th align="left">IPv6地址或前缀</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">2001::&#x2F;16</td><td align="left">用于IPv6 Internet，类似于IPv4公网地址</td></tr><tr><td align="left">2002::&#x2F;16</td><td align="left">用于6to4隧道</td></tr><tr><td align="left">FE80::&#x2F;10</td><td align="left">链路本地地址前缀，用于本地链路范围内的通信</td></tr><tr><td align="left">FF00::&#x2F;8</td><td align="left">组播地址前缀，用于IPv6组播</td></tr><tr><td align="left">::&#x2F;128</td><td align="left">未指定地址，类似于IPv4中的0.0.0.0</td></tr><tr><td align="left">::1&#x2F;128</td><td align="left">环回地址，类似于IPv4中的127.0.0.1</td></tr></tbody></table><h3 id="IPv6地址类型"><a href="#IPv6地址类型" class="headerlink" title="IPv6地址类型"></a>IPv6地址类型</h3><p><strong>IPv6地址分类</strong></p><p><img src="/../img/img_artical/net_sec/7.4.9.png" alt="7.4.9"></p><p><strong>单播地址（Unicast Address）</strong></p><ul><li>标识一个接口，目的地址为单播地址的报文会被送到被标识的接口</li><li>在IPv6中，一个接口拥有多个IPv6地址是非常常见的现象</li></ul><p><strong>组播地址（Multicast Address）</strong></p><ul><li><p>标识多个接口，目的地址为组播地址的报文会被送到被标识的所有接口</p></li><li><p>只有加入相应组播组的设备接口才会侦听发往该组播地址的报文</p></li></ul><p><strong>任播地址（Anycast Address）</strong></p><ul><li>任播地址标识一组网络接口 (通常属于不同的节点)</li><li>目标地址是任播地址的数据包将发送给其中路由意义上最近的一个网络接口</li></ul><p><strong>IPv6没有定义广播地址（BroadcastAddress）</strong></p><h3 id="IPv6地址和IPv4地址比较"><a href="#IPv6地址和IPv4地址比较" class="headerlink" title="IPv6地址和IPv4地址比较"></a>IPv6地址和IPv4地址比较</h3><table><thead><tr><th align="left"></th><th align="left">IPv4</th><th align="left">IPv6</th></tr></thead><tbody><tr><td align="left">地址空间</td><td align="left">2^32</td><td align="left">2^128</td></tr><tr><td align="left">表示方式</td><td align="left">点分十进制</td><td align="left">冒号隔开的十六进制</td></tr><tr><td align="left">地址类型</td><td align="left">单播、组播、广播</td><td align="left">单播、组播、任播</td></tr><tr><td align="left">其它</td><td align="left">A、B、C等主类地址</td><td align="left">IPv6中无此概念</td></tr><tr><td align="left"></td><td align="left">组播地址 (224.0.0.0&#x2F;4)</td><td align="left">IPv6组播地址 (FFO0::&#x2F;8)</td></tr><tr><td align="left"></td><td align="left">广播地址</td><td align="left">IPv6中无此概念</td></tr><tr><td align="left"></td><td align="left">未指定的地址0.0.0.0&#x2F;32</td><td align="left">未指定的地址::&#x2F;128</td></tr><tr><td align="left"></td><td align="left">环回地址127.0.0.0&#x2F;8</td><td align="left">环回地址是::1&#x2F;128</td></tr><tr><td align="left"></td><td align="left">公网IP地址</td><td align="left">全球单播地址</td></tr><tr><td align="left"></td><td align="left">私网IP地址(10.0.0.0&#x2F;8，172.16.0.0&#x2F;12以及192.168.0.0&#x2F;16)</td><td align="left">唯一本地地址 (FD00::&#x2F;8)</td></tr><tr><td align="left"></td><td align="left">APIPA地址(169.254.0.0&#x2F;16)</td><td align="left">链路本地地址(FE80::&#x2F;10)</td></tr></tbody></table><h2 id="IPv6基本配置"><a href="#IPv6基本配置" class="headerlink" title="IPv6基本配置"></a>IPv6基本配置</h2><h3 id="IPv6基本配置-1"><a href="#IPv6基本配置-1" class="headerlink" title="IPv6基本配置"></a>IPv6基本配置</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span></span><br><span class="line"><span class="attr">[Huawei]ipv6</span>                               <span class="string">//开启IPv6报文转发功能</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">G0/0/0</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/0]ipv6</span> <span class="string">enable                 //启动接口的IPv6功能</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/0]ipv6</span> <span class="string">address 2001:12::1 64  //配置IPv6地址</span></span><br></pre></td></tr></table></figure><h2 id="IPv6静态路由实验"><a href="#IPv6静态路由实验" class="headerlink" title="IPv6静态路由实验"></a>IPv6静态路由实验</h2><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]ipv6</span> <span class="string">route-static 2001:2:: 64 2001:12::1</span></span><br></pre></td></tr></table></figure><h2 id="IPv4-IPv6双栈"><a href="#IPv4-IPv6双栈" class="headerlink" title="IPv4&amp;IPv6双栈"></a>IPv4&amp;IPv6双栈</h2><h3 id="OSPFv3配置命令"><a href="#OSPFv3配置命令" class="headerlink" title="OSPFv3配置命令"></a>OSPFv3配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospfv3</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[R1-ospfv3-1]routerid</span> <span class="string">1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospfv3-1]quit</span></span><br><span class="line"><span class="attr">[R1]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ospfv3</span> <span class="string">1 area 12         //进入接口配置OSPFv3</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]intg0/0/0</span></span><br><span class="line"><span class="attr">[R1-G0/0/0]ospfv3</span> <span class="string">1 area 12</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN3</title>
      <link href="/posts/backbone3.html"/>
      <url>/posts/backbone3.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="BGP路径属性"><a href="#BGP路径属性" class="headerlink" title="BGP路径属性"></a>BGP路径属性</h2><h3 id="BGP路径属性-1"><a href="#BGP路径属性-1" class="headerlink" title="BGP路径属性"></a>BGP路径属性</h3><p><strong>路径属性</strong></p><ul><li>任何一条BGP路由都拥有多个路径属性</li><li>当路由器将BGP路由通告给邻居时，会携带路径属性</li><li>BGP的路径属性将影响路由优选</li></ul><h3 id="路径属性分类"><a href="#路径属性分类" class="headerlink" title="路径属性分类"></a>路径属性分类</h3><p><strong>公认属性是所有BGP路由器都必须能够识别的属性</strong></p><ul><li><p>公认必遵：</p><ul><li><p>所有BGP设备都要认识这一类属性</p></li><li><p>必须包含在每个Update消息里</p></li><li><p>如果缺少这类属性，update报文不完整， 路由信息会出现错误</p></li><li><p>–Origin属性：起源属性，路由是通过network 注入的，还是通过import 注入的</p><p>–AS_path属性：这条路由是从哪里来的，从哪个AS号来的，经过了哪个AS号，</p><p>–Next_Hop：定义路由的下一跳信息</p></li></ul></li><li><p>公认任意：</p><ul><li>所有BGP设备认识此类属性</li><li>可能包括在某些Update消息里</li><li>如果缺少这类属性，路由信息不会出现错误</li><li>Local_Pref属性</li></ul></li></ul><p><strong>可选属性不需要都被BGP路由器所识别</strong></p><ul><li><p>可选过渡：</p><ul><li>BGP设备可以不识别此类属性，而且依然会接受该类属性并通告给其他对等体</li><li>Community：团体属性</li></ul></li><li><p>可选非过渡：</p><ul><li>BGP设备不识别此类属性会忽略该属性，且不会通告给其他对等体</li><li>MED属性</li></ul></li></ul><h3 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h3><p><strong>常用属性</strong></p><ul><li>Next_hop：下一跳属性</li><li>Local_Preference：本地优先级属性</li><li>AS_Path：路径属性</li><li>Origin：起源属性</li><li>MED：开销属性</li></ul><h3 id="BGP选路规则"><a href="#BGP选路规则" class="headerlink" title="BGP选路规则"></a>BGP选路规则</h3><p><strong>BGP选路原则：根据BGP属性来的，所以要先了解属性，在判断路由优选原则</strong></p><ul><li><p>(第一个)：丢弃下一跳不可达的路由</p><ul><li>这不是BGP选路原则（至少华为不是这么认为的），因为在任何路由协议中，我们都会认为下一跳不可达的路由是无效的</li></ul></li><li><p>1、比较”协议首选值-pref-val”属性，数值越大越好，默认值是0，只在本设备生效，不在网络中传递</p></li><li><p>2、比较”本地优先级-local_pref”属性，数值越大越好，默认值是100</p></li><li><p>3、比较：是本地始发的路由，还是从对等体学来的路由， 本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合 &gt; 自动聚合 &gt; network &gt; import &gt; 从对等体学到的</p></li><li><p>4、比较”as-path” 属性-as号越短越好</p></li><li><p>5、比较”起源属性”-指的是以什么方式注入进BGP协议的</p></li><li><p>6、比较”MED”属性，指的是一个路由器去往一个BGP路由网段的距离，类似cost</p></li><li><p>7、比较EBGP邻居优先于IBGP邻居，EBGP路由优先级高于IBGP路由</p></li><li><p>8、比较”去往BGP路由的下一跳IP地址”的cost开销值-越小越好</p><ul><li><p>如果前面8条选路规则无法选出最优的路由，我们就可以做负载均衡了</p><p>  备注：AS号一致，  在要负载均衡的那台设备上开启负载均衡功能</p></li></ul></li><li><p>9、比较”cluster-list”的长度，越短越好</p></li><li><p>10、比较Router ID（Orginator_ID）的大小，越小越好</p></li><li><p>11、比较”peer 后面的IP地址的大小”，越小越好</p></li></ul><h2 id="路由优选之Pre-val"><a href="#路由优选之Pre-val" class="headerlink" title="路由优选之Pre_val"></a>路由优选之Pre_val</h2><h3 id="Preferred-Value"><a href="#Preferred-Value" class="headerlink" title="Preferred_Value"></a>Preferred_Value</h3><ul><li>默认值0，数值越大越优先</li><li>华为特定的私有属性</li><li>只在本设备有效，不在网络中随路由传递</li></ul><h3 id="地址前缀列表"><a href="#地址前缀列表" class="headerlink" title="地址前缀列表"></a>地址前缀列表</h3><p><strong>地址前缀列表：ip-prefix</strong></p><ul><li>作用：专门做路由过滤的，不能过滤数据包</li><li>特点：匹配路由精准，既可以匹配前缀，又可以匹配掩码</li><li>配置：ip prefix 名字 动作 前缀 掩码</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10        //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd     //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">preferred-value 123  //协议首选值为123</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略，因为协议首选值这个属性，只在我的本机起作用，不能在在网络中传递</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之Next-hop"><a href="#路由优选之Next-hop" class="headerlink" title="路由优选之Next_hop"></a>路由优选之Next_hop</h2><h3 id="Next-hop"><a href="#Next-hop" class="headerlink" title="Next_hop"></a>Next_hop</h3><p><strong>BGP路由中的Next_hop属性设置规则</strong></p><ul><li>BGP路由器在向EBGP邻居发布路由时，会把该路由的下一跳设置为本地与对端建立BGP邻居关系的接口地址</li><li>BGP路由器将本地始发路由发布给IBGP邻居时，会把该路由的下一跳设置为本地与对端建立BGP邻居关系的接口地址</li><li>路由器在接收到EBGP邻居发布的路由后，在将路由传递给自己的IBGP邻居时，默认不修改路由的下一跳地址</li><li>下一跳不可达的路由会被丢弃</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer10.10.1.1next-hop-local</span>   <span class="string">//修改下一跳地址为本地地址，即自己转发路由出去的接口地址</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之Local-pref"><a href="#路由优选之Local-pref" class="headerlink" title="路由优选之Local_pref"></a>路由优选之Local_pref</h2><h3 id="本地优先级"><a href="#本地优先级" class="headerlink" title="本地优先级"></a>本地优先级</h3><p><strong>Local_preference属性</strong></p><ul><li>本地优先级属性，默认是100，数值越大越优先</li><li>该属性能再AS内部任意传递（IBGP邻居之间传递）</li><li>该属性不能再AS之间传递（EBGP邻居之间不携带该属性）</li><li>在AS的IBGP邻居之间，出方向和入方向都可以修改该属性</li></ul><h3 id="配置命令-2"><a href="#配置命令-2" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10        //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd     //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">local-preference 200 //本地优先级为200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之AS-Path"><a href="#路由优选之AS-Path" class="headerlink" title="路由优选之AS_Path"></a>路由优选之AS_Path</h2><h3 id="AS-Path"><a href="#AS-Path" class="headerlink" title="AS_Path"></a>AS_Path</h3><p><strong>AS_Path</strong></p><ul><li>AS_Path属性按顺序记录一条路由从源地址到目的地址所经过的AS编号</li><li>AS_Path属性为公认必遵属性，任何一个BGP路由，都必须携带这个属性</li><li>AS_Path属性能防止EBGP邻居之间的环路，还可以做路由优选</li><li>路由在被通告给EBGP邻居时，路由器会在该路由的AS_Path中写上本地的AS号；路由被通告给IBGP对等体时，AS_Path不会发生改变</li><li>最右侧的为起源AS号，最左侧的为邻居的AS号：AS-path属性</li><li>AS号越短越优先（经过的AS号越少越优先）</li></ul><h3 id="配置命令-3"><a href="#配置命令-3" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10             //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd          //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">as-path 200 200 additive  //AS_PATH为200 200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure><p><strong>备注：</strong></p><ul><li>为什么添加的as号都为200呢，是只能添加200吗？  不是，可以添加任意值的as号</li><li>之所以都添加200，不添加其他AS号，仅仅是为了预防，因为AS_Path防止环路而导致路由无法传递</li><li>比如：如果我们添加了AS_path 500  ,如果我们要把路由传递给AS500的自制系统，就无法传递了</li><li>我们不清楚我们的前方会出现哪些AS号，所以我们尽量不要占用其他的AS号</li></ul><h2 id="路由优选之Origin"><a href="#路由优选之Origin" class="headerlink" title="路由优选之Origin"></a>路由优选之Origin</h2><h3 id="Origin"><a href="#Origin" class="headerlink" title="Origin"></a>Origin</h3><p><strong>Origin</strong></p><ul><li>Origin : i - IGP, e - EGP, ? - incomplete  （优先级）</li><li>IGP：优先级高，通过network命令注入到BGP路由表的路由，其Origin属性为 i</li><li>EGP : 次优的，Origin属性为  e</li><li>Incomplete：优先级低，如：通过import-route注入的路由，其Origin属性为  ?</li></ul><h3 id="配置命令-4"><a href="#配置命令-4" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10             //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd          //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">origin incomplete         //修改origin为Incomplete</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之MED"><a href="#路由优选之MED" class="headerlink" title="路由优选之MED"></a>路由优选之MED</h2><h3 id="MED"><a href="#MED" class="headerlink" title="MED"></a>MED</h3><p><strong>MED</strong></p><ul><li>多出口鉴别器，是可选非过渡属性，是一种度量值</li><li>MED默认值是0，值越小越优先</li><li>作用两个AS之间，收到MED属性的AS，默认不将这个属性通告给第三方AS</li></ul><h3 id="配置命令-5"><a href="#配置命令-5" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10             //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd          //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">cost 999                  //修改MED为999</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN1</title>
      <link href="/posts/backbone1.html"/>
      <url>/posts/backbone1.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="BGP概述"><a href="#BGP概述" class="headerlink" title="BGP概述"></a>BGP概述</h2><h3 id="动态路由分类"><a href="#动态路由分类" class="headerlink" title="动态路由分类"></a>动态路由分类</h3><p><strong>IGP：内部网关协议</strong></p><ul><li>AS内部使用IGP来计算和发现路由，如OSPF</li></ul><p><strong>EGP：外部网关协议</strong></p><ul><li>AS与AS之间使用BGP来传递和控制路由</li></ul><h3 id="AS"><a href="#AS" class="headerlink" title="AS"></a>AS</h3><p><strong>AS：自治系统</strong></p><ul><li>AS：Autonomous System 自治系统，指由一组网络和路由器组成的网络</li><li>每个自治系统都有唯一的一个编号，即AS号</li><li>AS号可以帮助互联网中的路由器找到要到达目的地的IP地址的最短路径</li><li>AS号由互联网分配机构IANA（互联网分配号码管理局）分配</li><li>AS号的范围被划分为两类：公共AS号和私有AS号</li><li>公共AS号是指由IANA分配的AS号，可用于在全球范围内标识自治系统</li><li>私有AS号是指由互联网注册机构（IR）分配的AS号，用于在私有互联网中标识自治系统</li></ul><p><strong>2字节AS号范围是0~65535</strong></p><ul><li>1<del>64511为公有AS，64512</del>65535为私有AS</li></ul><p><strong>4字节AS号范围是0~4294967295</strong></p><ul><li>4200000000~4294967294为私有AS号</li></ul><p><strong>网络规模扩大，路由数量不断增长，IGP已无法管理，AS的概念诞生</strong></p><p><strong>AS与AS之间通信需要使用哪种路由协议？</strong></p><ul><li>在AS之间使用BGP协议进行路由传递</li></ul><h3 id="BGP发展历史"><a href="#BGP发展历史" class="headerlink" title="BGP发展历史"></a>BGP发展历史</h3><p><img src="/../img/img_artical/net_sec/7.1.1.png" alt="7.1.1"></p><h3 id="BGP在企业中的应用"><a href="#BGP在企业中的应用" class="headerlink" title="BGP在企业中的应用"></a>BGP在企业中的应用</h3><p><img src="/../img/img_artical/net_sec/7.1.2.png" alt="7.1.2"></p><p><strong>场景一：遍布全国大型政企单位之间，或大型数据中心</strong></p><p><strong>场景二：运营商骨干网</strong></p><h3 id="BGP概述-1"><a href="#BGP概述-1" class="headerlink" title="BGP概述"></a>BGP概述</h3><p><strong>BGP：Border Gateway Protocol 边界网关协议</strong></p><ul><li>作用：实现在AS与AS之间动态交换路由信息</li><li>稳定：BGP是基于TCP协议建立的，使用端口号TCP179，非常稳定</li><li>BGP是公有协议，任何厂商的设备都支持BGP</li><li>BGP位于OSI的第7层 (应用层)</li><li>2006年之后单播IPv4网络使用的版本是BGP-4</li><li>IPv6使用的版本是MP-BGP</li></ul><h3 id="BGP特点"><a href="#BGP特点" class="headerlink" title="BGP特点"></a>BGP特点</h3><ul><li>稳定性非常高</li><li>传递大量路由</li><li>丰富的路由传递策略</li></ul><h2 id="BGP基本概念"><a href="#BGP基本概念" class="headerlink" title="BGP基本概念"></a>BGP基本概念</h2><h3 id="BGP特征"><a href="#BGP特征" class="headerlink" title="BGP特征"></a>BGP特征</h3><ul><li>路由器之间的BGP会话基于TCP连接而建立</li><li>运行BGP的路由器被称为BGP发言者（BGP Speaker），或BGP路由器</li><li>两个建立BGP会话的路由器互为对等体（Peer），BGP对等体之间交换BGP路由表</li><li>BGP路由器只发送增量的BGP路由更新，或进行触发式更新（不会周期性更新）</li><li>BGP能够传递大批量的路由，可在大规模网络中应用</li></ul><p><img src="/../img/img_artical/net_sec/7.1.3.png" alt="7.1.3"></p><h3 id="BGP邻居类型"><a href="#BGP邻居类型" class="headerlink" title="BGP邻居类型"></a>BGP邻居类型</h3><p><strong>BGP邻居类型</strong></p><ul><li>EBGP：运行于不同AS之间，默认优先级255</li><li>IBGP：运行于同一AS内部，默认优先级255</li></ul><p><img src="/../img/img_artical/net_sec/7.1.4.png" alt="7.1.4"></p><h3 id="BGP报文"><a href="#BGP报文" class="headerlink" title="BGP报文"></a>BGP报文</h3><p>BGP邻居的建立过程主要有5种报文</p><table><thead><tr><th align="left">报文</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">Open报文</td><td align="left">用于建立BGP邻居</td></tr><tr><td align="left">Update报文</td><td align="left">用于在邻居之间传递路由信息和撤销路由</td></tr><tr><td align="left">Keepalive报文</td><td align="left">用于维护邻居关系，保持BGP连接，周期性发送，60秒发一次</td></tr><tr><td align="left">notification报文</td><td align="left">通知报文，用于通知BGP邻居之间的报错信息，用于断开BGP连接</td></tr><tr><td align="left">Route-refresh报文</td><td align="left">策略更改后，让邻居重新发送路由信息</td></tr></tbody></table><h3 id="BGP邻居关系建立"><a href="#BGP邻居关系建立" class="headerlink" title="BGP邻居关系建立"></a>BGP邻居关系建立</h3><p><img src="/../img/img_artical/net_sec/7.1.5.png" alt="7.1.5"></p><h3 id="BGP状态机"><a href="#BGP状态机" class="headerlink" title="BGP状态机"></a>BGP状态机</h3><table><thead><tr><th align="left">Peer状态名称</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">Idle</td><td align="left">初始化状态，tcp未连接状态，邻居的状态为idle ,  当bgp设备和邻居进行tcp 连接时，会从当前的状态转为connect 状态</td></tr><tr><td align="left">Connect</td><td align="left">正在进行TCP连接，如果TCP连接建立失败则进入Active状态，反复尝试连接，如果tcp 建立连接成功，bgp 设备会向邻居发送open报文，状态也会转为OpenSent  状态</td></tr><tr><td align="left">Active</td><td align="left">TCP连接没建立成功，反复尝试TCP连接，如果成功，状态依然可以转为opensent 状态，如果重传计时器超时，依然没有收到邻居回应，bgp设备会返回上一个状态，上一个是connect  状态</td></tr><tr><td align="left">OpenSent</td><td align="left">TCP连接已经建立成功，开始发送Open报文，协商邻居的建立，如果bgp设备给邻居发送open报文后，如果收到来自邻居的回复，并且回复的报文是正确的，bgp 设备会继续发送keep alive 报文，状态转为  Open Comfirm 状态，如果bgp设备给邻居发送open报文后，如果收到来自邻居的回复，但是回复的报文有错误，bgp 设备会向邻居发送notification 报文（用于断开bgp连接状态），断开后会跳转到最初的idle 状态</td></tr><tr><td align="left">OpenConfirm</td><td align="left">协商成功，自己发送Keepalive报文，等待对方的Keepalive报文，如果收到邻居发来的keep alive 报文，状态会转为established  建立状态，如果收到邻居发来的notification 报文，状态会跳转为 idle 状态</td></tr><tr><td align="left">Established</td><td align="left">已经收到对方的Keepalive报文，开始使用Update通告路由信息，如果收到邻居发来的错误的update 报文或者keepalive 报文，bgp设备会发送notification 报文，通知邻居断开连接，会回到idle 初始化状态</td></tr></tbody></table><p><img src="/../img/img_artical/net_sec/7.1.6.png" alt="7.1.6"></p><h2 id="EBGP配置"><a href="#EBGP配置" class="headerlink" title="EBGP配置"></a>EBGP配置</h2><h3 id="EBGP配置-1"><a href="#EBGP配置-1" class="headerlink" title="EBGP配置"></a>EBGP配置</h3><p><strong>配置EBGP邻居关系</strong></p><p><img src="/../img/img_artical/net_sec/7.1.7.png" alt="7.1.7"></p><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]bgp</span> <span class="string">100                                //启动BGP进程，指定AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]router-id</span> <span class="string">1.1.1.1                  //配置BGP的router-id</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 as-number 200    //指定邻居地址和AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]network</span> <span class="string">192.168.1.0 24             //注入路由</span></span><br></pre></td></tr></table></figure><p><strong>配置R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200                                //启动BGP进程，指定AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]router-id</span> <span class="string">2.2.2.2                  //配置BGP的router-id</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.1 as-number 100    //指定邻居地址和AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]network</span> <span class="string">192.168.2.0 24             //注入路由</span></span><br></pre></td></tr></table></figure><h3 id="BGP路由的生成"><a href="#BGP路由的生成" class="headerlink" title="BGP路由的生成"></a>BGP路由的生成</h3><p><strong>如何产生路由</strong></p><ul><li>不同于IGP路由协议，BGP并不会发现并计算产生路由</li><li>BGP只会将IGP路由表中已存在的路由“搬”到BGP路由表中，称为注入路由</li><li>BGP将注入的路由通过Update报文“传递”给BGP邻居</li></ul><p><strong>BGP注入路由的方式有两种</strong></p><ul><li>network</li><li>import-route</li></ul><h3 id="BGP注入路由方式"><a href="#BGP注入路由方式" class="headerlink" title="BGP注入路由方式"></a>BGP注入路由方式</h3><p><strong>Network</strong></p><ul><li>Network只会注入IP路由表中已经存在的路由条目</li><li>Network优势是精准注入，不足是只能逐条注入路由，配置繁琐</li></ul><p><strong>import-route</strong></p><ul><li>import-route可以批量注入路由，可以将其他协议的路由注入BGP路由表</li><li>注入直连路由</li><li>注入静态路由</li><li>注入OSPF路由</li><li>……</li></ul><h2 id="邻居表和路由表"><a href="#邻居表和路由表" class="headerlink" title="邻居表和路由表"></a>邻居表和路由表</h2><h3 id="BGP邻居表"><a href="#BGP邻居表" class="headerlink" title="BGP邻居表"></a>BGP邻居表</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">bgp peer </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">BGP</span> <span class="string">local router ID : 1.1.1.1</span></span><br><span class="line"> <span class="attr">Local</span> <span class="string">AS number : 100</span></span><br><span class="line"> <span class="attr">Total</span> <span class="string">number of peers : 1      Peers in established state : 1</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Peer</span>          <span class="string">V   AS  MsgRcvd  MsgSent  OutQ  Up/Down     State       PrefRcv</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">192.168.12.2</span>  <span class="string">4   200   45       46      0    00:42:35  Established     1</span></span><br></pre></td></tr></table></figure><h3 id="BGP路由表"><a href="#BGP路由表" class="headerlink" title="BGP路由表"></a>BGP路由表</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">bgp routing-table </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">BGP</span> <span class="string">Local router ID is 1.1.1.1 </span></span><br><span class="line"> <span class="attr">Status</span> <span class="string">codes: * - valid, &gt; - best, d - damped,</span></span><br><span class="line">               <span class="attr">h</span> <span class="string">- history,  i - internal, s - suppressed, S - Stale</span></span><br><span class="line">               <span class="attr">Origin</span> : <span class="string">i - IGP, e - EGP, ? - incomplete</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Total</span> <span class="string">Number of Routes: 2</span></span><br><span class="line">      <span class="attr">Network</span>            <span class="string">NextHop        MED        LocPrf    PrefVal Path/Ogn</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">*&gt;</span>   <span class="string">192.168.1.0        0.0.0.0         0                     0      i</span></span><br><span class="line"> <span class="attr">*&gt;</span>   <span class="string">192.168.2.0        192.168.12.2    0                     0      200i</span></span><br></pre></td></tr></table></figure><h2 id="IBGP全互联"><a href="#IBGP全互联" class="headerlink" title="IBGP全互联"></a>IBGP全互联</h2><h3 id="Next-Hop"><a href="#Next-Hop" class="headerlink" title="Next_Hop"></a>Next_Hop</h3><p><strong>BGP路由中的Next_Hop属性设置规则</strong></p><ul><li><p>BGP路由器在向EBGP邻居发布路由时，会把该路由的下一跳设置为本地与对端建立的BGP邻居关系的接口地址</p></li><li><p>BGP路由器将本地始发路由发布给IBGP邻居时，会把该路由的下一跳设置为本地与对端建立的BGP邻居关系的接口地址</p></li><li><p>路由器在收到EBGP邻居发布的路由后，在将路由传递给自己的IBGP邻居时，默认不修改路由的下一跳地址</p></li></ul><h3 id="Next-Hop的缺省操作"><a href="#Next-Hop的缺省操作" class="headerlink" title="Next_Hop的缺省操作"></a>Next_Hop的缺省操作</h3><p><strong>使用peer next-hop-local命令可以在设置向IBGP对等体通告路由时，把下一跳设为本地与对端建立BGP邻居关系的接口地址</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 as-number 200</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 next-hop-local</span></span><br></pre></td></tr></table></figure><h3 id="IBGP全互联-1"><a href="#IBGP全互联-1" class="headerlink" title="IBGP全互联"></a>IBGP全互联</h3><p><strong>实现AS100内R4的10.10.4.4 和 AS300内R5的10.10.5.5互通</strong></p><p><img src="/../img/img_artical/net_sec/7.1.8.png" alt="7.1.8"></p><h3 id="IBGP配置步骤"><a href="#IBGP配置步骤" class="headerlink" title="IBGP配置步骤"></a>IBGP配置步骤</h3><p><strong>配置步骤</strong></p><ul><li>R4和R1建立EBGP邻居关系</li><li>AS200内部R1&#x2F;R2&#x2F;R3部署OSPF</li><li>R1&#x2F;R2&#x2F;R3建立IBGP全互联</li><li>R3和R5建立EBGP邻居关系</li><li>R4和R5中使用network注入路由</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置R4</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R4]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R4-G0/0/0]ip</span> <span class="string">add 192.168.14.4 24</span></span><br><span class="line"><span class="attr">[R4-G0/0/0]int</span> <span class="string">lo0</span></span><br><span class="line"><span class="attr">[R4-LoopBack0]ip</span> <span class="string">add 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R4]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R4-bgp]router-id</span> <span class="string">4.4.4.4</span></span><br><span class="line"><span class="attr">[R4-bgp]peer</span> <span class="string">192.168.14.1 as 200    //和R1建立外部邻居</span></span><br><span class="line"><span class="attr">[R4-bgp]network</span> <span class="string">10.10.4.4 32        //注入路由</span></span><br></pre></td></tr></table></figure><p><strong>配置R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R1-G0/0/0]ip</span> <span class="string">add 192.168.12.1 24</span></span><br><span class="line"><span class="attr">[R1-G0/0/0]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">add 192.168.14.1 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area-0.0.0.0]quit</span></span><br><span class="line"><span class="attr">[R1-ospf-1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]bgp</span> <span class="string">200  //开启BGP，配置AS200</span></span><br><span class="line"><span class="attr">[R1-bgp]router-id</span> <span class="string">1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.14.4 as 100      //和R4建立外部邻居</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.23.3 as 200      //和R3建立内部邻居</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.23.3 next-hop-local  //修改下一跳 </span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 as 200          //和R2建立内部邻居</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 next-hop-local  //修改下一跳</span></span><br></pre></td></tr></table></figure><p><strong>配置R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R2-G0/0/0]ip</span> <span class="string">add 192.168.12.2 24</span></span><br><span class="line"><span class="attr">[R2-G0/0/0]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R2-G0/0/1]ip</span> <span class="string">add 192.168.23.2 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area-0.0.0.0]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R2-bgp]router-id</span> <span class="string">2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.12.1 as 200</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.23.3 as 200</span></span><br></pre></td></tr></table></figure><p><strong>配置R3</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R3-G0/0/0]ip</span> <span class="string">add 192.168.23.3 24</span></span><br><span class="line"><span class="attr">[R3-G0/0/0]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R3-G0/0/1]ip</span> <span class="string">add 192.168.35.3 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]ospf</span> <span class="string">1 router-id 3.3.3.3</span></span><br><span class="line"><span class="attr">[R3-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R3-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R3-ospf-1-area-0.0.0.0]quit</span></span><br><span class="line"><span class="attr">[R3-ospf-1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R3-bgp]router-id</span> <span class="string">3.3.3.3</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.12.1 as 200    //和R1建立内部邻居</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.12.1 next-hop-local  //修改下一跳</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.23.2 as 200    //和R2建立内部邻居</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.23.2 next-hop-local  //修改下一跳</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.35.5 as 300    //和R5建立外部邻居</span></span><br></pre></td></tr></table></figure><p><strong>配置R5</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R5]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R5-G0/0/0]ip</span> <span class="string">add 192.168.35.5 24</span></span><br><span class="line"><span class="attr">[R5-G0/0/0]int</span> <span class="string">lo0</span></span><br><span class="line"><span class="attr">[R5-LoopBack0]ip</span> <span class="string">add 10.10.5.5 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R5]bgp</span> <span class="string">300</span></span><br><span class="line"><span class="attr">[R5-bgp]router-id</span> <span class="string">5.5.5.5</span></span><br><span class="line"><span class="attr">[R5-bgp]peer</span> <span class="string">192.168.35.3 as 200   //和R3建立外部邻居</span></span><br><span class="line"><span class="attr">[R5-bgp]network</span> <span class="string">10.10.5.5 32       //注入路由</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN2</title>
      <link href="/posts/backbone2.html"/>
      <url>/posts/backbone2.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="BGP通告原则"><a href="#BGP通告原则" class="headerlink" title="BGP通告原则"></a>BGP通告原则</h2><h3 id="BGP通告原则-1"><a href="#BGP通告原则-1" class="headerlink" title="BGP通告原则"></a>BGP通告原则</h3><p><strong>BGP传递给路由时需要遵循以下原则</strong></p><ul><li>第一条原则：只发布最优且有效（即下一跳地址可达）的路由</li><li>第二条原则：从EBGP邻居获取的路由，会发布给所有邻居</li><li>第三条原则：从IBGP邻居获取的路由，不会再发送给其他IBGP邻居（IBGP水平分割）</li></ul><h2 id="IBGP水平分割"><a href="#IBGP水平分割" class="headerlink" title="IBGP水平分割"></a>IBGP水平分割</h2><h3 id="IBGP水平分割-1"><a href="#IBGP水平分割-1" class="headerlink" title="IBGP水平分割"></a>IBGP水平分割</h3><p><strong>BGP通告原则三</strong></p><ul><li>从IBGP邻居学习到的BGP路由，不会再发送给其他IBGP邻居</li><li>该条原则也被称为”IBGP水平分割”</li><li>IBGP水平分割的作用：防止AS内部路由环路</li></ul><p><strong>IBGP水平分割的不足</strong></p><ul><li>导致域间路由无法传递</li></ul><p><strong>如何突破IBGP水平分割的限制</strong></p><ul><li>静态路由</li><li>在OSPF中引入BGP</li><li>IBGP全互联</li><li>路由反射器</li></ul><h2 id="路由反射器"><a href="#路由反射器" class="headerlink" title="路由反射器"></a>路由反射器</h2><h3 id="IBGP水平分割-2"><a href="#IBGP水平分割-2" class="headerlink" title="IBGP水平分割"></a>IBGP水平分割</h3><p><strong>IBGP水平分割</strong></p><ul><li>作用：用于防止AS内部出现环路</li><li>存在问题：BGP路由在AS内部无法传递</li><li>解决方案：IBGP邻居全互联，路由反射器</li></ul><h3 id="IBGP全互联的不足"><a href="#IBGP全互联的不足" class="headerlink" title="IBGP全互联的不足"></a>IBGP全互联的不足</h3><ul><li><p>邻居数量多：一个AS内有n台设备，需建立的邻居数为n（n-1）&#x2F;2</p></li><li><p>当设备数目很多时，设备配置十分复杂、路由维护十分复杂</p></li><li><p>当设备数目很多时，网络资源和设备资源的消耗都非常大</p></li></ul><h3 id="路由反射器-1"><a href="#路由反射器-1" class="headerlink" title="路由反射器"></a>路由反射器</h3><p><strong>反射器角色</strong></p><ul><li>路由反射器：RR（Route Reflector）</li><li>客户机</li><li>非客户机</li></ul><p><strong>反射器原理</strong></p><ul><li>客户机只需与RR之间建立IBGP连接，不需要与其他客户机建立IBGP连接，从而减少了IBGP连接数量</li><li>RR会将学习的路由反射出去，从而使得IBGP路由在AS内传播无需建立IBGP全互联，路由器反射器突破了IBGP水平分割限制</li><li>反射器通过命令指定自己的客户机，客户机不知道谁是反射器，只有反射器知道谁是客户机，没有指定为客户机的路由器，就是非客户机</li></ul><p><img src="/../img/img_artical/net_sec/7.2.1.png" alt="7.2.1"></p><h3 id="反射规则"><a href="#反射规则" class="headerlink" title="反射规则"></a>反射规则</h3><p><strong>反射规则</strong></p><ul><li>RR从非客户机收到的路由会反射给客户机，会发布给EBGP邻居</li><li>RR从非客户机收到的路由不会反射给非客户机</li><li>RR从客户机收到的路由会反射给客户机和非客户机，会发布给EBGP邻居</li><li>RR从EBGP邻居收到的路由，会反射给所有的客户机、非客户机</li></ul><p>注意此处<strong>反射</strong>和<strong>发送</strong>的区别。<strong>发送</strong>指的是传统情况下（相当于RR不存在的场景下）的BGP路由传递行为，而<strong>反射</strong>指的是遵循路由反射规则的情况下，RR执行的路由传递动作，被反射出去的路由会被RR插入特殊的路径属性</p><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R2-bgp]router-id</span> <span class="string">2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.12.1 as-number 200</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.12.1 reflect-client         //指定192.168.12.1为客户机</span></span><br></pre></td></tr></table></figure><h3 id="路由反射器防止环路"><a href="#路由反射器防止环路" class="headerlink" title="路由反射器防止环路"></a>路由反射器防止环路</h3><p><strong>路由反射器突破水平分割限制可能导致环路发生</strong></p><ul><li>RR的设定使得IBGP水平分割原则失效，这就可能导致环路的产生，为此RR会为BGP路由添加两个特殊的路径属性来避免出现环路</li><li>Originator_ID：始发者ID属性，属性用于防止集群内产生路由环路</li><li>Cluster_List：簇列表属性，属性用于防止集群间产生路由环路</li><li>Originator_ID、Cluster_List属性都属于可选非过渡类型</li></ul><p><strong>Originator ID属性</strong></p><ul><li>RR将一条BGP路由进行反射时会在反射出去的路由中增加Originator_ID，其值为本地AS中通告该路由的BGP路由器Router ID</li><li>若AS内存在多个RR，则Originator_ID属性由第一个RR创建，并且不被后续的RR所更改。</li><li>当BGP路由器收到一条携带Originator_ID属性的IBGP路由，并且Originator_ID属性值与自身的Router ID相同，则它不会学习该路由</li></ul><p><strong>路由反射簇（Cluster）</strong></p><ul><li><p>路由反射簇包括反射器RR及其Client。一个AS内允许存在多个路由反射簇（如下图）。</p></li><li><p>每一个簇都有唯一的簇ID（Cluster_ID，默认为RR的BGP Router ID ）。</p></li><li><p>当一条路由被反射器反射后，该RR（该簇）的Cluster_ID就会被添加至路由的Cluster_list属性中。</p></li><li><p>当RR收到一条携带Cluster_list属性的BGP路由，且该属性值中包含该簇的Cluster_ID时，RR认为该条路由存在环路，因此将忽略关于该条路由的更新</p></li></ul><h2 id="环回口建立IBGP邻居"><a href="#环回口建立IBGP邻居" class="headerlink" title="环回口建立IBGP邻居"></a>环回口建立IBGP邻居</h2><h3 id="BGP的稳定性"><a href="#BGP的稳定性" class="headerlink" title="BGP的稳定性"></a>BGP的稳定性</h3><p><strong>IBGP：</strong></p><ul><li>一般使用环回口建立IBGP邻居，从而提高稳定性</li><li>指定建立IBGP邻居的源地址为loopback地址</li></ul><p><strong>Loopback接口：</strong></p><ul><li>用loopback接口建立邻居更加稳定和可靠</li><li>使用物理接口的IP地址建立邻居，当物理接口和物理链路发送故障，BGP邻居就会down掉</li><li>而使用loopback接口IP地址建立邻居，假设两台设备之间有3条物理链路，即便坏掉其中2条物理链路，即便只有1条物理链路互通，就可以保证BGP邻居的正常</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R2-bgp]router-id</span> <span class="string">2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">10.10.1.1 as-number 200</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">10.10.1.1 connect-interface LoopBack()</span></span><br></pre></td></tr></table></figure><h2 id="更新源检测机制"><a href="#更新源检测机制" class="headerlink" title="更新源检测机制"></a>更新源检测机制</h2><h3 id="更新源检测机制-1"><a href="#更新源检测机制-1" class="headerlink" title="更新源检测机制"></a>更新源检测机制</h3><p><strong>TCP连接源地址</strong></p><ul><li>缺省情况下，BGP使用报文出接口作为TCP连接的本地接口</li><li>在部署IBGP对等体关系时，建议使用LoopBack地址作为更新源地址</li><li>Loopback接口非常稳定，可以借助AS内的冗余链路来保证可靠性</li><li>在部署EBGP对等体关系时，通常使用直连接口的IP地址作为源地址，如若使用Loopback接口建立EBGP对等体关系，则应注意EBGP多跳问题</li></ul><p><img src="/../img/img_artical/net_sec/7.2.2.png" alt="7.2.2"></p><h3 id="EBGP之间为何不能使用Loopback接口建立对等体"><a href="#EBGP之间为何不能使用Loopback接口建立对等体" class="headerlink" title="EBGP之间为何不能使用Loopback接口建立对等体"></a>EBGP之间为何不能使用Loopback接口建立对等体</h3><ul><li>BGP有直连检测机制</li><li>BGP要求，凡是建立EBGP邻居的路由器，必须使用直连网段，使用物理接口的IP地址，建立邻居</li><li>原因：因为EBGP要求稳定性和可靠性，  使用直连网段，使用物理接口建立邻居，BGP路由器能够感知到链路故障， 能够及时作出调整，如果用非直连网段建立EBGP邻居，路由器无法实时且有效的感知到网络故障</li><li>原理：EBGP报文中TTL值为1，</li><li>当经过一台路由器转发的时候，TTL值减去1，当TTL值为0的时候，报文被丢弃，所以无法建立BGP邻居关系</li><li>解决方法：突破直连检测机制</li></ul><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">peer</span> <span class="string">10.10.1.1 ebgp-max-hop  100   //修改bgp报文最大TTL为100  </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由4</title>
      <link href="/posts/routing4.html"/>
      <url>/posts/routing4.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="Stub区域"><a href="#Stub区域" class="headerlink" title="Stub区域"></a>Stub区域</h2><h3 id="OSPF特殊区域"><a href="#OSPF特殊区域" class="headerlink" title="OSPF特殊区域"></a>OSPF特殊区域</h3><p><strong>OSPF分为区域和特殊区域</strong></p><p><strong>OSPF普通区域：</strong></p><ul><li>包括标准区域和骨干区域</li></ul><p><strong>OSPF特殊区域：</strong></p><ul><li>Stub</li><li>Totally Stub</li><li>NSSA</li><li>Totally NSSA</li></ul><table><thead><tr><th align="left">区域类型</th><th>区域作用</th></tr></thead><tbody><tr><td align="left">普通区域</td><td>普通区域包括标准区域和骨干区域<br />标准区域是最通用的区域，它传输区域内路由，区域间路由和外部路由<br />骨干区域是连接所有其他OSPF区域的中央区域，骨干区域用Area 0表示</td></tr><tr><td align="left">Stub区域</td><td>不学习4、5类LSA、不允许引入外部路由，只发布域内路由和域间路由<br />在Stub区域中，数据库和路由表规模都会大大减少<br />依靠该区域的ABR发布默认的3类LSA与外部通信</td></tr><tr><td align="left">Totally Stub区域</td><td>不学习3、4、5类LSA、不允许引入外部路由，只发布域内路由<br />在Totally Stub区域中，数据库和路由表规模都会大大减少<br />依靠该区域的ABR发布默认的3类LSA与外部通信</td></tr><tr><td align="left">NSSA区域</td><td>NSSA区域不学习4、5类LSA，但是NSSA区域允许通过7类LSA引入外部路由<br />由ASBR发布7类LSA通告给本区域，这些7类LSA在ABR中转换成5类LSA，在整个OSPF网络中泛洪<br />依靠NSSA区域内的ABR发布默认7类LSA实现和外部通信</td></tr><tr><td align="left">Totally NSSA区域</td><td>Totally NSSA区域不学习3、4、5类LSA，但是NSSA区域允许通过7类LSA引入外部路由<br />由ASBR发布7类LSA通告给本区域，这些7类LSA在ABR中转换成5类LSA，在整个OSPF网络中泛洪<br />依靠NSSA区域内的ABR发布默认3类和7类LSA实现和外部通信</td></tr></tbody></table><p><strong>Stub区域作用</strong></p><ul><li>保护一个区域不受来自外部链路的影响</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>Stub区域特点</strong></p><ul><li>学习1类、2类、3类LSA</li><li>不学习4类、5类LSA</li><li>Stub区域的ABR会自动生成一条默认的3类LSA，实现和外部通信</li><li>骨干区域不能被配置为Stub区域</li><li>Stub区域中的所有路由器都必须将该区域设置为Stub</li><li>Stub区域内不能引入也不能接收AS外部路由</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]stub             //将区域12设置为stub区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">如果该区域有多个路由器，则需要全部设置为stub</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]stub             //将区域12设置为stub区域</span></span><br></pre></td></tr></table></figure><h2 id="Totally-Stub区域"><a href="#Totally-Stub区域" class="headerlink" title="Totally Stub区域"></a>Totally Stub区域</h2><h3 id="Stub区域的不足"><a href="#Stub区域的不足" class="headerlink" title="Stub区域的不足"></a>Stub区域的不足</h3><p><strong>Stub区域的不足</strong></p><ul><li>Stub虽然可以不受外部链路的影响，但是其他区域，依然会影响这个Stub区域的稳定性</li><li>Stub区域中，依然有很多其他区域的3类LSA，数据库依然庞大，依然会消耗设备资源和带宽资源</li></ul><p><strong>Stub区域的优化</strong></p><ul><li>不要4类、5类LSA，也不要3类LSA</li><li>具备这种特点的区域，称之为Totally Stub区域（完全末梢区域）</li></ul><h3 id="Totally-Stub"><a href="#Totally-Stub" class="headerlink" title="Totally Stub"></a>Totally Stub</h3><p><strong>Totally Stub作用：</strong></p><ul><li>保护一个区域不受来自外部链路的影响，也不受来自区域间链路的影响</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>Totally Stub区域特点：</strong></p><ul><li>学习1类、2类LSA</li><li>不学习3类、4类、5类LSA</li><li>Totally Stub区域的ABR会自动生成一条默认的3类LSA，实现和外部通信</li><li>骨干区域不能被配置为Stub区域</li><li>Totally Stub区域的ABR上需要配置stub no-summary</li><li>Totally Stub区域内不能引入也不接收AS外部路由</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]stub             //将区域12设置为stub区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">在Stub区域内ABR上配置</span></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]stub no-summary  //将区域12的ABR上配置</span></span><br></pre></td></tr></table></figure><h2 id="NSSA区域"><a href="#NSSA区域" class="headerlink" title="NSSA区域"></a>NSSA区域</h2><h3 id="Stub区域存在的问题"><a href="#Stub区域存在的问题" class="headerlink" title="Stub区域存在的问题"></a>Stub区域存在的问题</h3><p><strong>Stub区域存在的问题：</strong></p><ul><li>在Stub区域是无法引入外部路由</li><li>对于既需要引入外部路由又要进行保护的末梢区域，Stub和Totally Stub区域就不能满足需求了</li></ul><p><strong>NSSA区域和Stub区域区别</strong></p><ul><li>NSSA和Stub非常相似，不要其他区域的4类、5类LSA</li><li>但是NSSA区域中的路由器可以通过7类LSA，引入外部路由</li></ul><h3 id="2、NSSA区域"><a href="#2、NSSA区域" class="headerlink" title="2、NSSA区域"></a>2、NSSA区域</h3><p><strong>NSSA区域作用：</strong></p><ul><li>保护一个区域不受来自外部链路的影响，又可以引入外部路由</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>NSSA区域特点</strong></p><ul><li>学习1类、2类、3类、7类LSA</li><li>不学习4类、5类的LSA</li><li>NSSA区域中的路由器可以通过7类LSA，引入外部路由</li><li>NSSA区域的ABR会自动生成一条默认的7类LSA，实现和外部通信</li><li>7类的LSA只能在特殊区域NSSA内部传播，ABR会将7类的LSA转成5类的LSA</li><li>骨干区域不能被配置为NSSA区域</li><li>NSSA区域继承了Stub区域的优点，并且还能引入外部路由</li></ul><h3 id="配置命令-2"><a href="#配置命令-2" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]nssa             //将区域12设置为nssa区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">如果该区域有多个路由器，则需要全部设置为stub</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]nssa             //将区域12设置为nssa区域</span></span><br></pre></td></tr></table></figure><h2 id="Totally-NSSA区域"><a href="#Totally-NSSA区域" class="headerlink" title="Totally NSSA区域"></a>Totally NSSA区域</h2><h3 id="NSSA区域的不足"><a href="#NSSA区域的不足" class="headerlink" title="NSSA区域的不足"></a>NSSA区域的不足</h3><p><strong>NSSA区域的不足</strong></p><ul><li>但是本公司内的其他区域，依然会影响这个NSSA区域的稳定性</li><li>数据库依然庞大，依然会消耗设备资源和带宽资源</li></ul><p><strong>NSSA区域的优化</strong></p><ul><li>不要4类、5类LSA，也不要3类LSA</li><li>具备这种特点的区域，称之为Totally NSSA区域</li></ul><h3 id="Totally-NSSA区域-1"><a href="#Totally-NSSA区域-1" class="headerlink" title="Totally NSSA区域"></a>Totally NSSA区域</h3><p><strong>Totally NSSA区域作用：</strong></p><ul><li>保护一个区域不受外部链路和区域间链路影响，又可以引入外部路由</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>Totally NSSA区域特点</strong></p><ul><li>学习1类、2类、7类LSA</li><li>不学习3类、4类、5类LSA</li><li>Totally NSSA区域的ABR路由器需要配置nssa no-summary</li><li>Totally NSSA区域中的路由器可以通过7类LSA，引入外部路由</li><li>Totally NSSA区域的ABR会自动生成一条默认3类和一条默认7类的LSA</li><li>7类LSA只能在特殊区域NSSA内部传播，ABR会将7类LSA转化为5类LSA</li><li>骨干区域不能配置为NSSA区域</li></ul><h3 id="配置命令-3"><a href="#配置命令-3" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]nssa             //将区域12设置为nssa区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">在NSSA区域内ABR上配置</span></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]nssa no-summary  //将区域12的ABR上配置</span></span><br></pre></td></tr></table></figure><h3 id="7类LSA详解"><a href="#7类LSA详解" class="headerlink" title="7类LSA详解"></a>7类LSA详解</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1-ospf-1]display</span> <span class="string">ospf lsdb nssa 192.168.4.0</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.12</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">NSSA                      //表示的是7类的LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 192.168.4.0               //这条LSA的名字即外部路由的网段</span></span><br><span class="line">  <span class="attr">Adv</span> <span class="string">rtr   : 1.1.1.1                   //发布这条LSA的路由器，ASBR的router-id</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 27                        //作用:仅仅用于在NSSA区域中，用于表示外部路由</span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">36                        //特点:只有NSSA区域的ASBR可以产生7类LSA，7类LSA只能在NSSA区域以及TotallyNSSA区域内部传输</span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">NP                             为了将NSSA区域引入的外部路由发布到其它区域，需要把Type7LSA转化为Type5LSA以便在整个OSPF网络中通告</span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">80000001 </span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0x6779</span></span><br><span class="line">  <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0 </span></span><br><span class="line">  <span class="attr">TOS</span> <span class="string">0  Metric: 1 </span></span><br><span class="line">  <span class="attr">E</span> <span class="string">type    : 2</span></span><br><span class="line">  <span class="attr">Forwarding</span> <span class="string">Address : 192.168.12.1 </span></span><br><span class="line">  <span class="attr">Tag</span>       : <span class="string">1 </span></span><br><span class="line">  <span class="attr">Priority</span>  : <span class="string">Low</span></span><br></pre></td></tr></table></figure><h2 id="区域间路由汇总"><a href="#区域间路由汇总" class="headerlink" title="区域间路由汇总"></a>区域间路由汇总</h2><h3 id="路由汇总"><a href="#路由汇总" class="headerlink" title="路由汇总"></a>路由汇总</h3><p><strong>路由汇总</strong></p><ul><li>路由汇总又被称为路由聚合，即是将一组前缀相同的路由汇聚成一条路由，从而达到减小路由表规模以及优化设备资源利用率的目的，我们把汇聚之前的这组路由称为精细路由或明细路由，把汇聚之后的这条路由称为汇总路由或聚合路由</li></ul><p><strong>OSPF路由汇总的类型</strong></p><ul><li><p>在ABR执行路由汇总：对区域间的路由执行路由汇总</p><ul><li>区域间路由汇总，也叫3类LSA汇总 ，也叫ABR汇总</li><li>区域间路由汇总，是在ABR中配置，在区域中配置</li><li>汇总的是用network 注入的内部路由</li></ul></li><li><p>在ASBR执行路由汇总：对引入的外部路由执行路由汇总</p><ul><li>外部路由汇总，也叫5类LSA汇总 ，也叫ASBR汇总</li><li>外部路由汇总，是在ASBR中配置，在OSPF下配置，不需要进入区域</li><li>汇总的是用import-route 引入的外部路由</li></ul></li></ul><h3 id="路由汇总作用"><a href="#路由汇总作用" class="headerlink" title="路由汇总作用"></a>路由汇总作用</h3><ul><li>减少维护的数据库规模</li><li>减少路由表维护数量</li><li>减少其他区域不稳定链路的影响</li></ul><h3 id="配置命令-4"><a href="#配置命令-4" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">区域间路由汇总：</span></span><br><span class="line"><span class="attr">在ABR设备上配置</span></span><br><span class="line"><span class="attr">abr-summary</span> <span class="string">10.10.0.0 255.255.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">域外路由汇总</span></span><br><span class="line"><span class="attr">在ASBR设备上配置</span></span><br><span class="line"><span class="attr">asbr-summary</span> <span class="string">20.20.0.0 255.255.0.0</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由3</title>
      <link href="/posts/routing3.html"/>
      <url>/posts/routing3.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="区域间路由"><a href="#区域间路由" class="headerlink" title="区域间路由"></a>区域间路由</h2><h3 id="大型网络中，单区域OSPF存在的问题"><a href="#大型网络中，单区域OSPF存在的问题" class="headerlink" title="大型网络中，单区域OSPF存在的问题"></a>大型网络中，单区域OSPF存在的问题</h3><p><strong>为什么要划分多区域</strong></p><ul><li>数据库庞大</li><li>路由表庞大</li><li>设备压力大，资源消耗高</li><li>无法进行路由汇总</li><li>拓扑变更，引发路由重计算</li></ul><h3 id="区域划分"><a href="#区域划分" class="headerlink" title="区域划分"></a>区域划分</h3><p><strong>区域内部路由器（Internal Router）</strong></p><ul><li>该类设备的所有接口都属于同一个OSPF区域。如RRR5</li></ul><p><strong>区域边界路由器（Area Border Router）</strong></p><ul><li>该类设备接口分别连接两个及两个以上不同区域。如RR3</li></ul><p><img src="/../img/img_artical/net_sec/6.3.1.png" alt="6.3.1"></p><h3 id="区域间路由接口"><a href="#区域间路由接口" class="headerlink" title="区域间路由接口"></a>区域间路由接口</h3><p><strong>OSPF区域间路由传递是通过ABR产生的3类LSA实现的</strong></p><ul><li>R2依据Area 1内的1类LSA及2类LSA计算得出192.168.1.0&#x2F;24的路由（区域内路由），并将该路由通过3类LSA通告到Area 0。R3根据该LSA可计算出到达192.168.1.0&#x2F;24的区域间路由</li><li>R3重新生成一份3类LSA通告到Area 2中，所有OSPF区域都有192.168.1.0&#x2F;24的路由</li></ul><p><img src="/../img/img_artical/net_sec/6.3.2.png" alt="6.3.2"></p><h2 id="Network-Summary-LSA"><a href="#Network-Summary-LSA" class="headerlink" title="Network Summary LSA"></a>Network Summary LSA</h2><h3 id="Network-Summary-LSA详解"><a href="#Network-Summary-LSA详解" class="headerlink" title="Network Summary LSA详解"></a>Network Summary LSA详解</h3><p><strong>Network Summary LSA（3类LSA）：</strong></p><ul><li>Network Summary LSA（3类LSA）由ABR产生，用于一个区域通告到另一个区域的路由</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;dis</span> <span class="string">ospf lsdb summary 192.168.1.0</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">Sum-Net          //表示的是3类的LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 192.168.1.0      //这条LSA的名字，是区域之间的路由网段</span></span><br><span class="line">  <span class="attr">Adv</span> <span class="string">rtr   : 2.2.2.2          //发布这条LSA的路由器，是ABR的Router-id</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 1281            </span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">28 </span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">E               //作用：将区域内的2类LSA计算出来的路由，变成3类LSA在其他区域泛洪(广播)实现区域与区域之间的通信</span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">80000005         //特点:只有ABR可以产生3类LSA，3类LSA的传输范围仅仅限于同一个区域内</span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0x914f                 3类LSA在传输过程中，每经过1个ABR，3类LSA的advRouter就会变成所经过的那个ABR的Router-id</span></span><br><span class="line">  <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0    //目的地址的掩码：192.168.2.0/24</span></span><br><span class="line">  <span class="attr">Tos</span> <span class="string">0  metric: 5             //开销值是5，从下一跳到目的地址的cost值</span></span><br><span class="line">  <span class="attr">Priority</span>  : <span class="string">Low</span></span><br></pre></td></tr></table></figure><p><strong>LSA的三元组：链路状态类型、链路状态ID、通告路由器三元组唯一地标识了一个LSA</strong></p><h2 id="外部路由"><a href="#外部路由" class="headerlink" title="外部路由"></a>外部路由</h2><h3 id="外部路由引入"><a href="#外部路由引入" class="headerlink" title="外部路由引入"></a>外部路由引入</h3><p><strong>ASBR（AS Border Router）：</strong></p><ul><li>自治系统边界路由器，只要一台OSPF设备引入了外部路由，它就成为了ASBR</li><li>ASBR将外部路由以AS-external LSA（5类LSA）的形式在OSPF网络内泛洪</li></ul><p><img src="/../img/img_artical/net_sec/6.3.3.png" alt="6.3.3"></p><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置R7去往公司内网的路由条目</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R7]ip</span> <span class="string">route-static 192.168.0.0 16 192.168.67.6</span></span><br></pre></td></tr></table></figure><p><strong>配置R6去往PC3的静态路由</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R6]ip</span> <span class="string">route-static 192.168.3.0 24 192.168.67.7</span></span><br></pre></td></tr></table></figure><p><strong>在R6上，宣告静态路由进入OSPF区域</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R6]ospf</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[R6-ospf-1]import-route</span> <span class="string">static   //通过该命令产生的路由，称为OSPF外部路由</span></span><br></pre></td></tr></table></figure><h2 id="AS-external-LSA"><a href="#AS-external-LSA" class="headerlink" title="AS-external LSA"></a>AS-external LSA</h2><h3 id="AS-external-LSA详解"><a href="#AS-external-LSA详解" class="headerlink" title="AS-external LSA详解"></a>AS-external LSA详解</h3><p><strong>AS-external LSA（5类LSA）：</strong></p><ul><li>由ASBR产生，描述到达AS外部的路由，该LSA会被通告到所有的区域（除了Stub区域和NSSA区域）</li><li>5类LSA不属于任何一个区域</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">ospf lsdb ase 192.168.3.0</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">State Database</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Type</span>      : <span class="string">External       //表示的是5类的LSA</span></span><br><span class="line"> <span class="attr">Ls</span> <span class="string">id     : 192.168.3.0    //这条LSA的名字，是外部路由的网段</span></span><br><span class="line"> <span class="attr">Adv</span> <span class="string">rtr   : 6.6.6.6        //发布这条LSA的路由器，是ASBR的router-id</span></span><br><span class="line"> <span class="attr">Ls</span> <span class="string">age    : 1678 </span></span><br><span class="line"> <span class="attr">Len</span>       : <span class="string">36             //作用:在整个OSPF网络中，传输OSPF协议的外部路由</span></span><br><span class="line"> <span class="attr">Options</span>   :  <span class="string">E             //特点:只有ASBR可以产生5类LSA，5类LSA可以传输到整个OSPF网络的任何地方</span></span><br><span class="line"> <span class="attr">seq#</span>      : <span class="string">80000006             5类LSA在传输过程中，不会产生任何的变化</span></span><br><span class="line"> <span class="attr">chksum</span>    : <span class="string">0x83c5</span></span><br><span class="line"> <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0 </span></span><br><span class="line"> <span class="attr">TOS</span> <span class="string">0  Metric: 1           // cost值是1</span></span><br><span class="line"> <span class="attr">E</span> <span class="string">type    : 2              //引入外部路由，默认的类型是2</span></span><br><span class="line"> <span class="attr">Forwarding</span> <span class="string">Address : 0.0.0.0     //转发地址0.0.0.0 代表的就是6.6.6.6自己</span></span><br><span class="line"> <span class="attr">Tag</span>       : <span class="string">1 </span></span><br><span class="line"> <span class="attr">Priority</span>  : <span class="string">Low</span></span><br></pre></td></tr></table></figure><h2 id="ASBR-Summary-LSA"><a href="#ASBR-Summary-LSA" class="headerlink" title="ASBR-Summary LSA"></a>ASBR-Summary LSA</h2><h3 id="AS-Summary-LSA详解"><a href="#AS-Summary-LSA详解" class="headerlink" title="AS-Summary LSA详解"></a>AS-Summary LSA详解</h3><p><strong>ASBR-Summary LSA（4类LSA）：</strong></p><ul><li>由ABR产生，描述到ASBR的路由，通告给除ASBR所在区域的其他相关区域</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;dis</span> <span class="string">ospf lsdb asbr 6.6.6.6</span></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">           <span class="attr">Area</span>: <span class="string">0.0.0.12</span></span><br><span class="line">   <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"><span class="attr">Type</span>      : <span class="string">Sum-Asbr             //表示的是4类的LSA</span></span><br><span class="line"><span class="attr">Ls</span> <span class="string">id     : 6.6.6.6              //这条LSA的名字，是ASBR的Router-id</span></span><br><span class="line"><span class="attr">Adv</span> <span class="string">rtr   : 2.2.2.2              //发布这条LSA的路由器，是与ASBR在同一个区域的ABR的Router-id</span></span><br><span class="line"><span class="attr">Ls</span> <span class="string">age    : 1100              </span></span><br><span class="line"><span class="attr">Len</span>       : <span class="string">28                   //作用:在不同的OSPF区域之间，传递的ASBR的Router-id，帮助5类LSA计算外部路由</span></span><br><span class="line"><span class="attr">Options</span>   :  <span class="string">E                   //特点:只有ABR可以产生4类LSA</span></span><br><span class="line"><span class="attr">seq#</span>      : <span class="string">80000006                   4类LSA在传输过程中，每经过1个ABR，都会将经过的那个ABR的Router-id变成AdvRouter</span></span><br><span class="line"><span class="attr">chksum</span>    : <span class="string">0x2a09</span></span><br><span class="line"><span class="attr">Tos</span> <span class="string">0  metric: 4</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由2</title>
      <link href="/posts/routing2.html"/>
      <url>/posts/routing2.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="OSPF网络类型"><a href="#OSPF网络类型" class="headerlink" title="OSPF网络类型"></a>OSPF网络类型</h2><h3 id="七大状态"><a href="#七大状态" class="headerlink" title="七大状态"></a>七大状态</h3><table><thead><tr><th align="left">状态</th><th align="left">状态描述</th></tr></thead><tbody><tr><td align="left">Down</td><td align="left">OSPF最开始的状态</td></tr><tr><td align="left">Init</td><td align="left">初始化状态，收到对端发来Hello报文后状态为Init，但Hello报文中不含自己的Router ID</td></tr><tr><td align="left">two-way</td><td align="left">收到的Hello报文中包含有自己的Router ID ，则状态为2-way</td></tr><tr><td align="left">Exstart</td><td align="left">信息交换初始化状态，交互第一个DD报文，开始建立邻接状态</td></tr><tr><td align="left">Exchange</td><td align="left">信息交换状态，交互其余所有的DD报文</td></tr><tr><td align="left">Loading</td><td align="left">交互LSR，LSU，LSACK报文</td></tr><tr><td align="left">Full</td><td align="left">完全邻接状态</td></tr></tbody></table><ul><li>Down：发送hello报文</li><li>Init：接收到邻居发来的hello报文，但是该hello报文中没有自己的router id</li><li>Two-way：接收到的hello报文中，有自己的router-id，选举DR&#x2F;BDR</li><li>Exstart: 交互第一个dd 报文，确认主从关系，保证传输可靠</li><li>Exchange：交互数据库描述信息</li><li>Loading：数据库同步</li><li>Full：完全邻接状态</li></ul><h3 id="建立邻居关系"><a href="#建立邻居关系" class="headerlink" title="建立邻居关系"></a>建立邻居关系</h3><ul><li>OSPF使用Hello报文发现和建立邻居关系</li><li>在以太网链路上，缺省时，OSPF采用组播的形式发送Hello报文（目的地址224.0.0.5）</li><li>OSPF Hello报文中包含了路由器的RouterID、邻居列表等信息</li></ul><p><img src="/../img/img_artical/net_sec/6.2.1.png" alt="6.2.1"></p><h3 id="同步数据库"><a href="#同步数据库" class="headerlink" title="同步数据库"></a>同步数据库</h3><p><img src="/../img/img_artical/net_sec/6.2.2.png" alt="6.2.2"></p><p><strong>DD报文部分字段解释</strong></p><ul><li>I：当发送连续多个DD报文时，如果这是第一个DD报文，则置为1，否则置为0</li><li>M (More)：当发送连续多个DD报文时，如果这是最后一个DD报文，则置为0。否则置为1，表示后面还有其他的DD报文</li><li>MS (Master&#x2F;Slave)：当两台OSPF路由器交换DD报文时，首先需要确定双方的主从关系，RouterID大的一方会成为Master。当值为1时表示发送方Master</li><li>DD sequence number：DD报文序列号。主从双方利用序列号来保证DD报文传输的可靠性和完整性</li></ul><h3 id="OSPF网络类型-1"><a href="#OSPF网络类型-1" class="headerlink" title="OSPF网络类型"></a>OSPF网络类型</h3><p><strong>为什么要有网络类型</strong></p><ul><li>因为OSPF运行在不同的链路层就会有不同的问题，比如运行在以太网，默认为广播的网络环境下，就会存在共享网段中邻居数量多的问题，占用设备资源的问题，所以有了多种网络类型来适应不同的网络环境</li></ul><p><strong>OSPF有四种网络类型</strong></p><ul><li>广播类型（Broadcast）</li><li>非广播类型（NBMA）</li><li>点到点类型（P2P）</li><li>点到多点类型（P2MP）</li></ul><p><strong>链路层协议</strong></p><ul><li><p>当链路层协议是Ethernet，OSPF网络类型默认是Broadcast</p></li><li><p>当链路层协议是fr（帧中继）时，国内都已经不用了，OSPF运行在这个网络环境中，默认使用NBMA的网络类型 （不常见）</p></li><li><p>数据链路层运行的协议为PPP或者HDLC时，默认的网络类型为P2P</p></li><li><p>点到多点就是多个点到点（不常见）</p></li></ul><h2 id="DR和BDR"><a href="#DR和BDR" class="headerlink" title="DR和BDR"></a>DR和BDR</h2><h3 id="广播网络中的问题"><a href="#广播网络中的问题" class="headerlink" title="广播网络中的问题"></a>广播网络中的问题</h3><p><strong>一个共享网段中，存在多个OSPF路由器，同步信息效率低</strong></p><ul><li>任何一台路由器都会与其余所有路由器建立邻接关系，会形成n*(n-1)&#x2F;2个邻接关系，管理复杂</li><li>重复的发送和接收数据库信息，浪费带宽和设备资源</li></ul><p><img src="/../img/img_artical/net_sec/6.2.3.png" alt="6.2.3"></p><h3 id="DR"><a href="#DR" class="headerlink" title="DR"></a>DR</h3><p><strong>DR（Designated Router）：指定路由器</strong></p><ul><li>其他所有路由器都与DR建立邻接关系，和DR交换链路状态信息</li><li>其他路由器之间不建立邻接关系，不直接交换链路状态信息</li></ul><p><img src="/../img/img_artical/net_sec/6.2.4.png" alt="6.2.4"></p><h3 id="BDR"><a href="#BDR" class="headerlink" title="BDR"></a>BDR</h3><p><strong>BDR（Backup Designated Router）：备份指定路由器</strong></p><ul><li>为了规避单点故障风险，通过选举BDR，在DR失效时快速接管DR的工作</li><li>当一个网段中，具有多个ospf路由器的时候，为了快速和可靠的实现ospf数据库同步，需要指定一个路由器，也就是DR</li><li>选举为DR后，本网段中其他所有路由器，仅仅和DR同步消息，所以DR就拥有全部的数据库信息，所以DR非常重要</li><li>如果DR一旦出现故障，会导致DR与其他所有的路由器的邻接关系失效，数据库无法同步信息，也无法进行路由计算和数据转发</li><li>所以为了规避单点故障风险，会选举备份指定路由器，也就是BDR</li><li>在DR失效时，BDR可以快速接管DR的工作</li></ul><p><img src="/../img/img_artical/net_sec/6.2.5.png" alt="6.2.5"></p><h3 id="DR和BDR的作用"><a href="#DR和BDR的作用" class="headerlink" title="DR和BDR的作用"></a>DR和BDR的作用</h3><ul><li>减少邻接关系，降低设备负担</li><li>降低OSPF协议流量</li><li>加快数据库同步</li></ul><h3 id="DR与BDR的选举规则"><a href="#DR与BDR的选举规则" class="headerlink" title="DR与BDR的选举规则"></a>DR与BDR的选举规则</h3><p><strong>DR&#x2F;BDR的选举是非抢占式的</strong></p><p><strong>DR&#x2F;BDR的选举是基于端口的</strong></p><ul><li>接口的DR优先级越大越优先</li><li>接口的DR优先级相等时，RouterID越大越优先</li></ul><p><strong>每个网段中DR只有一个，BDR可以没有，DR必须有一个，如果没有DR，邻居将会一直卡在Two-way状态，无法建立邻接，无法full</strong></p><p><strong>当DR优先级为0时,不参加DR选举，直接变成DR-other</strong></p><p><strong>哪个接口先配置IP地址和OSPF，哪个接口会成为DR</strong></p><p><img src="/../img/img_artical/net_sec/6.2.6.png" alt="6.2.6"></p><h3 id="不同网络类型中DR与BDR的选举操作"><a href="#不同网络类型中DR与BDR的选举操作" class="headerlink" title="不同网络类型中DR与BDR的选举操作"></a>不同网络类型中DR与BDR的选举操作</h3><table><thead><tr><th>OSPF网络类型</th><th align="left">是否选举DR</th><th align="left">是否和邻居建立邻接关系</th></tr></thead><tbody><tr><td>P2P</td><td align="left">否</td><td align="left">是</td></tr><tr><td>Broadcast</td><td align="left">是</td><td align="left">DR与BDR、DRother建立邻接关系，BDR与DR、DRother建立邻接关系，DRother之间只建立邻居关系</td></tr><tr><td>NBMA</td><td align="left">是</td><td align="left">DR与BDR、DRother建立邻接关系，BDR与DR、DRother建立邻接关系，DRother之间只建立邻居关系</td></tr><tr><td>P2MP</td><td align="left">否</td><td align="left">是</td></tr></tbody></table><h3 id="路由器接口的角色分类"><a href="#路由器接口的角色分类" class="headerlink" title="路由器接口的角色分类"></a>路由器接口的角色分类</h3><ul><li>DR：指定路由器</li><li>BDR：备份指定路由器</li><li>DR-other：其他路由器<ul><li>同网段中，接口既不是DR，也不是BDR，就是DR-other</li></ul></li></ul><h3 id="路由器接口的角色概述"><a href="#路由器接口的角色概述" class="headerlink" title="路由器接口的角色概述"></a>路由器接口的角色概述</h3><ul><li>DR，BDR，DR-other都是指的接口，不是指的路由器</li><li>是在同一网段中选举DR，不是在一个区域中选举DR</li><li>在运行OSPF的路由器的多个接口角色可能相同，也可能不同<ul><li>比如：同一台路由器1个接口是DR，另外1个接口是DR-other</li></ul></li></ul><h3 id="DR优先级"><a href="#DR优先级" class="headerlink" title="DR优先级"></a>DR优先级</h3><p><strong>查看接口的DR优先级</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ospf interface</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 3.3.3.3</span></span><br><span class="line"> <span class="attr">Interfaces</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Area</span>: <span class="string">0.0.0.0      (MPLS TE not enabled)    ##优先级，默认1</span></span><br><span class="line"> <span class="attr">IP</span> <span class="string">Address      Type         State    Cost       Pri           DR              BDR </span></span><br><span class="line"> <span class="attr">192.168.23.3</span>    <span class="string">Broadcast    BDR      1          1             192.168.23.2    192.168.23.3</span></span><br><span class="line"> <span class="attr">192.168.34.3</span>    <span class="string">Broadcast    DR       1          1             192.168.34.3    192.168.34.4</span></span><br></pre></td></tr></table></figure><p><strong>优先级默认为1</strong></p><p><strong>修改接口的DR优先级</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ospf</span> <span class="string">dr-priority 100               //修改接口优先级为100</span></span><br><span class="line"><span class="attr">&lt;R3&gt;reset</span> <span class="string">ospf process                                      //重启OSPF进程</span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">The OSPF process will be reset. Continue? [Y/N]:y</span></span><br></pre></td></tr></table></figure><h2 id="OSPF数据库"><a href="#OSPF数据库" class="headerlink" title="OSPF数据库"></a>OSPF数据库</h2><h3 id="OSPF数据库-1"><a href="#OSPF数据库-1" class="headerlink" title="OSPF数据库"></a>OSPF数据库</h3><p><strong>OSPF数据库</strong></p><ul><li>OSPF数据库中，包含的是自己的链路状态信息，以及从邻居设备所学习过来的链路状态信息</li><li>而OSPF协议，正是通过链路状态信息，才可以将最终的路由条目计算出来，用于指导数据转发</li></ul><p><strong>查看OSPF数据库</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">ospf lsdb</span></span><br></pre></td></tr></table></figure><p><strong>LSDB：链路状态数据库</strong></p><ul><li>作用：存储LSA</li></ul><p><strong>LSA：链路状态通告</strong></p><ul><li>LSA是什么：用于计算路由的网段信息和拓扑信息</li><li>拓扑信息：拓扑图（我是谁，我连着谁）</li><li>网段信息：IP地址，掩码，cost值</li><li>拓扑信息和网段信息作用是什么？ 计算路由， 他们都属于计算路由的源材料</li><li>所以：LSA包含就是拓扑信息和网段信息，而拓扑信息和网段信息又是计算路由的原材料</li><li>所以LSA就是计算路由的原材料</li><li>数据库同步的过程，其实就是,邻居之间，LSA交换的过程</li></ul><h3 id="OSPF数据库解析"><a href="#OSPF数据库解析" class="headerlink" title="OSPF数据库解析"></a>OSPF数据库解析</h3><p><strong>查看OSPF数据库</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">ospf lsdb </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.0</span></span><br><span class="line"> <span class="attr">Type</span>      <span class="string">LinkState ID    AdvRouter          Age  Len   Sequence   Metric</span></span><br><span class="line"> <span class="attr">Router</span>    <span class="string">2.2.2.2         2.2.2.2            186  36    8000000C       1</span></span><br><span class="line"> <span class="attr">Router</span>    <span class="string">1.1.1.1         1.1.1.1            186  36    8000000F       1</span></span><br><span class="line"> <span class="attr">Network</span>   <span class="string">192.168.12.1    1.1.1.1            186  32    80000009       0</span></span><br><span class="line"> <span class="attr">Sum-Net</span>   <span class="string">192.168.45.0    2.2.2.2            186  28    80000008       3</span></span><br></pre></td></tr></table></figure><h3 id="LSA结构"><a href="#LSA结构" class="headerlink" title="LSA结构"></a>LSA结构</h3><p><strong>LSA结构</strong></p><ul><li>Type：类型：表示的是LSA的各种类型</li><li>LinkState ID：名字：表示的是LSA的名字</li><li>AdvRouter：通告路由器：表示的是产生这个LSA的路由器的router-id</li><li>Age：年龄：表示的是LSA的老化时间，最大时间是3600s</li><li>Len：长度：表示的是LSA的大小（单位是字节）</li><li>Sequence：序列号：表示的LSA的新旧程度，数值越大表示越新</li><li>Metric：度量值：表示链路的度量值</li></ul><h3 id="常见的LSA类型"><a href="#常见的LSA类型" class="headerlink" title="常见的LSA类型"></a>常见的LSA类型</h3><table><thead><tr><th align="center">类型</th><th align="center">名称</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">路由LSA<br />（Router LSA）</td><td align="center">每个设备都会产生，描述了区域内路由器的网段信息、拓扑信息与开销值</td></tr><tr><td align="center">2</td><td align="center">网络LSA<br />（Network LSA）</td><td align="center">由DR产生，辅助1类LSA完善区域内的拓扑信息和掩码</td></tr><tr><td align="center">3</td><td align="center">网络汇总LSA<br />（Network Summary LSA）</td><td align="center">由ABR产生，描述区域内某个网段的路由，该类LSA主要用于区域间路由的传递</td></tr><tr><td align="center">4</td><td align="center">ASBR汇总LSA<br />（ASBR Summary LSA）</td><td align="center">由ASBR产生，描述到ASBR的路由</td></tr><tr><td align="center">5</td><td align="center">AS外部LSA<br />（AS External LSA）</td><td align="center">由ASBR产生，用于描述到达OSPF的外部路由</td></tr><tr><td align="center">7</td><td align="center">非完全末梢区域LSA<br />(NSSA LSA)</td><td align="center">由ASBR产生，用于描述到达OSPF的外部路由</td></tr></tbody></table><h2 id="Router-LSA详解"><a href="#Router-LSA详解" class="headerlink" title="Router LSA详解"></a>Router LSA详解</h2><h3 id="Router-LSA详解-1"><a href="#Router-LSA详解-1" class="headerlink" title="Router LSA详解"></a>Router LSA详解</h3><p><strong>Router LSA（1类LSA）：</strong></p><ul><li>每台OSPF路由器都会产生</li><li>它描述了该路由器的拓扑信息、接口网络信息、度量值</li><li>Router LSA只能在所属的区域内传播</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R2&gt;display</span> <span class="string">ospf lsdb router 2.2.2.2             //查看名字为2.2.2.2的LSA</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 2.2.2.2</span></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.0</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">Router                             //Router表示是1类LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 2.2.2.2                            //表示这条LSA的名字，是该路由器的RouterID</span></span><br><span class="line">  <span class="attr">Adv</span> <span class="string">rtr   : 2.2.2.2                            //发布这条LSA的路由器，用RouterID表示</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 982                                //链路状态老化时间：此字段表示LSA已经生存的时间，单位是秒</span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">36                                 //是一个包含LSA头部在内的LSA的总长度值</span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">E                                 //每一个bit都对应了OSPF所支持的某种特性</span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">8000000f                           //链路状态序列号：当LSA每次有新的实例产生时，序列号就会增加</span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0xff30                             //校验和：用于保证数据的完整性和准确性。</span></span><br><span class="line">  <span class="attr">Link</span> <span class="string">count: 1                                  //作用：描述了设备的拓扑信息、网段信息、度量值</span></span><br><span class="line">   <span class="attr">*</span> <span class="string">Link ID: 192.168.23.2                       //特点：每个设备都会产生1类LSA,1类LSA只能在区域内传输</span></span><br><span class="line">     <span class="attr">Data</span>   : <span class="string">192.168.23.2 </span></span><br><span class="line">     <span class="attr">Link</span> <span class="string">Type: TransNet                         //连接类型           </span></span><br><span class="line">     <span class="attr">Metric</span> : <span class="string">1</span></span><br><span class="line">     </span><br><span class="line"><span class="attr">//广播型网络中的1类LSA，给出我们的信息遗漏两个重要的因素</span></span><br><span class="line">  <span class="attr">1）我们连接DR的那个接口的IP地址的掩码信息是多少，1类的LSA没有告诉我们</span></span><br><span class="line">     <span class="attr">192.168.23.2的掩码是多少，学习1类LSA的邻居是无法感知到的</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">2）通过1类的LSA，我们无法感知到邻居的存在，也无法感知用哪个接口连接着邻居</span></span><br><span class="line">    <span class="attr">只能感知到我们连接着DR</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">所以，在广播型网络中，我们学习到拓扑信息和网段信息不全，没有办法精确的计算出来路由</span></span><br><span class="line">  <span class="attr">所以在广播型网络中，我们还需要2类LSA来弥补1类LSA的不足</span></span><br></pre></td></tr></table></figure><p><strong>LSA的三元组：链路状态类型、链路状态ID、通告路由器三元组唯一地标识了一个LSA</strong><br><strong>判断LSA新旧：链路状态老化时间、链路状态序列号 、校验和用于判断LSA的新旧</strong></p><table><thead><tr><th align="left">Link Type</th><th align="left">Link ID</th><th align="left">Link Data</th></tr></thead><tbody><tr><td align="left">Point-to-Point(P2P)：描述一个从本路由器到邻居路由器之间的点到点链路，属于拓扑信息</td><td align="left">邻居路由器的Router ID</td><td align="left">宣告该Router LSA的路由器接口的IP地址</td></tr><tr><td align="left">TransNet：描述一个从本路由器到一个Transit网段(例如MA或者NBMA网段)的连接，属于拓扑信息</td><td align="left">DR的接口IP地址</td><td align="left">宣告该Router LSA的路由器接口的IP地址</td></tr><tr><td align="left">stubNet：描述一个从本路由器到一个stub网段(例如Loopback接口)的连接，属于网段信息</td><td align="left">宣告该RouterLSA的路由器接口的网络IP地址</td><td align="left">该Stub网络的网络掩码</td></tr></tbody></table><h2 id="Network-LSA详解"><a href="#Network-LSA详解" class="headerlink" title="Network LSA详解"></a>Network LSA详解</h2><h3 id="Network-LSA详解-1"><a href="#Network-LSA详解-1" class="headerlink" title="Network LSA详解"></a>Network LSA详解</h3><p><strong>Network LSA（2类LSA）：</strong></p><ul><li>由DR产生，描述本网段的链路状态，在所属的区域内传播</li><li>Network LSA记录了该网段内所有与DR建立了邻接关系的OSPF路由器，同时携带了该网段的网络掩码</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]display</span> <span class="string">ospf lsdb network 192.168.23.2</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 2.2.2.2</span></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.0</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">Network                    //表示是2类LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 192.168.23.2               //这条LSA的名字，是该网段中DR这个接口的IP地址                                                   Adv rtr   : 2.2.2.2                    //AdvRouter：发布这条LSA的路由器是DR接口所在的那台OSPF路由器的RouterID</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 6                          </span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">32                           </span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">E                       </span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">8000000a </span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0x4a68</span></span><br><span class="line">  <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0              //作用：补全DR所在网段的掩码信息，同时记录了该网段内所有与DR建立邻接关系的OSPF路由器，</span></span><br><span class="line">  <span class="attr">Priority</span>  : <span class="string">Low                          描述完整的区域内的拓扑信息</span></span><br><span class="line">     <span class="attr">Attached</span> <span class="string">Router    2.2.2.2          //特点：DR产生2类LSA，2类LSA仅仅在区域内传输</span></span><br><span class="line">     <span class="attr">Attached</span> <span class="string">Router    3.3.3.3          //最后两条信息，代表DR的管理范围</span></span><br><span class="line">                                           <span class="attr">也就是说：2.2.2.2</span> <span class="string">连接着DR，要和DR建立邻接关系，这个2.2.2.2归DR管理</span></span><br><span class="line">                                           <span class="attr">3.3.3.3</span> <span class="string">连接着DR，要和DR建立邻接关系，这个3.3.3.3归DR管理</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由1</title>
      <link href="/posts/routing1.html"/>
      <url>/posts/routing1.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="动态路由的优势"><a href="#动态路由的优势" class="headerlink" title="动态路由的优势"></a>动态路由的优势</h2><h3 id="企业现状"><a href="#企业现状" class="headerlink" title="企业现状"></a>企业现状</h3><p><strong>随着企业的发展，网络规模也不断在扩大</strong></p><ul><li>网络设备、网段数量越来越多</li><li>需要配置的路由条目越来越多</li></ul><h3 id="存在问题"><a href="#存在问题" class="headerlink" title="存在问题"></a>存在问题</h3><p><strong>在大型网络中存在的问题</strong></p><ul><li>静态路由，配置工作量大，效率低，出错率高</li><li>静态路由不能动态感知网络变化，不会自动更新</li><li>设备新增或删减，网络地址变更时，静态路由需要重新配置</li><li>当网络拓扑发生变更时，维护工作量大，网络中断时间过长</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>动态路由</strong></p><ul><li>动态路由协议可以自动更新，快速适应网络拓扑的变化</li></ul><p><strong>动态路由协议的特点</strong></p><ul><li>自动计算路由，无需手动配置</li><li>网络拓扑变更时，自动更新路由，无需手动配置</li><li>支持负载均衡，提高网络可靠性</li><li>能够选择出最优的路由</li></ul><h3 id="路由分类"><a href="#路由分类" class="headerlink" title="路由分类"></a>路由分类</h3><p><strong>–直连路由</strong></p><p><strong>–非直连路由</strong></p><ul><li>静态路由</li><li>动态路由<ul><li>IGP：内部网关路由协议-在同一个AS内部使用（在企业或者数据中心内部使用）<ul><li>DV：距离矢量路由协议<ul><li>RIP（v1&#x2F;v2）</li><li>IGRP-思科私有协议</li><li>EIGRP-思科私有协议</li></ul></li><li>LS：链路状态路由协议<ul><li>OSPF：开放式最短路径优先（企业用：功能多，可以精细化控制）</li><li>ISIS：中间系统到中间系统（数据中心用，转发能力强，大流量转发）</li></ul></li></ul></li><li>EGP：外部网关路由协议：在不同的AS之间使用（AS：自治系统）<ul><li>BGP：边界网关协议</li></ul></li></ul></li></ul><h2 id="OSPF概述"><a href="#OSPF概述" class="headerlink" title="OSPF概述"></a>OSPF概述</h2><h3 id="OSPF协议概述"><a href="#OSPF协议概述" class="headerlink" title="OSPF协议概述"></a>OSPF协议概述</h3><p><strong>OSPF协议概述</strong></p><ul><li>OSPF（Open Shortest Path First）：开放式最短路径优先</li><li>开放式：公有协议，所有厂商的设备都支持</li><li>最短路径优先：以最短路径，最快的方式转发数据包</li><li>作用：动态感知全网状态，自动计算最优路由，便于大型网络中对路由的管理和维护</li><li>应用：通常应用于企业内部和数据中心内部</li><li>版本：OSPFv2（IPv4）和OSPFv3（IPv6）</li><li>工作在OSI模型第三层，数据封装在IP头部后面，协议号为89</li><li>OSPF是基于链路状态的内部网关协议</li></ul><h3 id="OSPF协议优势"><a href="#OSPF协议优势" class="headerlink" title="OSPF协议优势"></a>OSPF协议优势</h3><p><strong>OSPF协议优势</strong></p><ul><li>利用”累计COST值”计算最优路由</li><li>采用组播形式收发部分协议报文，提高效率</li><li>引入区域概念，支持区域划分，降低设备压力</li><li>支持对等价路由进行负载分担，提高可靠性</li><li>支持报文认证，提高安全性</li><li>OSPF基于IP协议，为了可靠性，数据库同步：协商主从关系，序列号、有确认机制</li></ul><h3 id="OSPF应用场景"><a href="#OSPF应用场景" class="headerlink" title="OSPF应用场景"></a>OSPF应用场景</h3><p><strong>大型企业网络</strong></p><p><strong>基础概念：</strong></p><ul><li>Router ID</li><li>Area ID</li><li>Cost</li></ul><p><img src="/../img/img_artical/net_sec/6.1.1.png" alt="6.1.1"></p><h3 id="OSPF进程号"><a href="#OSPF进程号" class="headerlink" title="OSPF进程号"></a>OSPF进程号</h3><p><strong>OSPF进程号：Process</strong></p><ul><li>OSPF进程可以手动指定，如果未指定，则默认为1</li><li>作用：在同一个设备上，区分不同的OSPF路由协议</li><li>在同一个设备上，进程号不同的OSPF协议相互隔离</li><li>OSPF进程号只在本设备起作用，不在网络中传递</li><li>进程号范围&lt;1-65535&gt;</li></ul><h3 id="Router-ID"><a href="#Router-ID" class="headerlink" title="Router ID"></a>Router ID</h3><p><strong>OSPF使用Router ID唯一的标识一台运行OSPF的路由器</strong></p><ul><li>OSPF协议为路由设备取的名字，用于唯一的表示一台路由设备</li><li>特点：稳定，即一旦确定，就不会改变，除非重启OSPF进程</li><li>Router ID确定方式：可以手动指定，也可以自动选举，建议手动指定</li><li>如果没有手动配置RouterID，则路由器使用Lookback接口中最大的IP地址作为RouterID</li><li>如果没有配置Lookback接口，则路由器使用物理接口中最大的IP地址作为RouterID</li><li>备注：自动选举的前提是所有接口同时运行ospf，如果没有同时运行，哪个接口先启用ospf，就选择哪个接口的地址号做RouterID</li></ul><p><img src="/../img/img_artical/net_sec/6.1.2.png" alt="6.1.2"></p><h3 id="Area-ID"><a href="#Area-ID" class="headerlink" title="Area ID"></a>Area ID</h3><p>Area用于标识一个OSPF的区域</p><ul><li>将路由设备划分为不同的组，每个组用区域号（Area ID）来标识</li><li>网络规模大，路由表庞大，路由设备负担高，OSPF协议通过划分不同的区域来缩减路由表规模，降低路由设备负担</li></ul><p><img src="/../img/img_artical/net_sec/6.1.3.png" alt="6.1.3"></p><p><img src="/../img/img_artical/net_sec/6.1.4.png" alt="6.1.4"></p><h3 id="OSPF区域"><a href="#OSPF区域" class="headerlink" title="OSPF区域"></a>OSPF区域</h3><p><strong>OSPF骨干区域</strong></p><ul><li>区域号为0，表示的是“骨干区域”</li></ul><p><strong>OSPF非骨干区域</strong></p><ul><li>区域号不为0，表示的就是“非骨干区域”</li><li>非骨干区域必须和骨干区域“直接“相连，能实现”区域之间的互通“</li></ul><p><strong>OSPF区域的标识</strong></p><ul><li>通过十进制表示，例如区域0,1,2,3等，范围是0 - 4294967295</li><li>通过点分十进制表示，例如区域0.0.0.0,1.1.1.1,2.2.2.2,3.3.3.3等，范围是0.0.0.0 - 255.255.255.255</li></ul><h3 id="Cost"><a href="#Cost" class="headerlink" title="Cost"></a>Cost</h3><p><strong>Cost：开销</strong></p><ul><li>OSPF使用Cost作为路由的度量值</li><li>每一个开启OSPF功能的物理接口都有一个Cost值，默认值是1</li></ul><p><img src="/../img/img_artical/net_sec/6.1.5.png" alt="6.1.5"></p><p><strong>OSPF路径累计开销值</strong></p><ul><li>流量从源网络到目的网络所经过所有路由器的出接口的cost总和</li><li>例如：R3的路由表中到达10.1.1.0&#x2F;24的OSPF路由的cost是1+1+1&#x3D;3</li></ul><p><img src="/../img/img_artical/net_sec/6.1.6.png" alt="6.1.6"></p><h2 id="OSPF工作过程"><a href="#OSPF工作过程" class="headerlink" title="OSPF工作过程"></a>OSPF工作过程</h2><h3 id="OSPF工作原理"><a href="#OSPF工作原理" class="headerlink" title="OSPF工作原理"></a>OSPF工作原理</h3><ul><li>建立OSPF邻居表</li><li>同步OSPF数据库</li><li>计算OSPF路由表</li></ul><h2 id="OSPF单区域配置"><a href="#OSPF单区域配置" class="headerlink" title="OSPF单区域配置"></a>OSPF单区域配置</h2><h3 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>需求：在不同部门之间的PC互联互通</strong></p><p><strong>如果只有1个区域，则必须为骨干区域：Area 0</strong></p><p><img src="/../img/img_artical/net_sec/6.1.7.png" alt="6.1.7"></p><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>配置网络设备的接口IP地址和掩码</li><li>配置OSPF进程号</li><li>配置OSPF Router ID</li><li>配置OSPF 区域号</li><li>宣告接口的网段到OSPF</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置OSPF - R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R1]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]network</span> <span class="string">192.168.1.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R2]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R3</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]ospf</span> <span class="string">1 router-id 3.3.3.3</span></span><br><span class="line"><span class="attr">[R3]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R3]network</span> <span class="string">192.168.2.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R3]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><h3 id="OSPF邻居表解析"><a href="#OSPF邻居表解析" class="headerlink" title="OSPF邻居表解析"></a>OSPF邻居表解析</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ospf peer brief </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">  <span class="attr">Peer</span> <span class="string">Statistic Information</span></span><br><span class="line"> <span class="attr">----------------------------------------------------------------------------</span></span><br><span class="line"> <span class="attr">Area</span> <span class="string">Id          Interface                        Neighbor id      State    </span></span><br><span class="line"> <span class="attr">0.0.0.12</span>         <span class="string">GigabitEthernet0/0/0             2.2.2.2          Full        </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> #Router ID - 表示OSPF协议为R1起的名字</span></span><br><span class="line"><span class="comment"> #Area ID - 表示R1当前建立邻居关系所在的区域</span></span><br><span class="line"><span class="comment"> #Neighbor ID - 表示邻居路由器的OSPF Router ID</span></span><br><span class="line"><span class="comment"> #State - 表示邻居路由器的状态，最终的完美状态是Full（完全邻接）</span></span><br></pre></td></tr></table></figure><h3 id="OSPF报文类型"><a href="#OSPF报文类型" class="headerlink" title="OSPF报文类型"></a>OSPF报文类型</h3><p><strong>Hello报文：</strong></p><ul><li>用于发现、建立、维护和拆除OSPF邻居</li></ul><p><strong>数据库描述报文（DBD、DD）：</strong></p><ul><li>用于发送OSPF数据库条目的简要信息，实现数据库同步</li></ul><p><strong>链路状态请求报文（LSR）：</strong></p><ul><li>用于请求自己数据库中没有的链路状态通告信息（LSA）</li></ul><p><strong>链路状态更新报文（LSU）</strong></p><ul><li>用于回应LSR报文，发送链路状态信息（LSA）</li></ul><p><strong>链路状态确认报文（LSACK）</strong></p><ul><li>对收到对方的更新报文（LSU）进行确认</li></ul><h3 id="建立邻居关系"><a href="#建立邻居关系" class="headerlink" title="建立邻居关系"></a>建立邻居关系</h3><ul><li>OSPF使用Hello报文发现和建立邻居关系</li><li>在以太网链路上，缺省时，OSPF采用组播的形式发送Hello报文（目的地址224.0.0.5）</li><li>OSPF Hello报文中包含了路由器的RouterID、邻居列表等信息</li></ul><h3 id="邻居建立影响因素"><a href="#邻居建立影响因素" class="headerlink" title="邻居建立影响因素"></a>邻居建立影响因素</h3><p><strong>邻居建立失败原因：</strong></p><ul><li>两台路由器的Router ID相同，不能建立邻居</li><li>两台路由器的Area ID不同，不能建立邻居</li><li>两台路由器的三层不通，不能建立邻居</li></ul><h2 id="OSPF多区域配置"><a href="#OSPF多区域配置" class="headerlink" title="OSPF多区域配置"></a>OSPF多区域配置</h2><h3 id="大型网络中，单区域OSPF存在的问题"><a href="#大型网络中，单区域OSPF存在的问题" class="headerlink" title="大型网络中，单区域OSPF存在的问题"></a>大型网络中，单区域OSPF存在的问题</h3><p><strong>为什么要划分多区域</strong></p><ul><li>数据库庞大</li><li>路由表庞大</li><li>设备压力大，资源消耗高</li><li>无法进行路由汇总</li></ul><p><strong>多区域的优势</strong></p><ul><li>只有同一个区域内的路由器才需要同步数据库，不同区域的路由不需要同步数据库</li><li>所以同步数据库的设备少，数据报文就少，设备压力也小，也不过多浪费带宽</li><li>由于数据报文少，所以数据库最终就小</li><li>数据库小，数据库同步的速度就快，计算路由就快</li><li>数据库小，最终路由器表也小，转发数据的速度就快，公司的网络质量就好</li></ul><h3 id="OSPF路由器类型"><a href="#OSPF路由器类型" class="headerlink" title="OSPF路由器类型"></a>OSPF路由器类型</h3><table><thead><tr><th align="left">路由器类型</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">区域路由器</td><td align="left">路由器所有接口都属于同一个OSPF区域</td></tr><tr><td align="left">骨干区域路由器</td><td align="left">路由器只要有一个接口属于骨干区域</td></tr><tr><td align="left">区域边界路由器（ABR）</td><td align="left">同时连接着骨干区域和非骨干区域的路由器</td></tr><tr><td align="left">自治区域边界路由器（ASBR）</td><td align="left">与其他AS交换路由信息的路由器称为ASBR，具有产生外部路由能力的路由器</td></tr></tbody></table><h3 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>企业核心机房，连接不同办公楼宇，实现不同楼宇互通</strong></p><p><img src="/../img/img_artical/net_sec/6.1.8.png" alt="6.1.8"></p><h3 id="配置思路-1"><a href="#配置思路-1" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li><p>如图连接并配置设备接口IP地址</p></li><li><p>将R1和R2设置为区域12，R5和R6设置为区域56</p></li><li><p>将R2&#x2F;R3&#x2F;R4&#x2F;R5设置为区域0，最终实现PC1和PC2的互通</p></li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置OSPF - R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-0.0.0.12]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1-ospf-1-0.0.0.12]network</span> <span class="string">192.168.1.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-0.0.0.12]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2-ospf-1-0.0.0.12]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R2-ospf-1-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R3</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]ospf</span> <span class="string">1 router-id 3.3.3.3</span></span><br><span class="line"><span class="attr">[R3-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R3-ospf-1-0.0.0.0]network</span> <span class="string">192.168.34.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R3-ospf-1-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R4</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R4]ospf</span> <span class="string">1 router-id 4.4.4.4</span></span><br><span class="line"><span class="attr">[R4-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R4-ospf-1-0.0.0.0]network</span> <span class="string">192.168.34.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R4-ospf-1-0.0.0.0]network</span> <span class="string">192.168.45.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R5</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R5]ospf</span> <span class="string">1 router-id 5.5.5.5</span></span><br><span class="line"><span class="attr">[R5-ospf-1]area</span> <span class="string">56</span></span><br><span class="line"><span class="attr">[R5-ospf-1-0.0.0.56]network</span> <span class="string">192.168.56.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R5-ospf-1-0.0.0.56]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R5-ospf-1-0.0.0.0]network</span> <span class="string">192.168.45.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R5</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R6]ospf</span> <span class="string">1 router-id 6.6.6.6</span></span><br><span class="line"><span class="attr">[R6-ospf-1]area</span> <span class="string">56</span></span><br><span class="line"><span class="attr">[R6-ospf-1-0.0.0.56]network</span> <span class="string">192.168.56.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R6-ospf-1-0.0.0.56]network</span> <span class="string">192.168.2.0 0.0.0.255</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全5</title>
      <link href="/posts/campus5.html"/>
      <url>/posts/campus5.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="NAT原理"><a href="#NAT原理" class="headerlink" title="NAT原理"></a>NAT原理</h2><h3 id="NAT技术背景"><a href="#NAT技术背景" class="headerlink" title="NAT技术背景"></a>NAT技术背景</h3><p><strong>NAT技术背景</strong></p><ul><li>为节省IPv4地址，企业内网使用的都是”私有IP地址”</li><li>Internet网络的组成设备，使用都是”公有IP地址”</li><li>所以企业内网要与lnternet 互通，必须拥有”公有IP地址”</li></ul><h3 id="NAT概述"><a href="#NAT概述" class="headerlink" title="NAT概述"></a>NAT概述</h3><p><strong>NAT (Network Address Translation )，网络地址转换</strong></p><ul><li>主要应用在企业网络的边界设备上</li><li>对IP数据报文头部中的”私有IP地址”转换为”公有IP地址”实现内网到外网的访问</li><li>实现对企业内网的保护，增强企业内网的安全性，因为外网无法直接访问内网设备的私有IP地址</li></ul><h3 id="NAT工作原理"><a href="#NAT工作原理" class="headerlink" title="NAT工作原理"></a>NAT工作原理</h3><p><strong>NAT对IP报头中的源IP进行地址转换</strong></p><p><img src="/../img/img_artical/net_sec/5.5.1.png" alt="5.5.1"></p><p><strong>NAT工作表：NAT会话表</strong></p><p><img src="/../img/img_artical/net_sec/5.5.2.png" alt="5.5.2"></p><h3 id="NAT类型"><a href="#NAT类型" class="headerlink" title="NAT类型"></a>NAT类型</h3><p><strong>静态NAT</strong></p><ul><li>私有IP地址和公有IP地址1对1转换，不节省公有IP</li></ul><p><strong>动态NAT</strong></p><ul><li>基于”NAT地址池”实现”私有地址”和”公有地址”之间的随机转换</li><li>一个公有地址在不同的时间可以为多个私有地址进行转换，但在同一时间一个公有地址只能为一个私有地址进行转换，所以要求NAT地址池中的公有地址数量要多于企业内部私有地址的数量，所以这种方式并不常用</li></ul><p><strong>NAPT：网络地址端口转换（Network Address Port Translation）</strong></p><ul><li>多对一的地址转换，使用“IP地址+端口号”的形式进行转换，使多个私有IP地址可共用一个公网IP地址访问外网</li><li>允许多个私有地址转换为同一个公有地址，因此也称为“多对一地址转换”或地址复用</li><li>NAPT的实现方式主要有EasyIP和地址池NAPT</li></ul><p><strong>NAT Server</strong></p><ul><li>NAT Server是一种特殊的静态NAT</li><li>主要应用于外网用户访问企业内网服务器的场景</li></ul><h3 id="NAT总结"><a href="#NAT总结" class="headerlink" title="NAT总结"></a>NAT总结</h3><p><strong>NAT配置在出口设备的出接口上</strong></p><p><strong>NAT转换表</strong></p><ul><li>NAT有一个转换表：一个私有IP 和一个公网IP绑定在一起</li><li>数据包出去的时候，转换源IP： 将源IP由私有IP转换为公有IP，  目标IP不变</li><li>数据包回来的时候，转换目的IP： 将目的IP由公有IP地址，转换为私有IP，源IP不变</li></ul><p><strong>备注</strong></p><ul><li>默认路由解决的是数据出去的问题</li><li>NAT解决的时候数据回来的问题</li></ul><h2 id="静态NAT配置"><a href="#静态NAT配置" class="headerlink" title="静态NAT配置"></a>静态NAT配置</h2><h3 id="静态NAT"><a href="#静态NAT" class="headerlink" title="静态NAT"></a>静态NAT</h3><ul><li>静态NAT也称Basic NAT</li><li>静态NAT属于私有IP地址和公有IP地址1对1转换</li><li>静态NAT只转换IP地址，不转换端口号</li></ul><h3 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>企业内网的PC需要访问”公有服务器”</strong></p><ul><li>企业租用了1个公网地址段：100.1.1.0&#x2F;29</li><li>实现企业内网主机访问外部网络</li></ul><p><img src="/../img/img_artical/net_sec/5.5.3.png" alt="5.5.3"></p><h3 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h3><ul><li>在企业网络的边界设备上，配置默认路由，企业内网数据可以发送到Internet</li><li>因为Internet设备上没有”私有IP地址”的路由条目，所以数据无法返回到”企业内网”</li><li>在企业网络的边界设备（路由器）上，使用静态NAT技术，实现”私有IP地址”和”公网IP地址”互相转换</li></ul><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置接口IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在企业边界设备R1的出接口配置静态NAT</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>R1重要配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">static global 100.1.1.3 inside 192.168.1.1     //配置静态NAT</span></span><br></pre></td></tr></table></figure><h2 id="动态NAT配置"><a href="#动态NAT配置" class="headerlink" title="动态NAT配置"></a>动态NAT配置</h2><h3 id="动态NAT"><a href="#动态NAT" class="headerlink" title="动态NAT"></a>动态NAT</h3><ul><li>动态NAT基于”NAT地址池”实现”私有地址”和”公有地址”之间的随机转换</li><li>一个公有地址在不同的时间可以为多个私有地址进行转换，但在同一时间一个公有地址只能为一个私有地址进行转换，所以要求NAT地址池中的公有地址数量要多于企业内部私有地址的数量，所以这种方式并不常用</li></ul><h3 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求"></a>案例需求</h3><ul><li>企业内网的PC需要访问”公网服务器”</li><li>部署NAT地址池，实现私有IP地址和地址池里面的公网IP地址动态转换，实现内网多个私有主机访问外网</li></ul><p><img src="/../img/img_artical/net_sec/5.5.4.png" alt="5.5.4"></p><h3 id="案例分析-1"><a href="#案例分析-1" class="headerlink" title="案例分析"></a>案例分析</h3><ul><li>企业租用公网地址段100.1.1.0&#x2F;29</li><li>在R1连接”公网”的接口上，部署动态NAT，即让多个私有IP地址轮询使用NAT地址池里面的公网IP地址</li><li>100.1.1.0&#x2F;29子网中，可用IP地址仅有6个<br>地址范围：100.1.1.0-100.1.1.7<br>可用地址范围：100.1.1.1-100.1.1.6<br>100.1.1.1配置在R1出接口，100.1.1.2配置在R2-ISP接口<br>NAT地址池可用剩余地址：100.1.1.3-200.1.1.6</li></ul><h3 id="配置思路-1"><a href="#配置思路-1" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置接口IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在企业边界设备R1中创建公网地址池，用于NAT转换</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在企业边界设备R1的出接口配置动态NAT</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p>R1重要配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]nat</span> <span class="string">address-group 1 100.1.1.3 100.1.1.5                   //创建NAT地址池</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                  //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000 address-group 1 no-pat           //配置动态NAT，且不做端口转换</span></span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>动态NAT</strong></p><ul><li>基于”NAT地址池”实现”私有IP地址”和”公有IP地址”之间的转换</li><li>一个公有IP地址在不同的时间可以为多个私有IP地址进行转换</li><li>但是在同一时间一个公有IP地址只能为一个私有IP地址的网络会话进行转换</li><li>所以，如果公司的内网设备有同时上网的需求，产生大量网络会话，会导致NAT地址池枯竭</li><li>那么NAT地址池里公有IP地址的数量就需要很多很多，才有可能满足私有IP地址的主机上网的需求</li><li>所以动态NAT也没有达到节省公有IP地址的目的</li></ul><h2 id="NAPT之地址池NAT"><a href="#NAPT之地址池NAT" class="headerlink" title="NAPT之地址池NAT"></a>NAPT之地址池NAT</h2><h3 id="NAPT"><a href="#NAPT" class="headerlink" title="NAPT"></a>NAPT</h3><p><strong>NAPT（Network Address Port Translation）网络地址接口转换</strong></p><ul><li>使用”IP地址 + 端口号”的形式进行转换</li><li>使多个私有IP共用一个公有IP地址访问外网，节约公有IP地址</li><li>可以实现高并发的地址转换，也称为”多对一地址转换”或地址复用</li></ul><p><img src="/../img/img_artical/net_sec/5.5.5.png" alt="5.5.5"></p><h3 id="配置思路-2"><a href="#配置思路-2" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在企业边界设备R1中创建公网地址池，用于NAT转换</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在边界设备R1的出接口配置NAPT之地址池NAT</li></ul><h3 id="配置命令-2"><a href="#配置命令-2" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>R1重要配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]nat</span> <span class="string">address-group 1 100.1.1.3 100.1.1.5                   //创建NAT地址池</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                  //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000 address-group                    //配置NAPT，相比动态NAT，缺少了no-pat参数</span></span><br></pre></td></tr></table></figure><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><strong>NAPT：网络地址端口转换</strong></p><ul><li>使用”IP地址＋端口号”的形式进行转换，使多个私有IP地址可共用一个公网IP地址访问外网</li><li>允许多个私有地址同时转换为同一个公有地址，因此也称为“多对一地址转换”或地址复用</li><li>NAPT的实现方式主要有EasyIP和地址池NAPT</li><li>地址池NAT在目前企业中应用的最为广泛，是最主流的NAT解决方案</li><li>地址池NAT适用于大型企业，主机数量多企业</li></ul><h2 id="NAPT之Easy-IP"><a href="#NAPT之Easy-IP" class="headerlink" title="NAPT之Easy IP"></a>NAPT之Easy IP</h2><h3 id="案例需求-2"><a href="#案例需求-2" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>中小型企业，租用公网网段200.1.1.0&#x2F;30</strong></p><ul><li>可用地址范围：200.1.1.1-200.1.1.2，分别配置在边界设备的出接口和ISP设备的设备接口上，没有空闲的公网IP地址可以做NAT转换，所以使用EasyIP</li></ul><p><img src="/../img/img_artical/net_sec/5.5.6.png" alt="5.5.6"></p><h3 id="Easy-IP"><a href="#Easy-IP" class="headerlink" title="Easy IP"></a>Easy IP</h3><ul><li>EasyIP是一种特殊的NAPT，最节省公网IP地址</li><li>EasyIP使用出接口的公网IP地址作为NAT转换后的地址</li><li>EasyIP使用“IP地址+端口号”的形式进行转换</li><li>EasyIP可以利用ACL来控制哪些内部地址可以进行地址转换</li><li>EasyIP方式特别适合中小型局域网访问Internet的情况</li></ul><h3 id="配置思路-3"><a href="#配置思路-3" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在边界设备R1的出接口配置NAPT之EasyIP</li></ul><h3 id="配置命令-3"><a href="#配置命令-3" class="headerlink" title="配置命令"></a>配置命令</h3><p>R1重要配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                  //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000                                  //配置EasyIP</span></span><br></pre></td></tr></table></figure><h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p><strong>easy-ip</strong></p><ul><li><p>利用出口设备的出接口IP地址做NAT转换</p></li><li><p>这是目前最节约公网IP的一种NAT解决方案</p></li><li><p>easy-ip  适用于中小型企业，主机数量少的企业</p></li></ul><h2 id="NAT-Server"><a href="#NAT-Server" class="headerlink" title="NAT Server"></a>NAT Server</h2><h3 id="NAT-Server-1"><a href="#NAT-Server-1" class="headerlink" title="NAT Server"></a>NAT Server</h3><ul><li>NAT具有“屏蔽”内部主机的作用，但有时内网需要向外网提供服务，比如提供WEB服务，这种情况下需要内网的服务器不被“屏蔽”，外网用户可以随时访问内网服务器</li><li>NAT Server可以很好地解决外网主机访问内网服务器的需求</li><li>NAT Server需要提前配置好“公网IP地址+端口号”与“私网IP+端口号”的映射关系</li><li>当外网用户访问内网服务器时，将服务器的“公网IP地址+端口号”转换为对应的“私网IP地址+端口号”</li></ul><h3 id="案例需求-3"><a href="#案例需求-3" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>企业内网部署Web服务器，对外提供服务</strong></p><ul><li>允许外网主机访问企业内部服务器，使用NAT Server</li></ul><p><strong>允许企业内网主机访问外部网络，使用EasyIP或者地址池IP</strong></p><p><img src="/../img/img_artical/net_sec/5.5.7.png" alt="5.5.7"></p><h3 id="实验分析"><a href="#实验分析" class="headerlink" title="实验分析"></a>实验分析</h3><ul><li>外网用户通过互联网访问任何服务和应用，都是依靠“运营商”的路由设备</li><li>运营商的路由器没有私有网段的路由，只能访问公网地址才可以</li><li>企业租用公网IP地址，外部用户通过这些地址才能访问</li><li>企业网络设备必须能够实现”私有地址”和”公有地址”的转换</li><li>为了实现外网主机访问内网服务器，我们使用NAT Server</li></ul><h3 id="配置思路-4"><a href="#配置思路-4" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>配置内网服务器的IP地址和网关</li><li>配置并启用内网服务器的Web服务</li><li>在企业边界设备R1中配置接口IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在边界设备R1的出接口配置NAPT之EasyIP</li><li>在边界设备R1的出接口配置NAT Server</li></ul><h3 id="配置命令-4"><a href="#配置命令-4" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>R1重要配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                                        //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                                   //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                                             //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000                                                   //配置EasyIP</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">server protocol tcp global 100.1.1.6 80 inside 192.168.1.1 80   //配置NAT Server</span></span><br></pre></td></tr></table></figure><h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p><strong>NAT Server</strong></p><ul><li><p>是一种特殊的静态NAT</p></li><li><p>主要应用于外网用户访问企业内网服务器的场景</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全4</title>
      <link href="/posts/campus4.html"/>
      <url>/posts/campus4.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="ACL原理"><a href="#ACL原理" class="headerlink" title="ACL原理"></a>ACL原理</h2><h3 id="安全问题日益严峻"><a href="#安全问题日益严峻" class="headerlink" title="安全问题日益严峻"></a>安全问题日益严峻</h3><p><strong>随着网络的飞速发展，网络安全问题日益突出</strong></p><ul><li>企业重要服务器资源被随意访问，机密信息容易泄露，存在安全隐患</li><li>Internet病毒肆意侵略企业内网，内网环境的安全性堪忧</li><li>网络带宽被各类业务占用，导致重要的业务带宽得不到保障</li></ul><h3 id="ACL应用场景"><a href="#ACL应用场景" class="headerlink" title="ACL应用场景"></a>ACL应用场景</h3><p><strong>企业需求</strong></p><ul><li>为保证财务数据安全，禁止售后部门访问财务服务器，允许总裁办访问</li><li>禁止PC1访问财务服务器，允许PC2访问财务服务器</li></ul><p><strong>解决方案</strong></p><ul><li>配置ACL，控制数据包转发</li></ul><p><img src="/../img/img_artical/net_sec/5.4.1.png" alt="5.4.1"></p><h3 id="ACL概述"><a href="#ACL概述" class="headerlink" title="ACL概述"></a>ACL概述</h3><p><strong>ACL（Access Control List），访问控制列表</strong></p><ul><li>ACL是一个包含了多个规则的列表，不同规则通过”规则号”进行区分</li><li>每条”规则”都包含：动作 + 条件两部分内容</li><li>动作分为：允许（permit）和 拒绝（deny）</li><li>条件分为：地址和端口等···</li><li>主要用于在网络中的众多数据报文中，”抓取”感兴趣的数据</li><li>ACL本质上是一种报文过滤器，可以根据规则对报文进行过滤，按照规则的动作选择允许报文通过和阻止报文通过</li><li>ACL的作用是对数据报文进行访问控制，提高网络安全性</li></ul><h3 id="ACL作用"><a href="#ACL作用" class="headerlink" title="ACL作用"></a>ACL作用</h3><ul><li><p>对网络中数据报文进行过滤，做访问控制，</p></li><li><p>提高内网安全性， 提高带宽利用率</p></li></ul><h3 id="ACL命令解析"><a href="#ACL命令解析" class="headerlink" title="ACL命令解析"></a>ACL命令解析</h3><p><strong>ACL配置命令举例</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>ACL命令解析</strong></p><ul><li>2000：表示的是”ACL的名字”，可以通过ID表示，也可以通过字符表示</li><li>rule：表示的是”规则”</li><li>10：表示的是”规则号”，取值范围是0-4294967294</li><li>permit：表示的是动作 - 允许；（deny表示的是动作 - 拒绝）</li><li>source：表示当前的”规则”检查的是数据包中的源地址</li><li>192.168.1.0：表示的是源IP地址段</li><li>0.0.0.255：表示的是与源IP地址段对应的通配符掩码</li></ul><h3 id="ACL类型"><a href="#ACL类型" class="headerlink" title="ACL类型"></a>ACL类型</h3><p><strong>基本ACL</strong></p><ul><li>只能匹配”源IP地址”</li><li>匹配数据不精准</li><li>ACL的ID取值范围是：2000 - 2999</li></ul><p><strong>高级ACL</strong></p><ul><li>可以匹配：源和目的IP地址、源和目的端口号、协议号等</li><li>匹配的数据更加精准</li><li>ACL的ID取值范围是：3000 - 3999</li></ul><h3 id="ACL组成"><a href="#ACL组成" class="headerlink" title="ACL组成"></a>ACL组成</h3><p>**ACL编号：用于标识ACL **</p><ul><li>基本：2000-2999</li><li>高级：3000-3999</li></ul><p><strong>规则：即描述报文匹配条件的判断语句</strong></p><ul><li>规则编号：用于标识规则，范围： 0～4294967294，规则号越小越好， 规则号可以手动指定，也可以根据步长值自动分配</li><li>动作：包括permit &#x2F; deny两种动作，表示允许 &#x2F; 拒绝</li><li>匹配项：地址、端口、通配符····</li></ul><p><strong>IP地址通配符也是有0和1组成的</strong></p><ul><li>“0”表示”检查相应的位”，”1”表示”不检查相应的位”</li><li>总结：检查0，忽略1</li></ul><h3 id="ACL配置机制"><a href="#ACL配置机制" class="headerlink" title="ACL配置机制"></a>ACL配置机制</h3><p><strong>ACL配置顺序</strong></p><ul><li>根据ACL规则编号从小到大匹配（编号越小越优先被匹配）</li></ul><p><strong>ACL匹配机制</strong></p><ul><li><p>匹配即停止</p></li><li><p>如果没有匹配到第一条规则，向下查找第二条规则，如果匹配，则按照第二条规则的动作去执行</p></li><li><p>如果所有规则都无法匹配，则执行隐含规则</p><p>允许所有：只要使用traffic-filter调用ACL规则时默认规则是允许所有</p><p>拒绝所有：只要不使用traffic-filter调用ACL就是拒绝所有</p></li></ul><p><img src="/../img/img_artical/net_sec/5.4.2.png" alt="5.4.2"></p><h2 id="基本ACL配置"><a href="#基本ACL配置" class="headerlink" title="基本ACL配置"></a>基本ACL配置</h2><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><p><strong>企业需求：禁止PC1访问财务服务器，允许PC2访问</strong></p><p><img src="/../img/img_artical/net_sec/5.4.3.png" alt="5.4.3"></p><h3 id="基本ACL配置命令"><a href="#基本ACL配置命令" class="headerlink" title="基本ACL配置命令"></a>基本ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                 //创建acl2000</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 deny source 192.168.1.0 0.0.0.255       //配置acl规则</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R1-g0/0/0]traffic-filter</span> <span class="string">outbound acl 2000                  //在接口上调用acl2000</span></span><br></pre></td></tr></table></figure><h2 id="高级ACL配置"><a href="#高级ACL配置" class="headerlink" title="高级ACL配置"></a>高级ACL配置</h2><h3 id="实验需求"><a href="#实验需求" class="headerlink" title="实验需求"></a>实验需求</h3><p><strong>实验需求</strong></p><ul><li>售后部仅仅能访问Server1上的Web服务，不能访问其他服务</li><li>售后部可以访问行政部的所有设备的任何服务</li><li>除了上述权限外，售后部不能访问网络中的其他任何主机</li></ul><p><img src="/../img/img_artical/net_sec/5.4.4.png" alt="5.4.4"></p><h3 id="高级ACL配置命令"><a href="#高级ACL配置命令" class="headerlink" title="高级ACL配置命令"></a>高级ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]acl</span> <span class="string">3000                                                                                                 //创建acl3000</span></span><br><span class="line"><span class="attr">[R1-acl-3000]rule</span> <span class="string">10 permit tcp source 192.168.1.1 0 destination 192.168.3.1 0 destination-port eq 80        //配置acl规则</span></span><br><span class="line"><span class="attr">[R1-acl-3000]rule</span> <span class="string">20 permit ip source 192.168.1.1 0 destination 192.168.2.0 0.0.0.255                        //配置acl规则</span></span><br><span class="line"><span class="attr">[R1-acl-3000]rule</span> <span class="string">30 deny ip source 192.168.1.1 0 destination any                                            //配置acl规则</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">g0/0/2</span></span><br><span class="line"><span class="attr">[R1-g0/0/2]traffic-filter</span> <span class="string">outbound acl 3000                                                                  //在接口上调用acl3000</span></span><br></pre></td></tr></table></figure><h2 id="高级ACL之ICMP"><a href="#高级ACL之ICMP" class="headerlink" title="高级ACL之ICMP"></a>高级ACL之ICMP</h2><h3 id="实验需求-1"><a href="#实验需求-1" class="headerlink" title="实验需求"></a>实验需求</h3><p><strong>实验需求</strong></p><ul><li>售后部主机仅仅能 ping通Server1，不能访问Server1其他服务</li><li>售后部主机可以访问行政部的所有设备的任何服务</li><li>除了上述权限外，售后部不能访问网络中的其他任何主机</li></ul><p><img src="/../img/img_artical/net_sec/5.4.5.png" alt="5.4.5"></p><h3 id="高级ACL配置命令-1"><a href="#高级ACL配置命令-1" class="headerlink" title="高级ACL配置命令"></a>高级ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R1]acl 3000                                                                           //创建acl3000</span><br><span class="line">[R1-acl-3000]rule 10 permit icmp source 192.168.1.1 0 destination 192.168.3.1 0        //配置acl规则</span><br><span class="line">[R1-acl-3000]rule 20 permit ip source 192.168.1.1 0 destination 192.168.2.0 0.0.0.255  //配置acl规则</span><br><span class="line">[R1-acl-3000]rule 30 deny ip source 192.168.1.1 0 destination any                      //配置acl规则</span><br><span class="line">[R1]interface g0/0/2</span><br><span class="line">[R1-g0/0/2]traffic-filter outbound acl 3000                                            //在接口上调用acl3000</span><br></pre></td></tr></table></figure><h2 id="基本ACL之Telnet"><a href="#基本ACL之Telnet" class="headerlink" title="基本ACL之Telnet"></a>基本ACL之Telnet</h2><h3 id="实验需求-2"><a href="#实验需求-2" class="headerlink" title="实验需求"></a>实验需求</h3><p><strong>实验需求</strong></p><ul><li>为了便于设备管理，为设备开启远程管理功能，登录密码:NTD</li><li>仅仅允许R1的192.168.1.254 远程登录R2，其他设备不可以</li><li>拒绝R1的任何IP地址远程登录 R3，其他设备都可以</li></ul><p><img src="/../img/img_artical/net_sec/5.4.6.png" alt="5.4.6"></p><h3 id="配置远程访问功能"><a href="#配置远程访问功能" class="headerlink" title="配置远程访问功能"></a>配置远程访问功能</h3><p><strong>配置远程访问</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R2-ui-vty0-4]authentication-mode</span> <span class="string">password</span></span><br><span class="line"><span class="attr">please</span> <span class="string">configure the login password (maximum length 16):NTD</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R3]authentication-mode</span> <span class="string">password</span></span><br><span class="line"><span class="attr">please</span> <span class="string">configure the login password (maximum length 16):NTD</span></span><br></pre></td></tr></table></figure><h3 id="基本ACL配置命令-1"><a href="#基本ACL配置命令-1" class="headerlink" title="基本ACL配置命令"></a>基本ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]acl</span> <span class="string">2000                                          //创建acl2000</span></span><br><span class="line"><span class="attr">[R2-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.254 0    //配置acl规则</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R2-ui-vty0-4]acl</span> <span class="string">2000 inbound                        //在接口上调用acl2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]acl</span> <span class="string">2000                                          //创建acl2000</span></span><br><span class="line"><span class="attr">[R3-acl-2000]rule</span> <span class="string">10 deny source 192.168.1.254 0      //配置acl规则</span></span><br><span class="line"><span class="attr">[R3-acl-2000]rule</span> <span class="string">20 deny source 192.168.12.1 0       //配置acl规则</span></span><br><span class="line"><span class="attr">[R3-acl-2000]rule</span> <span class="string">30 permit source any                //配置acl规则</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R3-ui-vty0-4]acl</span> <span class="string">2000 inbound                        //在接口上调用acl2000</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全3</title>
      <link href="/posts/campus3.html"/>
      <url>/posts/campus3.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="子网划分概述"><a href="#子网划分概述" class="headerlink" title="子网划分概述"></a>子网划分概述</h2><h3 id="子网划分的原因"><a href="#子网划分的原因" class="headerlink" title="子网划分的原因"></a>子网划分的原因</h3><ul><li><p>节省IP地址，减少IP地址的浪费</p></li><li><p>满足不同网络对IP地址的需求</p></li><li><p>实现网络设备编址的层次化需求</p></li></ul><p><img src="/../img/img_artical/net_sec/5.3.1.png" alt="5.3.1"></p><h3 id="子网划分的理解"><a href="#子网划分的理解" class="headerlink" title="子网划分的理解"></a>子网划分的理解</h3><p><img src="/../img/img_artical/net_sec/5.3.2.png" alt="5.3.2"></p><h3 id="子网划分概述-1"><a href="#子网划分概述-1" class="headerlink" title="子网划分概述"></a>子网划分概述</h3><p><strong>子网划分是什么</strong></p><ul><li>子网划分指将一个网络划分为多个更小的网络</li></ul><p><strong>如何进行子网划分</strong></p><ul><li>将主机位借给网络位（让主机位变短，让网络位变长）</li></ul><h2 id="子网划分的方法"><a href="#子网划分的方法" class="headerlink" title="子网划分的方法"></a>子网划分的方法</h2><h3 id="子网划分的理解-1"><a href="#子网划分的理解-1" class="headerlink" title="子网划分的理解"></a>子网划分的理解</h3><p><strong>将192.168.1.0&#x2F;24划分为4个小网段</strong></p><ul><li>将主机位划到网络位</li></ul><p><img src="/../img/img_artical/net_sec/5.3.3.png" alt="5.3.3"></p><p><img src="/../img/img_artical/net_sec/5.3.4.png" alt="5.3.4"></p><p><img src="/../img/img_artical/net_sec/5.3.5.png" alt="5.3.5"></p><h3 id="C类地址的划分"><a href="#C类地址的划分" class="headerlink" title="C类地址的划分"></a>C类地址的划分</h3><p><strong>IP地址经过一次子网划分后，被分成三个部分–网络位、子网位和主机位</strong></p><p><img src="/../img/img_artical/net_sec/5.3.6.png" alt="5.3.6"></p><h2 id="等长子网划分应用"><a href="#等长子网划分应用" class="headerlink" title="等长子网划分应用"></a>等长子网划分应用</h2><h3 id="子网划分实例"><a href="#子网划分实例" class="headerlink" title="子网划分实例"></a>子网划分实例</h3><p><strong>某分公司共有生产部、销售部、财务部、客服部四个部门，每个部门的主机数最多不超过50台，若该公司获得了一个C类地址192.168.100.0&#x2F;24应该如何划分子网呢？</strong></p><p><strong>解决方案：执行等长的子网划分</strong></p><ul><li><p>划分4个相同大小的子网网段</p></li><li><p>每个子网网段中的IP地址数量相同</p></li><li><p>划分结果：分配4个子网网段，掩码为26<br>192.168.100.0&#x2F;26   （第一个子网网段）<br>192.168.100.64&#x2F;26   （第二个子网网段）<br>192.168.100.128&#x2F;26  （第三个子网网段）<br>192.168.100.192&#x2F;26  （第四个子网网段）</p></li></ul><table><thead><tr><th>部门</th><th>网段</th><th>掩码</th><th>有效地址</th></tr></thead><tbody><tr><td>生产部</td><td>192.168.100.0&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>销售部</td><td>192.168.100.64&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>财务部</td><td>192.168.100.128&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>客服部</td><td>192.168.100.192&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr></tbody></table><h2 id="可变长子网划分方法"><a href="#可变长子网划分方法" class="headerlink" title="可变长子网划分方法"></a>可变长子网划分方法</h2><h3 id="VLSM概述"><a href="#VLSM概述" class="headerlink" title="VLSM概述"></a>VLSM概述</h3><p><strong>VLSM</strong></p><ul><li>一个进行了子网划分的网络中的不同子网网段使用不同的子网掩码，而且每个子网网段中的IP地址数量也不一致</li></ul><h2 id="可变长子网划分应用"><a href="#可变长子网划分应用" class="headerlink" title="可变长子网划分应用"></a>可变长子网划分应用</h2><h3 id="子网划分实例-1"><a href="#子网划分实例-1" class="headerlink" title="子网划分实例"></a>子网划分实例</h3><p><strong>如果销售部有主机90台，生产部有50台，客服部有26台，财务部有15台应该如何划分子网呢？</strong></p><p><strong>解决方案：执行不等长的子网划分</strong></p><ul><li><p>划分4个不同大小的子网网段</p></li><li><p>每个子网网段中的IP地址数量不同</p></li><li><p>划分结果：分配4个子网网段<br>192.168.100.0&#x2F;25  （第一个子网网段）<br>192.168.100.128&#x2F;26   （第二个子网网段）<br>192.168.100.192&#x2F;27  （第三个子网网段）<br>192.168.100.224&#x2F;27  （第四个子网网段）</p></li></ul><table><thead><tr><th>部门</th><th>网段</th><th>掩码</th><th>有效地址</th></tr></thead><tbody><tr><td>销售部</td><td>192.168.100.0&#x2F;25</td><td>255.255.255.128</td><td>126</td></tr><tr><td>生产部</td><td>192.168.100.128&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>客服部</td><td>192.168.100.192&#x2F;27</td><td>255.255.255.224</td><td>30</td></tr><tr><td>财务部</td><td>192.168.100.224&#x2F;27</td><td>255.255.255.224</td><td>30</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全2</title>
      <link href="/posts/campus2.html"/>
      <url>/posts/campus2.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="多VLAN网关负载分担"><a href="#多VLAN网关负载分担" class="headerlink" title="多VLAN网关负载分担"></a>多VLAN网关负载分担</h2><h3 id="多VLAN网关负载分担-1"><a href="#多VLAN网关负载分担-1" class="headerlink" title="多VLAN网关负载分担"></a>多VLAN网关负载分担</h3><p><strong>多VLAN网关负载分担</strong></p><ul><li>创建多个备份组，每个备份组都有一台虚拟路由器</li><li>每个物理路由器在不同的VRRP组中扮演不同的角色</li><li>不同的虚拟路由器的Virtual IP作为不同的内网网关地址，实现流量转发负载分担</li></ul><h3 id="多VLAN网关负载分担实验"><a href="#多VLAN网关负载分担实验" class="headerlink" title="多VLAN网关负载分担实验"></a>多VLAN网关负载分担实验</h3><p><strong>拓扑</strong></p><p><img src="/../img/img_artical/net_sec/5.2.1.png" alt="5.2.1"></p><p><strong>需求：实现网关冗余，VLAN流量的负载均衡</strong></p><p><strong>SW1是备份组10的主网关</strong></p><p><strong>SW2是备份组20的主网关</strong></p><p><strong>步骤：</strong></p><ul><li><p>第一步：配置PC的IP地址，子网掩码，网关</p></li><li><p>第二步：交换机配置VLAN，接口加入指定VLAN</p><ul><li><p>SW3交换机创建VLAN10、VLAN20</p></li><li><p>SW3交换机与PC连接的接口都设置为Access模式，并分别加入VLAN10、VLAN20</p></li><li><p>SW3交换机与SW1、SW2连接的接口设置为Trunk模式</p></li><li><p>SW1、SW2与SW1连接的接口设置为Trunk模式</p></li></ul></li><li><p>第三步：交换机配置VLAN接口IP地址</p></li><li><p>第四步：交换机配置浮动路由</p><ul><li>配置备份组10、备份组20</li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">配置命令：</span></span><br><span class="line"><span class="attr">第一步：配置PC的IP地址，子网掩码，网关</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步：交换机配置VLAN，接口加入指定VLAN</span></span><br><span class="line"><span class="attr">1）SW3交换机创建VLAN10、VLAN20</span></span><br><span class="line"><span class="attr">2）SW3交换机与PC连接的接口都设置为Access模式，并分别加入VLAN10、VLAN20</span></span><br><span class="line"><span class="attr">3）SW3交换机与SW1、SW2连接的接口设置为Trunk模式</span></span><br><span class="line"><span class="attr">4）SW1、SW2与SW1连接的接口设置为Trunk模式</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW3]vlan</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[SW3]interface</span> <span class="string">gigabitethernet0/0/0</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/0]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/0]port</span> <span class="string">default vlan 10</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/0]interface</span> <span class="string">gigabitethernet0/0/1</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/1]port</span> <span class="string">default vlan 20</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/1]port-group</span> <span class="string">group-member g0/0/2 g0/0/3</span></span><br><span class="line"><span class="attr">[SW3-port-group]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[SW3-port-group]port</span> <span class="string">trunk allow-all vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">gigabitethernet0/0/0</span></span><br><span class="line"><span class="attr">[SW1-gigabitethernet0/0/0]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[SW1-gigabitethernet0/0/0]port</span> <span class="string">trunk allow-all vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]vlan</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[SW2]interface</span> <span class="string">gigabitethernet0/0/0</span></span><br><span class="line"><span class="attr">[SW2-gigabitethernet0/0/0]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[SW2-gigabitethernet0/0/0]port</span> <span class="string">trunk allow-all vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步：交换机配置VLAN接口IP地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">vlanif 10</span></span><br><span class="line"><span class="attr">[SW1-VlanIf10]ip</span> <span class="string">address 192.168.10.251 24</span></span><br><span class="line"><span class="attr">[SW1-VlanIf10]interface</span> <span class="string">vlanif 20</span></span><br><span class="line"><span class="attr">[SW1-VlanIf20]ip</span> <span class="string">address 192.168.20.251 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]interface</span> <span class="string">vlanif 10</span></span><br><span class="line"><span class="attr">[SW2-VlanIf10]ip</span> <span class="string">address 192.168.10.252 24</span></span><br><span class="line"><span class="attr">[SW2-VlanIf10]interface</span> <span class="string">vlanif 20</span></span><br><span class="line"><span class="attr">[SW2-VlanIf20]ip</span> <span class="string">address 192.168.20.252 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第四步：交换机配置浮动路由</span></span><br><span class="line"><span class="attr">1）配置备份组10、备份组20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]vrrp</span> <span class="string">vrid 10 virtual-ip 192.168.10.254</span></span><br><span class="line"><span class="attr">[SW1]vrrp</span> <span class="string">vrid 10 priority 130</span></span><br><span class="line"><span class="attr">[SW1]vrrp</span> <span class="string">vrid 20 virtual-ip 192.168.10.254</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]vrrp</span> <span class="string">vrid 10 virtual-ip 192.168.10.254</span></span><br><span class="line"><span class="attr">[SW2]vrrp</span> <span class="string">vrid 20 virtual-ip 192.168.10.254</span></span><br><span class="line"><span class="attr">[SW2]vrrp</span> <span class="string">vrid 20 priority 130</span></span><br></pre></td></tr></table></figure><h2 id="BFD原理"><a href="#BFD原理" class="headerlink" title="BFD原理"></a>BFD原理</h2><h3 id="现网中存在的问题"><a href="#现网中存在的问题" class="headerlink" title="现网中存在的问题"></a>现网中存在的问题</h3><p><strong>现网中存在的问题</strong></p><ul><li>网络应用的广泛部署，网络发生故障导致企业业务长时间中断</li><li>如何快速有效的发现网络设备或链路出现的故障</li><li>如何以毫秒级的速度发现网络问题</li><li>如何及时发现问题，解决问题，保障网络的可靠性</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>BFD（Bidirectional Forwarding Detection）</strong></p><ul><li>双向转发检测</li><li>BFD提供了一个通用的、标准化的、介质无关的、协议无关的快速故障检测机制</li></ul><p><strong>BFD的作用</strong></p><ul><li>专门用于发送超小和超快的检测数据包，以毫秒级进行发送，快速检测链路的故障，改善网络性能</li><li>当发现链路故障时，通知相关的设备和协议进行处理，快速恢复通信，保证网络可靠性</li></ul><h3 id="BFD原理描述"><a href="#BFD原理描述" class="headerlink" title="BFD原理描述"></a>BFD原理描述</h3><p><strong>原理简介</strong></p><ul><li>BFD在两台网络设备上建立会话</li><li>会话建立后会周期性地快速发送BFD报文，用来检测链路状态</li><li>如果在检测时间内没有收到BFD报文则认为链路发生故障，通知上层应用进行处理</li></ul><h3 id="BFD会话建立方式"><a href="#BFD会话建立方式" class="headerlink" title="BFD会话建立方式"></a>BFD会话建立方式</h3><p><strong>BFD会话建立有两种方式</strong></p><ul><li>静态建立</li><li>动态建立</li><li>静态和动态的主要区别：本地标识符和远端标识符配置方式不同</li></ul><p><strong>静态建立</strong></p><ul><li>手工配置BFD会话参数（手工配置：本地标识符和远端标识符）</li></ul><p><strong>动态建立</strong></p><ul><li>动态分配本地标识符、自动学习远端标识符</li></ul><h3 id="BFD检测机制"><a href="#BFD检测机制" class="headerlink" title="BFD检测机制"></a>BFD检测机制</h3><p><strong>BFD检测机制</strong></p><ul><li>两个设备建立BFD会话，链路两端周期性发送BFD控制报文</li><li>如果一端在既定的时间内没有收到报文，则认为路径上发生了故障</li></ul><p><img src="/../img/img_artical/net_sec/5.2.2.png" alt="5.2.2"></p><h3 id="BFD会话常见参数的缺省配置"><a href="#BFD会话常见参数的缺省配置" class="headerlink" title="BFD会话常见参数的缺省配置"></a>BFD会话常见参数的缺省配置</h3><table><thead><tr><th align="center">参数</th><th align="center">缺省值</th></tr></thead><tbody><tr><td align="center">发送间隔</td><td align="center">1000毫秒</td></tr><tr><td align="center">接收间隔</td><td align="center">1000毫秒</td></tr><tr><td align="center">本地检测倍数</td><td align="center">3</td></tr></tbody></table><h2 id="BFD与静态路由联动"><a href="#BFD与静态路由联动" class="headerlink" title="BFD与静态路由联动"></a>BFD与静态路由联动</h2><h3 id="BFD与静态路由联动-1"><a href="#BFD与静态路由联动-1" class="headerlink" title="BFD与静态路由联动"></a>BFD与静态路由联动</h3><p><img src="/../img/img_artical/net_sec/5.2.3.png" alt="5.2.3"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">配置BFD</span></span><br><span class="line"><span class="attr">[R1]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R1-bfd]quit</span></span><br><span class="line"><span class="attr">[R1]bfd</span> <span class="string">ntd bind peer-id 192.168.24.4           //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">local 1       //配置本端设备标识为1</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">remote 4      //配置远端设备标识为4</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R4]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R4-bfd]quit</span></span><br><span class="line"><span class="attr">[R4]bfd</span> <span class="string">ntd bind peer-id 192.168.12.1           //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R4-bfd-session-ntd]discriminator</span> <span class="string">local 4       //配置本端设备标识为4</span></span><br><span class="line"><span class="attr">[R4-bfd-session-ntd]discriminator</span> <span class="string">remote 1      //配置远端设备标识为1</span></span><br><span class="line"><span class="attr">[R4-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br><span class="line"></span><br><span class="line"><span class="attr">配置浮动路由</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.12.2</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.13.3 preference 70</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.34.0 24  192.168.12.2 </span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.12.1</span></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.24.4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.13.1</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.34.4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.24.2 </span></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.34.3 preference 70</span></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.13.0 24 192.168.24.2 </span></span><br><span class="line"></span><br><span class="line"><span class="attr">配置BFD和静态路由联动</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.12.2 track bfd-session ntd        //当BFD检测到指定链路不通时，从路由表中删除该静态路由</span></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.24.2 track bfd-session ntd        //当BFD检测到指定链路不通时，从路由表中删除该静态路由</span></span><br></pre></td></tr></table></figure><h2 id="BFD与VRRP联动"><a href="#BFD与VRRP联动" class="headerlink" title="BFD与VRRP联动"></a>BFD与VRRP联动</h2><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li>R1故障，R2切换为主网关</li><li>默认切换时间为3s</li><li>希望主&#x2F;备网关实现快速切换</li></ul><p><img src="/../img/img_artical/net_sec/5.2.4.png" alt="5.2.4"></p><h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>实现主备角色快速切换</strong></p><ul><li>在R1和R2之间，建立BFD会话</li><li>在R2上配置VRRP链路追踪，跟踪对象为BFD会话</li><li>一旦BFD会话的状态为down，则增加R2的优先级，确保R2升级为主路由器</li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><strong>在R1和R2之间建立BFD会话</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R1-bfd]quit</span></span><br><span class="line"><span class="attr">[R1]bfd</span> <span class="string">ntd bind peer-id 192.168.1.252          //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">local 1       //配置本端设备标识为1</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">remote 4      //配置远端设备标识为4</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R2-bfd]quit</span></span><br><span class="line"><span class="attr">[R2]bfd</span> <span class="string">ntd bind peer-id 192.168.1.251          //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R2-bfd-session-ntd]discriminator</span> <span class="string">local 4       //配置本端设备标识为4</span></span><br><span class="line"><span class="attr">[R2-bfd-session-ntd]discriminator</span> <span class="string">remote 1      //配置远端设备标识为1</span></span><br><span class="line"><span class="attr">[R2-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br></pre></td></tr></table></figure><p><strong>在R2上配置VRRP链路追踪，跟踪BFD会话</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]interface</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R2-G0/0/0]vrrp</span> <span class="string">vrid 1 track bfd-session 2 increased 110   //如果BFD会话断开，那么R2的优先级增加110</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全1</title>
      <link href="/posts/campus1.html"/>
      <url>/posts/campus1.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="浮动路由"><a href="#浮动路由" class="headerlink" title="浮动路由"></a>浮动路由</h2><h3 id="网络经典故障"><a href="#网络经典故障" class="headerlink" title="网络经典故障"></a>网络经典故障</h3><p><strong>单路径故障</strong></p><ul><li>通信终端之间仅仅存在一个转发路径</li></ul><p><strong>单路径风险</strong></p><ul><li>当这条唯一的路径出现故障，终端之间的通信都会彻底中断</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>冗余路径</strong></p><ul><li>在互联设备之间增加一条冗余路径，实现备份作用</li></ul><h3 id="技术实现"><a href="#技术实现" class="headerlink" title="技术实现"></a>技术实现</h3><p><strong>浮动路由</strong></p><ul><li><p>浮动路由又称为路由备份，由两条或多条链路组成浮动路由</p></li><li><p>浮动路由指配置两条静态路由，这两条静态路由的目的地址相同，但是下一跳不同</p></li><li><p>给这两条静态路由设置不同优先级，优先级高的那条静态路由作为主链路，优先级低的那条静态路由作为备份链路</p></li><li><p>也叫浮动静态路由，是一种特殊的静态路由，用于提供一种备份路径</p></li><li><p>当主路径出现故障时，备份路径就会启动，保持网络的连通性</p></li><li><p>配置完浮动路由后，备份链路不进入路由表，只有当主链路出现故障时，备份链路才进入路由表</p></li><li><p>当主链路故障恢复后，主链路进入路由表，承担数据转发任务，备份链路变为不可用状态，移出路由表</p></li></ul><p><strong>浮动路由的作用</strong></p><ul><li>预防单路径故障，保持网络的不中断</li></ul><p><strong>浮动路由的特点</strong></p><ul><li>浮动路由在同一时刻，数据只会由一条路径进行转发</li></ul><p><strong>浮动路由优先级</strong></p><ul><li>当去往同一个目的地有多条路由时，为了判断最优路由，各路由协议（包括静态路由）都被赋予了一个优先级</li><li>优先级高的路由会成为最优路由，路由器会将最优路由条目放入本地IP核心路由表中</li><li>路由优先级：优先级用数值表示，数值越小优先级越高</li></ul><table><thead><tr><th align="center">路由类别</th><th align="center">路由优先级</th></tr></thead><tbody><tr><td align="center">Direct：直连路由</td><td align="center">0</td></tr><tr><td align="center">Static：静态路由</td><td align="center">60</td></tr></tbody></table><h3 id="浮动路由配置命令"><a href="#浮动路由配置命令" class="headerlink" title="浮动路由配置命令"></a>浮动路由配置命令</h3><p><img src="/../img/img_artical/net_sec/5.1.1.png" alt="5.1.1"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.2.2</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.3.2 preference 70</span></span><br></pre></td></tr></table></figure><h3 id="浮动路由实验"><a href="#浮动路由实验" class="headerlink" title="浮动路由实验"></a>浮动路由实验</h3><p><strong>拓扑</strong></p><p><img src="/../img/img_artical/net_sec/5.1.2.png" alt="5.1.2"></p><p><strong>需求：配置浮动路由，实现链路冗余</strong></p><p><strong>步骤：</strong></p><ul><li><p>第一步：配置PC的IP地址，子网掩码，网关</p></li><li><p>第二步：交换机配置VLAN，接口加入指定VLAN</p><ul><li><p>SW1交换机创建VLAN10</p></li><li><p>SW1交换机的所有接口都设置为Access模式，并加入VLAN10</p></li><li><p>SW2交换机创建VLAN40</p></li><li><p>SW2交换机的所有接口都设置为Access模式，并加入VLAN40</p></li></ul></li><li><p>第三步：路由器配置接口IP地址</p></li><li><p>第四步：路由器配置浮动路由</p><ul><li><p>配置192.168.3.0&#x2F;24为备份链路，指定路由优先级为70</p></li><li><p>配置192.168.2.0&#x2F;24为主链路，静态路由默认优先级为60</p></li></ul></li><li><p>第五步：验证与测试</p><ul><li><p>验证是否主链路转发数据</p></li><li><p>验证是否主链路路由进入路由表</p></li><li><p>让主链路出现故障，验证备份路由是否起作用</p></li><li><p>恢复主链路，验证主链路是否重新取代备份链路进行工作</p></li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">配置命令：</span></span><br><span class="line"><span class="attr">第一步：配置PC的IP地址，子网掩码，网关</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步：交换机配置VLAN，接口加入指定VLAN</span></span><br><span class="line"><span class="attr">1）SW1交换机创建VLAN10</span></span><br><span class="line"><span class="attr">2）SW1交换机的所有接口都设置为Access模式，并加入VLAN10</span></span><br><span class="line"><span class="attr">3）SW2交换机创建VLAN40</span></span><br><span class="line"><span class="attr">4）SW2交换机的所有接口都设置为Access模式，并加入VLAN40</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">10</span></span><br><span class="line"><span class="attr">[SW1]quit</span></span><br><span class="line"><span class="attr">[SW1]port-group</span> <span class="string">proup-member GigabitEthernet0/0/1 to GigabitEthernet0/0/3</span></span><br><span class="line"><span class="attr">[SW1-port-group]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-port-group]port</span> <span class="string">default vlan 10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]vlan</span> <span class="string">40</span></span><br><span class="line"><span class="attr">[SW2]quit</span></span><br><span class="line"><span class="attr">[SW2]port-group</span> <span class="string">proup-member GigabitEthernet0/0/1 to GigabitEthernet0/0/2</span></span><br><span class="line"><span class="attr">[SW2-port-group]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW2-port-group]port</span> <span class="string">default vlan 40</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步：路由器配置接口IP地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.254 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]interface</span> <span class="string">GigabitEthernet0/0/1</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.2.1 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]interface</span> <span class="string">GigabitEthernet0/0/2</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/2]ip</span> <span class="string">address 192.168.3.1 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.4.254 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]interface</span> <span class="string">GigabitEthernet0/0/1</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.2.2 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]interface</span> <span class="string">GigabitEthernet0/0/2</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/2]ip</span> <span class="string">address 192.168.3.2 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第四步：路由器配置浮动路由</span></span><br><span class="line"><span class="attr">1）配置192.168.3.0/24为备份链路，指定路由优先级为70</span></span><br><span class="line"><span class="attr">2）配置192.168.4.0/24为主链路，静态路由默认优先级为60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.3.2 preference 70</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.2.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.3.1 preference 70</span></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.2.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第五步：验证与测试</span></span><br><span class="line"><span class="attr">1）验证是否主链路转发数据</span></span><br><span class="line"><span class="attr">2）验证是否主链路路由进入路由表</span></span><br><span class="line"><span class="attr">3）让主链路出现故障，验证备份路由是否起作用</span></span><br><span class="line"><span class="attr">4）恢复主链路，验证主链路是否重新取代备份链路进行工作</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table</span></span><br><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table 192.168.4.3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">备注：shutdown掉R1的g0/0/1</span> <span class="string">让主链路故障</span></span><br><span class="line"><span class="attr">验证备份链路是否工作</span></span><br></pre></td></tr></table></figure><h2 id="VRRP基本概念"><a href="#VRRP基本概念" class="headerlink" title="VRRP基本概念"></a>VRRP基本概念</h2><h3 id="网络经典故障-1"><a href="#网络经典故障-1" class="headerlink" title="网络经典故障"></a>网络经典故障</h3><p><strong>单网关面临的问题</strong></p><ul><li>当网关故障后，网段中的主机无法上网</li></ul><h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>通过部署多网关的方式实现网关备份</strong></p><p><strong>存在的问题</strong></p><ul><li>如何定义主机的网关地址</li></ul><h3 id="技术实现-1"><a href="#技术实现-1" class="headerlink" title="技术实现"></a>技术实现</h3><p><strong>VRRP</strong></p><ul><li>把多台路由设备联合组成一台虚拟的路由器配置一个虚拟网关IP地址</li><li>虚拟网关IP作为主机的网关，实现网关的备份</li></ul><h3 id="VRRP概述"><a href="#VRRP概述" class="headerlink" title="VRRP概述"></a>VRRP概述</h3><p><strong>VRRP协议</strong></p><ul><li>Virtual Router Redundancy Protocol，虚拟路由冗余协议</li><li>由IETF标准RFC2338定义，是公有标准协议，任何厂商设备都支持</li><li>VRRP协议位于OSI模型第三层，协议号为112</li><li>VRRP发送报文的方式为组播，地址为224.0.0.18</li></ul><p><strong>VRRP 的作用</strong></p><ul><li>实现多个真实网关的冗余备份</li><li>实现数据转发的负载均衡</li></ul><p><strong>VRRP组成员角色</strong></p><ul><li>主路由器：Master  →  负责承担数据报文转发任务</li><li>备份路由器：Backup  →  负责监控主路由器状态</li><li>虚拟路由器 ：Virtual → ⼜称 VRRP 备份组，虚拟路由器的 IP 地址作为局域网中主机的默认网关</li></ul><p><strong>VRRP主备角色选择原则</strong></p><ul><li>首先比较优先级，优先级大的为 master</li><li>如果优先级⼀致，其次比较 IP 地址，IP 地址⼤的为 master （模拟器⽆法模拟）</li></ul><p><strong>VRRP须知</strong></p><ul><li>在⼀个 VRRP 备份组中，Master 设备有且仅有⼀个</li><li>VRRP 协议包括两个版本：VRRPv2 和 VRRPv3</li><li>VRRPv2 仅适用于 IPv4 网络，VRRPv3 适用于 IPv4 和 IPv6 两种网络</li><li>VRRP 协议报文封装在 IP 报头的后面，协议号是 112</li><li>VRRP 通告报⽂源地址为主路由器物理接⼝的 IP 地址（不是虚拟 IP 地址），⽬的地址是 224.0.0.18</li></ul><h3 id="VRRP基本概念-1"><a href="#VRRP基本概念-1" class="headerlink" title="VRRP基本概念"></a>VRRP基本概念</h3><p><strong>VRRP路由器</strong></p><ul><li>运行VRRP协议的路由器称为VRRP路由器</li><li>VRRP是配置在路由器的接口上，而且也是基于接口工作的</li></ul><p><strong>VRID：Virtual Router Identifier（虚拟路由标识符）</strong></p><ul><li><p>又称备份组组号</p></li><li><p>一个VRRP组由多台路由器（的接口）组成，用相同的VRID进行表示</p></li><li><p>同一个VRRP组的路由器之间交互VRRP协议报文产生一台虚拟路由器</p></li><li><p>一个VRRP组中只能出现一台Master路由器</p></li></ul><p><strong>虚拟路由器</strong></p><ul><li><p>又称VRRP备份组</p></li><li><p>每一个VRRP组中都产生一台虚拟路由器（Virture Router），该路由器并非真实存在的物理设备，而是由VRRP虚拟出来的逻辑设备</p></li><li><p>一个VRRP组只产生一台虚拟路由器</p></li></ul><p><strong>虚拟IP地址及虚拟MAC地址</strong></p><ul><li><p>虚拟路由器拥有IP地址和MAC地址</p></li><li><p>其中IP地址由管理员配置VRRP时指定</p></li><li><p>虚拟IP地址通常作为用户主机的网关地址</p></li><li><p>虚拟MAC地址根据虚拟路由器 VRID 生成的，一个虚拟路由器拥有⼀个虚拟 MAC 地址</p><p>如果 VRID 是 1： 虚拟 MAC 地址就是： 00-00-5E-00-01-01</p><p>如果 VRID 是 5： 虚拟 MAC 地址就是： 00-00-5E-00-01-05</p></li></ul><p><strong>Master路由器</strong></p><ul><li>也被称为主路由器</li><li>负责转发用户上网数据</li><li>Master路由器会周期性地发送VRRP报文，用于通知同一个VRRP组中的Backup路由器关于自己的存活状态</li></ul><p><strong>Backup路由器</strong></p><ul><li>也被称为备份路由器</li><li>负责监控主路由器状态，事实监听Master路由器发出来的VRRP报文</li><li>当Master路由器故障时，Backup路由器会接替Master路由器的工作，称为新的Master路由器，负责转发用户的上网数据</li></ul><p><strong>Priority</strong></p><ul><li>优先级值</li><li>用来选举Master路由器</li><li>数值越大越优先，默认100，取值范围为0~255</li><li>如果优先级值相等则比较接口IP地址大小，IP地址越大越优先</li></ul><h3 id="VRRP协议报文"><a href="#VRRP协议报文" class="headerlink" title="VRRP协议报文"></a>VRRP协议报文</h3><p><strong>VRRP协议报文</strong></p><ul><li>VRRP协议报文基于组播方式发送，只能在同一个广播域传递</li><li>VRRP协议报文的目的组播地址为224.0.0.18</li><li>VRRP协议封装在IP报头后面，协议号为112</li></ul><p><img src="/../img/img_artical/net_sec/5.1.3.png" alt="5.1.3"></p><h2 id="VRRP主备切换"><a href="#VRRP主备切换" class="headerlink" title="VRRP主备切换"></a>VRRP主备切换</h2><h3 id="VRRP主备选举"><a href="#VRRP主备选举" class="headerlink" title="VRRP主备选举"></a>VRRP主备选举</h3><p><strong>VRRP协议状态机</strong></p><ul><li>Initialize（初始状态）</li><li>Master（活动状态）</li><li>Backup（备份状态）</li></ul><h3 id="VRRP主备选举-1"><a href="#VRRP主备选举-1" class="headerlink" title="VRRP主备选举"></a>VRRP主备选举</h3><p><strong>VRRP主备选举</strong></p><ul><li>配置完VRRP的设备初始时默认Initialize状态</li><li>若设备优先级小于255，则会先切换至Backup状态，然后再切换至Master状态</li><li>R1和R2通过相互发送VRRP报文进行Master选举</li><li>R1优先级为200，R2优先级为100，则R1被选为Master路由器</li><li>R1被选举为Master路由器后，立即发送免费ARP报文将虚拟MAC地址通告给与它连接的设备和主机</li></ul><h3 id="VRRP主备切换-1"><a href="#VRRP主备切换-1" class="headerlink" title="VRRP主备切换"></a>VRRP主备切换</h3><p><strong>VRRP主备切换–R1主动退出VRRP组</strong></p><ul><li>R1主动退出VRRP组，如删除VRRP配置</li><li>R1发送优先级为0的报文</li><li>R2成为新的Master</li><li>切换时间为偏移时间</li></ul><p><img src="/../img/img_artical/net_sec/5.1.4.png" alt="5.1.4"></p><p><strong>VRRP主备切换–R1设备故障</strong></p><ul><li>R1设备故障，无法发送报文</li><li>R2等待定时器超时</li><li>R2称为新的Master</li></ul><p><img src="/../img/img_artical/net_sec/5.1.5.png" alt="5.1.5"></p><p><strong>VRRP的两个定时器</strong></p><ul><li>ADVER_INTERVAL定时器：Master发送VRRP通告报文时间周期，默认1s</li><li>MASTER_DOWN定时器：Backup设备监听该定时器超时后，成为Master设备</li><li>MASTER_DOWN定时器计算公式如下</li></ul><p>​MASTER_DOWN&#x3D;(3*ADVER_INTERVAL)+Skew_time（便宜时间）</p><p>​其中Skew_time&#x3D;（256-Priority）&#x2F;256</p><h3 id="VRRP主备回切"><a href="#VRRP主备回切" class="headerlink" title="VRRP主备回切"></a>VRRP主备回切</h3><p><strong>VRRP主备回切</strong></p><ul><li>R1从故障恢复后，重新进行主备选举</li><li>R1优先级为130大于R2</li><li>且R1开启了抢占模式</li><li>R1重新成为Master设备</li></ul><p><img src="/../img/img_artical/net_sec/5.1.6.png" alt="5.1.6"></p><p><strong>VRRP抢占模式</strong></p><ul><li>抢占模式（默认开启）：如果Backup路由器开启了抢占功能，那么当他发现Master路由器的优先级比自己更低时，它将立即切换至Master状态，成为新的Master设备</li><li>非抢占模式：如果Backup路由器没有开启抢占功能，那么即时他发现Master路由器的优先级比自己更低，也只能保持Backup状态</li></ul><h3 id="VRRP工作原理"><a href="#VRRP工作原理" class="headerlink" title="VRRP工作原理"></a>VRRP工作原理</h3><p><strong>VRRP工作过程</strong></p><ul><li><p>VRRP备份组中的设备根据优先级选举出Master-主路由器</p></li><li><p>主路由器发送免费ARP报文，将虚拟MAC地址通知给与它连接的设备，承担数据转发任务</p></li><li><p>主路由器，周期性发送VRRP通告报文（三层心跳报文）</p></li><li><p>通告报文发送周期时间：默认为1s</p></li><li><p>通告报文发送的目的地址是组播地址：224.0.0.18</p></li><li><p>备份路由器，监控主路由器状态，在3倍的发送周期后，如果无法收到主路由器发送的VRRP通告报文，备份路由器升级为主路由器承担流量发送任务，新的主路由器会立即发送免费 ARP 报文，刷新与它连接设备中的 MAC 表项，从而把⽤户流量引到新的 Master 设备上来</p></li><li><p>原主路由器故障恢复时，⾸先切换至 Backup 状态：</p><p>如果原 Master 已开启抢占模式，并且对比优先级，发现⾃⼰的优先级⾼，则主动将自己切换成 Master。</p><p>如果原 Master 没有开启抢占模式，即便优先级⾼，也不会进⾏抢占，依然保持 Backup 状态</p></li></ul><h2 id="VRRP配置"><a href="#VRRP配置" class="headerlink" title="VRRP配置"></a>VRRP配置</h2><h3 id="VRRP配置命令"><a href="#VRRP配置命令" class="headerlink" title="VRRP配置命令"></a>VRRP配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.251 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254     //配置VRRP虚拟网关地址</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 priority 130                 //配置VRRP优先级</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.252 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254</span></span><br></pre></td></tr></table></figure><h2 id="VRRP监控上行接口"><a href="#VRRP监控上行接口" class="headerlink" title="VRRP监控上行接口"></a>VRRP监控上行接口</h2><h3 id="VRRP监视上行端口"><a href="#VRRP监视上行端口" class="headerlink" title="VRRP监视上行端口"></a>VRRP监视上行端口</h3><p><img src="/../img/img_artical/net_sec/5.1.7.png" alt="5.1.7"></p><h3 id="VRRP监视上行端口配置"><a href="#VRRP监视上行端口配置" class="headerlink" title="VRRP监视上行端口配置"></a>VRRP监视上行端口配置</h3><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1-G0/0/0]vrrp</span> <span class="string">vrid 1 track interface GigabitEthernet0/0/1 reduced 50</span></span><br><span class="line"><span class="attr">//如果R1的g0/0/1接口状态为down那么VRRP的优先级就减去50</span></span><br></pre></td></tr></table></figure><h3 id="上行端口故障恢复"><a href="#上行端口故障恢复" class="headerlink" title="上行端口故障恢复"></a>上行端口故障恢复</h3><p><strong>主路由器故障链路或端口恢复</strong></p><ul><li>主路由器恢复优先级</li><li>主路由器抢占回Master身份，继续转发用户流量</li></ul><p><strong>VRRP默认开启抢占功能</strong></p><ul><li>VRRP在主路由器设备上，必须开启</li></ul><h2 id="VRRP负载分担"><a href="#VRRP负载分担" class="headerlink" title="VRRP负载分担"></a>VRRP负载分担</h2><h3 id="VRRP单组缺陷"><a href="#VRRP单组缺陷" class="headerlink" title="VRRP单组缺陷"></a>VRRP单组缺陷</h3><p><strong>如果每个网段只有一个VRRP备份组</strong></p><ul><li>主路由器数据转发压力大</li><li>备份路由器不转发任何数据</li><li>网络设备利用率低</li></ul><p><img src="/../img/img_artical/net_sec/5.1.8.png" alt="5.1.8"></p><h3 id="VRRP负载分担-1"><a href="#VRRP负载分担-1" class="headerlink" title="VRRP负载分担"></a>VRRP负载分担</h3><p><strong>VRRP负载分担</strong></p><ul><li>创建多个备份组</li><li>每个备份组中都选举Master</li><li>实现流量转发的负载分担</li></ul><p><img src="/../img/img_artical/net_sec/5.1.9.png" alt="5.1.9"></p><h3 id="VRRP负载分担配置"><a href="#VRRP负载分担配置" class="headerlink" title="VRRP负载分担配置"></a>VRRP负载分担配置</h3><p><strong>配置VRRP备份组1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.251 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254     //配置VRRP虚拟网关地址</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 priority 130                 //配置VRRP优先级</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 track int g0/0/1 reduced 50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.252 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254</span></span><br></pre></td></tr></table></figure><p><strong>配置VRRP备份组2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.251 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 virtual-ip 192.168.1.253</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.252 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 virtual-ip 192.168.1.253     //配置VRRP虚拟网关地址</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 priority 130                 //配置VRRP优先级</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 track int g0/0/1 reduced 50</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络4</title>
      <link href="/posts/switching4.html"/>
      <url>/posts/switching4.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="DHCP的应用场景和原理"><a href="#DHCP的应用场景和原理" class="headerlink" title="DHCP的应用场景和原理"></a>DHCP的应用场景和原理</h2><h3 id="技术背景"><a href="#技术背景" class="headerlink" title="技术背景"></a>技术背景</h3><p><strong>企业网络中，大量的主机或设备需要获取IP地址等网络参数</strong></p><ul><li>如果采用手工配置，工作量大、容易出错且不好管理</li><li>如果用户擅自更改，还有可能会造成IP地址冲突等问题</li></ul><p><strong>使用动态主机配置协议DHCP，来分配IP地址等网络参数，可以减少管理员的工作量，避免出错</strong></p><h3 id="DHCP的定义"><a href="#DHCP的定义" class="headerlink" title="DHCP的定义"></a>DHCP的定义</h3><p><strong>DHCP，Dynamic Host Configuration Protocol</strong></p><ul><li>DHCP：动态主机配置协议</li><li>用于实现企业用户IP地址的动态分配和集中管理</li><li>避免繁琐的手工配置，快速适应网络的变化</li></ul><h3 id="DHCP的角色"><a href="#DHCP的角色" class="headerlink" title="DHCP的角色"></a>DHCP的角色</h3><p><strong>DHCP客户端</strong></p><ul><li>通过DHCP协议请求获取IP地址等网络参数，例如PC、手机、IP电话等</li></ul><p><strong>DHCP服务器</strong></p><ul><li>负责为DHCP客户端分配网络参数</li></ul><p><img src="/../img/img_artical/net_sec/4.4.1.png" alt="4.4.1"></p><p><strong>DHCP中继</strong></p><ul><li>当客户端与服务器不在一个网段的时候，才会用到DHCP中继设备</li><li>负责转发DHCP服务器和DHCP客户端之间的DHCP报文，协助DHCP服务器向DHCP客户端动态分配网络参数的设备</li></ul><p><img src="/../img/img_artical/net_sec/4.4.2.png" alt="4.4.2"></p><h3 id="DHCP工作原理"><a href="#DHCP工作原理" class="headerlink" title="DHCP工作原理"></a>DHCP工作原理</h3><p><strong>客户端首次接入网络从DHCP服务器中获取IP地址，会经过4个阶段</strong></p><ul><li>发现阶段：客户端<strong>广播</strong>发送DHCP Discover报文（<strong>DHCP发现报文</strong>，客户端找DHCP服务器，请求IP地址）</li><li>提供阶段：服务器收到客户端发的报文后，会<strong>单播</strong>回复DHCP Offer报文（<strong>DHCP回应报文</strong>，服务器给客户端发IP地址、网关、DNS等）</li><li>选择阶段：客户端收到Offer报文后，会再次<strong>广播</strong>发送DHCP Request报文（<strong>DHCP请求报文</strong>，客户端广播告知所有的服务器，选择了某某IP地址）</li><li>确认阶段：服务器收到客户端发报文后，会<strong>单播</strong>回复DHCP ACK报文（<strong>DHCP确认报文</strong>，确认分配结果，只有发了ACK报文，客户端才可以使用IP）</li></ul><p><img src="/../img/img_artical/net_sec/4.4.3.png" alt="4.4.3"></p><h2 id="基于全局的DHCP"><a href="#基于全局的DHCP" class="headerlink" title="基于全局的DHCP"></a>基于全局的DHCP</h2><h3 id="创建地址池"><a href="#创建地址池" class="headerlink" title="创建地址池"></a>创建地址池</h3><p><strong>地址池</strong></p><ul><li>DHCP服务器通过地址池为客户端提供IP地址等网络参数</li></ul><p><strong>创建地址池有2种方式</strong></p><ul><li>基于全局的地址池</li><li>基于接口的地址池</li></ul><h3 id="创建基于全局的DHCP"><a href="#创建基于全局的DHCP" class="headerlink" title="创建基于全局的DHCP"></a>创建基于全局的DHCP</h3><ul><li>开启设备的DHCP功能，确保设备为 DHCP 服务器</li><li>在DHCP服务器创建地址池，规划网段&#x2F;网关&#x2F;DNS和租约</li><li>在接收DHCP报文的接口上，开启基于全局的DHCP功能</li></ul><p><img src="/../img/img_artical/net_sec/4.4.4.png" alt="4.4.4"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.开启路由器DHCP功能</span><br><span class="line">[Huawei]sysname dhcp</span><br><span class="line">[dhcp]dhcp enable</span><br><span class="line"></span><br><span class="line">2.在路由器上建立地址池，配置网段/网关/DNS和租约</span><br><span class="line">[dhcp]ip pool p1         //建立地址池并命名</span><br><span class="line">[dhcp-ip-pool-p1]network 192.168.1.0 mask 255.255.255.0</span><br><span class="line">[dhcp-ip-pool-p1]gateway-list 192.168.1.254</span><br><span class="line">[dhcp-ip-pool-p1]dns-list 8.8.8.8</span><br><span class="line">[dhcp-ip-pool-p1]lease day 3      //设置DHCP租约为3天 (默认1天)</span><br><span class="line"></span><br><span class="line">3.为路由器接口G0/0/0配置地址，并在接口上启用DHCP</span><br><span class="line">[dhcp]interface GigabitEthernet0/0/0</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]ip address 192.168.1.254 24</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp select global       //接口下启用基于全局的DHCP</span><br></pre></td></tr></table></figure><h2 id="基于接口的DHCP"><a href="#基于接口的DHCP" class="headerlink" title="基于接口的DHCP"></a>基于接口的DHCP</h2><h3 id="创建基于接口的DHCP"><a href="#创建基于接口的DHCP" class="headerlink" title="创建基于接口的DHCP"></a>创建基于接口的DHCP</h3><ul><li>开启设备的DHCP功能，确保设备为 DHCP 服务器</li><li>配置基于接口的DHCP地址池，并配置DNS和租约</li><li>在接收DHCP报文的接口上，开启基于接口的DHCP功能</li></ul><p><img src="/../img/img_artical/net_sec/4.4.5.png" alt="4.4.5"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.开启路由器DHCP功能</span><br><span class="line">[Huawei]sysname dhcp</span><br><span class="line">[dhcp]dhcp enable</span><br><span class="line"></span><br><span class="line">2.在接口G0/0/0配置地址，开启基于接口的DHCP</span><br><span class="line">[dhcp]interface GigabitEthernet0/0/0</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]ip address 192.168.1.254 24</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp select interface       //接口下启用基于接口的DHCP</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp server dns-list 8.8.8.8</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp server lease day 3</span><br></pre></td></tr></table></figure><h2 id="DHCP中继代理"><a href="#DHCP中继代理" class="headerlink" title="DHCP中继代理"></a>DHCP中继代理</h2><h3 id="DHCP中继概述"><a href="#DHCP中继概述" class="headerlink" title="DHCP中继概述"></a>DHCP中继概述</h3><p><strong>场景：</strong></p><ul><li>DHCP客户端与DHCP服务器不在一个网段时，才需要DHCP中继</li></ul><p><strong>作用</strong></p><ul><li>传递DHCP服务器和DHCP客户端之间的DHCP报文</li></ul><p><img src="/../img/img_artical/net_sec/4.4.7.png" alt="4.4.7"></p><h3 id="DHCP中继配置"><a href="#DHCP中继配置" class="headerlink" title="DHCP中继配置"></a>DHCP中继配置</h3><ul><li>DHCP客户端的网关接口，才有资格成为DHCP中继</li><li>开启DHCP中继的DHCP功能</li><li>设置DHCP中继接口的模式为 relay</li><li>指定DHCP中继接口的DHCP服务器地址</li></ul><p><img src="/../img/img_artical/net_sec/4.4.8.png" alt="4.4.8"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.配置设备之间的互联接口及静态路由</span></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 10.10.10.2 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]quit</span></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.1.254 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 10.10.10.1 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]quit</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.1.0 24 10.10.10.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.在R1上配置DHCP地址池，启用DHCP</span></span><br><span class="line"><span class="attr">[R1]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">pool ntd</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]network</span> <span class="string">192.168.1.0 mask 255.255.255.0</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]gateway-list</span> <span class="string">192.168.1.254</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]excluded-ip-address</span> <span class="string">192.168.1.253        //排除的IP地址</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]dhcp</span> <span class="string">select global     //开启基于全局的DHCP</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.在R2上配置DHCP中继</span></span><br><span class="line"><span class="attr">[R2]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]dhcp</span> <span class="string">select relay     //在接口G0/0/1上应用DHCP中继功能</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]dhcp</span> <span class="string">relay server-ip 10.10.10.1   //指向DHCP服务器的IP地址</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络3</title>
      <link href="/posts/switching3.html"/>
      <url>/posts/switching3.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="VLAN间通信"><a href="#VLAN间通信" class="headerlink" title="VLAN间通信"></a>VLAN间通信</h2><h3 id="VLANIF虚接口"><a href="#VLANIF虚接口" class="headerlink" title="VLANIF虚接口"></a>VLANIF虚接口</h3><p><strong>三层交换机</strong></p><ul><li>具备路由功能的交换机，称之为三层交换机或多层交换机</li></ul><p><strong>VLAN间通信解决方案：VLANIF虚接口</strong></p><p><strong>VLANIF虚接口</strong></p><ul><li>每个VLAN都对应一个VLANIF接口</li><li>VLANIF接口是一种三层虚拟接口，可以实现VLAN间的三层互通</li><li>给每个VLAN需要配置一个VLANIF虚接口，配置接口IP地址，作为VLAN内主机的网关地址</li><li>VLANIF接口不占用额外的物理端口资源，节约成本通常在三层交换机上配置VLANIF接口，来实现VLAN间通信</li></ul><p><strong>三层交换机VLAN间通信的转发过程</strong></p><p><img src="/../img/img_artical/net_sec/4.3.1.png" alt="4.3.1"></p><h3 id="VLANIF虚接口配置"><a href="#VLANIF虚接口配置" class="headerlink" title="VLANIF虚接口配置"></a>VLANIF虚接口配置</h3><p><strong>VLANIF虚接口配置</strong></p><ul><li>在三层交换机上创建VLAN</li><li>为每个VLAN创建网关接口-VLANIF</li><li>为每个VLANIF配置网关IP地址</li><li>如有需要，还须在三层交换机上配置路由</li></ul><p><strong>要求实现不同VLAN间互通</strong></p><ul><li>创建VLAN、接口加入VLAN</li><li>配置VLANIF虚接口IP地址</li></ul><p><img src="/../img/img_artical/net_sec/4.3.2.png" alt="4.3.2"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.创建VLAN、接口加入VLAN</span></span><br><span class="line"><span class="attr">[SWl]vlan</span> <span class="string">batch 2 3</span></span><br><span class="line"><span class="attr">[SWl]interface</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[SW1-G0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-G0/0/1]port</span> <span class="string">default vlan 1</span></span><br><span class="line"><span class="attr">[SWlJinterface</span> <span class="string">g0/0/2</span></span><br><span class="line"><span class="attr">[SW1-G0/0/2]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-G0/0/2]port</span> <span class="string">default vlan 2</span></span><br><span class="line"><span class="attr">[SWl]interface</span> <span class="string">g0/0/3</span></span><br><span class="line"><span class="attr">[SW1-G0/0/3]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-G0/0/3]port</span> <span class="string">default vlan 3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.配置VLANIF虚接口IP-网关地址</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 1</span></span><br><span class="line"><span class="attr">[SW1-Vlanif1]ip</span> <span class="string">address 192.168.1.254 24</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 2</span></span><br><span class="line"><span class="attr">[SW1-Vlanif2]ip</span> <span class="string">address 192.168.2.254 24</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 3</span></span><br><span class="line"><span class="attr">[SW1-Vlanif3]ip</span> <span class="string">address 192.168.3.254 24</span></span><br></pre></td></tr></table></figure><h2 id="VLAN聚合原理及配置"><a href="#VLAN聚合原理及配置" class="headerlink" title="VLAN聚合原理及配置"></a>VLAN聚合原理及配置</h2><h3 id="VLAN聚合基本概念"><a href="#VLAN聚合基本概念" class="headerlink" title="VLAN聚合基本概念"></a>VLAN聚合基本概念</h3><p><strong>VLAN聚合（VLAN Aggregation，也称SuperVLAN）</strong></p><ul><li>指在一个物理网络内，用多个VLAN（称为Sub-VLAN）隔离广播域</li><li>这些Sub-VLAN聚合成一个逻辑的VLAN（称为Super VLAN）</li><li>这些Sub-VLAN使用同一个IP子网和缺省网关，可以节约IP地址资源</li></ul><p><strong>Super VLAN：超级VLAN</strong></p><p><strong>Sub-VLAN：子VLAN</strong></p><h3 id="多VLAN中IP地址浪费问题"><a href="#多VLAN中IP地址浪费问题" class="headerlink" title="多VLAN中IP地址浪费问题"></a>多VLAN中IP地址浪费问题</h3><p><strong>VLAN越多，IP地址浪费越多</strong></p><ul><li>一个VLAN中，网络号、广播地址、网关地址都不能分配给主机使用</li><li>且一个VLAN中实际主机数量过少，也要分配一个单独的网段</li></ul><p><img src="/../img/img_artical/net_sec/4.3.3.png" alt="4.3.3"></p><h3 id="VLAN聚合作用"><a href="#VLAN聚合作用" class="headerlink" title="VLAN聚合作用"></a>VLAN聚合作用</h3><p><strong>在多VLAN的网络环境中，节省IP地址</strong></p><ul><li>每个Sub-VLAN对应一个广播域，多个Sub-VLAN和一个Super-VLAN关联，只给Super-VLAN分配一个IP网段，所有Sub-VLAN都使用Super-VLAN的IP网段进行三层通信，从而节省IP地址</li></ul><p><img src="/../img/img_artical/net_sec/4.3.4.png" alt="4.3.4"></p><h3 id="Sub-VLAN"><a href="#Sub-VLAN" class="headerlink" title="Sub-VLAN"></a>Sub-VLAN</h3><p><strong>Sub-VLAN</strong></p><ul><li>只包含物理接口，不能建立三层VLANIF接口</li><li>Sub-VLAN用于隔离广播域</li><li>每个Sub-VLAN内的主机与外部的三层通信是靠Super-VLAN的三层VLANIF接口来实现的</li></ul><h3 id="Super-VLAN"><a href="#Super-VLAN" class="headerlink" title="Super-VLAN"></a>Super-VLAN</h3><p><strong>Super-VLAN</strong></p><ul><li>Super-VLAN只建立三层VLANIF接口，不包含物理接口，与网关对应</li><li>一个Super-VLAN可以包含一个或多个Sub-VLAN</li><li>Sub-VLAN不再占用一个独立的子网网段</li><li>在同一个Super-VLAN中，无论主机属于哪一个Sub-VLAN，它的IP地址都在Super-VLAN对应的网段内</li></ul><h3 id="Sub-VLAN之间的通信存在问题"><a href="#Sub-VLAN之间的通信存在问题" class="headerlink" title="Sub-VLAN之间的通信存在问题"></a>Sub-VLAN之间的通信存在问题</h3><p><strong>存在问题</strong></p><ul><li>普通VLAN中，不同VLAN内的主机可以通过各自不同网关进行三层互通</li><li>但是Super-VLAN中，所有Sub-VLAN内的主机使用的是同一个网段的地址，共用同一个网关地址，主机只会做二层转发，而不会送网关进行三层转发</li><li>不同Sub-VLAN的主机，在二层是相互隔离的，这就造成了Sub-VLAN间无法通信的问题</li></ul><h3 id="Sub-VLAN之间的通信解决方案"><a href="#Sub-VLAN之间的通信解决方案" class="headerlink" title="Sub-VLAN之间的通信解决方案"></a>Sub-VLAN之间的通信解决方案</h3><p><strong>解决方案</strong></p><ul><li>解决这一问题的方法就是使用Proxy ARP</li></ul><p><strong>Proxy ARP</strong></p><ul><li>如果ARP请求是从一个网络的主机发往同一网段但不在同一VLAN（同一广播域）内的另一台主机，那么连接这两个网络的设备就可以回答该ARP请求，这个过程称作ARP代理（Proxy ARP）</li><li>VLAN间Proxy ARP：两台主机处于相同网段，但属于不同VLAN</li></ul><h3 id="Sub-VLAN配置"><a href="#Sub-VLAN配置" class="headerlink" title="Sub-VLAN配置"></a>Sub-VLAN配置</h3><p><strong>VLAN角色类型</strong></p><ul><li>Sub-VLAN</li><li>Super-VLAN</li></ul><p><strong>Sub-VLAN配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">2</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Ethernet0/0/1</span></span><br><span class="line"><span class="attr">[SW1-E0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-E0/0/1]port</span> <span class="string">default vlan 2</span></span><br></pre></td></tr></table></figure><p><strong>Super-VLAN配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">10                                             //创建vlan10</span></span><br><span class="line"><span class="attr">[SW1-vlan-10]aggregate-vlan</span>                              <span class="string">//配置vlan10为Super-vlan</span></span><br><span class="line"><span class="attr">[SW1-vlan-10]access-vlan2</span>                                <span class="string">//将Sub-vlan vlan2加入Super-vlan</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">vlanif 10</span></span><br><span class="line"><span class="attr">[SW1-vlanif-10]ip</span> <span class="string">address 192.168.10.254 24</span></span><br><span class="line"><span class="attr">[SW1-vlanif-10]arp-proxy</span> <span class="string">inter-sub-vlan-proxy enable     //开启Proxy ARP</span></span><br></pre></td></tr></table></figure><h3 id="VLAN聚合配置思路"><a href="#VLAN聚合配置思路" class="headerlink" title="VLAN聚合配置思路"></a>VLAN聚合配置思路</h3><p><strong>配置思路</strong></p><ul><li>创建Sub-VLAN</li><li>配置端口模式</li><li>端口加入VLAN</li><li>创建Super-VLAN</li><li>将Sub-VLAN加入SuperVLAN</li><li>配置Super-VLAN的VLANIF接口</li><li>Super-VLAN下配置Proxy ARP</li><li>验证设备之间的互通性</li></ul><h2 id="端口隔离原理与配置"><a href="#端口隔离原理与配置" class="headerlink" title="端口隔离原理与配置"></a>端口隔离原理与配置</h2><h3 id="端口隔离概述"><a href="#端口隔离概述" class="headerlink" title="端口隔离概述"></a>端口隔离概述</h3><ul><li><p>实现报文之间的2层隔离，除了使用VLAN 技术以后，还可以使用端口隔离技术</p></li><li><p>采用该技术后，属于同一个VLAN 内的端口所连接的设备也可以实现通信的隔离</p></li><li><p>端口隔离为用户提供了更加安全、更加灵活的组网方案</p></li><li><p>端口隔离的作用：采用端口隔离功能，可以实现同一VLAN内端口之间的隔离</p></li><li><p>如何实现端口隔离功能：只需要将端口加入到隔离组中，就可以实现隔离组内端口之间二层数据的隔离</p></li><li><p>端口隔离的优势：节约了VLAN，提供了更安全、更灵活的组网方案</p></li></ul><h3 id="端口隔离的特点"><a href="#端口隔离的特点" class="headerlink" title="端口隔离的特点"></a>端口隔离的特点</h3><ul><li>端口隔离只是针对同一设备上的端口隔离组成员，对于不同设备上的接口而言，无法实现该功能</li><li>同一端口隔离组的接口之间互相隔离</li><li>隔离组的接口和其他接口之间不隔离</li><li>不同端口隔离组的接口之间不隔离</li></ul><h3 id="端口隔离应用场景"><a href="#端口隔离应用场景" class="headerlink" title="端口隔离应用场景"></a>端口隔离应用场景</h3><p><img src="/../img/img_artical/net_sec/4.3.5.png" alt="4.3.5"></p><h3 id="端口隔离基本概念"><a href="#端口隔离基本概念" class="headerlink" title="端口隔离基本概念"></a>端口隔离基本概念</h3><p><img src="/../img/img_artical/net_sec/4.3.6.png" alt="4.3.6"></p><h3 id="端口隔离配置实现"><a href="#端口隔离配置实现" class="headerlink" title="端口隔离配置实现"></a>端口隔离配置实现</h3><p><img src="/../img/img_artical/net_sec/4.3.7.png" alt="4.3.7"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络2</title>
      <link href="/posts/switching2.html"/>
      <url>/posts/switching2.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="STP协议概述"><a href="#STP协议概述" class="headerlink" title="STP协议概述"></a>STP协议概述</h2><h3 id="单点故障"><a href="#单点故障" class="headerlink" title="单点故障"></a>单点故障</h3><p><strong>PC之间的互通链路仅仅存在1个</strong></p><ul><li>任何一条链路出现问题，PC之间都会无法通信</li></ul><p><img src="/../img/img_artical/net_sec/4.2.1.png" alt="4.2.1"></p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>提高网络可靠性</strong></p><ul><li>增加冗余&#x2F;备份链路</li></ul><p><img src="/../img/img_artical/net_sec/4.2.2.png" alt="4.2.2"></p><h3 id="产生新的问题"><a href="#产生新的问题" class="headerlink" title="产生新的问题"></a>产生新的问题</h3><p><strong>增加备份链路后交换网络上产生二层环路</strong></p><ul><li><p>PC1访问PC2，PC1知道PC2的IP地址，但是不知识PC2的MAC地址</p></li><li><p>PC1会发送ARP广播(目的MAC为全FFFF数据)</p></li></ul><p><img src="/../img/img_artical/net_sec/4.2.3.png" alt="4.2.3"></p><p><strong>环路导致广播风暴</strong></p><ul><li>交换机收到广播帧后，会从除接收端口外的其他所有接口广播</li><li>广播帧在交换机之间一直循环下去，众多的广播帧最终形成广播风暴</li></ul><p><img src="/../img/img_artical/net_sec/4.2.4.png" alt="4.2.4"></p><p><strong>广播风暴导致网络瘫痪</strong></p><ul><li>广播帧增多形成广播风暴，从而导致链路拥塞，并极大消耗设备资源，最终导致网络拥塞不可用，还会导致设备宕机不可用</li></ul><p><img src="/../img/img_artical/net_sec/4.2.5.png" alt="4.2.5"></p><h3 id="STP概述"><a href="#STP概述" class="headerlink" title="STP概述"></a>STP概述</h3><p><strong>STP：生成树协议 （IEEE802.1d）</strong></p><ul><li>STP：Spanning Tree Protocol（生成树协议）</li><li>通过阻塞某个接口在逻辑上断开环路，防止广播风暴，破除二层环路</li><li>当主线路故障，阻塞接口被激活，主线路恢复，备份线路再次被阻塞</li><li>交换机之间通过周期性的发送BPDU报文，来实现STP的功能</li></ul><p><img src="/../img/img_artical/net_sec/4.2.6.png" alt="4.2.6"></p><p><strong>BPDU：桥协议数据单元</strong></p><ul><li>Bridge Protocol Data Unit ，桥协议数据单元，即STP协议的报文</li><li>也称二层的”心跳报文”，周期性发送，默认每2秒发送1次</li><li>组播发送，组播MAC地址为：01-80-C2-00-00-00</li></ul><h2 id="STP工作原理"><a href="#STP工作原理" class="headerlink" title="STP工作原理"></a>STP工作原理</h2><h3 id="STP工作原理-1"><a href="#STP工作原理-1" class="headerlink" title="STP工作原理"></a>STP工作原理</h3><ul><li><p>步骤一：选举根交换机</p></li><li><p>步骤二：在每个非根交换机上选举一个根端口</p></li><li><p>步骤三：在每条链路上选举一个指定端口</p></li><li><p>步骤四：阻塞非根端口、非指定端口</p></li></ul><p><img src="/../img/img_artical/net_sec/4.2.7.png" alt="4.2.7"></p><h3 id="选举根交换机"><a href="#选举根交换机" class="headerlink" title="选举根交换机"></a>选举根交换机</h3><p><strong>根网桥（根交换机）</strong></p><ul><li>STP引入了根桥（Root Bridge）概念</li><li>在一个STP网络中，根桥只有一个</li><li>STP初始化时，所有的交换机都认为自己是”根交换机”</li><li>交换机之间通过比较BID的来确定根交换机，BID值小的为根交换机</li></ul><p><strong>网桥ID（BID）</strong></p><ul><li>STP协议为交换机取的名字，用于在交换网络中唯一标识该设备</li><li>BID是优先级与MAC地址组成，BID值越小越优先</li><li>BID优先级取值范围：0~61440、默认值是:32768</li><li>BID优先级步长值：4096 (0或4096的倍数)</li></ul><p><img src="/../img/img_artical/net_sec/4.2.8.png" alt="4.2.8"></p><p><strong>通常根据BID优先级，选择根交换机</strong></p><ul><li>BID值小的为根交换机，首先比较优先级，优先级小的为根交换机</li><li>如果优先级一致，则MAC地址小的为根交换机</li></ul><p><img src="/../img/img_artical/net_sec/4.2.9.png" alt="4.2.9"></p><h3 id="STP配置命令"><a href="#STP配置命令" class="headerlink" title="STP配置命令"></a>STP配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.启动或关闭交换机的STP功能，默认情况下交换机的STP功能处于开启状态</span></span><br><span class="line"><span class="attr">[Huawei]stp</span> <span class="string">&#123;enable | disable&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.选择交换机的STP运行模式，默认情况下交换机的STP运行模式为MSTP</span></span><br><span class="line"><span class="attr">[Huawei]stp</span> <span class="string">mode &#123;stp | rstp | mstp&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.修改交换机的STP优先级，设置根交换机</span></span><br><span class="line"><span class="attr">[Huawei]stp</span> <span class="string">priority 4096</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.查看生成树状态信息</span></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">stp</span></span><br></pre></td></tr></table></figure><h2 id="选举根端口和指定端口"><a href="#选举根端口和指定端口" class="headerlink" title="选举根端口和指定端口"></a>选举根端口和指定端口</h2><h3 id="选举根端口"><a href="#选举根端口" class="headerlink" title="选举根端口"></a>选举根端口</h3><p><strong>根端口定律</strong></p><ul><li>非根交换机中有且只有一个根端口</li></ul><p><strong>选举根端口原则</strong></p><ul><li>非根交换机到根交换机的根路径开销值最小的端口（此端口到根的路径成本之和最低）如果根路径开销值相同，则比较对端交换机的BID，越小越优</li><li>如果对端BID也相同，则比较对端的PID，越小越优（PID由端口优先级和端口号组成优先级取值范围：0~240、步长值为16、端口优先级默认为128，所以端口号小PID就小）</li></ul><p><img src="/../img/img_artical/net_sec/4.2.10.png" alt="4.2.10"></p><p><strong>路径开销（路径成本）：Cost</strong></p><ul><li>交换机的每一个端口都有一个路径开销-Cost值</li><li>交换机端口Cost值和端口带宽有关，带宽越高，Cost值越小</li><li>默认情况下千兆端口开销为20000</li><li>默认情况下百兆端口开销为200000</li></ul><p><img src="/../img/img_artical/net_sec/4.2.11.png" alt="4.2.11"></p><p><strong>在非根网桥SW2&#x2F;SW3上，选择一个根端口（RP）</strong></p><ul><li>到根交换机的根路径开销值最小的端口，即根端口</li><li>SW2&#x2F;SW3的根端口为G0&#x2F;0&#x2F;1</li></ul><p><img src="/../img/img_artical/net_sec/4.2.12.png" alt="4.2.12"></p><h3 id="选举指定端口"><a href="#选举指定端口" class="headerlink" title="选举指定端口"></a>选举指定端口</h3><p><strong>指定端口定律</strong></p><ul><li>在每条链路上选择一个指定端口</li><li>根交换机的接口全是指定端口</li></ul><p><strong>选举指定端口原则</strong></p><ul><li>一条链路上，到根交换机的根路径开销值最小的端口，即指定端口</li><li>如果根路径开销相同，则比较接口所在交换机的BID，越小越优</li><li>如果交换机的BID也相同，则比较PID，越小越优</li></ul><h2 id="BPDU"><a href="#BPDU" class="headerlink" title="BPDU"></a>BPDU</h2><h3 id="BPDU-1"><a href="#BPDU-1" class="headerlink" title="BPDU"></a>BPDU</h3><p><strong>BPDU的4个关键字段，用于选举交换机角色和端口角色</strong></p><table><thead><tr><th align="center">BPDU报文字段</th><th align="center">字段作用</th></tr></thead><tbody><tr><td align="center">协议ID</td><td align="center"></td></tr><tr><td align="center">协议版本号</td><td align="center"></td></tr><tr><td align="center">报文类型</td><td align="center"></td></tr><tr><td align="center">拓扑变化标志</td><td align="center"></td></tr><tr><td align="center"><font color="#ff0000"><strong>根网桥ID</strong></font></td><td align="center"><font color="#ff0000"><strong>当前根桥的BID</strong></font></td></tr><tr><td align="center"><font color="#ff0000"><strong>根路径开销</strong></font></td><td align="center"><font color="#ff0000"><strong>本端口累计到根桥的开销值（Cost）</strong></font></td></tr><tr><td align="center"><font color="#ff0000"><strong>发送网桥ID</strong></font></td><td align="center"><font color="#ff0000"><strong>本交换设备的BID</strong></font></td></tr><tr><td align="center"><font color="#ff0000"><strong>端口ID</strong></font></td><td align="center"><font color="#ff0000"><strong>发送该BPDU报文的端口ID（PID）</strong></font></td></tr><tr><td align="center">报文老化时间</td><td align="center"></td></tr><tr><td align="center">消息老化时间</td><td align="center"></td></tr><tr><td align="center">发送报文间隔时间</td><td align="center"></td></tr><tr><td align="center">转发延迟时间</td><td align="center"></td></tr></tbody></table><h3 id="BPDU类型"><a href="#BPDU类型" class="headerlink" title="BPDU类型"></a>BPDU类型</h3><ul><li>配置 BPDU</li><li>拓扑变更BPDU</li></ul><h3 id="STP的收敛"><a href="#STP的收敛" class="headerlink" title="STP的收敛"></a>STP的收敛</h3><p><strong>STP端口的5种状态</strong></p><table><thead><tr><th>状态</th><th>用途</th></tr></thead><tbody><tr><td>禁用（Disabled）</td><td>强制关闭，没有启用STP协议</td></tr><tr><td>阻塞（Blocking）</td><td>只接收BPDU，不能发送BPDU</td></tr><tr><td>侦听（Listening）</td><td>比较BPDU，确定交换机角色和端口角色</td></tr><tr><td>学习（Learning）</td><td>基于端口上收到的数据帧，学习MAC地址表</td></tr><tr><td>转发（Forwarding）</td><td>端口的最终完美状态，发送和接收用户数据</td></tr></tbody></table><p><strong>STP的3种计时器，用于维护STP</strong></p><ul><li>Hello时间：端口发送BPDU报文的时间间隔，默认是2s</li><li>转发延迟（Forward delay）：端口从侦听到学习状态，分别停留的时间，15s</li><li>最大老化时间（Max Age）：一个端口最大的”没有接收BPDU”的时间间隔，20s</li></ul><p><strong>STP的收敛时间为：30~50s，非常慢</strong></p><ul><li>根交换机故障，STP的收敛时间约50秒</li><li>链路故障：STP的收敛时间约30~50秒</li></ul><p><img src="/../img/img_artical/net_sec/4.2.13.png" alt="4.2.13"></p><h2 id="MSTP工作原理及配置"><a href="#MSTP工作原理及配置" class="headerlink" title="MSTP工作原理及配置"></a>MSTP工作原理及配置</h2><h3 id="STP回顾"><a href="#STP回顾" class="headerlink" title="STP回顾"></a>STP回顾</h3><p><strong>弊端</strong></p><ul><li>收敛时间慢：30s~50s</li><li>设备利用率低</li></ul><p><strong>方案</strong></p><ul><li>RSTP，快速生成树协议</li><li>MSTP，多生成树协议</li></ul><h3 id="RSTP概述"><a href="#RSTP概述" class="headerlink" title="RSTP概述"></a>RSTP概述</h3><p><strong>RSTP：快速生成树协议</strong></p><ul><li>公有协议：IEEE802.1w</li><li>STP的基础上优化而来</li><li>实现网络的快速收敛，降低网络故障时间，提高数据转发的效率</li></ul><p><strong>RSTP对STP的改进</strong></p><ul><li>增加了2种端口角色（AP和BP）<ul><li>Backup Port（备份端口）主要是由于Designated Port的故障而触发的。当Designated Port发生故障时，Backup Port会立即开始转发数据</li><li>Alternate Port（备用端口）网络拓扑发生变化时触发状态转换，并转变为指定（designated）端口或根（root）端口，从而提供冗余路径</li></ul></li><li>减少了3个端口状态（阻塞、学习、转发合为一种）</li><li>引入了让指定端口尽快进入转发状态的机制（P&#x2F;A机制）</li></ul><p><strong>RSTP的不足</strong></p><ul><li>RSTP和STP有一个共同缺陷：局域网内所有的VLAN共享一颗生成树</li><li>所有的VLAN的数据转发路径是相同的</li><li>交换机之间的多个链路，只能实现备份的作用，永远只会使用其中的主链路转发数据，无法实现VLAN数据流的负载均衡，从而无法提高设备利用率，还有可能造成部分VLAN的数据流无法转发。</li></ul><h3 id="MSTP概述"><a href="#MSTP概述" class="headerlink" title="MSTP概述"></a>MSTP概述</h3><p><strong>MSTP，即Multiple STP，多生成树协议</strong></p><ul><li>RSTP的基础上优化而来</li><li>MSTP网络中，引入了域的概念，称为MST域</li><li>每个MST域中包含一个或多个”生成树”称之为”实例”</li><li>引入了实例”instance”的概念，实现VLAN数据流的负载均衡</li><li>默认情况下，所有的VLAN都属于同一个默认的实例 –  instance 0</li><li>可以基于需求，将不同的VLAN分配到不同的实例中</li><li>不同的实例，就是不同的生成树，就对应着多个不同的根桥</li></ul><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><p><strong>每个交换机创建相同的VLAN</strong></p><p><strong>交换机之间的链路配置为 Trunk，允许所有的VLAN通过</strong></p><p><strong>交换机启用STP协议，配置模式为MSTP</strong></p><p><strong>交换机指定MST域的域名、实例和vlan的对应关系</strong></p><p><strong>交换机上激活MST域的配置</strong></p><p><strong>验证与测试MST域的配置</strong></p><p><strong>同一个MST域的交换机配置特点：</strong></p><ul><li>都启动了MSTP</li><li>域名配置相同</li><li>实例配置相同</li></ul><h2 id="MSTP负载均衡"><a href="#MSTP负载均衡" class="headerlink" title="MSTP负载均衡"></a>MSTP负载均衡</h2><h3 id="MSTP负载均衡-1"><a href="#MSTP负载均衡-1" class="headerlink" title="MSTP负载均衡"></a>MSTP负载均衡</h3><p><strong>STP&#x2F;RSTP的弊端</strong></p><ul><li>所有的VLAN共用一个”生成树”，防止环路的同时只能确保一半的设备得到利用，另外一半的设备仅仅用作”备份”，无法提高设备的利用率</li></ul><p><strong>MSTP负载均衡</strong></p><ul><li>不同的VLAN关联到不同的实例</li><li>不同的实例的根交换机放置在不同的交换机上</li><li>不同的VLAN通过不同的根交换机进行数据的转发，从而确保提高设备的利用率，同时设备之间还能实现备份</li></ul><p><img src="/../img/img_artical/net_sec/4.2.14.png" alt="4.2.14"></p><p><strong>需求描述</strong></p><ul><li><p>PC1属于VLAN10，IP地址为192.168.10.1&#x2F;24，网关为192.168.10.254</p></li><li><p>PC2属于VLAN20，IP地址为192.168.20.1&#x2F;24，网关为192.168.20.254</p></li><li><p>确保PC1与PC2互通</p></li><li><p>合理配置MSTP，确保PC1与PC2之间的互通路径是最优的</p></li><li><p>配置命令</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.S1、S2、S3创建vlan并配置连接交换机的端口为trunk</span></span><br><span class="line"><span class="attr">[S1]VLAN</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[S1]port-group</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[S1-port-group-1]group-member</span> <span class="string">G0/0/3 G0/0/10</span></span><br><span class="line"><span class="attr">[S1-port-group-1]port</span> <span class="string">link-type trunk </span></span><br><span class="line"><span class="attr">[S1-port-group-1]port</span> <span class="string">trunk allow-pass vlan ALL</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[S2]VLAN</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[S2]port-group</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[S2-port-group-1]group-member</span> <span class="string">G0/0/4 G0/0/10</span></span><br><span class="line"><span class="attr">[S2-port-group-1]port</span> <span class="string">link-type trunk </span></span><br><span class="line"><span class="attr">[S2-port-group-1]port</span> <span class="string">trunk allow-pass vlan ALL</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[S3]VLAN</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[S3]port-group</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[S3-port-group-1]group-member</span> <span class="string">G0/0/5 G0/0/6</span></span><br><span class="line"><span class="attr">[S3-port-group-1]port</span> <span class="string">link-type trunk </span></span><br><span class="line"><span class="attr">[S3-port-group-1]port</span> <span class="string">trunk allow-pass vlan ALL</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.S1、S2、S3配置MSTP区域并激活</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">mode mstp 启用MSTP协议</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">region-configuration 创建区域</span></span><br><span class="line"><span class="attr">[S1-mst-region]region-name</span> <span class="string">ntd 定义区域名为ntd</span></span><br><span class="line"><span class="attr">[S1-mst-region]instance</span> <span class="string">1 vlan 10 指定vlan与实例的对应关系</span></span><br><span class="line"><span class="attr">[S1-mst-region]instance</span> <span class="string">2 vlan 20</span></span><br><span class="line"><span class="attr">[S1-mst-region]active</span> <span class="string">region-configuration 激活区域配置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">mode mstp 启用MSTP协议</span></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">region-configuration 创建区域</span></span><br><span class="line"><span class="attr">[S2-mst-region]region-name</span> <span class="string">ntd 定义区域名为ntd</span></span><br><span class="line"><span class="attr">[S2-mst-region]instance</span> <span class="string">1 vlan 10 指定vlan与实例的对应关系</span></span><br><span class="line"><span class="attr">[S2-mst-region]instance</span> <span class="string">2 vlan 20</span></span><br><span class="line"><span class="attr">[S2-mst-region]active</span> <span class="string">region-configuration 激活区域配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[S3]stp</span> <span class="string">mode mstp 启用MSTP协议</span></span><br><span class="line"><span class="attr">[S3]stp</span> <span class="string">region-configuration 创建区域</span></span><br><span class="line"><span class="attr">[S3-mst-region]region-name</span> <span class="string">ntd 定义区域名为ntd</span></span><br><span class="line"><span class="attr">[S3-mst-region]instance</span> <span class="string">1 vlan 10 指定vlan与实例的对应关系</span></span><br><span class="line"><span class="attr">[S3-mst-region]instance</span> <span class="string">2 vlan 20</span></span><br><span class="line"><span class="attr">[S3-mst-region]active</span> <span class="string">region-configuration 激活区域配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.配置S1为vlan10的主根、vlan20的次根网桥并查看配置</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">instance 1 priority 4096</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">instance 2 priority 8192</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.配置S2为vlan20的主根、vlan10的次根根网桥并查看配置</span></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">instance2 priority 4096</span></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">instance 1 priority 8192</span></span><br><span class="line"></span><br><span class="line"><span class="attr">5.配置PC1加入vlan10、PC2加入vlan20</span></span><br><span class="line"><span class="attr">[S3]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/1]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/1]port</span> <span class="string">default vlan 10</span></span><br><span class="line"><span class="attr">[S3]interface</span> <span class="string">GigabitEthernet 0/0/2</span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/2]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/2]port</span> <span class="string">default vlan 20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.配置S1与路由相连的接口加入vlan10</span></span><br><span class="line"><span class="attr">[S1]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[S1-GigabitEthernet0/0/1]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S1-GigabitEthernet0/0/1]port</span> <span class="string">default vlan 10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">7.配置S2与路由相连的接口加入</span> <span class="string">vlan20</span></span><br><span class="line"><span class="attr">[S2]interface</span> <span class="string">GigabitEthernet 0/0/2</span></span><br><span class="line"><span class="attr">[S2-GigabitEthernet0/0/2]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S2-GigabitEthernet0/0/2]port</span> <span class="string">default vlan 20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">8.配置路由器接口IP</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.10.254 24</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/2</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/2]ip</span> <span class="string">address 192.168.20.254 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">9.测试与验证</span></span><br><span class="line"><span class="attr">pc1</span> <span class="string">ping  pc2  通</span></span><br><span class="line"></span><br><span class="line"><span class="attr">10.查看验证</span></span><br><span class="line"> <span class="attr">&lt;SW3&gt;display</span> <span class="string">stp brief </span></span><br><span class="line"><span class="attr">查看S1的instance</span> <span class="string">1 g0/0/3 g0/0/10都是指定接口</span></span><br><span class="line"><span class="attr">查看S2的instance</span> <span class="string">2 g0/0/4 g0/0/10都是指定接口  </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络1</title>
      <link href="/posts/switching1.html"/>
      <url>/posts/switching1.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="Trunk原理与配置"><a href="#Trunk原理与配置" class="headerlink" title="Trunk原理与配置"></a>Trunk原理与配置</h2><h3 id="Vlan内通信"><a href="#Vlan内通信" class="headerlink" title="Vlan内通信"></a>Vlan内通信</h3><p><strong>实现跨交换的同Vlan通信</strong></p><p><img src="/../img/img_artical/net_sec/4.1.1.png" alt="4.1.1"></p><h3 id="Trunk接口"><a href="#Trunk接口" class="headerlink" title="Trunk接口"></a>Trunk接口</h3><p><strong>场景</strong></p><ul><li>通常用于交换机与交换机互连</li></ul><p><strong>特点</strong></p><ul><li>同时可以属于多个VLAN</li><li>接收数据帧，检查数据帧中的vlan标签，判断是否允许这个vlan标签通过，如果允许则接收数据帧，如果不允许则丢弃数据</li><li>转发数据帧，检查数据帧中的vlan标签，判断是否允许这个vlan标签通过，如果不允许则丢弃数据，如果允许，且vlan标签与接口Pvid相同，则剥离标签后转发，如果不相同则直接转发</li></ul><h3 id="Hybrid接口"><a href="#Hybrid接口" class="headerlink" title="Hybrid接口"></a>Hybrid接口</h3><p><strong>场景</strong></p><ul><li>既可以连接用户终端，也可以连接交换机&#x2F;路由器</li></ul><p><strong>特点</strong></p><ul><li>同时可以属于多个VLAN</li><li>可以像Access 接口一样，发送出去的数据不携带标签</li><li>可以像Trunk 接口一样，发送出去的数据携带标签</li><li>可以灵活控制接口上发送的数据帧是否携带标签</li></ul><h3 id="配置Trunk接口"><a href="#配置Trunk接口" class="headerlink" title="配置Trunk接口"></a>配置Trunk接口</h3><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">batch vlan 1 to 10          //创建vlan</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">G0/0/0                 //进入接口</span></span><br><span class="line"><span class="attr">[SW1-G0/0/0]port</span> <span class="string">link-type trunk      //设置接口为trunk</span></span><br><span class="line"><span class="attr">[SW1-G0/0/0]port</span> <span class="string">trunk allow-pass vlan all     //设置trunk允许通过的vlan</span></span><br></pre></td></tr></table></figure><h2 id="Eth-Trunk原理"><a href="#Eth-Trunk原理" class="headerlink" title="Eth-Trunk原理"></a>Eth-Trunk原理</h2><h3 id="组网中经常遇到的问题"><a href="#组网中经常遇到的问题" class="headerlink" title="组网中经常遇到的问题"></a>组网中经常遇到的问题</h3><p><img src="/../img/img_artical/net_sec/4.1.2.png" alt="4.1.2"></p><h3 id="链路聚合技术"><a href="#链路聚合技术" class="headerlink" title="链路聚合技术"></a>链路聚合技术</h3><p><strong>概述</strong></p><ul><li>Eth-Trunk(链路聚合技术)作为一种捆绑技术，可以把多个独立的物理接口绑定在起，作为一个大带宽的逻辑接口使用</li></ul><p><strong>好处</strong></p><ul><li>增加设备之间的互联带宽</li><li>提高设备之间的可靠性</li><li>对流量负载均衡，提高链路利用率</li></ul><p><img src="/../img/img_artical/net_sec/4.1.3.png" alt="4.1.3"></p><h3 id="Eth-Trunk概念"><a href="#Eth-Trunk概念" class="headerlink" title="Eth-Trunk概念"></a>Eth-Trunk概念</h3><p><strong>Eth-Trunk链路聚合模式</strong></p><ul><li>手工模式</li><li>LACP模式</li></ul><h3 id="手工模式"><a href="#手工模式" class="headerlink" title="手工模式"></a>手工模式</h3><p><strong>当设备不支持LACP协议时，使用手工模式</strong></p><ul><li>手工模式下3条活动链路都参与数据转发并分担流量</li><li>当一条链路故障时，在剩余的2条活动链路中分担流量</li></ul><p><img src="/../img/img_artical/net_sec/4.1.4.png" alt="4.1.4"></p><h3 id="配置手工模式Eth-Trunk"><a href="#配置手工模式Eth-Trunk" class="headerlink" title="配置手工模式Eth-Trunk"></a>配置手工模式Eth-Trunk</h3><p><strong>手工模式链路聚合配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Eth-Trunk 1                //创建并进入 eth-trunk 1</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]mode</span> <span class="string">manual load-balance     //配置手工模式</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port G0/0/1         //加入成员端口</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port G0/0/2         //加入成员端口</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]port</span> <span class="string">link-type trunk      //配置 eth-trunk 类型为 trunk</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]port</span> <span class="string">trunk allow-pass vlan all  //允许所有的 vlan</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SWl]display</span> <span class="string">eth-trunk 1           //查看当前设备的 eth-trunk 1的配置</span></span><br></pre></td></tr></table></figure><h2 id="LACP模式Eth-trunk配置"><a href="#LACP模式Eth-trunk配置" class="headerlink" title="LACP模式Eth-trunk配置"></a>LACP模式Eth-trunk配置</h2><h3 id="LACP模式"><a href="#LACP模式" class="headerlink" title="LACP模式"></a>LACP模式</h3><p><strong>LACP模式也称为M:N模式</strong></p><ul><li>M条活动链路，N条备份链路</li><li>当活动链路出现故障时，备份链路才进行转发</li></ul><h3 id="LACP模式工作原理"><a href="#LACP模式工作原理" class="headerlink" title="LACP模式工作原理"></a>LACP模式工作原理</h3><p><strong>LACP模式工作原理</strong></p><ul><li>确定主动端</li><li>确定活动链路</li><li>LACP抢占功能</li></ul><h3 id="确定LACP主动端"><a href="#确定LACP主动端" class="headerlink" title="确定LACP主动端"></a>确定LACP主动端</h3><p><strong>确定LACP主动端</strong></p><ul><li>通过比较两端设备的系统优先级来确定LACP主动端</li><li>系统优先级越小越优先，默认值为32768</li><li>如果系统优先级相同，则比较两端设备的MAC地址，越小越优先</li></ul><h3 id="确定LACP活动链路"><a href="#确定LACP活动链路" class="headerlink" title="确定LACP活动链路"></a>确定LACP活动链路</h3><ul><li>选出主动端后，以主动端的接口优先级来选择活动接口</li><li>如果主动端的接口优先级相同，则选择接口编号小的为活动接口</li><li>两端设备的活动端口建立的活动链路以负载分担的方式转发数据</li><li>可以设置活动端口的数量</li></ul><h3 id="开启LACP抢占功能"><a href="#开启LACP抢占功能" class="headerlink" title="开启LACP抢占功能"></a>开启LACP抢占功能</h3><ul><li>开启LACP抢占后，链路聚合组会始终选择高优先级的接口作为活动接口</li><li>活动接口故障后，备份链路的接口被激活，承担数据转发任务</li><li>活动接口恢复后，优先级高于备份接口，进行抢占，重新成为活动端口</li></ul><h3 id="配置LACP模式的Eth-Trunk"><a href="#配置LACP模式的Eth-Trunk" class="headerlink" title="配置LACP模式的Eth-Trunk"></a>配置LACP模式的Eth-Trunk</h3><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SWl]lacp</span> <span class="string">priority 100      //设置LACP 系统优先级</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Eth-Trunk 1  //创建并进入 eth-trunk 1</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]mode</span> <span class="string">lacp-static   //设置为LACP模式</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port g0/0/1   //添加成员接口</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunkl]trunk</span> <span class="string">port g0/0/2</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port g0/0/3</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunkl]port</span> <span class="string">link-type trunk  //设置trunk模式</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]port</span> <span class="string">trunk allow-pass vlan all  //允许所有vlan通过</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]max</span> <span class="string">active-link number 2     //设置活动端口上限</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunkl]lacp</span> <span class="string">preempt enable//开启LACP抢占</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理4</title>
      <link href="/posts/netexp4.html"/>
      <url>/posts/netexp4.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="TCP数据包格式"><a href="#TCP数据包格式" class="headerlink" title="TCP数据包格式"></a>TCP数据包格式</h2><h3 id="传输层的作用"><a href="#传输层的作用" class="headerlink" title="传输层的作用"></a>传输层的作用</h3><p><strong>IP层提供点到点的连接</strong></p><p><strong>传输层提供端到端的连接</strong></p><ul><li>端口到端口的连接（不同端口号，代表不同应用程序）</li></ul><p><img src="/../img/img_artical/net_sec/3.4.1.png" alt="3.4.1"></p><h3 id="TCP协议概述"><a href="#TCP协议概述" class="headerlink" title="TCP协议概述"></a>TCP协议概述</h3><p><strong>TCP（Transmission Control Protocol）</strong></p><ul><li>传输控制协议</li><li>可靠的、面向连接的协议</li><li>传输效率低（建立连接需要的时间长）</li></ul><h3 id="UDP协议概述"><a href="#UDP协议概述" class="headerlink" title="UDP协议概述"></a>UDP协议概述</h3><p><strong>UDP（User Datagram Protocol）</strong></p><ul><li>用户数据报文协议</li><li>不可靠的、无连接的服务</li><li>传输效率高（无需专门建立连接，速度快）</li></ul><h3 id="TCP的报文结构"><a href="#TCP的报文结构" class="headerlink" title="TCP的报文结构"></a>TCP的报文结构</h3><p><img src="/../img/img_artical/net_sec/3.4.2.png" alt="3.4.2"></p><ul><li>源端口：源端口和IP地址的作用是标识报文的返回地址</li><li>目的端口：目标端口指明接收方计算机上的应用程序接口<ul><li>备注：源端口是随机的，目标端口是固定的</li></ul></li><li>序列号：seq，使用序列号，保证了tcp传输的有序性</li><li>确认号：ACK，确认号，表示在回复对端，你发的（在该序号之前的所有数据，我都已经收到）</li><li>首部长度：由固定头部和可选项组成， 最小为20字节，最大为60字节</li><li>保留：为将来定义新的用途保留，现在一般置0</li><li>控制位：共6个，每一个标志位表示一个控制功能<ul><li>SYN&#x3D;1：代表请求建立连接（同步位）</li><li>ACK&#x3D;1：代表同意建立连接（确认位）</li><li>FIN&#x3D;1：代表请求断开连接（停止位）</li><li>URG&#x3D;1：代表紧急指针开启—紧急指针：特别着急的数据段优先传递</li><li>PSH&#x3D;1：代表提示接收端应用程序要立刻将数据从缓冲区里面取走.</li><li>RST&#x3D;1：数据没有传输完成断开了，在次请求建议连接</li></ul></li><li>窗口：滑动窗口，代表数据在发送之前，设备间要进行协商，依照最小单位为准发送</li><li>校验和：此校验和是对整个的 TCP 报文段，包括 TCP 头部和 TCP 数据</li></ul><h2 id="TCP连接与断开"><a href="#TCP连接与断开" class="headerlink" title="TCP连接与断开"></a>TCP连接与断开</h2><h3 id="TCP连接与断开-1"><a href="#TCP连接与断开-1" class="headerlink" title="TCP连接与断开"></a>TCP连接与断开</h3><ul><li>TCP连接与断开<ul><li>TCP连接的建立：三次握手、TCP连接的断开：四次挥手</li></ul></li><li>SYN：同步位，TCP需要建立连接时将该值设为1</li><li>ACK：确认位，当该位为1时，用于确认发送方的数据</li><li>FIN：当TCP断开连接时将该位置为1</li></ul><h3 id="TCP的连接"><a href="#TCP的连接" class="headerlink" title="TCP的连接"></a>TCP的连接</h3><p><strong>TCP的连接：三次握手</strong></p><p><img src="/../img/img_artical/net_sec/3.4.3.png" alt="3.4.3"></p><h3 id="TCP的断开"><a href="#TCP的断开" class="headerlink" title="TCP的断开"></a>TCP的断开</h3><p><strong>TCP的断开：四次挥手</strong></p><p><img src="/../img/img_artical/net_sec/3.4.4.png" alt="3.4.4"></p><h2 id="UDP协议解析"><a href="#UDP协议解析" class="headerlink" title="UDP协议解析"></a>UDP协议解析</h2><h3 id="UDP封装格式"><a href="#UDP封装格式" class="headerlink" title="UDP封装格式"></a>UDP封装格式</h3><p><img src="/../img/img_artical/net_sec/3.4.5.png" alt="3.4.5"></p><ul><li><p>源端口：源端口和IP地址的作用是标识报文的返回地址</p></li><li><p>目的端口：目标端口指明接收方计算机上的应用程序接口</p></li><li><p>UDP长度：代表整个UDP的数据报是多大</p></li><li><p>UDP校验和：是一个检查机制，在发送数据包之前检查一下数据包的完整性</p></li></ul><h3 id="UDP的应用"><a href="#UDP的应用" class="headerlink" title="UDP的应用"></a>UDP的应用</h3><table><thead><tr><th align="center">端口</th><th align="center">协议</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">69</td><td align="center">TFTP</td><td align="center">简单文件传输协议</td></tr><tr><td align="center">53</td><td align="center">DNS</td><td align="center">域名服务</td></tr><tr><td align="center">123</td><td align="center">NTP</td><td align="center">网络时间协议</td></tr><tr><td align="center">67&#x2F;68</td><td align="center">DHCP</td><td align="center">动态主机配置协议</td></tr></tbody></table><h2 id="应用层协议介绍"><a href="#应用层协议介绍" class="headerlink" title="应用层协议介绍"></a>应用层协议介绍</h2><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p><strong>Domain Name System，域名系统</strong></p><ul><li>用来完成域名与IP地址之间的映射，便于用户对网站的记忆和访问</li><li>端口号为TCP或UDP的53</li></ul><h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><p><strong>File Transfer Protocol</strong></p><ul><li>文件传输协议</li><li>使用最为广泛的文件传输应用，用于稳定的传输的大容量的文件</li><li>端口号为TCP21和20</li></ul><p><strong>FTP的工作原理</strong></p><ul><li>控制连接：TCP21，用于发送FTP命令信息</li><li>数据连接：TCP20，用于上传、下载数据</li></ul><h3 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h3><p><strong>网络设备管理方式</strong></p><ul><li>本地管理，通过console 线缆管理网络设备。第一次配置设备时使用</li><li>远程管理，通过IP网络，利用远程管理协议管理设备，比如Telnet或SSH</li></ul><p><strong>常见的远程管理协议</strong></p><ul><li>Telnet，多在公司内部使用，传输数据的方式是明文，端口号为TCP23</li><li>SSH，可在任何场景下使用，传输数据的方式是密文，端口号为 TCP22</li></ul><p><strong>Telnet的常见认证方式</strong></p><ul><li>密码认证，远程登录时，仅仅需要密码，认证方式单一，权限控制不精准</li><li>AAA认证，远程登录时，需要用户名和密码，可为不同的用户分配不同权限远程登录权限的控制，更加灵活</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理3</title>
      <link href="/posts/netexp3.html"/>
      <url>/posts/netexp3.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="IP数据包格式"><a href="#IP数据包格式" class="headerlink" title="IP数据包格式"></a>IP数据包格式</h2><h3 id="网络层概述"><a href="#网络层概述" class="headerlink" title="网络层概述"></a>网络层概述</h3><p><strong>位于OSI模型第三层</strong></p><p><strong>作用</strong></p><ul><li>定义网络设备的逻辑地址，俗称网络层地址（如IP地址）</li><li>在不同的网段之间选择最佳数据转发路径</li></ul><p><strong>协议</strong></p><ul><li>IP协议</li></ul><h3 id="IP数据包格式-1"><a href="#IP数据包格式-1" class="headerlink" title="IP数据包格式"></a>IP数据包格式</h3><p><strong>网络层的所有功能，都是通过该层的诸多协议实现的</strong></p><ul><li>目前网络中，主要的网络层协议是IP 协议</li></ul><p><img src="/../img/img_artical/net_sec/3.3.1.png" alt="3.3.1"></p><p><strong>IP数据报是可变长度的，它由两部分组成：首部和数据</strong></p><ul><li>首部由两部分组成:固定部分和可变部分</li><li>固定部分20字节，可变部分由一些选项组成，最长40字节</li></ul><p><img src="/../img/img_artical/net_sec/3.3.2.png" alt="3.3.2"></p><p><strong>字段作用解析</strong></p><ul><li><p>版本：指的IP地址的版本 （IPv4 或 IPV6）</p></li><li><p>首部长度：数据包的首部长度一共是多少</p></li><li><p>优先级与服务类型：表示数据包是否需要优选传递</p></li><li><p>总长度：表示的是整个数据包的大小，也就是首部+数据</p></li><li><p>标识符、标志、段偏移量：作用将拆开的数据包进行组合（用来数据重组的）</p></li><li><p>TTL值：数据生命周期</p><ul><li>作用：防止数据无限循环转发</li><li>原理：数据包每经过一台路由器，TTL值会减1，当TTL为0时，数据包被丢弃</li></ul></li><li><p>协议号：数据包在网络中传递时所用的协议</p><ul><li>1 – ICMP</li><li>6 – TCP</li><li>17 – UDP</li></ul></li><li><p>首部校验和：是用来做数据包核对用的，确定数据包是否是完整，如果是就接收，如果不是完整的数据包则丢弃</p></li><li><p>源IP地址 ：表示发送这个数据包的设备的IP地址</p></li><li><p>目标IP地址：表示接收这个数据包的设备的IP地址</p></li><li><p>可选项：他是一个可变长度，取值范围：0-40个字节 一般数据包中不是加该选项的</p></li><li><p>数据：他是应用层发出的数据—–在数据包中体现，单独看不到</p></li></ul><h2 id="IP地址解析"><a href="#IP地址解析" class="headerlink" title="IP地址解析"></a>IP地址解析</h2><h3 id="网络与广播地址"><a href="#网络与广播地址" class="headerlink" title="网络与广播地址"></a>网络与广播地址</h3><p><strong>网络地址</strong></p><ul><li>主机位全为0的IP地址</li><li>表示的是一个网络范围，仅仅表示一个区域，不代表任何一个主机</li><li>例如：192.168.1.0 255.255.25.0，是网络地址</li></ul><p><strong>广播地址</strong></p><ul><li>主机位全为1的IP地址</li><li>表示的是一个网络范围内的所有主机&#x2F;设备</li><li>例如：192.168.1.255 255.255.255.0，是广播地址</li></ul><h3 id="可用IP地址"><a href="#可用IP地址" class="headerlink" title="可用IP地址"></a>可用IP地址</h3><p><strong>可用IP地址范围及广播地址</strong></p><p><img src="/../img/img_artical/net_sec/3.3.3.png" alt="3.3.3"></p><h2 id="网络层常见协议"><a href="#网络层常见协议" class="headerlink" title="网络层常见协议"></a>网络层常见协议</h2><h3 id="ICMP协议概述"><a href="#ICMP协议概述" class="headerlink" title="ICMP协议概述"></a>ICMP协议概述</h3><p><strong>概述</strong></p><ul><li>ICMP（Internet Control Message Protocol），Internet控制消息协议</li><li>位于 OSI 模型第三层，即网络层</li><li>协议号：1</li></ul><p><strong>作用</strong></p><ul><li>在IP网络中发送控制消息，反馈可能发生在通信环境中的各种问题，从而为网络连通性测试以及网络故障定位提供有效指示信息</li></ul><p><strong>场景示例</strong></p><ul><li>当路由器收到一个不能被送到最终目的地的数据包时，路由器会向源主机发送一个ICMP主机不可达的消息</li></ul><p><img src="/../img/img_artical/net_sec/3.3.4.png" alt="3.3.4"></p><h3 id="ICMP协议应用"><a href="#ICMP协议应用" class="headerlink" title="ICMP协议应用"></a>ICMP协议应用</h3><p><strong>测试工具-Ping</strong></p><ul><li>测试两个设备之间的连通性</li><li>使用的是ICMP协议的数据包</li></ul><p><strong>测试命令</strong></p><ul><li>ping  目标IP</li><li>ping  目标IP  -t          &#x2F;&#x2F;一直ping目标地址</li><li>ping  目标IP  -c  X     &#x2F;&#x2F;指定ping几次</li><li>ping  目标IP  -i   X     &#x2F;&#x2F;指定ping包的字节大小</li><li>tracert  目标IP          &#x2F;&#x2F;路由追踪</li></ul><p><strong>Echo Request，请求报文</strong></p><p><strong>Echo Reply，响应报文</strong></p><p><img src="/../img/img_artical/net_sec/3.3.5.png" alt="3.3.5"></p><p><strong>常见的Ping反馈结果</strong></p><ul><li><p>连接建立成功，Reply from 目标地址….</p></li><li><p>目标主机不可达，Destination host unreachable</p><ul><li>同网段中没有这个IP地址，或IP地址错误</li><li>跨网段通信时，本主机没有填写网关地址</li></ul></li><li><p>请求时间超时，Request timed out</p><ul><li>对方主机没有填写网关地址</li><li>对方的防火墙阻断了</li></ul></li></ul><h3 id="ARP协议概述"><a href="#ARP协议概述" class="headerlink" title="ARP协议概述"></a>ARP协议概述</h3><p><strong>ARP（address resolution protocol）：地址解析协议</strong></p><ul><li>属于OSI 模型第三层（网络层）</li><li>主要作用是:基于目标IP地址获得对应的目标MAC地址，从而完成数据的2层头部封装实现数据的快速转发</li></ul><p><strong>ARP报文类型</strong></p><ul><li>ARP请求报文，源设备以广播的方式发送，向所有设备请求MAC地址</li><li>ARP回应报文，目标设备以单播的方式回应，直接返回给“源设备</li></ul><p><strong>ARP核心工作表</strong></p><ul><li>ARP表，包含的是IP地址与MAC地址的对应关系条目</li><li>ARP条目分为静态和动态两种类型</li><li>动态ARP条目的存活时间是1200s</li></ul><p><strong>任何设备发送数据的原理</strong></p><ul><li>任何设备在发送数据包之前，必须检查ARP 表，查看包含去往目标IP地址时所使用的MAC地址</li><li>如果ARP表包含目标IP地址对应的条目，则使用目标MAC封装数据</li><li>如果ARP表不包含对应的ARP条目信息，则发送ARP请求，获得目标MAC</li></ul><p><strong>ARP常用命令</strong></p><ul><li>PC&gt;arp  -a &#x2F;&#x2F;查看arp缓存表<br>Internet Address   Physical Address   Type<br>192.168.1.2         54-89-98-B9-74-25  dynamic (动态)</li><li>PC&gt;arp -d  &#x2F;&#x2F;清空arp缓存表</li><li>PC&gt;arp -s 192.168.1.2  54-89-98-B9-74-25  &#x2F;&#x2F;添加静态的ARP表记录</li></ul><h3 id="ARP工作原理"><a href="#ARP工作原理" class="headerlink" title="ARP工作原理"></a>ARP工作原理</h3><ul><li>设备刚开机时，ARP表是空的</li><li>主机10.1.1.1要与10.1.1.2通信，首先以广播方式发送ARP 请求</li></ul><p><img src="/../img/img_artical/net_sec/3.3.6.png" alt="3.3.6"></p><ul><li>所有主机都接收到10.1.1.1的ARP请求报文，但只有10.1.1.2给它一个单播回复，并将10.1.1.1的MAC地址保存在自己的ARP表</li></ul><p><img src="/../img/img_artical/net_sec/3.3.7.png" alt="3.3.7"></p><ul><li>主机10.1.1.1将10.1.1.2的MAC地址保存到ARP缓存中，然后就可以发送数据</li></ul><h2 id="路由原理和配置"><a href="#路由原理和配置" class="headerlink" title="路由原理和配置"></a>路由原理和配置</h2><h3 id="什么是路由"><a href="#什么是路由" class="headerlink" title="什么是路由"></a>什么是路由</h3><p><strong>将数据包从一个网段发送到另一个网段</strong></p><ul><li>需要依靠具备路由功能的设备来完成</li><li>常见的路由设备有路由器或三层交换机、防火墙</li></ul><h3 id="路由器如何工作"><a href="#路由器如何工作" class="headerlink" title="路由器如何工作"></a>路由器如何工作</h3><p><strong>根据路由表选择最佳路径</strong></p><ul><li>每个路由器都维护着一张路由表，这是转发数据包的关键</li><li>每条路由表记录指明了：到达某个子网或主机应从路由器的哪个物理端口发送，通过此端口可到达该路径的下一个路由器的地址</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">目的地址</span>   <span class="string">/掩码        协议      优先级      开销值              下一跳            出接口 </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Destination/Mask</span>      <span class="string">Proto     Pre        Cost               NextHop          Interface </span></span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure><h3 id="路由表的形成"><a href="#路由表的形成" class="headerlink" title="路由表的形成"></a>路由表的形成</h3><p><strong>路由表是在路由器中维护的路由条目的集合，路由器根据路由表做路径选择，路由表是怎么形成的呢?</strong></p><p><strong>直连网段</strong></p><ul><li>配置接口IP地址</li><li>并且接口状态up</li></ul><p><strong>非直连网段</strong></p><p><img src="/../img/img_artical/net_sec/3.3.8.png" alt="3.3.8"></p><h3 id="路由的类型"><a href="#路由的类型" class="headerlink" title="路由的类型"></a>路由的类型</h3><p><strong>依据来源的不同，路由条目可以分为三种类型</strong></p><ul><li>通过链路层协议发现的路由称为直连路由，优先级为0</li><li>通过网络管理员手动添加的路由称为静态路由，优先级为60</li><li>通过动态路由协议自动发现的路由称为动态路由，ospf路由优先级为10</li></ul><h3 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h3><p><strong>静态路由：</strong></p><ul><li>由管理员手动配置添加，为单向条目</li><li>通信双方的路由器都需要配置路由，否则会导致数据包有去无回</li></ul><p><img src="/../img/img_artical/net_sec/3.3.9.png" alt="3.3.9"></p><h3 id="静态路由配置命令"><a href="#静态路由配置命令" class="headerlink" title="静态路由配置命令"></a>静态路由配置命令</h3><p><strong>使用ip route-static 命令</strong></p><ul><li>指定到达的目的网络</li><li>基本格式:</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]ip</span> <span class="string">route-static 目标网络 子网掩码 下一跳地址</span></span><br></pre></td></tr></table></figure><h2 id="配置默认路由"><a href="#配置默认路由" class="headerlink" title="配置默认路由"></a>配置默认路由</h2><h3 id="默认路由"><a href="#默认路由" class="headerlink" title="默认路由"></a>默认路由</h3><p><strong>默认路由</strong></p><ul><li>默认的目标网络为0.0.0.0&#x2F;0，可以匹配任何目标地址</li><li>只有路由表中找不到任何明细路由时，才会使用默认路由（缺省路由）</li><li>默认路由，可以手动添加，也可以让路由器动态学习</li></ul><h3 id="默认路由配置命令"><a href="#默认路由配置命令" class="headerlink" title="默认路由配置命令"></a>默认路由配置命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ip route-static 0.0.0.0 0 下一跳地址</span><br></pre></td></tr></table></figure><h2 id="路由器转发数据包的过程"><a href="#路由器转发数据包的过程" class="headerlink" title="路由器转发数据包的过程"></a>路由器转发数据包的过程</h2><p><img src="/../img/img_artical/net_sec/3.3.10.png" alt="3.3.10"></p><p><img src="/../img/img_artical/net_sec/3.3.11.png" alt="3.3.11"></p><p><img src="/../img/img_artical/net_sec/3.3.12.png" alt="3.3.12"></p><p><img src="/../img/img_artical/net_sec/3.3.13.png" alt="3.3.13"></p><p><img src="/../img/img_artical/net_sec/3.3.14.png" alt="3.3.14"></p><p><img src="/../img/img_artical/net_sec/3.3.15.png" alt="3.3.15"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理2</title>
      <link href="/posts/netexp2.html"/>
      <url>/posts/netexp2.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="数据链路层解析"><a href="#数据链路层解析" class="headerlink" title="数据链路层解析"></a>数据链路层解析</h2><h3 id="数据链路层概述"><a href="#数据链路层概述" class="headerlink" title="数据链路层概述"></a>数据链路层概述</h3><p><strong>位于网络层与物理层之间</strong></p><p><img src="/../img/img_artical/net_sec/3.2.1.png" alt="3.2.1"></p><p><strong>功能</strong></p><ul><li>数据链路的建立、维护与拆除</li><li>帧形成、帧传输、帧同步</li><li>帧的差错恢复和流量控制</li></ul><p><strong>协议</strong></p><ul><li>Ethernet（以太网）</li></ul><h3 id="以太网概述"><a href="#以太网概述" class="headerlink" title="以太网概述"></a>以太网概述</h3><p><strong>以太网</strong></p><ul><li>以太网（Ethernet）是一种计算机局域网技术</li><li>以太网是目前最通用，使用最广泛的局域网通信协议标准</li><li>通常使用的局域网即”以太网”</li></ul><p><strong>主机A与主机B之间的通信，可能遇见的问题</strong></p><ul><li>如何区分不同设备</li><li>如何识别设备发送的数据</li></ul><p><strong>以太网地址 (MAC)</strong></p><ul><li>MAC地址用来标识以太网上唯一的一个设备</li><li>长度：48个bit  (6个字节）</li><li>组成：24个bit的厂商标识+24个bit的网卡编号</li><li>表示方式：使用12位的16进制数表示的  如：98-FA-9B-EE-AA-04</li><li>MAC地址的第8位为0表示单播地址，为1表示组播地址（每一个物理网卡都有一个全球唯一的MAC地址）</li><li>48位都为1 表示广播地址</li></ul><p><img src="/../img/img_artical/net_sec/3.2.2.png" alt="3.2.2"></p><h3 id="Ethernet-II帧格式"><a href="#Ethernet-II帧格式" class="headerlink" title="Ethernet II帧格式"></a>Ethernet II帧格式</h3><ul><li>目的地址：接收主机的MAC地址（6个字节&#x3D;48个bit）</li><li>源地址：发送数据主机的MAC地址</li><li>类型：用来表示上一层使用的什么协议，如果是0x800 代表上层协议是 ip协议</li><li>数据：要传输的数据（包含IP包头，包含TCP包头，包含数据）</li><li>帧校验序列：数据校验，检查数据是否损坏，好的就接收，坏的就丢弃</li><li>以太网帧的数据长度范围46-1500 字节 （净重）</li><li>以太网帧的长度范围64-1518 字节 （毛重）</li></ul><p><img src="/../img/img_artical/net_sec/3.2.3.png" alt="3.2.3"></p><h2 id="理解冲突域"><a href="#理解冲突域" class="headerlink" title="理解冲突域"></a>理解冲突域</h2><h3 id="单工、半双工与全双工"><a href="#单工、半双工与全双工" class="headerlink" title="单工、半双工与全双工"></a>单工、半双工与全双工</h3><p><strong>单工</strong></p><ul><li>只有一个信道，传输方向只能是单向的</li><li>传输数据的信道只有一个，只能接收数据，不能回复数据（类似BB机）</li></ul><p><strong>半双工</strong></p><ul><li>只有一个信道，在同一时刻，只能是单向传输</li><li>传输数据的信道只有一个，可以接收数据，也可以回复数据，但是不能同时进行（类似：对讲机）</li></ul><p><strong>全双工</strong></p><ul><li>双信道，同时可以有双向数据传输</li><li>传输数据的信道有两个，接口可以在同一时刻接收数据和发送数据（类似：电话）</li></ul><p><img src="/../img/img_artical/net_sec/3.2.4.png" alt="3.2.4"></p><h3 id="冲突域概述"><a href="#冲突域概述" class="headerlink" title="冲突域概述"></a>冲突域概述</h3><p><strong>什么是冲突域</strong></p><ul><li>早期以太网是多个网络节点共享同一链路，在同一传输介质上的多个节点共享同一条链路，多个节点争用链路的使用权，这样就会发生冲突</li><li>连接在同一传输介质上的产生冲突的所有节点的集合就是一个冲突域</li></ul><p><img src="/../img/img_artical/net_sec/3.2.5.png" alt="3.2.5"></p><h3 id="分割冲突域"><a href="#分割冲突域" class="headerlink" title="分割冲突域"></a>分割冲突域</h3><p><strong>为了提高传输效率，分割冲突域</strong></p><p><img src="/../img/img_artical/net_sec/3.2.6.png" alt="3.2.6"></p><h3 id="交换机分割冲突域"><a href="#交换机分割冲突域" class="headerlink" title="交换机分割冲突域"></a>交换机分割冲突域</h3><p><strong>交换机分割冲突域</strong></p><ul><li>早期的以太网利用物理层设备HUB来构建网络，不能隔绝冲突</li><li>交换机设备取代了HUB设备组建以太网后，交换机的每个接口访问另一个接口时，都有一条专有的线路，不会产生冲突，所以交换机的每个接口，都是一个不同的冲突域，所以交换机可以分割冲突域</li><li>全双工从根本上解决了以太网的冲突问题</li></ul><h2 id="交换机工作原理"><a href="#交换机工作原理" class="headerlink" title="交换机工作原理"></a>交换机工作原理</h2><h3 id="交换机概述"><a href="#交换机概述" class="headerlink" title="交换机概述"></a>交换机概述</h3><p><strong>交换机是用来连接局域网的主要设备</strong></p><ul><li>交换机能够根据以太网帧中目标MAC地址智能的转发数据，因此交换机工作在数据链路层</li><li>交换机可以分割冲突域，实现全双工通信</li><li>交换机转发数据，主要依靠的是核心工作表：MAC地址表</li></ul><h3 id="交换机工作原理-1"><a href="#交换机工作原理-1" class="headerlink" title="交换机工作原理"></a>交换机工作原理</h3><p><strong>交换机的转发原理</strong></p><ul><li>初始状态，MAC地址表是空的</li><li>MAC地址学习</li><li>广播未知数据帧</li><li>接收方回应</li><li>交换机实现单播通信</li></ul><p><strong>学习</strong></p><ul><li>学习数据帧源MAC地址，生成MAC地址表，并将源MAC地址和对应的接口号写入MAC地址表</li></ul><p><img src="/../img/img_artical/net_sec/3.2.7.png" alt="3.2.7"></p><p><strong>广播</strong></p><ul><li>若目标MAC地址在MAC地址表中没有，交换机就向该数据帧的入接口外的其他所有接口广播未知目标MAC地址</li></ul><p><img src="/../img/img_artical/net_sec/3.2.8.png" alt="3.2.8"></p><p><img src="/../img/img_artical/net_sec/3.2.9.png" alt="3.2.9"></p><p><strong>转发</strong></p><ul><li>交换机根据MAC地址表和目标MAC地址，单播转发数据帧</li></ul><p><img src="/../img/img_artical/net_sec/3.2.10.png" alt="3.2.10"></p><p><strong>更新</strong></p><ul><li>交换机MAC地址表中的转发条目是动态学习到的，老化时间是300秒</li><li>如果发现一个帧的入接口和MAC地址表中该源MAC地址所对应的接口不同，交换机将MAC地址重新学习到新的接口</li></ul><h3 id="查看MAC地址表"><a href="#查看MAC地址表" class="headerlink" title="查看MAC地址表"></a>查看MAC地址表</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;display</span> <span class="string">mac-address  </span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">address table of slot 0:</span></span><br><span class="line"><span class="attr">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address    VLAN/       PEVLAN CEVLAN Port            Type      LSP/LSR-ID  </span></span><br><span class="line">               <span class="attr">VSI/SI</span>                                              <span class="string">MAC-Tunnel  </span></span><br><span class="line"><span class="attr">-------------------------------------------------------------------------------</span></span><br><span class="line"> <span class="attr">5489-9802-3b6e</span> <span class="string">1           -      -      GE0/0/1          dynamic   0/-         </span></span><br><span class="line"> <span class="attr">5489-9886-7447</span> <span class="string">1           -      -      GE0/0/2          dynamic   0/-         </span></span><br><span class="line"> <span class="attr">5489-9899-2a4a</span> <span class="string">1           -      -      GE0/0/3          dynamic   0/-         </span></span><br><span class="line"><span class="attr">-------------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure><h2 id="理解广播域"><a href="#理解广播域" class="headerlink" title="理解广播域"></a>理解广播域</h2><h3 id="广播域概述"><a href="#广播域概述" class="headerlink" title="广播域概述"></a>广播域概述</h3><p><strong>定义</strong></p><ul><li>广播域指接收同一广播消息的节点的集合，比如：一个节点发送目的MAC地址为全FFFF-FFFF-FFFF的广播报文，其余能够收到这条广播报文的节点的集合，就是一个广播域</li><li>通常”一个IP网段，就是一个广播域”</li></ul><p><img src="/../img/img_artical/net_sec/3.2.11.png" alt="3.2.11"></p><h3 id="广播域过大所带来的问题"><a href="#广播域过大所带来的问题" class="headerlink" title="广播域过大所带来的问题"></a>广播域过大所带来的问题</h3><p><strong>广播域中网络节点过多所带来的问题</strong></p><ul><li>一个广播域中的网络节点越多，广播报文也必然会越多</li><li>当广播报文越多，当前广播域的带宽占用就越多，网络不可用风险增大</li><li>当广播报文越多，当前广播域中的设备资源占用高，转发数据速度慢</li><li>所以当一个广播域中的节点过多，网络的稳定性和安全性会越低</li></ul><h2 id="VLAN概述"><a href="#VLAN概述" class="headerlink" title="VLAN概述"></a>VLAN概述</h2><h3 id="VLAN概述-1"><a href="#VLAN概述-1" class="headerlink" title="VLAN概述"></a>VLAN概述</h3><p><strong>什么是VLAN</strong></p><ul><li>VirtualLAN(虚拟局域网)</li><li>将一个物理的局域网(LAN) 逻辑上划分成多个虚拟局域网 (VLAN) 的通信技术</li></ul><p><strong>为什么引入VLAN</strong></p><ul><li>交换机分割了冲突域，但是不能分割广播域</li><li>随着交换机端口数量的增多，网络中广播增多，降低了网络的效率</li><li>为了分割广播域，引入了VLAN</li></ul><p><strong>VLAN分割广播域</strong></p><p><img src="/../img/img_artical/net_sec/3.2.12.png" alt="3.2.12"></p><p><strong>VLAN的作用</strong></p><ul><li>广播控制</li><li>安全性</li><li>带宽利用</li><li>延迟</li></ul><h3 id="VLAN的划分种类"><a href="#VLAN的划分种类" class="headerlink" title="VLAN的划分种类"></a>VLAN的划分种类</h3><p><strong>基于端口划分的静态VLAN（常见）</strong></p><ul><li>通常是基于接口划分</li></ul><p><img src="/../img/img_artical/net_sec/3.2.13.png" alt="3.2.13"></p><p><strong>基于MAC地址划分的动态VLAN</strong></p><h3 id="标准以太网帧及带有vlan-标签的数据帧"><a href="#标准以太网帧及带有vlan-标签的数据帧" class="headerlink" title="标准以太网帧及带有vlan 标签的数据帧"></a>标准以太网帧及带有vlan 标签的数据帧</h3><ul><li><p>Vlan数据帧（标准）：目标地址+源地址+类型+数据+帧校验序列</p></li><li><p>VLAN数据帧：目的地址+源地址+【Vlan-Tag】+类型+数据+帧校验序列</p></li><li><p>注：vlan-tag：共4个字节，分为4个字段，其中最后一个字段VID表示vlan编号（12个bit），2的12次方是4096，所以0-4095个vlan,但是0和4095是被保留的，所以一个交换机中可以创建的vlan编号最大到4094</p></li></ul><h2 id="VLAN配置"><a href="#VLAN配置" class="headerlink" title="VLAN配置"></a>VLAN配置</h2><h3 id="PVID"><a href="#PVID" class="headerlink" title="PVID"></a>PVID</h3><p><strong>PVID: Port Default VLANID，也称缺省VLAN</strong></p><ul><li>表示接口所属的VLAN</li><li>每个接口都有一个PVID</li><li>交换机中所有接口的PVID默认都为VLAN1，但是可以手动修改</li></ul><h3 id="配置VLAN的步骤"><a href="#配置VLAN的步骤" class="headerlink" title="配置VLAN的步骤"></a>配置VLAN的步骤</h3><p><strong>创建VLAN</strong></p><ul><li>创建单个VLAN</li><li>批量创建VLAN</li></ul><p><strong>将接口加入到相应的VLAN中</strong></p><h3 id="创建VLAN"><a href="#创建VLAN" class="headerlink" title="创建VLAN"></a>创建VLAN</h3><p><strong>创建单个VLAN</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]vlan</span> <span class="string">10    //创建VLAN10</span></span><br></pre></td></tr></table></figure><p><strong>批量创建VLAN</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]vlan</span> <span class="string">batch 10 15 20   //创建多个不连续vlan</span></span><br><span class="line"><span class="attr">[Huawei]vlan</span> <span class="string">batch 10 to 20   //创建多个连续vlan</span></span><br></pre></td></tr></table></figure><h3 id="删除VLAN"><a href="#删除VLAN" class="headerlink" title="删除VLAN"></a>删除VLAN</h3><p><strong>删除VLAN</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]undo</span> <span class="string">vlan 10               //删除VLAN10</span></span><br><span class="line"><span class="attr">[Huawei]undo</span> <span class="string">vlan batch 10 15 20   //删除多个不连续vlan</span></span><br><span class="line"><span class="attr">[Huawei]undo</span> <span class="string">vlan batch 10 to 20   //删除多个连续vlan</span></span><br></pre></td></tr></table></figure><h3 id="Access接口"><a href="#Access接口" class="headerlink" title="Access接口"></a>Access接口</h3><p><strong>场景</strong></p><ul><li>通常用于连接终端设备（主机、服务器）</li></ul><p><strong>特点</strong></p><ul><li>同时只能属于一个VLAN</li><li>接收数据帧时，若该帧不带vlan标签，用接口PVID数值做为标签，给数据帧打标签</li><li>接收数据帧时，若该帧带vlan标签，判断vlan标签和本接口的PVID是否一致，一致接收数据，不一致则丢弃数据</li><li>转发数据帧时，若该帧vlan标签与本接口PVID一致，则剥离标签并转发，不一致则丢弃数据</li></ul><h3 id="将接口加入VLAN"><a href="#将接口加入VLAN" class="headerlink" title="将接口加入VLAN"></a>将接口加入VLAN</h3><p><strong>接口加入VLAN</strong></p><ul><li>创建VLAN</li><li>设置接口模式成Access</li><li>将接口加入VLAN</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">g0/0/1                 //进入g0/0/1接口</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/1]port</span> <span class="string">link-type access     //将接口设置为access模式</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/1]port</span> <span class="string">default vlan 2       //将接口加入vlan2</span></span><br></pre></td></tr></table></figure><h3 id="验证vlan的配置"><a href="#验证vlan的配置" class="headerlink" title="验证vlan的配置"></a>验证vlan的配置</h3><p><strong>检查vlan信息</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]display</span> <span class="string">vlan               //显示所有vlan信息</span></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">vlan 2             //显示指定vlan信息</span></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">port vlan          //显示vlan中包含的接口信息</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理1</title>
      <link href="/posts/netexp1.html"/>
      <url>/posts/netexp1.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="协议分层"><a href="#协议分层" class="headerlink" title="协议分层"></a>协议分层</h2><h3 id="计算机网络发展"><a href="#计算机网络发展" class="headerlink" title="计算机网络发展"></a>计算机网络发展</h3><p><strong>计算机的诞生</strong></p><ul><li>1946年2月14日ENIAC诞生</li></ul><p><strong>计算机网络的诞生</strong></p><ul><li>1969年APNET诞生</li></ul><p><strong>不同网络之间的互联</strong></p><ul><li>由于网络标准不一样，无法完成互联</li></ul><h3 id="计算机网络功能"><a href="#计算机网络功能" class="headerlink" title="计算机网络功能"></a>计算机网络功能</h3><p><strong>数据通信、资源共享、增加数据可靠性、提高系统处理能力（主要功能数据通信）</strong></p><p><img src="/../img/img_artical/net_sec/3.1.1.png" alt="3.1.1"></p><h3 id="什么是协议"><a href="#什么是协议" class="headerlink" title="什么是协议"></a>什么是协议</h3><p><strong>什么是协议?</strong></p><ul><li><p>为了使数据可以在网络上从源传递到目的地，网络上所有设备需要”讲”相同的”语言”</p></li><li><p>描述网络通信”语言”规范的一组规则就是协议</p></li><li><p>例如：两个人交谈，必须使用相同的语言，如果你说汉语，他说阿拉伯语……</p></li></ul><p><strong>数据通信协议的定义</strong></p><ul><li>决定数据的格式和传输的一组规则或者一组惯例</li></ul><h3 id="为什么分层"><a href="#为什么分层" class="headerlink" title="为什么分层"></a>为什么分层</h3><p><strong>网络通信的过程很复杂</strong></p><ul><li>数据以电子信号的形式穿越介质到达正确的计算机，然后转换成最初的形式，以便接收者能够阅读</li><li>为了降低网络设计的复杂性，将协议进行了分层设计，方便网络故障的定位</li></ul><h3 id="邮局实例（传统通信）"><a href="#邮局实例（传统通信）" class="headerlink" title="邮局实例（传统通信）"></a>邮局实例（传统通信）</h3><p><img src="/../img/img_artical/net_sec/3.1.2.png" alt="3.1.2"></p><h2 id="理解OSI模型"><a href="#理解OSI模型" class="headerlink" title="理解OSI模型"></a>理解OSI模型</h2><h3 id="OSI协议模型"><a href="#OSI协议模型" class="headerlink" title="OSI协议模型"></a>OSI协议模型</h3><p><img src="/../img/img_artical/net_sec/3.1.3.png" alt="3.1.3"></p><h3 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h3><p><strong>OSI参考模型</strong></p><ul><li>国际标准化组织(International Standard Organization，ISO)于1984年正式颁布开放系统互连 (Open System Interconnection，OSI) 参考模型</li><li>所有的软件和硬件开发都遵循统一的OSI模型</li></ul><p><img src="/../img/img_artical/net_sec/3.1.4.png" alt="3.1.4"></p><h3 id="OSI七层的功能简介"><a href="#OSI七层的功能简介" class="headerlink" title="OSI七层的功能简介"></a>OSI七层的功能简介</h3><table><thead><tr><th align="center">层名称</th><th align="center">功能</th></tr></thead><tbody><tr><td align="center">应用层</td><td align="center">为用户提供各种服务功能，比如各种应用程序，网络服务与最终用户的一个接口</td></tr><tr><td align="center">表示层</td><td align="center">数据的表示、安全、压缩、加密等</td></tr><tr><td align="center">会话层</td><td align="center">建立、维护、终止会话，例如断点续传</td></tr><tr><td align="center">传输层</td><td align="center">定义传输数据的协议端口号，实现了程序与程序的互连，可靠与不可靠的传输,流量控制差错校验</td></tr><tr><td align="center">网络层</td><td align="center">进行逻辑地址寻址，实现不同网络之间通信，定义了IP地址，为数据的传输选择最佳路径，路由器工作在网络层</td></tr><tr><td align="center">数据链路层</td><td align="center">建立逻辑链接，进行硬件地址寻址、通过MAC地址实现数据的通信，帧包装、帧传输、帧同步，交换机工作在数据链路层</td></tr><tr><td align="center">物理层</td><td align="center">建立、维护、断开物理连接，定义了接口及介质，实现了比特流的传输</td></tr></tbody></table><h2 id="理解TCP-IP模型"><a href="#理解TCP-IP模型" class="headerlink" title="理解TCP&#x2F;IP模型"></a>理解TCP&#x2F;IP模型</h2><h3 id="OSI模型与TCP-IP模型"><a href="#OSI模型与TCP-IP模型" class="headerlink" title="OSI模型与TCP&#x2F;IP模型"></a>OSI模型与TCP&#x2F;IP模型</h3><ul><li>OSI模型，仅仅是ISO 提出的一个”参考”标准</li><li>实际的网络中更多使用TCP&#x2F;IP 5层模型，但是实现的功能是相同的</li></ul><p><img src="/../img/img_artical/net_sec/3.1.5.png" alt="3.1.5"></p><h3 id="TCP-IP协议族的组成"><a href="#TCP-IP协议族的组成" class="headerlink" title="TCP&#x2F;IP协议族的组成"></a>TCP&#x2F;IP协议族的组成</h3><p><strong>TCP&#x2F;IP是一系列协议的集合，所以严格称呼应是TCP&#x2F;IP协议族</strong></p><p><img src="/../img/img_artical/net_sec/3.1.6.png" alt="3.1.6"></p><p><strong>网络层常见协议：</strong> </p><ul><li><p>IP：互联网协议，定义了IP地址</p></li><li><p>ICMP：网络控制消息协议，验证和测试网络连通性</p></li><li><p>ARP：地址解析协议，将IP地址解析成MAC地址</p></li><li><p>OSPF：开放式最短路径优先，动态路由协议</p></li></ul><p><strong>传输层常见协议：</strong></p><ul><li><p>TCP：传输控制协议—安全可靠，速度慢</p></li><li><p>UDP： 用户数据报协议—不可靠，速度快</p></li></ul><p><strong>应用层常见协议：</strong></p><ul><li><p>HTTP：超文本传输协议—TCP 80端口</p></li><li><p>FTP：文件传输协议—TCP 20  和21</p></li><li><p>TFTP：简单文件传输协议—UDP  69</p></li><li><p>DHCP：动态主机配置协议—UDP 67  68</p></li><li><p>Telnet：远程管理协议—TCP 23</p></li><li><p>RDP：远程桌面协议—TCP 3389</p></li><li><p>DNS：域名解析—TCP或UDP 53</p></li><li><p>SMTP：简单邮件传输协议—TCP 25</p></li><li><p>SNMP：网络管理协议—UDP 161</p></li></ul><h3 id="各层PDU"><a href="#各层PDU" class="headerlink" title="各层PDU"></a>各层PDU</h3><p><strong>PDU：Protocol Data Unit，协议数据单元，即协议的数据包</strong></p><p><img src="/../img/img_artical/net_sec/3.1.7.png" alt="3.1.7"></p><ul><li><p>传输层 数据段 segment</p></li><li><p>网络层 数据包 packet</p></li><li><p>数据链路层 数据帧 frame</p></li><li><p>物理层  比特流 bit</p></li></ul><h3 id="设备与层的对应关系"><a href="#设备与层的对应关系" class="headerlink" title="设备与层的对应关系"></a>设备与层的对应关系</h3><p><img src="/../img/img_artical/net_sec/3.1.8.png" alt="3.1.8"></p><h2 id="数据通信流程"><a href="#数据通信流程" class="headerlink" title="数据通信流程"></a>数据通信流程</h2><h3 id="数据通信"><a href="#数据通信" class="headerlink" title="数据通信"></a>数据通信</h3><p><strong>所谓的设备之间的通信，指的是设备之间能够互相传输数据</strong></p><p><strong>产生数据</strong></p><ul><li>即数据封装，指的是数据通过应用层产生以后，发送到第一层，每经过一层都添加一个协议头部的过程</li></ul><p><strong>传输数据</strong></p><ul><li>即网络传输，数据在由不同的网络设备组成的互联网中传输的过程，主要是依靠交换机和路由器实现数据在不同设备之间的转发</li></ul><p><strong>接收数据</strong></p><ul><li>即数据解封装，指的是数据被设备通过网线接收以后形成数据帧，然后一层一层分析头部，然后传递给上一层处理，一直到应用层的过程</li><li>也可以说是：不断的分析并删除每层的协议头部的过程</li></ul><p><strong>设备之间的数据传输，一定是双向的，每个方向都分为3个阶段</strong></p><ul><li>产生数据，也称之为”数据封装”</li><li>传输数据，也称之为”网络传输”</li><li>接收数据，也称之为”数据解封装”</li></ul><h3 id="数据封装过程"><a href="#数据封装过程" class="headerlink" title="数据封装过程"></a>数据封装过程</h3><p><strong>应用层在产生数据后，从应用层到物理层，每经过一层，都会加上每一层的头部信息，传输层封装TCP头部， 网络层封装IP头部，数据链路层封装MAC头部和尾部</strong></p><p><img src="/../img/img_artical/net_sec/3.1.9.png" alt="3.1.9"></p><h3 id="数据解封装过程"><a href="#数据解封装过程" class="headerlink" title="数据解封装过程"></a>数据解封装过程</h3><p><strong>数据从下往上的过程，接收数据后，从物理层到应用层，每达到一层，会把相应的头部信息拆除，数据链路层拆除MAC头部和尾部，网络层拆除IP头部，传输层拆除TCP头部</strong></p><p><img src="/../img/img_artical/net_sec/3.1.10.png" alt="3.1.10"></p><h2 id="物理层解析"><a href="#物理层解析" class="headerlink" title="物理层解析"></a>物理层解析</h2><h3 id="物理层概述"><a href="#物理层概述" class="headerlink" title="物理层概述"></a>物理层概述</h3><p><strong>物理层是TCP&#x2F;IP模型的最底层</strong></p><p><strong>物理层为数据传输提供稳定的物理连接</strong></p><h3 id="物理层功能"><a href="#物理层功能" class="headerlink" title="物理层功能"></a>物理层功能</h3><ul><li>定义设备的物理连接的标准和特性，比如接口形状，大小</li><li>定义电气特性，高低电压、传输速率和传输距离</li><li>构建数据通道，通过物理接口和传输介质来进行数据传输</li><li>物理层核心就是“信号和介质“</li></ul><h3 id="物理层传输介质"><a href="#物理层传输介质" class="headerlink" title="物理层传输介质"></a>物理层传输介质</h3><p><strong>有线介质</strong></p><ul><li>双绞线</li><li>光纤</li></ul><p><strong>无线介质</strong></p><ul><li>微波</li><li>激光</li><li>红外线</li></ul><p><strong>超五类线缆</strong></p><ul><li>局域网环境，最常见线缆</li><li>线缆外表有清晰“米标”</li><li>适用于100Mbps网络</li></ul><p><strong>6类线缆</strong></p><ul><li>增加十字骨架，抗干扰</li><li>适用于1000Mbps网络</li></ul><p><strong>7类和8类线缆</strong></p><ul><li>7类速率10Gbps</li><li>8类速率40Gbps</li></ul><p><strong>水晶头</strong></p><p><img src="/../img/img_artical/net_sec/3.1.11.png" alt="3.1.11"></p><p><strong>布线套装</strong></p><p><img src="/../img/img_artical/net_sec/3.1.12.png" alt="3.1.12"></p><p><strong>光纤</strong></p><ul><li>光纤按光在其中的传输模式可分为单模和多模</li></ul><p><strong>单模光纤</strong></p><ul><li>可支持1G~40Gb&#x2F;100Gb，距离200KM</li><li>适合用于长距离传输、可用于室内和室外</li></ul><p><strong>多模光纤</strong></p><ul><li>可支持1G~40Gb&#x2F;100Gb高速网络</li><li>适合用于短距离传输，通常用于室内</li></ul><p><strong>布线套装</strong></p><p><img src="/../img/img_artical/net_sec/3.1.13.png" alt="3.1.13"></p><h2 id="网线制作"><a href="#网线制作" class="headerlink" title="网线制作"></a>网线制作</h2><h3 id="制作双绞线"><a href="#制作双绞线" class="headerlink" title="制作双绞线"></a>制作双绞线</h3><p><strong>剥线</strong></p><ul><li>将双绞线的一端插入网线的剥线口 (末端离刀口长度约3-5厘米)，握住网线缓慢旋转一圈，去掉外部的套层，可看到相互缠绕的8根芯线</li><li>注意:不要割断金属芯线</li></ul><p><strong>理线</strong></p><ul><li>将裸露的8根双绞线分开，按照标准线序捋直排列好，并用网线钳将末端剪齐，保留1.2厘米左右</li></ul><p><img src="/../img/img_artical/net_sec/3.1.14.png" alt="3.1.14"></p><p><strong>排列好的每条芯线分别对应RJ-45水晶头的1-8针脚</strong></p><ul><li>T568B(白橙、橙、白绿、蓝、白蓝、绿、白棕、棕)</li><li>T568A(白绿、绿、白橙、蓝、白蓝、橙、白棕、棕)</li></ul><p><img src="/../img/img_artical/net_sec/3.1.15.png" alt="3.1.15"></p><p><strong>压线头</strong></p><ul><li>将整理好的双绞线芯线平稳捏住 (末端保持整齐)，插入到RJ-45水晶接头中(塑料卡扣朝下，开口朝向网线)确保8根芯线都顶到最里端的铜触片位置</li></ul><p><img src="/../img/img_artical/net_sec/3.1.16.png" alt="3.1.16"></p><p><strong>压线</strong></p><ul><li>将接好线的水晶头放到网线钳的压线口内 (注意要捏住网线，往里顶紧)，然后握住网线钳使劲压紧(线与线头不能有松动)，以确保水晶头的铜触片嵌入双绞线的芯线</li></ul><p><img src="/../img/img_artical/net_sec/3.1.17.png" alt="3.1.17"></p><p><strong>制作双绞线的另一端</strong></p><ul><li>依次剥线、理线、压线头，操作与前面一样</li><li>两端都压制好以后，一根网线就制作完工</li></ul><h3 id="测试双绞线"><a href="#测试双绞线" class="headerlink" title="测试双绞线"></a>测试双绞线</h3><p><strong>测试双绞线的连通性</strong></p><ul><li>将做好的双绞线两端分别插入测试仪的RJ-45接口，打开测试仪的电源开关，观察指示灯以判断网线连通性</li></ul><p><img src="/../img/img_artical/net_sec/3.1.18.png" alt="3.1.18"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全6</title>
      <link href="/posts/winsec6.html"/>
      <url>/posts/winsec6.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="PE急救工具盘"><a href="#PE急救工具盘" class="headerlink" title="PE急救工具盘"></a>PE急救工具盘</h2><h3 id="什么是PE工具箱"><a href="#什么是PE工具箱" class="headerlink" title="什么是PE工具箱"></a>什么是PE工具箱</h3><p><strong>基于WindowsPE制作，包含大量工具软件的U盘&#x2F;光盘系统</strong></p><ul><li>磁盘分区、分区调整、分区格式化</li><li>系统安装、系统备份和还原</li><li>修改密码、数据恢复</li></ul><p><strong>注: 网上的PE工具箱大同小异，以微PE为例</strong></p><h3 id="制作WinPE工具箱"><a href="#制作WinPE工具箱" class="headerlink" title="制作WinPE工具箱"></a>制作WinPE工具箱</h3><p><strong>制作</strong></p><ul><li>安装PE到U盘</li><li>安装PE到移动硬盘</li><li>生成可启动ISO</li></ul><p><img src="/../img/img_artical/net_sec/2.6.1.png" alt="2.6.1"></p><h2 id="重置Win密码"><a href="#重置Win密码" class="headerlink" title="重置Win密码"></a>重置Win密码</h2><h3 id="清除Windows登录密码"><a href="#清除Windows登录密码" class="headerlink" title="清除Windows登录密码"></a>清除Windows登录密码</h3><p><strong>如果忘记Windows开机密码</strong></p><ul><li>win7&#x2F;8&#x2F;10&#x2F;2012&#x2F;2016&#x2F;2019等全系列</li></ul><p><strong>原理</strong></p><ul><li>PE启动，修改密码文件C: Windows System32 config SAM</li></ul><p><strong>操作</strong></p><ul><li>NTPWEdit</li><li>清空密码&#x2F;设置新密码</li></ul><p><img src="/../img/img_artical/net_sec/2.6.2.png" alt="2.6.2"></p><h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><h3 id="分区大小调整"><a href="#分区大小调整" class="headerlink" title="分区大小调整"></a>分区大小调整</h3><p><strong>Win磁盘管理的压缩卷、扩展卷只能对“右侧”操作</strong></p><ul><li>压缩只能“释放”到右侧</li><li>基本磁盘扩展只能“合并”右侧空间</li></ul><p><strong>傲梅分区助手、DiskGenius</strong></p><ul><li>快速分区</li><li>自由调整分区大小</li></ul><p><img src="/../img/img_artical/net_sec/2.6.3.png" alt="2.6.3"></p><h2 id="系统备份与恢复"><a href="#系统备份与恢复" class="headerlink" title="系统备份与恢复"></a>系统备份与恢复</h2><h3 id="系统备份"><a href="#系统备份" class="headerlink" title="系统备份"></a>系统备份</h3><p><strong>WIM是英文Microsoft Windowslmaging Format(WIM)的简称，它是Windows基于文件的映像格式</strong></p><ul><li>一个文件中可以存储多个映像</li><li>可以离线维护映像</li><li>支持压缩</li></ul><p><strong>CGI备份还原工具</strong></p><ul><li>创建WIM备份</li></ul><p><img src="/../img/img_artical/net_sec/2.6.4.png" alt="2.6.4"></p><h3 id="系统恢复"><a href="#系统恢复" class="headerlink" title="系统恢复"></a>系统恢复</h3><p><strong>从WIM文件恢复</strong></p><p><img src="/../img/img_artical/net_sec/2.6.5.png" alt="2.6.5"></p><h2 id="制作U启动盘"><a href="#制作U启动盘" class="headerlink" title="制作U启动盘"></a>制作U启动盘</h2><h3 id="U启动程序"><a href="#U启动程序" class="headerlink" title="U启动程序"></a>U启动程序</h3><p><strong>下载制作U启程序</strong></p><ul><li>Ventov是一个制作可启动U盘的开源工具，只需要把ISO等类型的文件拷贝到U盘里面就可以启动了</li><li>同时支持x86LegacyBIOS、x86_64UEFI模式</li><li>支持Windows、Linux等操作系统</li></ul><h3 id="运行U启程序"><a href="#运行U启程序" class="headerlink" title="运行U启程序"></a>运行U启程序</h3><p><strong>制作U盘启动盘</strong></p><ul><li>确认电脑已插上U盘后，并且事先备份U盘数据内容</li><li>双击“Ventoy2Disk”运行</li></ul><h3 id="准备ISO镜像文件"><a href="#准备ISO镜像文件" class="headerlink" title="准备ISO镜像文件"></a>准备ISO镜像文件</h3><p><strong>复制操作系统ISO镜像文件到U盘</strong></p><p><img src="/../img/img_artical/net_sec/2.6.6.png" alt="2.6.6"></p><h3 id="引导方式"><a href="#引导方式" class="headerlink" title="引导方式"></a>引导方式</h3><p><strong>引导方式</strong></p><ul><li>BIOS，基本输入输出系统，Windows7及以前操作系统</li><li>UEFI，统一的可扩展固件接口，Windows8及以后操作系统</li></ul><p><strong>设置的方法</strong></p><ul><li>开机后根据提示操作，通常为 Del键或F2键</li></ul><h3 id="物理机进入“引导菜单”"><a href="#物理机进入“引导菜单”" class="headerlink" title="物理机进入“引导菜单”"></a>物理机进入“引导菜单”</h3><p><strong>插入U盘</strong></p><p><strong>进入”引导菜单”</strong></p><ul><li>根据提示按F12键进入</li><li>注:不同电脑按键可能不一样</li></ul><h3 id="物理机U盘启动计算机"><a href="#物理机U盘启动计算机" class="headerlink" title="物理机U盘启动计算机"></a>物理机U盘启动计算机</h3><p><strong>选择U盘引导</strong></p><ul><li>可以根据U盘的型号或容量判断</li></ul><p><strong>在Ventoy界面选中Windows 10ISO镜像</strong></p><p><img src="/../img/img_artical/net_sec/2.6.7.png" alt="2.6.7"></p><p><strong>出现”Pressany key to boot…”时，按回车或空格键</strong></p><p><strong>进入安装界面</strong></p><p><img src="/../img/img_artical/net_sec/2.6.8.png" alt="2.6.8"></p><h2 id="U启安装Win10系统"><a href="#U启安装Win10系统" class="headerlink" title="U启安装Win10系统"></a>U启安装Win10系统</h2><h3 id="虚拟机进入“引导菜单”"><a href="#虚拟机进入“引导菜单”" class="headerlink" title="虚拟机进入“引导菜单”"></a>虚拟机进入“引导菜单”</h3><p><strong>打开Windows10虚拟机</strong></p><p><strong>插入U盘</strong></p><p><img src="/../img/img_artical/net_sec/2.6.9.png" alt="2.6.9"></p><h3 id="虚拟机U盘启动计算机"><a href="#虚拟机U盘启动计算机" class="headerlink" title="虚拟机U盘启动计算机"></a>虚拟机U盘启动计算机</h3><p><strong>重新启动虚拟机，进入引导菜单</strong></p><ul><li>按Ctrl+Alt+Insert键重启</li><li>重启后，不停按ESC键</li></ul><p><strong>注:不要””关机再开机”的方式启动</strong></p><p><img src="/../img/img_artical/net_sec/2.6.10.png" alt="2.6.10"></p><p><strong>在Ventoy界面选中Windows 10ISO镜像</strong></p><p><img src="/../img/img_artical/net_sec/2.6.11.png" alt="2.6.11"></p><p><strong>进入安装界面</strong></p><p><img src="/../img/img_artical/net_sec/2.6.12.png" alt="2.6.12"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全5</title>
      <link href="/posts/winsec5.html"/>
      <url>/posts/winsec5.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="活动目录与域概述"><a href="#活动目录与域概述" class="headerlink" title="活动目录与域概述"></a>活动目录与域概述</h2><h3 id="域和域控制器"><a href="#域和域控制器" class="headerlink" title="域和域控制器"></a>域和域控制器</h3><p><strong>工作组</strong></p><ul><li>特点：地位平等、管理分散，没有实现集中管理</li><li>默认工作组名：WORKGROUP</li><li>工作组环境下创建的用户称为本地用户，本地用户是本地创建、本地存储、本地登录且只能登录本地一台计算机</li></ul><p><strong>域（Domain）</strong></p><ul><li>集中管理网络中多台计算机的一种逻辑模式</li><li>有别于工作组的对等式管理</li><li>是组织与存储资源的核心管理单元</li></ul><p><strong>域控制器（Domain Controller）</strong></p><ul><li>每个域中至少有一台域控制器</li><li>集中存放整个域的用户账号和安全数据库</li></ul><h3 id="活动目录的概念"><a href="#活动目录的概念" class="headerlink" title="活动目录的概念"></a>活动目录的概念</h3><p><strong>活动目录（Active Directory）</strong></p><ul><li>Windows网络中的目录服务</li><li>提供了存储网络对象信息并使网络用户使用这些数据的方法</li></ul><p><strong>活动目录特点</strong></p><ul><li>集中管理、便捷的网络资源（用户&#x2F;组账号、共享文件夹、打印机）访问</li><li>可扩展性</li></ul><h2 id="创建AD域网络"><a href="#创建AD域网络" class="headerlink" title="创建AD域网络"></a>创建AD域网络</h2><h3 id="升级域控的条件"><a href="#升级域控的条件" class="headerlink" title="升级域控的条件"></a>升级域控的条件</h3><ul><li>安装者必须具有本地管理员权限</li><li>操作系统版本必须为Windows Server版</li><li>本地磁盘至少有一个分区为NTFS文件系统</li><li>静态TCP&#x2F;IP设置（IP地址、子网掩码等）</li><li>有相应的DNS服务器支持</li><li>有足够的可用磁盘空间</li></ul><h3 id="安装第一台域控制器"><a href="#安装第一台域控制器" class="headerlink" title="安装第一台域控制器"></a>安装第一台域控制器</h3><p><strong>推荐步骤</strong></p><ul><li>设置网络环境和主机名</li><li>Active Directory域服务</li><li>提升为域控制器</li><li>在新林中新建域</li><li>林功能级别</li><li>设置目录服务还原模式的Administrator密码</li><li>安装</li></ul><h3 id="设置网络参数和主机名"><a href="#设置网络参数和主机名" class="headerlink" title="设置网络参数和主机名"></a>设置网络参数和主机名</h3><p><strong>配置域控制器网络环境</strong></p><p><img src="/../img/img_artical/net_sec/2.5.1.png" alt="2.5.1"></p><h3 id="添加活动目录"><a href="#添加活动目录" class="headerlink" title="添加活动目录"></a>添加活动目录</h3><p><strong>添加Active Directory域服务</strong></p><p><img src="/../img/img_artical/net_sec/2.5.2.png" alt="2.5.2"></p><h3 id="活动目录安装向导"><a href="#活动目录安装向导" class="headerlink" title="活动目录安装向导"></a>活动目录安装向导</h3><p><strong>添加新林、输入域名</strong></p><p><img src="/../img/img_artical/net_sec/2.5.3.png" alt="2.5.3"></p><p><strong>林级别及目录服务还原密码</strong></p><p><img src="/../img/img_artical/net_sec/2.5.4.png" alt="2.5.4"></p><p><strong>安装</strong></p><p><img src="/../img/img_artical/net_sec/2.5.5.png" alt="2.5.5"></p><h2 id="加入域网络"><a href="#加入域网络" class="headerlink" title="加入域网络"></a>加入域网络</h2><h3 id="客户计算机加入域"><a href="#客户计算机加入域" class="headerlink" title="客户计算机加入域"></a>客户计算机加入域</h3><p><strong>配置客户端网络环境</strong></p><p><img src="/../img/img_artical/net_sec/2.5.6.png" alt="2.5.6"></p><p><strong>设置 “计算机名&#x2F;域更改”</strong></p><p><img src="/../img/img_artical/net_sec/2.5.7.png" alt="2.5.7"></p><p><strong>输入域用户账户名</strong></p><p><img src="/../img/img_artical/net_sec/2.5.8.png" alt="2.5.8"></p><p><strong>确认域成员身份</strong></p><p><img src="/../img/img_artical/net_sec/2.5.9.png" alt="2.5.9"></p><h2 id="域用户管理"><a href="#域用户管理" class="headerlink" title="域用户管理"></a>域用户管理</h2><h3 id="创建域用户账户"><a href="#创建域用户账户" class="headerlink" title="创建域用户账户"></a>创建域用户账户</h3><p><strong>域用户账户存储在活动目录数据库中</strong></p><p><strong>创建域用户的工具</strong></p><p><img src="/../img/img_artical/net_sec/2.5.10.png" alt="2.5.10"></p><p><strong>显示名</strong></p><ul><li>在同一组织单位（OU）内应唯一</li></ul><p><strong>用户登录名</strong></p><ul><li>在整个域唯一</li><li>最长20字符</li></ul><h3 id="配置域用户账户属性"><a href="#配置域用户账户属性" class="headerlink" title="配置域用户账户属性"></a>配置域用户账户属性</h3><ul><li>登录时间</li><li>登录到</li><li>账户过期</li></ul><p><img src="/../img/img_artical/net_sec/2.5.11.png" alt="2.5.11"></p><p><strong>登录时间</strong></p><ul><li>默认任意时间都能登录</li></ul><p><strong>登录到</strong></p><ul><li>可限制登录的计算机</li></ul><p><img src="/../img/img_artical/net_sec/2.5.12.png" alt="2.5.12"></p><h2 id="OU与组策略"><a href="#OU与组策略" class="headerlink" title="OU与组策略"></a>OU与组策略</h2><h3 id="组织单元（OU）"><a href="#组织单元（OU）" class="headerlink" title="组织单元（OU）"></a>组织单元（OU）</h3><p><strong>概念</strong></p><ul><li>容器：有效地组织活动目录对象</li></ul><p><strong>设计方式</strong></p><ul><li>基于部门的OU</li><li>基于地理位置的OU</li><li>基于对象类型的OU</li><li>OU的设计也可以是混合的</li></ul><h3 id="组策略的作用"><a href="#组策略的作用" class="headerlink" title="组策略的作用"></a>组策略的作用</h3><p><strong>组策略（一组策略的集合）</strong></p><ul><li>可以统一修改系统、设置程序</li><li>调整桌面环境、安全设置、自动执行脚本、软件分发</li></ul><p><strong>使用组策略可以：</strong></p><ul><li>对整个域设置组策略，可影响所有成员计算机和域用户的工作环境</li><li>对OU设置组策略，可影响该OU下的所有计算机和域用户的工作环境</li><li>降低布置用户和计算机环境的总费用，方便推行公司计算机使用规范及安全策略</li></ul><h3 id="组策略设置对象"><a href="#组策略设置对象" class="headerlink" title="组策略设置对象"></a>组策略设置对象</h3><p><strong>组策略的具体设置保存在GPO中</strong></p><p><strong>默认的2个GPO</strong></p><ul><li>默认域策略（Default Domain Policy）</li><li>默认域控制器策略（Default Domain Controller Policy）</li></ul><h3 id="计算机配置与用户配置"><a href="#计算机配置与用户配置" class="headerlink" title="计算机配置与用户配置"></a>计算机配置与用户配置</h3><p><img src="/../img/img_artical/net_sec/2.5.13.png" alt="2.5.13"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全4</title>
      <link href="/posts/winsec4.html"/>
      <url>/posts/winsec4.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="DNS概述"><a href="#DNS概述" class="headerlink" title="DNS概述"></a>DNS概述</h2><h3 id="什么是DNS"><a href="#什么是DNS" class="headerlink" title="什么是DNS"></a>什么是DNS</h3><p><strong>什么是DNS</strong></p><ul><li>DNS域名解析系统</li><li>TCP端口53</li></ul><p><strong>为什么需要DNS系统</strong></p><ul><li><a href="http://www.baidu.com与119.75.217.56，哪个更好记？">www.baidu.com与119.75.217.56，哪个更好记？</a></li><li>互联网中的114查号台&#x2F;导航员</li></ul><p><strong>DNS（Domain Name System，域名系统）的功能</strong></p><ul><li>正向解析：根据注册的域名查找对应的IP地址，名字  –&gt;  IP</li><li>反向解析：根据IP地址查找对应的注册域名（相对不常用），IP  –&gt;  名字</li></ul><p><strong>域名解决方案的演进</strong></p><ul><li>早期（本地，hosts文件）C:\Windows\System32\drivers\etc\hosts(主机名解析文件)</li><li>现在（DNS服务器，分布式解析库）</li></ul><p><img src="/../img/img_artical/net_sec/2.4.1.png" alt="2.4.1"></p><h3 id="域名空间结构"><a href="#域名空间结构" class="headerlink" title="域名空间结构"></a>域名空间结构</h3><p><strong>层次化命名</strong></p><p><img src="/../img/img_artical/net_sec/2.4.2.png" alt="2.4.2"></p><p><strong>常见顶级域名</strong></p><ul><li>组织域、国家&#x2F;地区域名</li></ul><table><thead><tr><th align="center">组织域</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center">gov</td><td align="center">政府机构</td></tr><tr><td align="center">com</td><td align="center">商业机构</td></tr><tr><td align="center">edu</td><td align="center">教育机构</td></tr><tr><td align="center">org</td><td align="center">民间团体组织</td></tr><tr><td align="center">net</td><td align="center">网络服务机构</td></tr><tr><td align="center">mil</td><td align="center">军事部门</td></tr><tr><td align="center">arpa</td><td align="center">反向域</td></tr></tbody></table><table><thead><tr><th align="center">国家&#x2F;地区域</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center">cn</td><td align="center">中国</td></tr><tr><td align="center">hk</td><td align="center">中国香港</td></tr><tr><td align="center">tw</td><td align="center">中国台湾</td></tr><tr><td align="center">us</td><td align="center">美国</td></tr><tr><td align="center">ru</td><td align="center">俄罗斯</td></tr><tr><td align="center">…</td><td align="center">其他</td></tr></tbody></table><h2 id="DNS原理及配置"><a href="#DNS原理及配置" class="headerlink" title="DNS原理及配置"></a>DNS原理及配置</h2><h3 id="查询过程及方式"><a href="#查询过程及方式" class="headerlink" title="查询过程及方式"></a>查询过程及方式</h3><p><strong>客户端  &#x3D;&gt;  缓存DNS  &#x3D;&gt;  权威DNS</strong></p><h3 id="DNS的查询方法"><a href="#DNS的查询方法" class="headerlink" title="DNS的查询方法"></a>DNS的查询方法</h3><p><strong>从查询方式分类</strong></p><ul><li>递归查询</li><li>迭代查询</li></ul><p><strong>从查询内容分类</strong></p><ul><li>正向查询：由域名查找IP地址</li><li>反向查询：由IP地址查找域名</li></ul><h2 id="安装DNS服务"><a href="#安装DNS服务" class="headerlink" title="安装DNS服务"></a>安装DNS服务</h2><h3 id="配置DNS服务"><a href="#配置DNS服务" class="headerlink" title="配置DNS服务"></a>配置DNS服务</h3><p><strong>提供DNS服务的必要条件</strong></p><ul><li>有固定的IP地址</li><li>安装并启动DNS服务</li><li>有区域文件，配置转发器，或者配置根提示</li></ul><h3 id="安装DNS服务器角色"><a href="#安装DNS服务器角色" class="headerlink" title="安装DNS服务器角色"></a>安装DNS服务器角色</h3><ul><li><p>确认服务器已设置固定IP地址（如192.168.10.10)</p></li><li><p>添加  DNS服务器  角色</p></li></ul><p><img src="/../img/img_artical/net_sec/2.4.3.png" alt="2.4.3"></p><h3 id="创建DNS区域"><a href="#创建DNS区域" class="headerlink" title="创建DNS区域"></a>创建DNS区域</h3><p><strong>使用DNS管理器</strong></p><ul><li>Win+R运行dnsmgmt.msc</li><li>新建区域</li></ul><h2 id="配置DNS域名解析"><a href="#配置DNS域名解析" class="headerlink" title="配置DNS域名解析"></a>配置DNS域名解析</h2><h3 id="配置DNS区域解析"><a href="#配置DNS区域解析" class="headerlink" title="配置DNS区域解析"></a>配置DNS区域解析</h3><p><strong>常见资源记录类别</strong></p><table><thead><tr><th align="center">资源记录</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">A（主机）</td><td align="center">此区域中某个“FQDN –&gt; IP地址”的记录</td></tr><tr><td align="center">PTR（指针）</td><td align="center">此区域中某个“IP地址 –&gt; FQDN”的记录</td></tr><tr><td align="center">CNAME（别名）</td><td align="center">将多个名字映射到同一个站点</td></tr></tbody></table><h3 id="DNS正向解析"><a href="#DNS正向解析" class="headerlink" title="DNS正向解析"></a>DNS正向解析</h3><p><strong>配置正向解析</strong></p><ul><li>右击区域名添加创建A记录</li><li>添加A记录内容“www –&gt;  192.168.10.10”</li></ul><h3 id="DNS功能测试"><a href="#DNS功能测试" class="headerlink" title="DNS功能测试"></a>DNS功能测试</h3><p><strong>准备网络环境</strong></p><ul><li>客户端与DNS服务器网络连通</li><li>将客户端首选DNS设为企业自建的DNS</li><li>使用nslookup查询并观察结果</li></ul><p><strong>域名解析测试</strong></p><ul><li>使用nslookup  域名（查询并观察结果）</li></ul><h2 id="IIS概述"><a href="#IIS概述" class="headerlink" title="IIS概述"></a>IIS概述</h2><h3 id="Web服务"><a href="#Web服务" class="headerlink" title="Web服务"></a>Web服务</h3><p><strong>Web服务概述</strong></p><ul><li>服务端：支持HTTP协议的网页提供程序</li><li>浏览器&#x2F;客户端：下载并按标记规范显示网页的浏览器程序</li><li>Http超文本传输协议，端口80</li></ul><p><img src="/../img/img_artical/net_sec/2.4.4.png" alt="2.4.4"></p><h3 id="如何获取网页资源"><a href="#如何获取网页资源" class="headerlink" title="如何获取网页资源"></a>如何获取网页资源</h3><p><strong>URL网页</strong></p><ul><li>Uniform Resource Locator，统一资源定位器</li><li>资源类别：&#x2F;&#x2F;服务器地址&#x2F;目录地址&#x2F;文件名，比如<ul><li><a href="https://www.baidu.com/">https://www.baidu.com/</a></li><li><a href="https://www.bilibili.com/video/BV1Tg4y1C7Sq">https://www.bilibili.com/video/BV1Tg4y1C7Sq</a></li></ul></li></ul><h3 id="常见Web服务端软件"><a href="#常见Web服务端软件" class="headerlink" title="常见Web服务端软件"></a>常见Web服务端软件</h3><ul><li>Microsoft IIS</li><li>Apache HTTP Server</li><li>Nginx</li></ul><h3 id="什么是IIS"><a href="#什么是IIS" class="headerlink" title="什么是IIS"></a>什么是IIS</h3><p><strong>Internet Information Service，互联网信息服务</strong></p><ul><li>微软提供的Web服务产品，集成在Windows操作系统中</li><li>可以通过图形管理工具配置Web&#x2F;FTP服务</li></ul><h2 id="创建WEB站点"><a href="#创建WEB站点" class="headerlink" title="创建WEB站点"></a>创建WEB站点</h2><h3 id="安装Web服务器角色"><a href="#安装Web服务器角色" class="headerlink" title="安装Web服务器角色"></a>安装Web服务器角色</h3><p><strong>服务器管理器</strong></p><ul><li>添加角色和功能</li><li>Web服务器（IIS）</li></ul><p><img src="/../img/img_artical/net_sec/2.4.5.png" alt="2.4.5"></p><h3 id="准备网页文件"><a href="#准备网页文件" class="headerlink" title="准备网页文件"></a>准备网页文件</h3><p>为网站准备网页资料</p><p><img src="/../img/img_artical/net_sec/2.4.6.png" alt="2.4.6"></p><h3 id="配置Web站点"><a href="#配置Web站点" class="headerlink" title="配置Web站点"></a>配置Web站点</h3><p><strong>使用IIS管理器</strong></p><ul><li>Win + R运行inetmgr即可</li></ul><p><img src="/../img/img_artical/net_sec/2.4.7.png" alt="2.4.7"></p><p><strong>创建Web站点</strong></p><ul><li>右击网站–添加网站</li><li>输入网站名，选择物理路径</li></ul><p><img src="/../img/img_artical/net_sec/2.4.8.png" alt="2.4.8"></p><p><strong>配置默认文档的优先级</strong></p><ul><li>即访问此网站目录时，IIS提供给浏览器的第一个文档</li><li>大多数网站将index.html作为首页</li></ul><h3 id="客户端浏览"><a href="#客户端浏览" class="headerlink" title="客户端浏览"></a>客户端浏览</h3><p><strong>http:&#x2F;&#x2F;服务器IP地址</strong></p><p><img src="/../img/img_artical/net_sec/2.4.9.png" alt="2.4.9"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全3</title>
      <link href="/posts/winsec3.html"/>
      <url>/posts/winsec3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="磁盘分区管理"><a href="#磁盘分区管理" class="headerlink" title="磁盘分区管理"></a>磁盘分区管理</h2><h3 id="磁盘的分区管理"><a href="#磁盘的分区管理" class="headerlink" title="磁盘的分区管理"></a>磁盘的分区管理</h3><p><strong>Win+R运行，执行  diskmgmt.msc  打开磁盘管理</strong></p><ul><li><p>右击分区  &#x3D;&gt;  格式化</p></li><li><p>格式化将清除卷上的所有数据</p></li></ul><h3 id="更改驱动器号"><a href="#更改驱动器号" class="headerlink" title="更改驱动器号"></a>更改驱动器号</h3><p><strong>更改驱动器盘符</strong></p><ul><li>使用驱动器号来表示并访问分区或卷</li></ul><h2 id="发布共享文件夹"><a href="#发布共享文件夹" class="headerlink" title="发布共享文件夹"></a>发布共享文件夹</h2><h3 id="Windows共享概述"><a href="#Windows共享概述" class="headerlink" title="Windows共享概述"></a>Windows共享概述</h3><p><strong>微软公司推出的网络文件&#x2F;打印机服务系统</strong></p><ul><li>可以将一台主机的资源分布给其他主机共用</li><li>共享&#x3D;资源复用</li></ul><p><strong>共享访问的优点</strong></p><ul><li>方便、快捷</li><li>相比光盘&#x2F;U盘不易受文件大小限制</li><li>可以实现访问控制权限</li></ul><h3 id="配置共享文件夹"><a href="#配置共享文件夹" class="headerlink" title="配置共享文件夹"></a>配置共享文件夹</h3><p><strong>右击文件夹  &#x3D;&gt;  共享  &#x3D;&gt;  添加用户  &#x3D;&gt;  分配权限</strong></p><h2 id="访问共享文件夹"><a href="#访问共享文件夹" class="headerlink" title="访问共享文件夹"></a>访问共享文件夹</h2><h3 id="通过UNC路径访问"><a href="#通过UNC路径访问" class="headerlink" title="通过UNC路径访问"></a>通过UNC路径访问</h3><p><strong>UNC（Universal Naming Convention）通用命名规则，快捷访问网络中资源</strong></p><p><strong>以下位置可输入UNC路径</strong></p><ul><li>资源管理器的地址栏</li><li>Win+r，运行框</li></ul><p><strong>UNC路径格式</strong></p><ul><li>\\服务器名\[共享名]</li><li>\\服务器IP\[共享名]</li></ul><h3 id="通过映射网络驱动器访问"><a href="#通过映射网络驱动器访问" class="headerlink" title="通过映射网络驱动器访问"></a>通过映射网络驱动器访问</h3><p><strong>把网络共享资源映射为网络驱动器（盘符），以简化访问步骤，常用于多频次访问场景</strong></p><p><strong>映射网络驱动器</strong></p><ul><li>右击  计算机  或  网络  </li><li>cmd运行，net  use  X:   \\服务器地址\共享名</li></ul><p><strong>断开网络驱动器</strong></p><ul><li>右击网络驱动器，选择  断开</li></ul><h2 id="共享资源管控"><a href="#共享资源管控" class="headerlink" title="共享资源管控"></a>共享资源管控</h2><h3 id="计算机管理-共享文件夹"><a href="#计算机管理-共享文件夹" class="headerlink" title="计算机管理-共享文件夹"></a>计算机管理-共享文件夹</h3><p><strong>管理共享文件夹</strong></p><ul><li>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  共享文件夹  &#x3D;&gt;  共享</li></ul><p><strong>监控及管理已连接的用户</strong></p><ul><li>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  共享文件夹  &#x3D;&gt;  会话</li></ul><p><strong>监控及管理被打开的文件</strong></p><ul><li>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  共享文件夹  &#x3D;&gt;  打开的文件</li></ul><h3 id="特殊共享"><a href="#特殊共享" class="headerlink" title="特殊共享"></a>特殊共享</h3><p><strong>特殊共享</strong></p><ul><li>系统自动建立的用于管理目的的共享文件夹</li></ul><p><strong>主要类别</strong></p><ul><li>Drive letter$</li><li>ADMIN$</li></ul><p><strong>隐藏共享</strong></p><ul><li>共享名$</li></ul><h2 id="FTP服务概述"><a href="#FTP服务概述" class="headerlink" title="FTP服务概述"></a>FTP服务概述</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><strong>FTP（File Transfer Protocol，文件传输协议）</strong></p><ul><li>是一种用于在网络上进行文件传输的协议</li><li>通俗说就是实现文件共享功能</li></ul><p><strong>基于C&#x2F;S架构的文档下载&#x2F;上传通信</strong></p><ul><li>FTP基于客户端-服务器模型，其中一个计算机作为FTP服务器，而其他计算机作为FTP客户端</li><li>服务端程序：提供文件存储和传输服务</li><li>客户端程序：通过连接到FTP服务器进行文件上传和下载</li></ul><h3 id="FTP服务组件"><a href="#FTP服务组件" class="headerlink" title="FTP服务组件"></a>FTP服务组件</h3><p><strong>Microsoft IIS</strong></p><ul><li>Internet Information Service，互联网信息服务</li><li>微软提供的Web&#x2F;FTP服务产品，集成在Windows操作系统中</li></ul><h2 id="部署FTP服务"><a href="#部署FTP服务" class="headerlink" title="部署FTP服务"></a>部署FTP服务</h2><h3 id="安装FTP服务软件"><a href="#安装FTP服务软件" class="headerlink" title="安装FTP服务软件"></a>安装FTP服务软件</h3><p><strong>安装核心组件</strong></p><ul><li>右击  此电脑  &#x3D;&gt;  管理  &#x3D;&gt;  管理  &#x3D;&gt;  添加角色和功能  &#x3D;&gt;  默认下一步  &#x3D;&gt;  …  &#x3D;&gt;  Web服务器（IIS）  &#x3D;&gt;  添加功能  &#x3D;&gt;  下一步…  &#x3D;&gt;  FTP服务  &#x3D;&gt;  安装</li></ul><p><img src="/../img/img_artical/net_sec/2.3.1.png" alt="2.3.1"></p><h3 id="添加FTP站点"><a href="#添加FTP站点" class="headerlink" title="添加FTP站点"></a>添加FTP站点</h3><p>添加FTP站点，指定站点名及根目录</p><p><img src="/../img/img_artical/net_sec/2.3.2.png" alt="2.3.2"></p><h3 id="FTP身份验证"><a href="#FTP身份验证" class="headerlink" title="FTP身份验证"></a>FTP身份验证</h3><p>FTP支持匿名登录和基本（认证）登录两种身份验证方式</p><ul><li>匿名登录允许用户以匿名身份登录FTP服务器，并访问公共文件</li><li>基本认证登录要求用户提供用户名和密码进行身份验证，只有通过验证的用户才能够访问受限文件</li><li>匿名身份验证，客户端通过资源管理器访问FTP直接登录</li><li>基本身份验证，客户端通过资源管理器访问FTP需输入用户名及密码</li></ul><h3 id="常用FTP客户端软件"><a href="#常用FTP客户端软件" class="headerlink" title="常用FTP客户端软件"></a>常用FTP客户端软件</h3><p>Windows资源管理器</p><ul><li>资源管理器地址栏输入ftp:&#x2F;&#x2F;服务器IP</li></ul><p>专用图形工具</p><ul><li>FileZilla Client、FlashFXP、LeapFTP、CuteFTP</li></ul><p>网页浏览器（仅下载）</p><ul><li>打开浏览器地址栏输入ftp:&#x2F;&#x2F;服务器IP</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全2</title>
      <link href="/posts/winsec2.html"/>
      <url>/posts/winsec2.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="安全基线概述"><a href="#安全基线概述" class="headerlink" title="安全基线概述"></a>安全基线概述</h2><h3 id="操作系统安全基线"><a href="#操作系统安全基线" class="headerlink" title="操作系统安全基线"></a>操作系统安全基线</h3><p><strong>安全基线</strong></p><ul><li>服务器安全基线是为了满足安全规范要求，服务器必须要达到的安全（最低）标准</li></ul><p><strong>主要有以下作用</strong></p><ul><li>设置口令复杂度策略，防止暴力破解密码</li><li>控制用户或文件权限，减少被攻击后的影响</li><li>最小化安装操作系统，防止不必要的服务带来的安全问题</li></ul><p><strong>基线范围</strong></p><ul><li>安全基线在银行、证券、运营商、互联网行业等信息安全领域的应用范围非常广泛</li></ul><p><strong>通常包含以下：</strong></p><ul><li>操作系统</li><li>网络设备</li><li>数据库</li></ul><h3 id="Windows系统安全配置"><a href="#Windows系统安全配置" class="headerlink" title="Windows系统安全配置"></a>Windows系统安全配置</h3><p><strong>安全配置</strong></p><ul><li>用户管理</li><li>密码策略管理</li><li>共享管理</li><li>文件权限管理</li><li>用户权限管理</li><li>日志审核管理</li><li>远程管理</li><li>其他安全选项</li></ul><h2 id="系统账户安全"><a href="#系统账户安全" class="headerlink" title="系统账户安全"></a>系统账户安全</h2><h3 id="本地安全策略"><a href="#本地安全策略" class="headerlink" title="本地安全策略"></a>本地安全策略</h3><p><strong>指的是为保护本计算机资源而配置的规则</strong></p><ul><li>账户策略：密码策略和账户锁定策略</li><li>本地策略：审核策略、用户权限分配、安全选项</li></ul><h3 id="本地安全策略工具"><a href="#本地安全策略工具" class="headerlink" title="本地安全策略工具"></a>本地安全策略工具</h3><p><strong>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  本地安全策略</strong></p><p><img src="/../img/img_artical/net_sec/2.2.1.png" alt="2.2.1"></p><h3 id="账户策略"><a href="#账户策略" class="headerlink" title="账户策略"></a>账户策略</h3><p><strong>账户策略：控制用户账户如何与计算机交互</strong></p><ul><li>密码策略：确定密码的设置，如密码复杂度和密码长度等</li><li>账户锁定策略：确定账户锁定的条件和时间</li></ul><h3 id="密码策略"><a href="#密码策略" class="headerlink" title="密码策略"></a>密码策略</h3><p><strong>密码必须符合复杂性要求</strong></p><ul><li>不能包含用户的账户名</li><li>包含以下四类字符中的三类字符：大写字母（A到Z），小写字母（a到z），数字（0到9），非字母字符（例如!  $  #  %等）</li></ul><p><strong>密码最小值</strong></p><ul><li>取值范围0-14，0表示无限长度</li></ul><p><strong>密码最长使用期限</strong></p><ul><li>默认42天，取值范围0-999，0表示永不过期</li></ul><p><strong>密码最短使用期限</strong></p><ul><li>取值范围0-998，默认0表示无限制，随时可更改密码</li></ul><p><strong>强制密码历史</strong></p><ul><li>默认0表示历史曾经使用过的密码可以随便使用，取值范围0-24</li></ul><p><strong>测试密码破解的网址：<a href="https://www.security.org/how-secure-is-my-password/"><strong>https://www.security.org/how-secure-is-my-password/</strong></a></strong></p><h3 id="账户锁定策略"><a href="#账户锁定策略" class="headerlink" title="账户锁定策略"></a>账户锁定策略</h3><p><strong>配置账户锁定策略，防止暴力破解攻击</strong></p><p><strong>账户锁定时间</strong></p><ul><li>在自动解锁之前保持锁定的分钟数，取值范围0-99999,0表示永不自动解锁，只能由管理员手动解锁</li></ul><p><strong>账户锁定阈值</strong></p><ul><li>登录尝试失败的次数，取值范围0-999，默认0表示不锁定账户</li></ul><p><strong>重置账户锁定计数器</strong></p><ul><li>多长时间内累加失败次数</li></ul><h2 id="系统审核"><a href="#系统审核" class="headerlink" title="系统审核"></a>系统审核</h2><h3 id="审核策略"><a href="#审核策略" class="headerlink" title="审核策略"></a>审核策略</h3><p><strong>本地策略适用于计算机，包含以下策略：</strong></p><ul><li>审核策略：设置计算机上的安全日志中的日志记录</li><li>用户权限分配：设置用户和组的权限</li><li>安全选项：为计算机指定安全设置</li></ul><p><strong>配置以安全日志的方式记录安全相关事件</strong></p><ul><li>审核策略更改，记录对策略的修改事件</li><li>审核登录事件，记录用户登录成功或失败事件</li><li>审核账户管理，记录用户添加&#x2F;删除&#x2F;重命名&#x2F;禁用&#x2F;启用等事件</li></ul><h2 id="用户权限配置"><a href="#用户权限配置" class="headerlink" title="用户权限配置"></a>用户权限配置</h2><h3 id="用户权限分配"><a href="#用户权限分配" class="headerlink" title="用户权限分配"></a>用户权限分配</h3><p><strong>设置用户和组的权限</strong></p><ul><li>允许通过远程桌面服务登录</li><li>允许本地登录</li><li>拒绝本地登录</li><li>更改系统时间</li><li>备份文件和目录</li></ul><h2 id="安全选项配置"><a href="#安全选项配置" class="headerlink" title="安全选项配置"></a>安全选项配置</h2><h3 id="安全选项策略"><a href="#安全选项策略" class="headerlink" title="安全选项策略"></a>安全选项策略</h3><p><strong>本地策略  &#x3D;&gt;  安全选项</strong></p><ul><li>交互式登录：无需按Ctrl+Alt+Del，默认禁用</li><li>交互式登录：提示用户在密码过期之前更改密码，默认5天</li><li>交互式登录：不显示最后的用户名，默认禁用</li><li>关机：允许系统在未登录的情况下关闭，默认禁用</li></ul><h2 id="账户系统安全加固"><a href="#账户系统安全加固" class="headerlink" title="账户系统安全加固"></a>账户系统安全加固</h2><h3 id="Window账户"><a href="#Window账户" class="headerlink" title="Window账户"></a>Window账户</h3><p><strong>多用户系统</strong></p><ul><li>Windows不应只有一个管理员账户、应根据业备需求，设定不同的用户和用户组，如管理员账户、Web用户、数据库用户</li></ul><p><strong>定期检查用户，删除无用、过期的账户</strong></p><ul><li>应保证所有用户均为有效且在用</li></ul><p><strong>禁用Guest账户</strong></p><ul><li>系统应禁用Guest账户，Guest账户默认不开启</li></ul><h3 id="Windows账户管理"><a href="#Windows账户管理" class="headerlink" title="Windows账户管理"></a>Windows账户管理</h3><p><strong>账户管理</strong></p><ul><li>更改默认管理员账户名称（应更改默认管理员administrator的名称，防止暴力破解等问题）</li><li>不显示最后的用户名（用户登出后，下次登录时，不应显示上次登录用户的名称）</li></ul><p><strong>检测方法</strong></p><ul><li>控制面板  &#x3D;&gt;  系统和安全  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理</li><li>控制面板  &#x3D;&gt;  系统和安全  &#x3D;&gt;  管理工具  &#x3D;&gt;  本地安全策略</li></ul><h3 id="查看账户"><a href="#查看账户" class="headerlink" title="查看账户"></a>查看账户</h3><p><strong>查看系统当前账户</strong></p><ul><li>打开cmd查看当前账户</li><li>开始  &#x3D;&gt;  控制面板  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理，进入本地用户和组，查看用户</li><li>打开注册表，查看用户和组</li></ul><p><strong>以管理员登录，进入命令提示环境查看用户</strong></p><ul><li>运行cmd</li><li>net user</li></ul><p><strong>打开注册表查看用户</strong></p><ul><li>运行regedit</li><li>HKEY_LOCAL_MACHINE&#x2F;SAM&#x2F;SAM&#x2F;Domains&#x2F;Account&#x2F;Users&#x2F;</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全1</title>
      <link href="/posts/winsec1.html"/>
      <url>/posts/winsec1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="用户账户基础"><a href="#用户账户基础" class="headerlink" title="用户账户基础"></a>用户账户基础</h2><h3 id="用户账户概述"><a href="#用户账户概述" class="headerlink" title="用户账户概述"></a>用户账户概述</h3><p><strong>用户账户用来记录用户的用户名和口令、隶属的组等信息</strong></p><ul><li>每个用户账户包含唯一的登录名和对应的密码</li><li>不同的用户身份拥有不同的权限</li></ul><p><strong>操作系统根据SID识别不同用户</strong></p><ul><li>每个用户拥有唯一安全标识符（SID）</li><li>用户权限通过用户的SID来记录</li><li>查看命令为：whoami &#x2F;user</li></ul><p><img src="/../img/img_artical/net_sec/2.1.1.png" alt="2.1.1"></p><h3 id="本地用户和组控制台"><a href="#本地用户和组控制台" class="headerlink" title="本地用户和组控制台"></a>本地用户和组控制台</h3><p><strong>运行  lusrmgr.msc   ，直接打开   本地用户和组，</strong></p><ul><li>或者右击  开始  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  本地用户和组</li></ul><p><img src="/../img/img_artical/net_sec/2.1.2.png" alt="2.1.2"></p><h3 id="内置用户"><a href="#内置用户" class="headerlink" title="内置用户"></a>内置用户</h3><p><strong>Windows系统默认存在的系统</strong></p><ul><li>Administrator：管理员（权限最大）</li><li>Guest：来宾（权限最小），默认禁用</li></ul><p><font color="#ff0000"><strong>内置用户可以改名、禁用，但无法删除</strong></font></p><h2 id="用户账号操作"><a href="#用户账号操作" class="headerlink" title="用户账号操作"></a>用户账号操作</h2><h3 id="用户管理操作"><a href="#用户管理操作" class="headerlink" title="用户管理操作"></a>用户管理操作</h3><p><strong>创建新用户</strong></p><ul><li>右击空白处，选   新用户</li><li>指定用户名、密码及密码属性</li></ul><p><strong>账户属性</strong></p><ul><li><p>用户下次登录时须更改密码（每个员工创建不同帐户）</p></li><li><p>用户不能更改密码（用于公用帐户）</p></li><li><p>密码永不过期（默认42天）</p></li><li><p>帐户已禁用</p></li></ul><p><img src="/../img/img_artical/net_sec/2.1.3.png" alt="2.1.3"></p><p><strong>更改用户属性</strong></p><ul><li>常规属性、是否禁用、隶属于</li></ul><p><strong>设置密码</strong></p><ul><li>选中用户，右击选  设置密码</li></ul><p><img src="/../img/img_artical/net_sec/2.1.4.png" alt="2.1.4"></p><p><strong>重命名用户</strong></p><ul><li>适用于工作交接场合</li><li>由管理员将前任员工的账户改名</li></ul><p><strong>删除用户</strong></p><ul><li>适用于员工离职&#x2F;账户废止等场合</li></ul><p><font color="#ff0000"><strong>建议禁用账户而不是删除，若删除后重建同名账户，其SID值会不同</strong></font></p><h2 id="组账号基础"><a href="#组账号基础" class="headerlink" title="组账号基础"></a>组账号基础</h2><h3 id="组账户概述"><a href="#组账户概述" class="headerlink" title="组账户概述"></a>组账户概述</h3><p><strong>用来为多个用户批量授权</strong></p><ul><li>为一个组授予权限后，所有成员用户自动获得相应权限</li><li>用户加入一个组，自动获得此组的权限</li></ul><h3 id="创建新的组账号"><a href="#创建新的组账号" class="headerlink" title="创建新的组账号"></a>创建新的组账号</h3><p><strong>打开本地用户和组  &#x3D;&gt;  组  &#x3D;&gt;  右击  &#x3D;&gt;  新建组  &#x3D;&gt;  输入组名  &#x3D;&gt;  创建</strong></p><p><img src="/../img/img_artical/net_sec/2.1.5.png" alt="2.1.5"></p><h3 id="管理组成员"><a href="#管理组成员" class="headerlink" title="管理组成员"></a>管理组成员</h3><ul><li><p>双击本地组  &#x3D;&gt;  添加  &#x3D;&gt;  输入用户名  &#x3D;&gt;  确定  &#x3D;&gt;  确定</p></li><li><p>或者右击用户名  &#x3D;&gt;  属性  &#x3D;&gt;  隶属于  &#x3D;&gt;  输入组名  +&gt;  确定  &#x3D;&gt;  确定</p></li></ul><p><img src="/../img/img_artical/net_sec/2.1.6.png" alt="2.1.6"></p><h2 id="内置组账号管理"><a href="#内置组账号管理" class="headerlink" title="内置组账号管理"></a>内置组账号管理</h2><h3 id="内置组账号"><a href="#内置组账号" class="headerlink" title="内置组账号"></a>内置组账号</h3><p><strong>常用的内置组</strong></p><ul><li><p>Administrators:管理员组</p></li><li><p>Guests:来宾组</p></li><li><p>Network Configuration Operators：具有管理网络功能，例如更改IP地址</p></li><li><p>Backup Operators：具有备份和还原的权限</p></li><li><p>Remote Desktop Users：此组内用户可以从远程计算机使用远程桌面来连接</p></li><li><p>Print Operators：具有管理打印机的权限</p></li><li><p>Users:新用户默认组</p></li><li><p>Authenticated Users:任何有效登录的的用户都属于此组</p></li><li><p>Everyone:任何用户都属此组</p></li></ul><h2 id="NTFS权限基础"><a href="#NTFS权限基础" class="headerlink" title="NTFS权限基础"></a>NTFS权限基础</h2><h3 id="什么是文件系统"><a href="#什么是文件系统" class="headerlink" title="什么是文件系统"></a>什么是文件系统</h3><p><strong>基本作用</strong></p><ul><li>定义向磁盘上存文档的方法和数据结构，以及读文档的规则</li><li>格式化操作就是建新的文件系统</li></ul><p><strong>Windows常见的文件系统</strong></p><ul><li>FAT32，文件分配表</li><li>NTFS，新技术文件系统</li><li>ReFS，复原文件系统</li></ul><h3 id="NTFS文件系统的优点"><a href="#NTFS文件系统的优点" class="headerlink" title="NTFS文件系统的优点"></a>NTFS文件系统的优点</h3><ul><li>高读写：提高磁盘读写性能</li><li>可靠性：加密、访问控制列表</li><li>磁盘利用率：压缩、磁盘配额</li><li>大容量：最大可支持16EB</li><li>AD需要NTFS支持</li></ul><p><strong>如何获取NTFS文件系统的分区：</strong></p><ul><li>右击此电脑  &#x3D;&gt;  管理  &#x3D;&gt;  工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  磁盘管理  &#x3D;&gt;  格式化对应的分区</li></ul><h3 id="文件夹的NTFS权限"><a href="#文件夹的NTFS权限" class="headerlink" title="文件夹的NTFS权限"></a>文件夹的NTFS权限</h3><p><strong>目录操作权限</strong></p><ul><li>完全控制：可执行所有操作</li><li>修改：可修改、删除</li><li>读取和执行：可读取、执行</li><li>列出文件夹内容</li><li>读取：可读取内容</li><li>写入：可创建文件夹或者文件</li><li>特殊权限：调整“安全”设置的权限</li></ul><p><strong>文件操作权限</strong></p><ul><li>完全控制：可执行所有操作</li><li>修改：可修改、删除</li><li>读取和执行：可读取、执行</li><li>读取：可读取内容</li><li>写入：可创建文件夹或者文件</li><li>特殊权限：调整“安全”设置的权限</li></ul><p><strong><font color="ff0000">文件的NTFS权限与文件夹的NTFS权限对比少了一个列出文件夹内容的权限</font></strong></p><h2 id="NTFS权限应用规则"><a href="#NTFS权限应用规则" class="headerlink" title="NTFS权限应用规则"></a>NTFS权限应用规则</h2><h3 id="文档的NTFS选项设置"><a href="#文档的NTFS选项设置" class="headerlink" title="文档的NTFS选项设置"></a>文档的NTFS选项设置</h3><ul><li><p>右击指定的目录或文件  &#x3D;&gt;  属性  &#x3D;&gt;  安全  &#x3D;&gt;  编辑  &#x3D;&gt;  添加  &#x3D;&gt;  指定用户或组</p></li><li><p>确定后设置权限</p></li></ul><h3 id="权限累加"><a href="#权限累加" class="headerlink" title="权限累加"></a>权限累加</h3><p><strong>用户对文档的有效权限</strong></p><ul><li>等于用户的权限  +  用户所属各组的权限</li></ul><p><strong>累加权限示例</strong></p><ul><li>用户huangrong同时属于taohuadao和gaibang组</li></ul><p><img src="/../img/img_artical/net_sec/2.1.7.png" alt="2.1.7"></p><h3 id="权限的拒绝"><a href="#权限的拒绝" class="headerlink" title="权限的拒绝"></a>权限的拒绝</h3><p><strong>可以为文档配置拒绝权限</strong></p><ul><li>拒绝权限优先，能够实现“一票否决”</li></ul><p><strong>拒绝权限示例</strong></p><ul><li>用户huangrong同时属于taohuadao和gaibang组</li></ul><p><img src="/../img/img_artical/net_sec/2.1.8.png" alt="2.1.8"></p><h3 id="权限继承"><a href="#权限继承" class="headerlink" title="权限继承"></a>权限继承</h3><p><strong>新建文件和子目录自动继承上一级目录的权限</strong></p><h3 id="取消继承"><a href="#取消继承" class="headerlink" title="取消继承"></a>取消继承</h3><p><strong>放弃从上一级目录继承的权限</strong></p><ul><li>右击文件  &#x3D;&gt;  属性  &#x3D;&gt;  安全  &#x3D;&gt;  高级  &#x3D;&gt;  禁用继承  &#x3D;&gt;  在弹出的提示中选择第一个  &#x3D;&gt;  确定  &#x3D;&gt;  编辑  &#x3D;&gt;  选择普通用户  &#x3D;&gt;  取消完全控制的勾选仅留读权限  &#x3D;&gt;  确定</li></ul><h3 id="强制继承"><a href="#强制继承" class="headerlink" title="强制继承"></a>强制继承</h3><p><strong>使子目录及文档立即继承当前文件夹的权限</strong></p><ul><li>右击目录  &#x3D;&gt;  属性  &#x3D;&gt;  安全  &#x3D;&gt;  高级  &#x3D;&gt;  勾选禁用继承下的复选框  &#x3D;&gt;  是  &#x3D;&gt;  确定</li></ul><p><font color="#ff0000"><strong>注：下级取消继承后上级目录可以强制继承，上级目录强制继承后下级目录还可以再次取消继承</strong></font></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础4</title>
      <link href="/posts/netbase4.html"/>
      <url>/posts/netbase4.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础4"><a href="#网络应用基础4" class="headerlink" title="网络应用基础4"></a>网络应用基础4</h1><h2 id="Windows概述"><a href="#Windows概述" class="headerlink" title="Windows概述"></a>Windows概述</h2><h3 id="什么是操作系统"><a href="#什么是操作系统" class="headerlink" title="什么是操作系统"></a>什么是操作系统</h3><p><strong>Operation System，操作系统</strong></p><ul><li>是一套用来管理硬件与软件资源的程序</li><li>主要控制CPU处理器、内存、硬盘，操作文件系统的读取和写入</li><li>为用户提供一个与硬件&#x2F;软件交互的操作界面</li></ul><p><img src="/../img/img_artical/net_sec/1.4.1.png" alt="1.4.1"></p><h3 id="Windows系统分类"><a href="#Windows系统分类" class="headerlink" title="Windows系统分类"></a>Windows系统分类</h3><p><strong>适用于个人电脑</strong></p><ul><li>Windows 7&#x2F;8&#x2F;10&#x2F;11</li></ul><p><strong>适用于服务器</strong></p><ul><li>Windows Server 2008&#x2F;2012&#x2F;2016&#x2F;2019</li></ul><h3 id="Windows版本"><a href="#Windows版本" class="headerlink" title="Windows版本"></a>Windows版本</h3><p><strong>个人电脑系列</strong></p><ul><li>Windows 10 家庭版&#x2F;专业版&#x2F;企业版&#x2F;教育版</li></ul><p><strong>适用于服务器</strong></p><ul><li>Windows Server 2019 标准版&#x2F;数据中心版</li></ul><h3 id="选用Windows服务器的理由"><a href="#选用Windows服务器的理由" class="headerlink" title="选用Windows服务器的理由"></a>选用Windows服务器的理由</h3><ul><li>易操作</li><li>易部署</li><li>适合中小企业或局域网环境</li></ul><h2 id="虚拟化技术"><a href="#虚拟化技术" class="headerlink" title="虚拟化技术"></a>虚拟化技术</h2><h3 id="什么是虚拟化"><a href="#什么是虚拟化" class="headerlink" title="什么是虚拟化"></a>什么是虚拟化</h3><p><strong>通过软件技术来模拟更多的设备资源</strong></p><ul><li>1个物理设备&#x3D;&gt;n个虚拟设备</li></ul><p><img src="/../img/img_artical/net_sec/1.4.2.png" alt="1.4.2"></p><h3 id="虚拟化实现条件"><a href="#虚拟化实现条件" class="headerlink" title="虚拟化实现条件"></a>虚拟化实现条件</h3><p><strong>支持虚拟化的CPU处理器</strong></p><ul><li>Intel-VT、AMD-V</li></ul><p><strong>内存足够支撑运行多个虚拟机</strong></p><ul><li>建议不少于16GB</li></ul><p><strong>虚拟化平台软件</strong></p><h3 id="常见的虚拟化软件产品"><a href="#常见的虚拟化软件产品" class="headerlink" title="常见的虚拟化软件产品"></a>常见的虚拟化软件产品</h3><p><strong>主要厂商及产品</strong></p><table><thead><tr><th align="center">系列</th><th align="center">PC版</th><th align="center">企业版</th></tr></thead><tbody><tr><td align="center">VMware</td><td align="center">VMware Workstation</td><td align="center">VMware vSphere</td></tr><tr><td align="center">Microsoft</td><td align="center">VirtualPC</td><td align="center">Hyper-V</td></tr><tr><td align="center">RedHat</td><td align="center">KVM</td><td align="center">RHEV</td></tr><tr><td align="center">Oracle</td><td align="center">VM VirtualBox</td><td align="center">VM Server</td></tr></tbody></table><h3 id="安装VMware-Workstation"><a href="#安装VMware-Workstation" class="headerlink" title="安装VMware Workstation"></a>安装VMware Workstation</h3><p><strong>从VMware官网获取Workstation Pro安装文件</strong></p><ul><li><a href="https://www.vmware.com/cn.html">https://www.vmware.com/cn.html</a></li></ul><p><strong>双击安装文件，根据提示安装</strong></p><h3 id="创建新虚拟机"><a href="#创建新虚拟机" class="headerlink" title="创建新虚拟机"></a>创建新虚拟机</h3><ul><li><p>创建虚拟机安装目录（E:\虚拟机\Win10-1）</p></li><li><p>创建裸机</p></li><li><p>文件 &#x3D;&gt; 新建虚拟机 &#x3D;&gt; 自定义（高级）&#x3D;&gt; 下一步 &#x3D;&gt; 稍后安装操作系统 &#x3D;&gt; 下一步 &#x3D;&gt; 客户机操作系统 &#x3D;&gt; 选择Windows 10 X64 &#x3D;&gt; 下一步 &#x3D;&gt; 虚拟机名输入win10-1 &#x3D;&gt; 位置选择（E:\虚拟机\Win10-1）&#x3D;&gt; 下一步 &#x3D;&gt; 固件类型选择UEFI &#x3D;&gt; 下一步 &#x3D;&gt; 下一步 &#x3D;&gt; 输入内存2048M &#x3D;&gt; 下一步 &#x3D;&gt; 磁盘大小输入500G &#x3D;&gt; 将虚拟磁盘存储为单个文件 &#x3D;&gt; 下一步 &#x3D;&gt; 下一步 &#x3D;&gt; 完成</p></li></ul><h2 id="Win10系统安装"><a href="#Win10系统安装" class="headerlink" title="Win10系统安装"></a>Win10系统安装</h2><h3 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h3><p><strong>镜像光盘放光驱</strong></p><ul><li>双击CD&#x2F;DVD-浏览-选择系统镜像文件</li></ul><p><strong>Win10系统的硬件要求</strong></p><ul><li>CPU处理器：1.0Hhz或更快</li><li>启动内存：2GB（64位）</li><li>硬盘空间：不少于20GB（64位），建议100GB及以上</li></ul><h3 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h3><p><strong>点击启动按钮进入安装向导</strong></p><ul><li>出现如下提示，将鼠标点击到虚拟机内并按回车</li></ul><p><img src="/../img/img_artical/net_sec/1.4.3.png" alt="1.4.3"></p><p><strong>配置安装过程</strong></p><ul><li><p>下一步 &#x3D;&gt; 现在安装 &#x3D;&gt; 我接受许可条款 &#x3D;&gt; 下一步 &#x3D;&gt; 自定义 &#x3D;&gt; 新建 &#x3D;&gt; 输入102400MB &#x3D;&gt; 应用 &#x3D;&gt; 确定 &#x3D;&gt; 选择未分配的空间再点新建 &#x3D;&gt; 输入102400MB &#x3D;&gt; 应用 &#x3D;&gt; 选择第一个100G分区 &#x3D;&gt; 下一步 &#x3D;&gt; 提示正在安装windows &#x3D;&gt; 等待安装完自动重启</p></li><li><p>区域设置选择中国 &#x3D;&gt; 是 &#x3D;&gt; 键盘布局选择微软拼音 &#x3D;&gt; 是 &#x3D;&gt; 跳过 &#x3D;&gt; 改为域加入 &#x3D;&gt; 输入用户名及密码（123456）&#x3D;&gt; 下一步 &#x3D;&gt; 再输入密码 &#x3D;&gt; 下一步 &#x3D;&gt; 自定义安全问题 &#x3D;&gt; 下一步 &#x3D;&gt; 否 &#x3D;&gt; 隐私设置全部关闭 &#x3D;&gt; 接受 &#x3D;&gt; 等待进入桌面环境。</p></li></ul><h3 id="设备驱动"><a href="#设备驱动" class="headerlink" title="设备驱动"></a>设备驱动</h3><p><strong>什么是硬件驱动？</strong></p><ul><li>能够让计算机的硬件充分发挥硬件性能，使硬件能够正常工作，我们把这样的程序称为硬件驱动。</li></ul><p><strong>安装虚拟工具（VMware Tools）</strong></p><ul><li><p>虚拟机菜单-安装VMware Tools</p></li><li><p>打开资源管理器-点击光驱驱动器盘符-双击setup64-下一步-下一步-安装-完成-是</p></li><li><p>安装完VMwareTools后显示效果可全屏显示</p></li><li><p>物理机文件复制或拖拽到虚拟机</p></li><li><p>虚拟机安装虚拟工具相当于物理机安装硬件驱动程序</p></li></ul><h2 id="虚拟化高级应用"><a href="#虚拟化高级应用" class="headerlink" title="虚拟化高级应用"></a>虚拟化高级应用</h2><h3 id="虚拟机快照"><a href="#虚拟机快照" class="headerlink" title="虚拟机快照"></a>虚拟机快照</h3><ul><li><p>为虚拟机的不同时间点记录数据备份</p></li><li><p>需要时可用来快速恢复虚拟机（类似于玩游戏时候的存档读档）</p></li><li><p>操作：虚拟机菜单 &#x3D;&gt; 快照 &#x3D;&gt; 拍摄快照 &#x3D;&gt; 输入快照名及描述信息</p></li></ul><p><strong>建议关机后做虚拟机快照，关机快照稳定、节省磁盘空间</strong></p><h2 id="配置IP地址"><a href="#配置IP地址" class="headerlink" title="配置IP地址"></a>配置IP地址</h2><h3 id="配置IP地址-默认网关"><a href="#配置IP地址-默认网关" class="headerlink" title="配置IP地址&#x2F;默认网关"></a>配置IP地址&#x2F;默认网关</h3><p><strong>设置 &#x3D;&gt; 网络和Internet &#x3D;&gt; 更改适配器设置 &#x3D;&gt; 双击”Ethernet0” &#x3D;&gt; 属性 &#x3D;&gt; 双击”Internet协议版本4”</strong></p><p><img src="/../img/img_artical/net_sec/1.4.4.png" alt="1.4.4"></p><h3 id="IP地址配置方式"><a href="#IP地址配置方式" class="headerlink" title="IP地址配置方式"></a>IP地址配置方式</h3><p><strong>静态配置IP地址</strong></p><ul><li>需管理员手动配置、配置IP地址任务量大、容易错误及冲突，适用于网络规模小，一般服务器配置静态固定IP地址</li></ul><p><strong>动态配置IP地址</strong></p><ul><li>自动获取IP地址，需要有DHCP服务器的支持，降低网络地址配置任务量，避免手动输入错误及冲突的几率</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础3</title>
      <link href="/posts/netbase3.html"/>
      <url>/posts/netbase3.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础3"><a href="#网络应用基础3" class="headerlink" title="网络应用基础3"></a>网络应用基础3</h1><h2 id="远程管理交换机"><a href="#远程管理交换机" class="headerlink" title="远程管理交换机"></a>远程管理交换机</h2><h3 id="配置IP地址"><a href="#配置IP地址" class="headerlink" title="配置IP地址"></a>配置IP地址</h3><p><strong>远程管理需要通过IP地址访问网络设备</strong></p><ul><li>交换机的端口默认无法配置IP地址</li><li>需要使用虚拟端口Vlanif 1</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 1                           //进入Vlanif 1虚拟接口</span></span><br><span class="line"><span class="attr">[SW1-Vlanif1]ip</span> <span class="string">address 192.168.1.1 24            //配置IP地址为192.168.1.1，子网掩码为24</span></span><br></pre></td></tr></table></figure><h3 id="配置远程登录密码"><a href="#配置远程登录密码" class="headerlink" title="配置远程登录密码"></a>配置远程登录密码</h3><p><strong>远程登录需要配置VTY接口</strong></p><ul><li><p>VTY是虚拟终端，是一种网络设备远程连接的方式</p></li><li><p>vty 0 4表示同时开启0-4五个会话，即可最多同时供五个用户进行连接</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">vty 0 4                                //进入用户接口VTY</span></span><br><span class="line"><span class="attr">[SW1-ui-vty0-4]set</span> <span class="string">authentication password cipher 123456   //配置密码为密文123456</span></span><br><span class="line"><span class="attr">[SW1-ui-vty0-4]user</span> <span class="string">privilege level 15                     //设置用户权限为15</span></span><br></pre></td></tr></table></figure><p><strong>用户等级权限如下：</strong></p><ul><li>0 参观，ping、tracert、telnet、display、quit等</li><li>1 监控，reboot、reset、undo、debugging等</li><li>2 系统配置，所有配置命令（管理级配置命令除外）</li><li>3<del>15，所有命令（4</del>15用于精细化权限管理）</li></ul><h3 id="远程连接测试"><a href="#远程连接测试" class="headerlink" title="远程连接测试"></a>远程连接测试</h3><p><strong>需要支持telnet的客户端软件</strong></p><ul><li><p>第三方软件，如SecureCRT、Putty、Xshell等</p></li><li><p>路由器&#x2F;交换机自带telnet命令</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW2&gt;telnet</span> <span class="string">192.168.1.1                                     //telnet + 目标主机IP地址</span></span><br><span class="line"><span class="attr">Trying</span> <span class="string">192.168.1.1 ...</span></span><br><span class="line"><span class="attr">Press</span> <span class="string">CTRL+K to abort</span></span><br><span class="line"><span class="attr">Connected</span> <span class="string">to 192.168.1.1 ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Login</span> <span class="string">authentication</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Password</span>:                                                  <span class="string">//输入密码</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">The max number of VTY users is 5, and the number</span></span><br><span class="line">      <span class="attr">of</span> <span class="string">current VTY users on line is 1.</span></span><br><span class="line">      <span class="attr">The</span> <span class="string">current login time is 2023-11-23 19:57:58.</span></span><br><span class="line"><span class="attr">&lt;SW1&gt;</span>                                                      <span class="string">//主机名已从SW2变为SW1</span></span><br></pre></td></tr></table></figure><h2 id="路由介绍"><a href="#路由介绍" class="headerlink" title="路由介绍"></a>路由介绍</h2><h3 id="什么是路由器"><a href="#什么是路由器" class="headerlink" title="什么是路由器"></a>什么是路由器</h3><p><strong>负责在不同网络之间转发数据的设备</strong></p><ul><li>路由器决定到达目标的路径</li><li>路由器也为直连网络的主机充当”网关”角色</li></ul><p><img src="/../img/img_artical/net_sec/1.3.1.png" alt="1.3.1"></p><p><strong>路由器是实现网络互连的核心设备</strong></p><h2 id="路由器工作原理"><a href="#路由器工作原理" class="headerlink" title="路由器工作原理"></a>路由器工作原理</h2><h3 id="路由器工作原理简述"><a href="#路由器工作原理简述" class="headerlink" title="路由器工作原理简述"></a>路由器工作原理简述</h3><p><strong>每台路由器维护一份路由表，路由表记录着：</strong></p><ul><li>要访问XX网段应从哪个接口发送数据</li><li>可到达的下一个路由器（主机）的地址</li></ul><p><strong>路由器如何工作？</strong></p><ul><li><p>路由器接收数据包</p></li><li><p>检查数据包中的目标IP</p></li><li><p>在路由表中查找与目标IP相匹配的路由条目</p></li><li><p>路由表中找到与目标IP相匹配的路由条目后，按照此条目所指的方向将数据转发出去</p></li></ul><p><img src="/../img/img_artical/net_sec/1.3.2.png" alt="1.3.2"></p><h2 id="路由表基本配置"><a href="#路由表基本配置" class="headerlink" title="路由表基本配置"></a>路由表基本配置</h2><h3 id="配置设备名、接口地址"><a href="#配置设备名、接口地址" class="headerlink" title="配置设备名、接口地址"></a>配置设备名、接口地址</h3><p><strong>配置设备名（sysname）</strong></p><p><strong>配置接口地址（ip address IP地址 子网掩码）</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;u</span> <span class="string">t m                                         //取消终端提示消息</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.                </span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span>                                   <span class="string">//进入系统视图</span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]sysname</span> <span class="string">R1                                    //将路由器改名为R1</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0                   //进入GE0/0/0端口</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.254 24  //配置IP地址为192.168.1.254 子网掩码为255.255.255.0</span></span><br></pre></td></tr></table></figure><h3 id="保存路由器配置"><a href="#保存路由器配置" class="headerlink" title="保存路由器配置"></a>保存路由器配置</h3><p><strong>保存路由器配置（save）</strong></p><ul><li>大多数通用操作与交换机配置相同</li></ul><p></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;save</span></span><br><span class="line">  <span class="attr">The</span> <span class="string">current configuration will be written to the device. </span></span><br><span class="line">  <span class="attr">Are</span> <span class="string">you sure to continue? (y/n)[n]:y                              //提示配置将被写入设备，是否继续，输入y继续</span></span><br><span class="line">  <span class="attr">It</span> <span class="string">will take several minutes to save configuration file, please wait.......</span></span><br><span class="line">  <span class="attr">Configuration</span> <span class="string">file had been saved successfully</span></span><br><span class="line">  <span class="attr">Note</span>: <span class="string">The configuration file will take effect after being activated</span></span><br><span class="line"><span class="attr">&lt;R1&gt;</span></span><br></pre></td></tr></table></figure><h2 id="直连路由"><a href="#直连路由" class="headerlink" title="直连路由"></a>直连路由</h2><h3 id="什么是直连路由"><a href="#什么是直连路由" class="headerlink" title="什么是直连路由"></a>什么是直连路由</h3><p><strong>直连路由是指路由器接口所连接的网络段</strong></p><h3 id="路由器组网示例"><a href="#路由器组网示例" class="headerlink" title="路由器组网示例"></a>路由器组网示例</h3><p><strong>多网段互连</strong></p><ul><li>教学部、市场部各自有独立网段，如何实现互连？</li></ul><p><img src="/../img/img_artical/net_sec/1.3.3.png" alt="1.3.3"></p><p><strong>PC1配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.4.png" alt="1.3.4"></p><p><strong>PC2配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.5.png" alt="1.3.5"></p><p><strong>PC3配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.6.png" alt="1.3.6"></p><p><strong>PC4配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.7.png" alt="1.3.7"></p><p><strong>路由器R1配置：</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;u</span> <span class="string">t m</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]sysname</span> <span class="string">R1</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.2.254 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.1.254 24</span></span><br></pre></td></tr></table></figure><p><strong>验证连通性：PC1 ping PC2、PC3、PC4</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PC&gt;ping</span> <span class="string">192.168.1.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Ping</span> <span class="string">192.168.1.2: 32 data bytes, Press Ctrl_C to break</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.1.2: bytes=32 seq=1 ttl=128 time=47 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.1.2: bytes=32 seq=2 ttl=128 time=31 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.1.2: bytes=32 seq=3 ttl=128 time=31 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">---</span> <span class="string">192.168.1.2 ping statistics ---</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) transmitted</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) received</span></span><br><span class="line">  <span class="attr">0.00%</span> <span class="string">packet loss</span></span><br><span class="line">  <span class="attr">round-trip</span> <span class="string">min/avg/max = 31/36/47 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PC&gt;ping</span> <span class="string">192.168.2.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Ping</span> <span class="string">192.168.2.1: 32 data bytes, Press Ctrl_C to break</span></span><br><span class="line"><span class="attr">Request</span> <span class="string">timeout!</span></span><br><span class="line"><span class="attr">Request</span> <span class="string">timeout!</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.1: bytes=32 seq=3 ttl=127 time=62 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.1: bytes=32 seq=4 ttl=127 time=63 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.1: bytes=32 seq=5 ttl=127 time=62 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">---</span> <span class="string">192.168.2.1 ping statistics ---</span></span><br><span class="line">  <span class="attr">5</span> <span class="string">packet(s) transmitted</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) received</span></span><br><span class="line">  <span class="attr">40.00%</span> <span class="string">packet loss</span></span><br><span class="line">  <span class="attr">round-trip</span> <span class="string">min/avg/max = 0/62/63 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PC&gt;ping</span> <span class="string">192.168.2.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Ping</span> <span class="string">192.168.2.2: 32 data bytes, Press Ctrl_C to break</span></span><br><span class="line"><span class="attr">Request</span> <span class="string">timeout!</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.2: bytes=32 seq=2 ttl=127 time=47 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.2: bytes=32 seq=3 ttl=127 time=62 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">---</span> <span class="string">192.168.2.2 ping statistics ---</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) transmitted</span></span><br><span class="line">  <span class="attr">2</span> <span class="string">packet(s) received</span></span><br><span class="line">  <span class="attr">33.33%</span> <span class="string">packet loss</span></span><br><span class="line">  <span class="attr">round-trip</span> <span class="string">min/avg/max = 0/54/62 ms</span></span><br></pre></td></tr></table></figure><h3 id="查看路由表"><a href="#查看路由表" class="headerlink" title="查看路由表"></a>查看路由表</h3><p><strong>查看路由表 display ip routing-table</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table </span></span><br><span class="line"><span class="attr">Route</span> <span class="string">Flags: R - relay, D - download to fib</span></span><br><span class="line"><span class="attr">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">Routing</span> <span class="string">Tables: Public</span></span><br><span class="line">         <span class="attr">Destinations</span> : <span class="string">10       Routes : 10       </span></span><br><span class="line"></span><br><span class="line"><span class="attr">Destination/Mask</span>    <span class="string">Proto   Pre  Cost      Flags NextHop         Interface</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">127.0.0.0/8</span>   <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br><span class="line">      <span class="attr">127.0.0.1/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br><span class="line"><span class="attr">127.255.255.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br><span class="line">    <span class="attr">192.168.1.0/24</span>  <span class="string">Direct  0    0           D   192.168.1.254   GigabitEthernet0/0/1         </span></span><br><span class="line">    <span class="attr">//通往1.0网段找1.254地址，从0/0/1接口出去</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">192.168.1.254/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/1</span></span><br><span class="line">  <span class="attr">192.168.1.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/1</span></span><br><span class="line">    <span class="attr">192.168.2.0/24</span>  <span class="string">Direct  0    0           D   192.168.2.254   GigabitEthernet0/0/0        </span></span><br><span class="line">    <span class="attr">//通往2.0网段找2.254地址，从0/0/0接口出去</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">192.168.2.254/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/0</span></span><br><span class="line">  <span class="attr">192.168.2.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/0</span></span><br><span class="line"><span class="attr">255.255.255.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br></pre></td></tr></table></figure><h2 id="远程管理路由器"><a href="#远程管理路由器" class="headerlink" title="远程管理路由器"></a>远程管理路由器</h2><h3 id="配置远程登录"><a href="#配置远程登录" class="headerlink" title="配置远程登录"></a>配置远程登录</h3><p><strong>远程登录需要配置VTY接口</strong></p><ul><li><p>VTY是虚拟终端，是一种网络设备远程连接的方式</p></li><li><p>vty 0 4表示同时开启0-4五个会话，即可最多同时供五个用户进行连接</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]user-interface</span> <span class="string">vty 0 4                                //进入用户接口VTY</span></span><br><span class="line"><span class="attr">[R1-ui-vty0-4]set</span> <span class="string">authentication password cipher 123456   //配置密码为密文123456</span></span><br><span class="line"><span class="attr">[R1-ui-vty0-4]user</span> <span class="string">privilege level 15                     //设置用户权限为15</span></span><br></pre></td></tr></table></figure><p><strong>用户等级权限如下：</strong></p><ul><li>0 参观，ping、tracert、telnet、display、quit等</li><li>1 监控，reboot、reset、undo、debugging等</li><li>2 系统配置，所有配置命令（管理级配置命令除外）</li><li>3<del>15，所有命令（4</del>15用于精细化权限管理）</li></ul><h3 id="远程连接测试-1"><a href="#远程连接测试-1" class="headerlink" title="远程连接测试"></a>远程连接测试</h3><p><strong>需要支持telnet的客户端软件</strong></p><ul><li><p>第三方软件，如SecureCRT、Putty、Xshell等</p></li><li><p>路由器&#x2F;交换机自带telnet命令</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;telnet</span> <span class="string">192.168.1.1                                     //telnet + 目标主机IP地址</span></span><br><span class="line"><span class="attr">Trying</span> <span class="string">192.168.1.1 ...</span></span><br><span class="line"><span class="attr">Press</span> <span class="string">CTRL+K to abort</span></span><br><span class="line"><span class="attr">Connected</span> <span class="string">to 192.168.1.1 ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Login</span> <span class="string">authentication</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Password</span>:                                                  <span class="string">//输入密码</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">The max number of VTY users is 5, and the number</span></span><br><span class="line">      <span class="attr">of</span> <span class="string">current VTY users on line is 1.</span></span><br><span class="line">      <span class="attr">The</span> <span class="string">current login time is 2023-11-23 19:57:58.</span></span><br><span class="line"><span class="attr">&lt;R1&gt;</span>                                                      <span class="string">//主机名已从SW1变为R1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础2</title>
      <link href="/posts/netbase2.html"/>
      <url>/posts/netbase2.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础2"><a href="#网络应用基础2" class="headerlink" title="网络应用基础2"></a>网络应用基础2</h1><h2 id="交换机介绍"><a href="#交换机介绍" class="headerlink" title="交换机介绍"></a>交换机介绍</h2><h3 id="什么是交换机"><a href="#什么是交换机" class="headerlink" title="什么是交换机"></a>什么是交换机</h3><p><strong>交换机，Switch</strong></p><ul><li>用于将多台计算机&#x2F;交换机连接到一起，组建网络</li><li>交换机负责为其中任意两台计算机提供独享线路进行通信</li><li>连接电脑组建局域网（组建局域网的主要设备）</li></ul><p><img src="/../img/img_artical/net_sec/1.2.1.png" alt="1.2.1"></p><h3 id="非网管型交换机"><a href="#非网管型交换机" class="headerlink" title="非网管型交换机"></a>非网管型交换机</h3><p><strong>也称为即插即用交换机</strong></p><ul><li>即插即用，无需（也不支持）对设备进行配置</li><li>使用简单、价格便宜（数百元）</li></ul><p><img src="/../img/img_artical/net_sec/1.2.2.png" alt="1.2.2"></p><h3 id="网管型交换机"><a href="#网管型交换机" class="headerlink" title="网管型交换机"></a>网管型交换机</h3><p><strong>也称为智能交换机</strong></p><ul><li>能够实现网段划分、流量控制等更多高级功能（隔离、限速、ACL、堆叠）</li><li>支持对设备做高级配置，价格也贵一些（数千元、数万元）</li></ul><p><img src="/../img/img_artical/net_sec/1.2.3.png" alt="1.2.3"></p><h2 id="部署eNSP平台"><a href="#部署eNSP平台" class="headerlink" title="部署eNSP平台"></a>部署eNSP平台</h2><h3 id="eNSP网络仿真平台介绍"><a href="#eNSP网络仿真平台介绍" class="headerlink" title="eNSP网络仿真平台介绍"></a>eNSP网络仿真平台介绍</h3><p><strong>华为研发的一款图形化网络仿真平台</strong></p><ul><li>便于ICT（信息通信技术）从业者快速熟悉华为产品</li><li>可以实现企业网络<strong>规划&#x2F;设计&#x2F;运维</strong>等相关操作，帮助使用者了解并掌握相关操作和配置</li></ul><h3 id="认识eNSP操作界面"><a href="#认识eNSP操作界面" class="headerlink" title="认识eNSP操作界面"></a>认识eNSP操作界面</h3><p><strong>拓扑绘制区</strong></p><p><strong>设备和线缆区</strong></p><p><img src="/../img/img_artical/net_sec/1.2.4.png" alt="1.2.4"></p><h2 id="交换机组网"><a href="#交换机组网" class="headerlink" title="交换机组网"></a>交换机组网</h2><h3 id="网路拓扑介绍"><a href="#网路拓扑介绍" class="headerlink" title="网路拓扑介绍"></a>网路拓扑介绍</h3><p><strong>教学部网段 192.168.1.0&#x2F;24</strong></p><ul><li>计算机pc1-1：IP地址192.168.1.1，掩码255.255.255.0</li><li>计算机pc1-2：IP地址192.168.1.2，掩码255.255.255.0</li><li>……</li></ul><p><img src="/../img/img_artical/net_sec/1.2.1.png" alt="1.2.5"></p><h3 id="绘制拓扑"><a href="#绘制拓扑" class="headerlink" title="绘制拓扑"></a>绘制拓扑</h3><p><strong>按照图例绘制简化版eNSP拓扑</strong></p><ul><li>1台交换机、2台PC机、2条网线</li><li>为方便识别，对每个设备、计算机重新命名</li></ul><p><img src="/../img/img_artical/net_sec/1.2.6.png" alt="1.2.6"></p><h3 id="交换组网的配置实现"><a href="#交换组网的配置实现" class="headerlink" title="交换组网的配置实现"></a>交换组网的配置实现</h3><p><strong>配置计算机PC1-1及PC1-2的IP地址及子网掩码</strong></p><p><img src="/../img/img_artical/net_sec/1.2.7.png" alt="1.2.7"></p><p><strong>结果验证</strong></p><ul><li><p>确认交换机LSW1、计算机PC1-1和PC1-2都已启动</p></li><li><p>从PC1-1能ping通PC1-2的IP地址，反之亦然</p></li></ul><p><img src="/../img/img_artical/net_sec/1.2.8.png" alt="1.2.8"></p><h2 id="交换机配置视图"><a href="#交换机配置视图" class="headerlink" title="交换机配置视图"></a>交换机配置视图</h2><h3 id="建立配置连接"><a href="#建立配置连接" class="headerlink" title="建立配置连接"></a>建立配置连接</h3><p><strong>软件连接：Putty、ServerCRT、Xshell等</strong></p><p><strong>硬件连接</strong></p><ul><li>计算机COM&#x2F;USB口 &#x3D;&gt; Console线 &#x3D;&gt; 交换机Console口</li></ul><p><img src="/../img/img_artical/net_sec/1.2.9.png" alt="1.2.9"></p><h3 id="几种命令行配置视图"><a href="#几种命令行配置视图" class="headerlink" title="几种命令行配置视图"></a>几种命令行配置视图</h3><p><strong>华为交换机内部是华为VRP（Versatile Routing Platform，通用路由平台）网络操作系统，该系统也用在路由器、防火墙等产品上</strong></p><p><img src="/../img/img_artical/net_sec/1.2.10.png" alt="1.2.10"></p><h3 id="切换不同视图"><a href="#切换不同视图" class="headerlink" title="切换不同视图"></a>切换不同视图</h3><p><strong>进入命令行终端时默认在用户视图，此时通过命令可切换视图</strong></p><ul><li>通过system-view、interface命令进行切换</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;</span>                                        <span class="string">//用户视图</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span>                             <span class="string">//切换系统视图</span></span><br><span class="line"><span class="attr">[Huawei]</span>                                        <span class="string">//系统视图</span></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">GigabitEthernet 0/0/1         //切换接口视图</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/1]</span>                   <span class="string">//接口视图</span></span><br></pre></td></tr></table></figure><p><strong>视图回退操作</strong></p><ul><li>退回到前一个视图：quit命令</li><li>快速返回到用户视图：return命令，或快捷键Ctrl + Z</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/1]quit</span>     <span class="string">//返回上一个视图</span></span><br><span class="line"><span class="attr">[Huawei]</span></span><br><span class="line"><span class="attr">[Huawei]return</span>  <span class="string">//快速返回用户视图</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;</span></span><br></pre></td></tr></table></figure><h3 id="操作技巧"><a href="#操作技巧" class="headerlink" title="操作技巧"></a>操作技巧</h3><p><strong>命令行特性</strong></p><ul><li>命令可简写</li><li>按TAB键自动补全</li><li>按？能获取帮助信息</li><li>命令不区分大小写</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">//TAB补全</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;sys</span>                                       <span class="string">//按TAB补全</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]</span></span><br><span class="line"><span class="attr">//?获取帮助信息</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;sy?</span></span><br><span class="line">  <span class="attr">system-view</span>         <span class="string"></span></span><br><span class="line"><span class="attr">//简写</span>  <span class="string"></span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;sy</span>                                         <span class="string">//按回车</span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">//不区分大小写</span>    <span class="string"></span></span><br><span class="line"><span class="attr">[Huawei]QUIT</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;</span></span><br></pre></td></tr></table></figure><h2 id="命令行基本操作"><a href="#命令行基本操作" class="headerlink" title="命令行基本操作"></a>命令行基本操作</h2><h3 id="查看VRP系统版本"><a href="#查看VRP系统版本" class="headerlink" title="查看VRP系统版本"></a>查看VRP系统版本</h3><p><strong>display version命令</strong></p><ul><li>可显示系统版本、设备型号、已开机时间</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;display</span> <span class="string">version </span></span><br><span class="line"><span class="attr">Huawei</span> <span class="string">Versatile Routing Platform Software</span></span><br><span class="line"><span class="attr">VRP</span> <span class="string">(R) software, Version 5.110 (S5700 V200R001C00)           //系统版本、设备型号</span></span><br><span class="line"><span class="attr">Copyright</span> <span class="string">(c) 2000-2011 HUAWEI TECH CO., LTD</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Quidway</span> <span class="string">S5700-28C-HI Routing Switch uptime is 0 week, 0 day, 0 hour, 40 minutes      //开机时间</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;</span></span><br></pre></td></tr></table></figure><h3 id="查看当前交换机的配置"><a href="#查看当前交换机的配置" class="headerlink" title="查看当前交换机的配置"></a>查看当前交换机的配置</h3><p><strong>查看当前有效配置（display current-configuration）</strong></p><p><strong>查看当前视图配置（display this）</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;display</span> <span class="string">current-configuration                    //全部配置信息</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">sysname</span> <span class="string">Huawei</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">cluster</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ntdp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ndp</span> <span class="string">enable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">..........</span></span><br><span class="line"><span class="attr">..........</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">this                                     //查看当前视图配置</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">sysname</span> <span class="string">Huawei</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">cluster</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ntdp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ndp</span> <span class="string">enable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">drop</span> <span class="string">illegal-mac alarm</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="配置设备名"><a href="#配置设备名" class="headerlink" title="配置设备名"></a>配置设备名</h3><p><strong>sysname命令</strong></p><ul><li><p>作用：可以在众多交换机中区分出来</p></li><li><p>命名规范：部门、位置、机架编号</p></li><li><p>需要在系统视图下执行</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]sysname</span> <span class="string">SW1                              //将设备名改为SW1</span></span><br><span class="line"><span class="attr">[SW1]</span></span><br></pre></td></tr></table></figure><h3 id="保存交换机的配置"><a href="#保存交换机的配置" class="headerlink" title="保存交换机的配置"></a>保存交换机的配置</h3><p><strong>保存当前配置（save）</strong></p><ul><li>需要在用户视图下执行</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;save</span></span><br><span class="line"><span class="attr">The</span> <span class="string">current configuration will be written to the device.</span></span><br><span class="line"><span class="attr">Are</span> <span class="string">you sure to continue?[Y/N]y                           //输入y确认</span></span><br><span class="line"><span class="attr">Save</span> <span class="string">the configuration successfully.  //保存成功</span></span><br></pre></td></tr></table></figure><h3 id="启用-禁用端口"><a href="#启用-禁用端口" class="headerlink" title="启用&#x2F;禁用端口"></a>启用&#x2F;禁用端口</h3><p><strong>默认自动开启，可以手动关闭以排查网络故障</strong></p><p><strong>在指定接口视图下</strong></p><ul><li>执行shutdown命令可以手动禁用此接口</li><li>执行undo shutdown命令可恢复启用此接口</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[SW1-GigabitEthernet0/0/1]shutdown</span>                   <span class="string">//关闭端口</span></span><br><span class="line"><span class="attr">[SW1-GigabitEthernet0/0/1]undo</span> <span class="string">shutdown              //启动端口</span></span><br></pre></td></tr></table></figure><p><strong>undo命令行一般用来恢复缺省状态、禁用某个功能或者删除某项配置</strong></p><h3 id="设置终端密码"><a href="#设置终端密码" class="headerlink" title="设置终端密码"></a>设置终端密码</h3><p><strong>默认交换机登录无需密码，为了安全需要添加认证密码</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">console 0                                  //进入用户接口console</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]authentication-mode</span> <span class="string">password                  //启用密码认证</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]set</span> <span class="string">authentication password simple 123456     //设置明文密码123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Login</span> <span class="string">authentication                                           //再次登录时需密码验证</span></span><br><span class="line"><span class="attr">Password</span>:<span class="string"></span></span><br><span class="line"><span class="attr">&lt;SW1&gt;</span></span><br></pre></td></tr></table></figure><p><strong>设置密码时需设置密码类型</strong></p><ul><li><p>simple为明文密码</p></li><li><p>cipher为密文密码</p></li><li><p>区别为明文密码在配置中可以看到，密文密码会被加密</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">console 0</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]display</span> <span class="string">this</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">con 0</span></span><br><span class="line"> <span class="attr">authentication-mode</span> <span class="string">password</span></span><br><span class="line"> <span class="attr">set</span> <span class="string">authentication password simple 123456                       //明文密码</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">return</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1-ui-console0]set</span> <span class="string">authentication password cipher 123456</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]display</span> <span class="string">this</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">con 0</span></span><br><span class="line"> <span class="attr">authentication-mode</span> <span class="string">password</span></span><br><span class="line"> <span class="attr">set</span> <span class="string">authentication password cipher O|*dXi\0b)`S/0Rb&#123;DzN8qg#    //密文密码</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">return</span></span><br></pre></td></tr></table></figure><h2 id="配置技巧"><a href="#配置技巧" class="headerlink" title="配置技巧"></a>配置技巧</h2><h3 id="取消终端提示消息"><a href="#取消终端提示消息" class="headerlink" title="取消终端提示消息"></a>取消终端提示消息</h3><p><strong>undo terminal monitor</strong></p><p><strong>配置命令会被终端界面一些提示消息打断，可以使用此命令关闭提示消息，只对当前终端有效，且重新登录时自动启动</strong></p><ul><li>只能在用户视图下配置<ul><li>初学者可以暂时取消这些提示消息</li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;undo</span> <span class="string">terminal monitor </span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.</span></span><br></pre></td></tr></table></figure><h3 id="更改自动退出超时"><a href="#更改自动退出超时" class="headerlink" title="更改自动退出超时"></a>更改自动退出超时</h3><p><strong>终端会话默认超过10分钟会自动退出</strong></p><ul><li>调试设备时可以延长超时时间</li><li>为了安全调试完毕后需设置短时间</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">console 0</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]idle-timeout</span> <span class="string">1440               //修改超时时间为1440分钟</span></span><br></pre></td></tr></table></figure><p><strong>如果设置为0的话则设备永不休眠</strong></p><h3 id="重启设备"><a href="#重启设备" class="headerlink" title="重启设备"></a>重启设备</h3><p><strong>reboot</strong></p><ul><li>在用户视图下执行，可重启当前设备</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;reboot</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">The system is now comparing the configuration, please wait.</span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">All the configuration will be saved to the configuration file for the n</span></span><br><span class="line"><span class="attr">ext</span> <span class="string">startup:flash:/vrpcfg.zip, Continue?[Y/N]:n                                       //如果交换机配置进行了修改则询问是否保存配置</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">If want to reboot with saving diagnostic information, input &#x27;N&#x27; and then e</span></span><br><span class="line"><span class="attr">xecute</span> <span class="string">&#x27;reboot save diagnostic-information&#x27;.</span></span><br><span class="line"><span class="attr">System</span> <span class="string">will reboot! Continue?[Y/N]:y                                                  //确认是否进行重启</span></span><br></pre></td></tr></table></figure><p><strong>如果重启前未对配置进行修改则不会进行第一次确认</strong></p><h3 id="恢复出厂设置"><a href="#恢复出厂设置" class="headerlink" title="恢复出厂设置"></a>恢复出厂设置</h3><p><strong>reset saved-configuration</strong></p><ul><li>用户视图下执行，适用于系统配置紊乱&#x2F;错误、修复不便等情况</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;reset</span> <span class="string">saved-configuration </span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">The action will delete the saved configuration in the device.</span></span><br><span class="line"><span class="attr">The</span> <span class="string">configuration will be erased to reconfigure. Continue? [Y/N]:y                  //提示恢复出厂设置将清空所有配置，是否继续</span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">Now clearing the configuration in the device.</span></span><br><span class="line"><span class="attr">Nov</span> <span class="string">23 2023 19:45:20-08:00 SW1 %%01CFM/4/RST_CFG(l)[0]:The user chose Y when dec</span></span><br><span class="line"><span class="attr">iding</span> <span class="string">whether to reset the saved configuration.</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Succeeded in clearing the configuration in the device.</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础1</title>
      <link href="/posts/netbase1.html"/>
      <url>/posts/netbase1.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础"><a href="#网络应用基础" class="headerlink" title="网络应用基础"></a>网络应用基础</h1><h2 id="TCP-IP协议及配置"><a href="#TCP-IP协议及配置" class="headerlink" title="TCP&#x2F;IP协议及配置"></a>TCP&#x2F;IP协议及配置</h2><h3 id="TCP-IP协议概述"><a href="#TCP-IP协议概述" class="headerlink" title="TCP&#x2F;IP协议概述"></a>TCP&#x2F;IP协议概述</h3><p><strong>TCP&#x2F;IP协议族</strong></p><ul><li>计算机之间进行通信时必须共同遵循的一种通信规定</li><li>最广泛使用的通信协议的集合</li><li>包含大量Internet应用中的标准协议</li><li>支持跨网络结构、跨操作系统平台的数据通信</li></ul><p><strong>主机与主机之间通信的三要素</strong></p><ul><li>IP地址</li><li>子网掩码</li><li>默认网关</li></ul><h3 id="什么是IP地址"><a href="#什么是IP地址" class="headerlink" title="什么是IP地址"></a>什么是IP地址</h3><p><strong>用来标识一个网络节点的互联网地址</strong></p><p><strong>IPV4地址的组成</strong></p><ul><li>地址长度：32位</li><li>网络位+主机位</li></ul><h3 id="IPV4地址表示方式"><a href="#IPV4地址表示方式" class="headerlink" title="IPV4地址表示方式"></a>IPV4地址表示方式</h3><p><strong>点分十进制</strong></p><ul><li>4个十进制数（0~255）表示，以点隔开</li></ul><p><img src="/../img/img_artical/net_sec/1.1.1.png" alt="1.1.1"></p><h3 id="IP地址分类-网络规模"><a href="#IP地址分类-网络规模" class="headerlink" title="IP地址分类(网络规模)"></a>IP地址分类(网络规模)</h3><p><strong>常用的IP地址</strong></p><ul><li>A类：0 ~ 127         超大型网络      <font color=#ff0000>网</font>.主.主.主</li><li>B类：128 ~ 191       大型网络        <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主.主</li><li>C类：192 ~ 223       中小型网络      <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主</li></ul><p><strong>组播及科研专用</strong></p><ul><li>D类：224 ~ 239       组播网络          </li><li>E类： 240 ~ 255       科研网络</li></ul><table><thead><tr><th>类别</th><th>IP范围</th></tr></thead><tbody><tr><td>A类</td><td><font color=#ff0000>0</font>.0.0.0 ~  <font color=#ff0000>127</font>.255.255.255</td></tr><tr><td>B类</td><td><font color=#ff0000>128</font>.<font color=#ff0000>0</font>.0.0 ~  <font color=#ff0000>191</font>.<font color=#ff0000>255</font>.255.255</td></tr><tr><td>C类</td><td><font color=#ff0000>192</font>.<font color=#ff0000>0</font>.<font color=#ff0000>0</font>.0 ~  <font color=#ff0000>223</font>.<font color=#ff0000>255</font>.<font color=#ff0000>255</font>.255</td></tr></tbody></table><h3 id="什么是子网掩码"><a href="#什么是子网掩码" class="headerlink" title="什么是子网掩码"></a>什么是子网掩码</h3><p><strong>判断IP地址的网络位，相同网络位的IP地址可以直接通信</strong></p><p><strong>不能单独存在，必须结合IP地址一起使用</strong></p><p><strong>默认子网掩码</strong></p><ul><li>A类：255.0.0.0        <font color=#ff0000>网</font>.主.主.主</li><li>B类：255.255.0.0      <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主.主</li><li>C类：255.255.255.0    <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主</li></ul><h3 id="默认网关"><a href="#默认网关" class="headerlink" title="默认网关"></a>默认网关</h3><p><strong>什么是网关</strong></p><ul><li><p>从一个网段连接另一个网段的”关口”</p></li><li><p>通常是一台路由器或者防火墙&#x2F;接入服务器的地址</p></li></ul><p><img src="/../img/img_artical/net_sec/1.1.2.png" alt="1.1.2"></p><h3 id="IP地址使用场景"><a href="#IP地址使用场景" class="headerlink" title="IP地址使用场景"></a>IP地址使用场景</h3><p><strong>根据使用范围区分：</strong></p><ul><li>公有地址：可以在互联网合法使用，需要向NIC付费申请，全球唯一</li><li>私有地址：预留给企业内部使用，无需付费，局域网唯一</li></ul><table><thead><tr><th align="center">类别</th><th align="center">私有IP范围</th></tr></thead><tbody><tr><td align="center">A类</td><td align="center"><font color="#ff0000">10</font>.0.0.0 ~ <font color="#ff0000">10</font>.255.255.255</td></tr><tr><td align="center">B类</td><td align="center"><font color="#ff0000">172.16</font>.0.0 ~ <font color="#ff0000">172.31</font>.255.255</td></tr><tr><td align="center">C类</td><td align="center"><font color="#ff0000">192.168</font>.0.0 ~ <font color="#ff0000">192.168</font>.255.255</td></tr></tbody></table><p><strong>注：所有的IP地址都由国际组织NIC(Network Information Center)负责统一分配，截止2019年11月26日,全球IPv4地址已经正式用尽了，128位的IPv6地址正在逐步普及。</strong></p><h3 id="查看IP地址参数"><a href="#查看IP地址参数" class="headerlink" title="查看IP地址参数"></a>查看IP地址参数</h3><p><strong>设置 &#x3D;&gt; 网络和Internet &#x3D;&gt; 以太网</strong></p><ul><li>找到”本地连接”或”Ethernet0”，打开即可查看</li></ul><p><img src="/../img/img_artical/net_sec/1.1.3.png" alt="1.1.3"></p><p><strong>Win + R键调出运行窗口，输入cmd打开命令窗口</strong></p><p><strong>执行ipconfig命令</strong></p><ul><li>获得IP地址、子网掩码、默认网关等信息</li><li>&#x2F;all选项可以查看更详细的DNS服务器、物理地址（MAC地址）等信息</li></ul><p><img src="/../img/img_artical/net_sec/1.1.4.png" alt="1.1.4"></p><h3 id="测试网络连通性"><a href="#测试网络连通性" class="headerlink" title="测试网络连通性"></a>测试网络连通性</h3><p><strong>ping命令</strong></p><ul><li>向目标主机发送数据包，根据反馈结果判断网络连通性。</li></ul><p><img src="/../img/img_artical/net_sec/1.1.5.png" alt="1.1.5"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
